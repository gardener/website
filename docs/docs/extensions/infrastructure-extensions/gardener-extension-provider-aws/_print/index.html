<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://gardener.cloud/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/><link rel=alternate type=application/rss+xml href=https://gardener.cloud/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Provider AWS | Gardener</title>
<meta name=description content="Gardener extension controller for the AWS cloud provider"><meta property="og:url" content="https://gardener.cloud/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/"><meta property="og:site_name" content="Gardener"><meta property="og:title" content="Provider AWS"><meta property="og:description" content="Gardener extension controller for the AWS cloud provider"><meta property="og:locale" content="en_US"><meta property="og:type" content="website"><meta property="og:image" content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta itemprop=name content="Provider AWS"><meta itemprop=description content="Gardener extension controller for the AWS cloud provider"><meta itemprop=wordCount content="407"><meta itemprop=image content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta name=twitter:title content="Provider AWS"><meta name=twitter:description content="Gardener extension controller for the AWS cloud provider"><link rel=preload href=/scss/main.min.52d93bcd446cd63373e35bf3f68b78c63f08370d066ccb303bdd0e25f237661c.css as=style integrity="sha256-Utk7zURs1jNz41vz9ot4xj8INw0GbMswO90OJfI3Zhw=" crossorigin=anonymous><link href=/scss/main.min.52d93bcd446cd63373e35bf3f68b78c63f08370d066ccb303bdd0e25f237661c.css rel=stylesheet integrity="sha256-Utk7zURs1jNz41vz9ot4xj8INw0GbMswO90OJfI3Zhw=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><style>.nav-link:hover{text-decoration:none}.ml-md-auto{margin-left:auto!important}.td-search__icon{color:#fff!important}.td-search__input.form-control::placeholder{color:#fff;border:1px;border-radius:20px}.td-search__input.form-control{border:1px;border-radius:20px}.td-search__input{max-width:90%}.td-search:not(:focus-within){color:#fff!important}</style><a class=navbar-brand href=/><span class=navbar-logo><svg width="90" height="90" viewBox="0 0 90 90" xmlns:xlink="http://www.w3.org/1999/xlink"><title>logo</title><desc>Created with Sketch.</desc><defs><path d="M41.8864954.994901575c.996545099999999-.479910833 2.6164002-.477918931 3.6088091.0L76.8159138 16.0781121C77.8124589 16.5580229 78.8208647 17.8257185 79.0659694 18.8995926l7.7355517 33.8916663C87.0476474 53.8696088 86.6852538 55.4484075 85.9984855 56.3095876L64.3239514 83.4885938C63.6343208 84.3533632 62.1740175 85.0543973 61.0725268 85.0543973H26.3092731c-1.1060816.0-2.5646564-.704623400000003-3.2514246-1.5658035L1.38331434 56.3095876C.693683723 55.4448182.335174016 53.865133.580278769 52.7912589L8.31583044 18.8995926C8.56195675 17.8212428 9.57347722 16.556031 10.5658861 16.0781121L41.8864954.994901575z" id="path-1"/><linearGradient x1="12.7542673%" y1="-18.6617048%" x2="88.2666158%" y2="84.6075483%" id="linearGradient-3"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="50%" y1="4.93673768%" x2="148.756007%" y2="175.514523%" id="linearGradient-4"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="19.1574381%" y1="-9.04800713%" x2="82.2203149%" y2="77.9084293%" id="linearGradient-5"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="57.4403751%" y1="26.3148481%" x2="137.966711%" y2="158.080556%" id="linearGradient-6"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="logo"><g id="Rectangle-2" transform="translate(1.000000, 0.000000)"><mask id="mask-2" fill="#fff"><use xlink:href="#path-1"/></mask><use id="Mask" fill="#009f76" xlink:href="#path-1"/><polygon fill="#000" opacity=".289628623" mask="url(#mask-2)" points="-17.6484375 54.5224609 30.8242188 25.0791016 63.4726562 58.5 24.7324219 92.6689453"/></g><path d="M56.8508631 39.260019C56.4193519 40.443987 55.6088085 41.581593 54.6736295 42.1938694l-8.0738997 5.2861089c-1.3854671.907087099999998-3.6247515.9116711-5.0172201.0L33.50861 42.1938694C32.123143 41.2867823 31 39.206345 31 37.545932V26.4150304c0-.725313.2131118-1.5301454.569268099999999-2.2825772L56.8508631 39.260019z" id="Combined-Shape" fill="url(#linearGradient-3)" transform="translate(43.925432, 36.147233) scale(-1, 1) translate(-43.925432, -36.147233)"/><path d="M56.0774672 25.1412464C56.4306829 25.8903325 56.6425556 26.6907345 56.6425556 27.4119019V38.5428034c0 1.6598979-1.1161415 3.73626640000001-2.50861 4.6479374l-8.0738997 5.286109c-1.3854671.907087000000004-3.6247516.911671000000005-5.0172201.0L32.9689261 43.1907408C32.2918101 42.7474223 31.6773514 42.0238435 31.2260376 41.206007L56.0774672 25.1412464z" id="Combined-Shape" fill="url(#linearGradient-4)" transform="translate(43.821278, 37.246598) scale(-1, 1) translate(-43.821278, -37.246598)"/><path d="M65.0702134 57.1846889C64.5985426 58.2007851 63.8367404 59.1236871 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.1597438 58.7930183 24 56.7816693 24 55.1323495V37.1145303C24 36.3487436 24.249712 35.5060005 24.6599102 34.7400631L65.0702134 57.1846889z" id="Combined-Shape" fill="url(#linearGradient-5)"/><path d="M65.0189476 34.954538C65.3636909 35.6617313 65.5692194 36.42021 65.5692194 37.1145303V55.1323495C65.5692194 56.7842831 64.4072119 58.7943252 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.9237304 59.2341061 25.3159155 58.5918431 24.8568495 57.8487596L65.0189476 34.954538z" id="Combined-Shape" fill="url(#linearGradient-6)"/></g></g></svg></span><span class=text-capitalize>Gardener</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://demo.gardener.cloud target=_blank><span>Demo</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/adopter><span>Adopters</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><div class=dropdown><a href=/docs class=nav-link>Documentation</a><div class=dropdown-content><a class=taxonomy-term href=/docs>Users</a>
<a class=taxonomy-term href=/docs>Operators</a>
<a class=taxonomy-term href=/docs>Developers</a>
<a class=taxonomy-term href=/docs>All</a></div></div></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog><span>Blogs</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community><span>Community</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.c5a2c98a9529c04eb8f8e383921421ad.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/>Return to the regular view of this page</a>.</p></div><h1 class=title>Provider AWS</h1><div class=lead>Gardener extension controller for the AWS cloud provider</div><div class=content><h1 id=gardener-extension-for-aws-providerhttpsgardenercloud><a href=https://gardener.cloud>Gardener Extension for AWS provider</a></h1><p><a href=https://api.reuse.software/info/github.com/gardener/gardener-extension-provider-aws><img src=https://api.reuse.software/badge/github.com/gardener/gardener-extension-provider-aws alt="REUSE status"></a>
<a href=https://concourse.ci.gardener.cloud/teams/gardener/pipelines/gardener-extension-provider-aws-master/jobs/master-head-update-job><img src=https://concourse.ci.gardener.cloud/api/v1/teams/gardener/pipelines/gardener-extension-provider-aws-master/jobs/master-head-update-job/badge alt="CI Build status"></a>
<a href=https://goreportcard.com/report/github.com/gardener/gardener-extension-provider-aws><img src=https://goreportcard.com/badge/github.com/gardener/gardener-extension-provider-aws alt="Go Report Card"></a></p><p>Project Gardener implements the automated management and operation of <a href=https://kubernetes.io/>Kubernetes</a> clusters as a service.
Its main principle is to leverage Kubernetes concepts for all of its tasks.</p><p>Recently, most of the vendor specific logic has been developed <a href=https://github.com/gardener/gardener>in-tree</a>.
However, the project has grown to a size where it is very hard to extend, maintain, and test.
With <a href=https://github.com/gardener/gardener/blob/master/docs/proposals/01-extensibility.md>GEP-1</a> we have proposed how the architecture can be changed in a way to support external controllers that contain their very own vendor specifics.
This way, we can keep Gardener core clean and independent.</p><p>This controller implements Gardener&rsquo;s extension contract for the AWS provider.</p><p>An example for a <code>ControllerRegistration</code> resource that can be used to register this controller to Gardener can be found <a href=https://github.com/gardener/gardener-extension-provider-aws/blob/master/example/controller-registration.yaml>here</a>.</p><p>Please find more information regarding the extensibility concepts and a detailed proposal <a href=https://github.com/gardener/gardener/blob/master/docs/proposals/01-extensibility.md>here</a>.</p><h2 id=supported-kubernetes-versions>Supported Kubernetes versions</h2><p>This extension controller supports the following Kubernetes versions:</p><table><thead><tr><th>Version</th><th>Support</th><th>Conformance test results</th></tr></thead><tbody><tr><td>Kubernetes 1.31</td><td>1.31.0+</td><td><a href=https://testgrid.k8s.io/conformance-gardener#Gardener,%20v1.31%20AWS><img src="https://testgrid.k8s.io/q/summary/conformance-gardener/Gardener,%20v1.31%20AWS/tests_status?style=svg" alt="Gardener v1.31 Conformance Tests"></a></td></tr><tr><td>Kubernetes 1.30</td><td>1.30.0+</td><td><a href=https://testgrid.k8s.io/conformance-gardener#Gardener,%20v1.30%20AWS><img src="https://testgrid.k8s.io/q/summary/conformance-gardener/Gardener,%20v1.30%20AWS/tests_status?style=svg" alt="Gardener v1.30 Conformance Tests"></a></td></tr><tr><td>Kubernetes 1.29</td><td>1.29.0+</td><td><a href=https://testgrid.k8s.io/conformance-gardener#Gardener,%20v1.29%20AWS><img src="https://testgrid.k8s.io/q/summary/conformance-gardener/Gardener,%20v1.29%20AWS/tests_status?style=svg" alt="Gardener v1.29 Conformance Tests"></a></td></tr><tr><td>Kubernetes 1.28</td><td>1.28.0+</td><td><a href=https://testgrid.k8s.io/conformance-gardener#Gardener,%20v1.28%20AWS><img src="https://testgrid.k8s.io/q/summary/conformance-gardener/Gardener,%20v1.28%20AWS/tests_status?style=svg" alt="Gardener v1.28 Conformance Tests"></a></td></tr><tr><td>Kubernetes 1.27</td><td>1.27.0+</td><td><a href=https://testgrid.k8s.io/conformance-gardener#Gardener,%20v1.27%20AWS><img src="https://testgrid.k8s.io/q/summary/conformance-gardener/Gardener,%20v1.27%20AWS/tests_status?style=svg" alt="Gardener v1.27 Conformance Tests"></a></td></tr><tr><td>Kubernetes 1.26</td><td>1.26.0+</td><td><a href=https://testgrid.k8s.io/conformance-gardener#Gardener,%20v1.26%20AWS><img src="https://testgrid.k8s.io/q/summary/conformance-gardener/Gardener,%20v1.26%20AWS/tests_status?style=svg" alt="Gardener v1.26 Conformance Tests"></a></td></tr><tr><td>Kubernetes 1.25</td><td>1.25.0+</td><td><a href=https://testgrid.k8s.io/conformance-gardener#Gardener,%20v1.25%20AWS><img src="https://testgrid.k8s.io/q/summary/conformance-gardener/Gardener,%20v1.25%20AWS/tests_status?style=svg" alt="Gardener v1.25 Conformance Tests"></a></td></tr></tbody></table><p>Please take a look <a href=/docs/gardener/shoot-operations/supported_k8s_versions/>here</a> to see which versions are supported by Gardener in general.</p><h2 id=compatibility>Compatibility</h2><p>The following lists known compatibility issues of this extension controller with other Gardener components.</p><table><thead><tr><th>AWS Extension</th><th>Gardener</th><th>Action</th><th>Notes</th></tr></thead><tbody><tr><td><code>&lt;= v1.15.0</code></td><td><code>>v1.10.0</code></td><td>Please update the provider version to <code>> v1.15.0</code> or disable the feature gate <code>MountHostCADirectories</code> in the Gardenlet.</td><td>Applies if feature flag <code>MountHostCADirectories</code> in the Gardenlet is enabled. Shoots with CSI enabled (Kubernetes version >= 1.18) miss a mount to the directory <code>/etc/ssl</code> in the Shoot API Server. This can lead to not trusting external Root CAs when the API Server makes requests via webhooks or OIDC.</td></tr></tbody></table><hr><h2 id=how-to-start-using-or-developing-this-extension-controller-locally>How to start using or developing this extension controller locally</h2><p>You can run the controller locally on your machine by executing <code>make start</code>.</p><p>Static code checks and tests can be executed by running <code>make verify</code>. We are using Go modules for Golang package dependency management and <a href=https://github.com/onsi/ginkgo>Ginkgo</a>/<a href=https://github.com/onsi/gomega>Gomega</a> for testing.</p><h2 id=feedback-and-support>Feedback and Support</h2><p>Feedback and contributions are always welcome. Please report bugs or suggestions as <a href=https://github.com/gardener/gardener-extension-provider-aws/issues>GitHub issues</a> or join our <a href=https://kubernetes.slack.com/messages/gardener>Slack channel #gardener</a> (please invite yourself to the Kubernetes workspace <a href=http://slack.k8s.io>here</a>).</p><h2 id=learn-more>Learn more!</h2><p>Please find further resources about out project here:</p><ul><li><a href=https://gardener.cloud/>Our landing page gardener.cloud</a></li><li><a href=https://kubernetes.io/blog/2018/05/17/gardener/>&ldquo;Gardener, the Kubernetes Botanist&rdquo; blog on kubernetes.io</a></li><li><a href=https://kubernetes.io/blog/2019/12/02/gardener-project-update/>&ldquo;Gardener Project Update&rdquo; blog on kubernetes.io</a></li><li><a href=https://github.com/gardener/gardener/blob/master/docs/proposals/01-extensibility.md>GEP-1 (Gardener Enhancement Proposal) on extensibility</a></li><li><a href=https://github.com/gardener/gardener/blob/master/docs/proposals/04-new-core-gardener-cloud-apis.md>GEP-4 (New <code>core.gardener.cloud/v1beta1</code> API)</a></li><li><a href=https://github.com/gardener/gardener/tree/master/docs/extensions>Extensibility API documentation</a></li><li><a href=https://godoc.org/github.com/gardener/gardener/extensions/pkg>Gardener Extensions Golang library</a></li><li><a href=https://gardener.cloud/api-reference/>Gardener API Reference</a></li></ul></div></div><div class=td-content style=page-break-before:always><h1 id=pg-979df175ce45dca2d78e2698ba76c8c2>1 - Tutorials</h1><h3 id=overview>Overview</h3><p>Gardener allows you to create a Kubernetes cluster on different infrastructure providers. This tutorial will guide you through the process of creating a cluster on AWS.</p><h3 id=prerequisites>Prerequisites</h3><ul><li>You have created an <a href=https://aws.amazon.com/>AWS account</a>.</li><li>You have access to the Gardener dashboard and have permissions to create projects.</li></ul><h3 id=steps>Steps</h3><ol><li><p>Go to the Gardener dashboard and create a <em>Project</em>.</p><img src=/__resources/new-gardener-project_ad03bc.png></li><li><p>Choose <em>Secrets</em>, then the plus icon <img src=/__resources/plus-icon_3b1f20.png> and select <em>AWS</em>.</p><img src=/__resources/create-secret-aws_79dc1a.png></li><li><p>To copy the policy for AWS from the Gardener dashboard, click on the help icon <img src=/__resources/help-icon_01486c.png> for AWS secrets, and choose copy <img src=/__resources/copy-icon_0f5ab8.png>.</p><img src=/__resources/gardener-copy-policy_a52965.png></li><li><p><a href=https://console.aws.amazon.com/iam/home?#/policies>Create a new policy</a> in AWS:</p><ol><li><p>Choose <em>Create policy</em>.</p><img src=/__resources/amazon-create-policy_5ef114.png></li><li><p>Paste the policy that you copied from the Gardener dashboard to this custom policy.</p><img src=/__resources/amazon-create-policy-json_7d6327.png></li><li><p>Choose <em>Next</em> until you reach the Review section.</p></li><li><p>Fill in the name and description, then choose <em>Create policy</em>.</p><img src=/__resources/amazon-review-policy_6fba71.png></li></ol></li><li><p><a href="https://console.aws.amazon.com/iam/home?#/users$new?step=details">Create a new technical user</a> in AWS:</p><ol><li><p>Type in a username and select the access key credential type.</p><img src=/__resources/add-user_775731.png></li><li><p>Choose <em>Attach an existing policy</em>.</p></li><li><p>Select <em>GardenerAccess</em> from the policy list.</p></li><li><p>Choose <em>Next</em> until you reach the Review section.</p></li></ol><img src=/__resources/attach-policy_a6a81f.png>
<img src=/__resources/finish-user_a9e956.png><div class="alert alert-info" role=alert><h4 class=alert-heading>Note</h4>Note: After the user is created, <code>Access key ID</code> and <code>Secret access key</code> are generated and displayed. Remember to save them. The <code>Access key ID</code> is used later to create secrets for Gardener.</div><img src=/__resources/save-keys_f23816.png></li><li><p>On the Gardener dashboard, choose <em>Secrets</em> and then the plus sign <img src=/__resources/plus-icon_3b1f20.png>. Select <em>AWS</em> from the drop down menu to add a new AWS secret.</p></li><li><p>Create your secret.</p><ol><li>Type the name of your secret.</li><li>Copy and paste the <code>Access Key ID</code> and <code>Secret Access Key</code> you saved when you created the technical user on AWS.</li><li>Choose <em>Add secret</em>.
<img src=/__resources/add-aws-secret_ed47ad.png></li></ol><blockquote><p>After completing these steps, you should see your newly created secret in the <em>Infrastructure Secrets</em> section.</p></blockquote><img src=/__resources/secret-stored_a4c7f9.png></li><li><p>To create a new cluster, choose <em>Clusters</em> and then the plus sign in the upper right corner.</p><img src=/__resources/new-cluster_353d7b.png></li><li><p>In the <em>Create Cluster</em> section:</p><ol><li>Select <em>AWS</em> in the <em>Infrastructure</em> tab.</li><li>Type the name of your cluster in the <em>Cluster Details</em> tab.</li><li>Choose the secret you created before in the <em>Infrastructure Details</em> tab.</li><li>Choose <em>Create</em>.</li></ol><img src=/__resources/create-cluster_7a45a2.png></li><li><p>Wait for your cluster to get created.</p><img src=/__resources/processing-cluster_522005.png></li></ol><h3 id=result>Result</h3><p>After completing the steps in this tutorial, you will be able to see and download the kubeconfig of your cluster.</p><img src=/__resources/copy-kubeconfig_752d59.png></div><div class=td-content style=page-break-before:always><h1 id=pg-3df8b1939d1f45daa8220886832c9751>2 - Deployment</h1><h1 id=deployment-of-the-aws-provider-extension>Deployment of the AWS provider extension</h1><p><strong>Disclaimer:</strong> This document is NOT a step by step installation guide for the AWS provider extension and only contains some configuration specifics regarding the installation of different components via the helm charts residing in the AWS provider extension <a href=https://github.com/gardener/gardener-extension-provider-aws>repository</a>.</p><h2 id=gardener-extension-admission-aws>gardener-extension-admission-aws</h2><h3 id=authentication-against-the-garden-cluster>Authentication against the Garden cluster</h3><p>There are several authentication possibilities depending on whether or not <a href=https://github.com/gardener/garden-setup#concept-the-virtual-cluster>the concept of <em>Virtual Garden</em></a> is used.</p><h4 id=virtual-garden-is-not-used-ie-the-runtime-garden-cluster-is-also-the-target-garden-cluster><em>Virtual Garden</em> is not used, i.e., the <code>runtime</code> Garden cluster is also the <code>target</code> Garden cluster.</h4><p><strong>Automounted Service Account Token</strong>
The easiest way to deploy the <code>gardener-extension-admission-aws</code> component will be to not provide <code>kubeconfig</code> at all. This way in-cluster configuration and an automounted service account token will be used. The drawback of this approach is that the automounted token will not be automatically rotated.</p><p><strong>Service Account Token Volume Projection</strong>
Another solution will be to use <a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#service-account-token-volume-projection>Service Account Token Volume Projection</a> combined with a <code>kubeconfig</code> referencing a token file (see example below).</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Config
</span></span><span style=display:flex><span>clusters:
</span></span><span style=display:flex><span>- cluster:
</span></span><span style=display:flex><span>    certificate-authority-data: &lt;CA-DATA&gt;
</span></span><span style=display:flex><span>    server: https://default.kubernetes.svc.cluster.local
</span></span><span style=display:flex><span>  name: garden
</span></span><span style=display:flex><span>contexts:
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>    cluster: garden
</span></span><span style=display:flex><span>    user: garden
</span></span><span style=display:flex><span>  name: garden
</span></span><span style=display:flex><span>current-context: garden
</span></span><span style=display:flex><span>users:
</span></span><span style=display:flex><span>- name: garden
</span></span><span style=display:flex><span>  user:
</span></span><span style=display:flex><span>    tokenFile: /var/run/secrets/projected/serviceaccount/token
</span></span></code></pre></div><p>This will allow for automatic rotation of the service account token by the <code>kubelet</code>. The configuration can be achieved by setting both <code>.Values.global.serviceAccountTokenVolumeProjection.enabled: true</code> and <code>.Values.global.kubeconfig</code> in the respective chart&rsquo;s <code>values.yaml</code> file.</p><h4 id=virtual-garden-is-used-ie-the-runtime-garden-cluster-is-different-from-the-target-garden-cluster><em>Virtual Garden</em> is used, i.e., the <code>runtime</code> Garden cluster is different from the <code>target</code> Garden cluster.</h4><p><strong>Service Account</strong>
The easiest way to setup the authentication will be to create a service account and the respective roles will be bound to this service account in the <code>target</code> cluster. Then use the generated service account token and craft a <code>kubeconfig</code> which will be used by the workload in the <code>runtime</code> cluster. This approach does not provide a solution for the rotation of the service account token. However, this setup can be achieved by setting <code>.Values.global.virtualGarden.enabled: true</code> and following these steps:</p><ol><li>Deploy the <code>application</code> part of the charts in the <code>target</code> cluster.</li><li>Get the service account token and craft the <code>kubeconfig</code>.</li><li>Set the crafted <code>kubeconfig</code> and deploy the <code>runtime</code> part of the charts in the <code>runtime</code> cluster.</li></ol><p><strong>Client Certificate</strong>
Another solution will be to bind the roles in the <code>target</code> cluster to a <code>User</code> subject instead of a service account and use a client certificate for authentication. This approach does not provide a solution for the client certificate rotation. However, this setup can be achieved by setting both <code>.Values.global.virtualGarden.enabled: true</code> and <code>.Values.global.virtualGarden.user.name</code>, then following these steps:</p><ol><li>Generate a client certificate for the <code>target</code> cluster for the respective user.</li><li>Deploy the <code>application</code> part of the charts in the <code>target</code> cluster.</li><li>Craft a <code>kubeconfig</code> using the already generated client certificate.</li><li>Set the crafted <code>kubeconfig</code> and deploy the <code>runtime</code> part of the charts in the <code>runtime</code> cluster.</li></ol><p><strong>Projected Service Account Token</strong>
This approach requires an already deployed and configured <a href=https://github.com/gardener/oidc-webhook-authenticator>oidc-webhook-authenticator</a> for the <code>target</code> cluster. Also the <code>runtime</code> cluster should be registered as a trusted identity provider in the <code>target</code> cluster. Then projected service accounts tokens from the <code>runtime</code> cluster can be used to authenticate against the <code>target</code> cluster. The needed steps are as follows:</p><ol><li>Deploy <a href=https://github.com/gardener/oidc-webhook-authenticator>OWA</a> and establish the needed trust.</li><li>Set <code>.Values.global.virtualGarden.enabled: true</code> and <code>.Values.global.virtualGarden.user.name</code>. <strong>Note:</strong> username value will depend on the trust configuration, e.g., <code>&lt;prefix>:system:serviceaccount:&lt;namespace>:&lt;serviceaccount></code></li><li>Set <code>.Values.global.serviceAccountTokenVolumeProjection.enabled: true</code> and <code>.Values.global.serviceAccountTokenVolumeProjection.audience</code>. <strong>Note:</strong> audience value will depend on the trust configuration, e.g., <code>&lt;cliend-id-from-trust-config></code>.</li><li>Craft a kubeconfig (see example below).</li><li>Deploy the <code>application</code> part of the charts in the <code>target</code> cluster.</li><li>Deploy the <code>runtime</code> part of the charts in the <code>runtime</code> cluster.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Config
</span></span><span style=display:flex><span>clusters:
</span></span><span style=display:flex><span>- cluster:
</span></span><span style=display:flex><span>    certificate-authority-data: &lt;CA-DATA&gt;
</span></span><span style=display:flex><span>    server: https://virtual-garden.api
</span></span><span style=display:flex><span>  name: virtual-garden
</span></span><span style=display:flex><span>contexts:
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>    cluster: virtual-garden
</span></span><span style=display:flex><span>    user: virtual-garden
</span></span><span style=display:flex><span>  name: virtual-garden
</span></span><span style=display:flex><span>current-context: virtual-garden
</span></span><span style=display:flex><span>users:
</span></span><span style=display:flex><span>- name: virtual-garden
</span></span><span style=display:flex><span>  user:
</span></span><span style=display:flex><span>    tokenFile: /var/run/secrets/projected/serviceaccount/token
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-60ce03f807554a2877fd8358d47eefca>3 - Dual Stack Ingress</h1><h1 id=using-ipv4ipv6-dual-stack-ingress-in-an-ipv4-single-stack-cluster>Using IPv4/IPv6 (dual-stack) Ingress in an IPv4 single-stack cluster</h1><h2 id=motivation>Motivation</h2><p>IPv6 adoption is continuously growing, already overtaking IPv4 in certain regions, e.g. India, or scenarios, e.g. mobile.
Even though most IPv6 installations deploy means to reach IPv4, it might still be beneficial to expose services
natively via IPv4 and IPv6 instead of just relying on IPv4.</p><h2 id=disadvantages-of-full-ipv4ipv6-dual-stack-deployments>Disadvantages of full IPv4/IPv6 (dual-stack) Deployments</h2><p>Enabling full IPv4/IPv6 (dual-stack) support in a kubernetes cluster is a major endeavor. It requires a lot of changes
and restarts of all pods so that all pods get addresses for both IP families. A side-effect of dual-stack networking
is that failures may be hidden as network traffic may take the other protocol to reach the target. For this reason and
also due to reduced operational complexity, service teams might lean towards staying in a single-stack environment as
much as possible. Luckily, this is possible with Gardener and IPv4/IPv6 (dual-stack) ingress on AWS.</p><h2 id=simplifying-ipv4ipv6-dual-stack-ingress-with-protocol-translation-on-aws>Simplifying IPv4/IPv6 (dual-stack) Ingress with Protocol Translation on AWS</h2><p>Fortunately, the network load balancer on AWS supports automatic protocol translation, i.e. it can expose both IPv4 and
IPv6 endpoints while communicating with just one protocol to the backends. Under the hood, automatic protocol translation
takes place. Client IP address preservation can be achieved by using proxy protocol.</p><p>This approach enables users to expose IPv4 workload to IPv6-only clients without having to change the workload/service.
Without requiring invasive changes, it allows a fairly simple first step into the IPv6 world for services just requiring
ingress (incoming) communication.</p><h2 id=necessary-shoot-cluster-configuration-changes-for-ipv4ipv6-dual-stack-ingress>Necessary Shoot Cluster Configuration Changes for IPv4/IPv6 (dual-stack) Ingress</h2><p>To be able to utilize IPv4/IPv6 (dual-stack) Ingress in an IPv4 shoot cluster, the cluster needs to meet two preconditions:</p><ol><li><code>dualStack.enabled</code> needs to be set to <code>true</code> to configure VPC/subnet for IPv6 and add a routing rule for IPv6.
(This does not add IPv6 addresses to kubernetes nodes.)</li><li><code>loadBalancerController.enabled</code> needs to be set to <code>true</code> as well to use the load balancer controller, which supports
dual-stack ingress.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>kind: Shoot
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  provider:
</span></span><span style=display:flex><span>    type: aws
</span></span><span style=display:flex><span>    infrastructureConfig:
</span></span><span style=display:flex><span>      apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>      kind: InfrastructureConfig
</span></span><span style=display:flex><span>      dualStack:
</span></span><span style=display:flex><span>        enabled: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>    controlPlaneConfig:
</span></span><span style=display:flex><span>      apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>      kind: ControlPlaneConfig
</span></span><span style=display:flex><span>      loadBalancerController:
</span></span><span style=display:flex><span>        enabled: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>When <code>infrastructureConfig.networks.vpc.id</code> is set to the ID of an existing VPC, please make sure that your VPC has an <a href=https://docs.aws.amazon.com/vpc/latest/userguide/modify-vpcs.html#vpc-associate-ipv6-cidr>Amazon-provided IPv6 CIDR block added</a>.</p><p>After adapting the shoot specification and reconciling the cluster, dual-stack load balancers can be created using
kubernetes services objects.</p><h2 id=creating-an-ipv4ipv6-dual-stack-ingress>Creating an IPv4/IPv6 (dual-stack) Ingress</h2><p>With the preconditions set, creating an IPv4/IPv6 load balancer is as easy as annotating a service with the correct
annotations:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Service
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  annotations:
</span></span><span style=display:flex><span>    service.beta.kubernetes.io/aws-load-balancer-ip-address-type: dualstack
</span></span><span style=display:flex><span>    service.beta.kubernetes.io/aws-load-balancer-scheme: internet-facing
</span></span><span style=display:flex><span>    service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: instance
</span></span><span style=display:flex><span>    service.beta.kubernetes.io/aws-load-balancer-type: external
</span></span><span style=display:flex><span>  name: ...
</span></span><span style=display:flex><span>  namespace: ...
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  type: LoadBalancer
</span></span></code></pre></div><p>In case the client IP address should be preserved, the following annotation can be used to enable proxy protocol.
(The pod receiving the traffic needs to be configured for proxy protocol as well.)</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>    service.beta.kubernetes.io/aws-load-balancer-proxy-protocol: <span style=color:#a31515>&#34;*&#34;</span>
</span></span></code></pre></div><p>Please note that changing an existing <code>Service</code> to dual-stack may cause the creation of a new load balancer without
deletion of the old AWS load balancer resource. While this helps in a seamless migration by not cutting existing
connections it may lead to wasted/forgotten resources. Therefore, the (manual) cleanup needs to be taken into account
when migrating an existing <code>Service</code> instance.</p><p>For more details see <a href=https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.4/guide/service/nlb/>AWS Load Balancer Documentation - Network Load Balancer</a>.</p><h2 id=dns-considerations-to-prevent-downtime-during-a-dual-stack-migration>DNS Considerations to Prevent Downtime During a Dual-Stack Migration</h2><p>In case the migration of an existing service is desired, please check if there are DNS entries directly linked to the
corresponding load balancer. The migrated load balancer will have a new domain name immediately, which will not be ready
in the beginning. Therefore, a direct migration of the domain name entries is not desired as it may cause a short
downtime, i.e. domain name entries without backing IP addresses.</p><p>If there are DNS entries directly linked to the corresponding load balancer and they are managed by the
<a href=https://github.com/gardener/gardener-extension-shoot-dns-service>shoot-dns-service</a>, you can identify this via
annotations with the prefix <code>dns.gardener.cloud/</code>. Those annotations can be linked to a <code>Service</code>, <code>Ingress</code> or
<code>Gateway</code> resources. Alternatively, they may also use <code>DNSEntry</code> or <code>DNSAnnotation</code> resources.</p><p>For a seamless migration without downtime use the following three step approach:</p><ol><li>Temporarily prevent direct DNS updates</li><li>Migrate the load balancer and wait until it is operational</li><li>Allow DNS updates again</li></ol><p>To prevent direct updates of the DNS entries when the load balancer is migrated add the annotation
<code>dns.gardener.cloud/ignore: 'true'</code> to all affected resources next to the other <code>dns.gardener.cloud/...</code> annotations
before starting the migration. For example, in case of a <code>Service</code> ensure that the service looks like the following:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>kind: Service
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  annotations:
</span></span><span style=display:flex><span>    dns.gardener.cloud/ignore: <span style=color:#a31515>&#39;true&#39;</span>
</span></span><span style=display:flex><span>    dns.gardener.cloud/class: garden
</span></span><span style=display:flex><span>    dns.gardener.cloud/dnsnames: <span style=color:#a31515>&#39;...&#39;</span>
</span></span><span style=display:flex><span>    ...
</span></span></code></pre></div><p>Next, migrate the load balancer to be dual-stack enabled by adding/changing the corresponding annotations.</p><p>You have multiple options how to check that the load balancer has been provisioned successfully. It might be useful
to peek into <code>status.loadBalancer.ingress</code> of the corresponding <code>Service</code> to identify the load balancer:</p><ul><li>Check in the AWS console for the corresponding load balancer provisioning state</li><li>Perform domain name lookups with <code>nslookup</code>/<code>dig</code> to check whether the name resolves to an IP address.</li><li>Call your workload via the new load balancer, e.g. using
<code>curl --resolve &lt;my-domain-name>:&lt;port>:&lt;IP-address> https://&lt;my-domain-name>:&lt;port></code>, which allows you to call your
service with the &ldquo;correct&rdquo; domain name without using actual name resolution.</li><li>Wait a fixed period of time as load balancer creation is usually finished within 15 minutes</li></ul><p>Once the load balancer has been provisioned, you can remove the annotation <code>dns.gardener.cloud/ignore: 'true'</code> again
from the affected resources. It may take some additional time until the domain name change finally propagates
(up to one hour).</p></div><div class=td-content style=page-break-before:always><h1 id=pg-28a12e85fc80a44c9f68439847c31f5e>4 - Ipv6</h1><h1 id=support-for-ipv6>Support for IPv6</h1><h2 id=overview>Overview</h2><p>Gardener supports different levels of IPv6 support in shoot clusters.
This document describes the differences between them and what to consider when using them.</p><p>In <a href=/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/ipv6/#ipv6-ingress-for-ipv4-shoot-clusters>IPv6 Ingress for IPv4 Shoot Clusters</a>, the focus is on how an existing IPv4-only shoot cluster can provide dual-stack services to clients.
Section <a href=/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/ipv6/#ipv6-only-shoot-clusters>IPv6-only Shoot Clusters</a> describes how to create a shoot cluster that only supports IPv6.
Finally, <a href=/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/ipv6/#dual-stack-shoot-clusters>Dual-Stack Shoot Clusters</a> explains how to create a shoot cluster that supports both IPv4 and IPv6.</p><h2 id=ipv6-ingress-for-ipv4-shoot-clusters>IPv6 Ingress for IPv4 Shoot Clusters</h2><p>Per default, Gardener shoot clusters use only IPv4.
Therefore, they also expose their services only via load balancers with IPv4 addresses.
To allow external clients to also use IPv6 to access services in an IPv4 shoot cluster, the cluster needs to be configured to support dual-stack ingress.</p><p>It is possible to configure a shoot cluster to support dual-stack ingress, see <a href=/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/dual-stack-ingress/>Using IPv4/IPv6 (dual-stack) Ingress in an IPv4 single-stack cluster</a> for more information.</p><p>The main benefit of this approach is that the existing cluster stays almost as is without major changes, keeping the operational simplicity.
It works very well for services that only require incoming communication, e.g. pure web services.</p><p>The main drawback is that certain scenarios, especially related to IPv6 callbacks, are not possible.
This means that services, which actively call to their clients via web hooks, will not be able to do so over IPv6.
Hence, those services will not be able to allow full-usage via IPv6.</p><h2 id=ipv6-only-shoot-clusters>IPv6-only Shoot Clusters</h2><h3 id=motivation>Motivation</h3><p>IPv6-only shoot clusters are the best option to verify that services are fully IPv6-compatible.
While <a href=/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/ipv6/#dual-stack-shoot-clusters>Dual-Stack Shoot Clusters</a> may fall back on using IPv4 transparently, IPv6-only shoot clusters enforce the usage of IPv6 inside the cluster.
Therefore, it is recommended to check with IPv6-only shoot clusters if a workload is fully IPv6-compatible.</p><p>In addition to being a good testbed for IPv6 compatibility, IPv6-only shoot clusters may also be a desirable eventual target in the IPv6 migration as they allow to support both IPv4 and IPv6 clients while having a single-stack with the cluster.</p><h3 id=creating-an-ipv6-only-shoot-cluster>Creating an IPv6-only Shoot Cluster</h3><p>To create an IPv6-only shoot cluster, the following needs to be specified in the <code>Shoot</code> resource (see also <a href=/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/usage/#example-shoot-manifest-ipv6>here</a>):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>kind: Shoot
</span></span><span style=display:flex><span>apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  networking:
</span></span><span style=display:flex><span>    type: ...
</span></span><span style=display:flex><span>    ipFamilies:
</span></span><span style=display:flex><span>      - IPv6
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  provider:
</span></span><span style=display:flex><span>    type: aws
</span></span><span style=display:flex><span>    infrastructureConfig:
</span></span><span style=display:flex><span>      apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>      kind: InfrastructureConfig
</span></span><span style=display:flex><span>      networks:
</span></span><span style=display:flex><span>        vpc:
</span></span><span style=display:flex><span>          cidr: 192.168.0.0/16
</span></span><span style=display:flex><span>        zones:
</span></span><span style=display:flex><span>          - name: ...
</span></span><span style=display:flex><span>            public: 192.168.32.0/20
</span></span><span style=display:flex><span>            internal: 192.168.48.0/20
</span></span></code></pre></div><blockquote class="alert alert-warning"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>alert-outline</title><path d="M12 2 1 21H23M12 6l7.53 13H4.47M11 10v4h2V10m-2 6v2h2V16"/></svg><p>Warning</p></div><p>Please note that <code>nodes</code>, <code>pods</code> and <code>services</code> should not be specified in <code>.spec.networking</code> resource.</p></blockquote><p>In contrast to that, it is still required to specify IPv4 ranges for the VPC and the public/internal subnets.
This is mainly due to the fact that public/internal load balancers still require IPv4 addresses as there are no pure IPv6-only load balancers as of now.
The ranges can be sized according to the expected amount of load balancers per zone/type.</p><p>The IPv6 address ranges are provided by AWS. It is ensured that the IPv6 ranges are globally unique und internet routable.</p><h3 id=load-balancer-configuration>Load Balancer Configuration</h3><p>The AWS Load Balancer Controller is automatically deployed when using an IPv6-only shoot cluster.
When creating a load balancer, the corresponding annotations need to be configured, see <a href=https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/service/nlb/>AWS Load Balancer Documentation - Network Load Balancer</a> for details.</p><p>The AWS Load Balancer Controller allows dual-stack ingress so that an IPv6-only shoot cluster can serve IPv4 and IPv6 clients.
You can find an example <a href=/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/dual-stack-ingress/#creating-an-ipv4ipv6-dual-stack-ingress>here</a>.</p><blockquote class="alert alert-warning"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>alert-outline</title><path d="M12 2 1 21H23M12 6l7.53 13H4.47M11 10v4h2V10m-2 6v2h2V16"/></svg><p>Warning</p></div><p>When accessing Network Load Balancers (NLB) from within the same IPv6-only cluster, it is crucial to add the annotation <code>service.beta.kubernetes.io/aws-load-balancer-target-group-attributes: preserve_client_ip.enabled=false</code>.
Without this annotation, if a request is routed by the NLB to the same target instance from which it originated, the client IP and destination IP will be identical.
This situation, known as the hair-pinning effect, will prevent the request from being processed.
(This also happens for internal load balancers in IPv4 clusters, but is mitigated by the NAT gateway for external IPv4 load balancers.)</p></blockquote><h3 id=connectivity-to-ipv4-only-services>Connectivity to IPv4-only Services</h3><p>The IPv6-only shoot cluster can connect to IPv4-only services via DNS64/NAT64.
The cluster is configured to use the DNS64/NAT64 service of the underlying cloud provider.
This allows the cluster to resolve IPv4-only DNS names and to connect to IPv4-only services.</p><p>Please note that traffic going through NAT64 incurs the same cost as ordinary NAT traffic in an IPv4-only cluster.
Therefore, it might be beneficial to prefer IPv6 for services, which provide IPv4 and IPv6.</p><h2 id=dual-stack-shoot-clusters>Dual-Stack Shoot Clusters</h2><h3 id=motivation-1>Motivation</h3><p>Dual-stack shoot clusters support IPv4 and IPv6 out-of-the-box.
They can be the intermediate step on the way towards IPv6 for any existing (IPv4-only) clusters.</p><h3 id=creating-a-dual-stack-shoot-cluster>Creating a Dual-Stack Shoot Cluster</h3><p>To create a dual-stack shoot cluster, the following needs to be specified in the <code>Shoot</code> resource:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>kind: Shoot
</span></span><span style=display:flex><span>apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  networking:
</span></span><span style=display:flex><span>    type: ...
</span></span><span style=display:flex><span>    pods: 192.168.128.0/17
</span></span><span style=display:flex><span>    nodes: 192.168.0.0/18
</span></span><span style=display:flex><span>    services: 192.168.64.0/18
</span></span><span style=display:flex><span>    ipFamilies:
</span></span><span style=display:flex><span>      - IPv4
</span></span><span style=display:flex><span>      - IPv6
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  provider:
</span></span><span style=display:flex><span>    type: aws
</span></span><span style=display:flex><span>    infrastructureConfig:
</span></span><span style=display:flex><span>      apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>      kind: InfrastructureConfig
</span></span><span style=display:flex><span>      networks:
</span></span><span style=display:flex><span>        vpc:
</span></span><span style=display:flex><span>          cidr: 192.168.0.0/18
</span></span><span style=display:flex><span>        zones:
</span></span><span style=display:flex><span>          - name: ...
</span></span><span style=display:flex><span>            workers: 192.168.0.0/19
</span></span><span style=display:flex><span>            public: 192.168.32.0/20
</span></span><span style=display:flex><span>            internal: 192.168.48.0/20
</span></span></code></pre></div><p>Please note that the only change compared to an IPv4-only shoot cluster is the addition of <code>IPv6</code> to the <code>.spec.networking.ipFamilies</code> field.
The order of the IP families defines the preference of the IP family.
In this case, IPv4 is preferred over IPv6, e.g. services specifying no IP family will get only an IPv4 address.</p><h3 id=migration-of-ipv4-only-shoot-clusters-to-dual-stack>Migration of IPv4-only Shoot Clusters to Dual-Stack</h3><p>Eventually, migration should be as easy as changing the <code>.spec.networking.ipFamilies</code> field in the <code>Shoot</code> resource from <code>IPv4</code> to <code>IPv4, IPv6</code>.
However, as of now, this is not supported.</p><p>It is worth recognizing that the migration from an IPv4-only shoot cluster to a dual-stack shoot cluster involves rolling of the nodes/workload as well.
Nodes will not get a new IPv6 address assigned automatically.
The same is true for pods as well.
Once the migration is supported, the detailed caveats will be documented here.</p><h3 id=load-balancer-configuration-1>Load Balancer Configuration</h3><p>The AWS Load Balancer Controller is automatically deployed when using a dual-stack shoot cluster.
When creating a load balancer, the corresponding annotations need to be configured, see <a href=https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/service/nlb/>AWS Load Balancer Documentation - Network Load Balancer</a> for details.</p><blockquote class="alert alert-warning"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>alert-outline</title><path d="M12 2 1 21H23M12 6l7.53 13H4.47M11 10v4h2V10m-2 6v2h2V16"/></svg><p>Warning</p></div><p>Please note that load balancer services without any special annotations will default to IPv4-only regardless how <code>.spec.ipFamilies</code> is set.</p></blockquote><p>The AWS Load Balancer Controller allows dual-stack ingress so that a dual-stack shoot cluster can serve IPv4 and IPv6 clients.
You can find an example <a href=/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/dual-stack-ingress/#creating-an-ipv4ipv6-dual-stack-ingress>here</a>.</p><blockquote class="alert alert-warning"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>alert-outline</title><path d="M12 2 1 21H23M12 6l7.53 13H4.47M11 10v4h2V10m-2 6v2h2V16"/></svg><p>Warning</p></div><p>When accessing external Network Load Balancers (NLB) from within the same cluster via IPv6 or internal NLBs via IPv4, it is crucial to add the annotation <code>service.beta.kubernetes.io/aws-load-balancer-target-group-attributes: preserve_client_ip.enabled=false</code>.
Without this annotation, if a request is routed by the NLB to the same target instance from which it originated, the client IP and destination IP will be identical.
This situation, known as the hair-pinning effect, will prevent the request from being processed.</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-f9e02d7a81c7f540c23da08a17dfec76>5 - Local Setup</h1><h3 id=admission-aws>admission-aws</h3><p><code>admission-aws</code> is an admission webhook server which is responsible for the validation of the cloud provider (AWS in this case) specific fields and resources. The Gardener API server is cloud provider agnostic and it wouldn&rsquo;t be able to perform similar validation.</p><p>Follow the steps below to run the admission webhook server locally.</p><ol><li><p>Start the Gardener API server.</p><p>For details, check the Gardener <a href=/docs/gardener/local_setup/>local setup</a>.</p></li><li><p>Start the webhook server</p><p>Make sure that the <code>KUBECONFIG</code> environment variable is pointing to the local garden cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make start-admission
</span></span></code></pre></div></li><li><p>Setup the <code>ValidatingWebhookConfiguration</code>.</p><p><code>hack/dev-setup-admission-aws.sh</code> will configure the webhook Service which will allow the kube-apiserver of your local cluster to reach the webhook server. It will also apply the <code>ValidatingWebhookConfiguration</code> manifest.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./hack/dev-setup-admission-aws.sh
</span></span></code></pre></div></li></ol><p>You are now ready to experiment with the <code>admission-aws</code> webhook server locally.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-464bc9c324b16ca3984ff0327efdf6c3>6 - Operations</h1><h1 id=using-the-aws-provider-extension-with-gardener-as-operator>Using the AWS provider extension with Gardener as operator</h1><p>The <a href=https://github.com/gardener/gardener/blob/master/example/30-cloudprofile.yaml><code>core.gardener.cloud/v1beta1.CloudProfile</code> resource</a> declares a <code>providerConfig</code> field that is meant to contain provider-specific configuration.
Similarly, the <a href=https://github.com/gardener/gardener/blob/master/example/50-seed.yaml><code>core.gardener.cloud/v1beta1.Seed</code> resource</a> is structured.
Additionally, it allows to configure settings for the backups of the main etcds&rsquo; data of shoot clusters control planes running in this seed cluster.</p><p>This document explains what is necessary to configure for this provider extension.</p><h2 id=cloudprofile-resource><code>CloudProfile</code> resource</h2><p>In this section we are describing how the configuration for <code>CloudProfile</code>s looks like for AWS and provide an example <code>CloudProfile</code> manifest with minimal configuration that you can use to allow creating AWS shoot clusters.</p><h3 id=cloudprofileconfig><code>CloudProfileConfig</code></h3><p>The cloud profile configuration contains information about the real machine image IDs in the AWS environment (AMIs).
You have to map every version that you specify in <code>.spec.machineImages[].versions</code> here such that the AWS extension knows the AMI for every version you want to offer.
For each AMI an <code>architecture</code> field can be specified which specifies the CPU architecture of the machine on which given machine image can be used.</p><p>An example <code>CloudProfileConfig</code> for the AWS extension looks as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>kind: CloudProfileConfig
</span></span><span style=display:flex><span>machineImages:
</span></span><span style=display:flex><span>- name: coreos
</span></span><span style=display:flex><span>  versions:
</span></span><span style=display:flex><span>  - version: 2135.6.0
</span></span><span style=display:flex><span>    regions:
</span></span><span style=display:flex><span>    - name: eu-central-1
</span></span><span style=display:flex><span>      ami: ami-034fd8c3f4026eb39
</span></span><span style=display:flex><span>      <span style=color:green># architecture: amd64 # optional</span>
</span></span></code></pre></div><h3 id=example-cloudprofile-manifest>Example <code>CloudProfile</code> manifest</h3><p>Please find below an example <code>CloudProfile</code> manifest:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>kind: CloudProfile
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: aws
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  type: aws
</span></span><span style=display:flex><span>  kubernetes:
</span></span><span style=display:flex><span>    versions:
</span></span><span style=display:flex><span>    - version: 1.27.3
</span></span><span style=display:flex><span>    - version: 1.26.8
</span></span><span style=display:flex><span>      expirationDate: <span style=color:#a31515>&#34;2022-10-31T23:59:59Z&#34;</span>
</span></span><span style=display:flex><span>  machineImages:
</span></span><span style=display:flex><span>  - name: coreos
</span></span><span style=display:flex><span>    versions:
</span></span><span style=display:flex><span>    - version: 2135.6.0
</span></span><span style=display:flex><span>  machineTypes:
</span></span><span style=display:flex><span>  - name: m5.large
</span></span><span style=display:flex><span>    cpu: <span style=color:#a31515>&#34;2&#34;</span>
</span></span><span style=display:flex><span>    gpu: <span style=color:#a31515>&#34;0&#34;</span>
</span></span><span style=display:flex><span>    memory: 8Gi
</span></span><span style=display:flex><span>    usable: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>  volumeTypes:
</span></span><span style=display:flex><span>  - name: gp2
</span></span><span style=display:flex><span>    class: standard
</span></span><span style=display:flex><span>    usable: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>  - name: io1
</span></span><span style=display:flex><span>    class: premium
</span></span><span style=display:flex><span>    usable: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>  regions:
</span></span><span style=display:flex><span>  - name: eu-central-1
</span></span><span style=display:flex><span>    zones:
</span></span><span style=display:flex><span>    - name: eu-central-1a
</span></span><span style=display:flex><span>    - name: eu-central-1b
</span></span><span style=display:flex><span>    - name: eu-central-1c
</span></span><span style=display:flex><span>  providerConfig:
</span></span><span style=display:flex><span>    apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>    kind: CloudProfileConfig
</span></span><span style=display:flex><span>    machineImages:
</span></span><span style=display:flex><span>    - name: coreos
</span></span><span style=display:flex><span>      versions:
</span></span><span style=display:flex><span>      - version: 2135.6.0
</span></span><span style=display:flex><span>        regions:
</span></span><span style=display:flex><span>        - name: eu-central-1
</span></span><span style=display:flex><span>          ami: ami-034fd8c3f4026eb39
</span></span><span style=display:flex><span>          <span style=color:green># architecture: amd64 # optional</span>
</span></span></code></pre></div><h2 id=seed-resource><code>Seed</code> resource</h2><p>This provider extension does not support any provider configuration for the <code>Seed</code>&rsquo;s <code>.spec.provider.providerConfig</code> field.
However, it supports to manage backup infrastructure, i.e., you can specify configuration for the <code>.spec.backup</code> field.</p><h3 id=backup-configuration>Backup configuration</h3><p>Please find below an example <code>Seed</code> manifest (partly) that configures backups.
As you can see, the location/region where the backups will be stored can be different to the region where the seed cluster is running.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Secret
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: backup-credentials
</span></span><span style=display:flex><span>  namespace: garden
</span></span><span style=display:flex><span>type: Opaque
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  accessKeyID: base64(access-key-id)
</span></span><span style=display:flex><span>  secretAccessKey: base64(secret-access-key)
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>kind: Seed
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: my-seed
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  provider:
</span></span><span style=display:flex><span>    type: aws
</span></span><span style=display:flex><span>    region: eu-west-1
</span></span><span style=display:flex><span>  backup:
</span></span><span style=display:flex><span>    provider: aws
</span></span><span style=display:flex><span>    region: eu-central-1
</span></span><span style=display:flex><span>    secretRef:
</span></span><span style=display:flex><span>      name: backup-credentials
</span></span><span style=display:flex><span>      namespace: garden
</span></span><span style=display:flex><span>  ...
</span></span></code></pre></div><p>Please look up <a href=https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys>https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys</a> as well.</p><h4 id=permissions-for-aws-iam-user>Permissions for AWS IAM user</h4><p>Please make sure that the provided credentials have the correct privileges. You can use the following AWS IAM policy document and attach it to the IAM user backed by the credentials you provided (please check the <a href=http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage.html>official AWS documentation</a> as well):</p><details><summary>Click to expand the AWS IAM policy document!</summary><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;Version&#34;: <span style=color:#a31515>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>  &#34;Statement&#34;: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      &#34;Effect&#34;: <span style=color:#a31515>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      &#34;Action&#34;: <span style=color:#a31515>&#34;s3:*&#34;</span>,
</span></span><span style=display:flex><span>      &#34;Resource&#34;: <span style=color:#a31515>&#34;*&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></details></div><div class=td-content style=page-break-before:always><h1 id=pg-b56ae0589f68df0d7a157f7430ba7bbd>7 - Usage</h1><h1 id=using-the-aws-provider-extension-with-gardener-as-end-user>Using the AWS provider extension with Gardener as end-user</h1><p>The <a href=https://github.com/gardener/gardener/blob/master/example/90-shoot.yaml><code>core.gardener.cloud/v1beta1.Shoot</code> resource</a> declares a few fields that are meant to contain provider-specific configuration.</p><p>In this document we are describing how this configuration looks like for AWS and provide an example <code>Shoot</code> manifest with minimal configuration that you can use to create an AWS cluster (modulo the landscape-specific information like cloud profile names, secret binding names, etc.).</p><h2 id=provider-secret-data>Provider Secret Data</h2><p>Every shoot cluster references a <code>SecretBinding</code> or a <code>CredentialsBinding</code> which itself references a <code>Secret</code>, and this <code>Secret</code> contains the provider credentials of your AWS account.
This <code>Secret</code> must look as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Secret
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: core-aws
</span></span><span style=display:flex><span>  namespace: garden-dev
</span></span><span style=display:flex><span>type: Opaque
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  accessKeyID: base64(access-key-id)
</span></span><span style=display:flex><span>  secretAccessKey: base64(secret-access-key)
</span></span></code></pre></div><p>The <a href=https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys>AWS documentation</a> explains the necessary steps to enable programmatic access, i.e. create <strong>access key ID</strong> and <strong>access key</strong>, for the user of your choice.</p><p>⚠️ For security reasons, we recommend creating a <strong>dedicated user with programmatic access only</strong>. Please avoid re-using a IAM user which has access to the AWS console (human user).</p><p>⚠️ Depending on your AWS API usage it can be problematic to reuse the same AWS Account for different Shoot clusters in the same region due to rate limits. Please consider spreading your Shoots over multiple AWS Accounts if you are hitting those limits.</p><h3 id=permissions>Permissions</h3><p>Please make sure that the provided credentials have the correct privileges. You can use the following AWS IAM policy document and attach it to the IAM user backed by the credentials you provided (please check the <a href=http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage.html>official AWS documentation</a> as well):</p><details><summary>Click to expand the AWS IAM policy document!</summary><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;Version&#34;: <span style=color:#a31515>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>  &#34;Statement&#34;: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      &#34;Effect&#34;: <span style=color:#a31515>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      &#34;Action&#34;: <span style=color:#a31515>&#34;autoscaling:*&#34;</span>,
</span></span><span style=display:flex><span>      &#34;Resource&#34;: <span style=color:#a31515>&#34;*&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      &#34;Effect&#34;: <span style=color:#a31515>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      &#34;Action&#34;: <span style=color:#a31515>&#34;ec2:*&#34;</span>,
</span></span><span style=display:flex><span>      &#34;Resource&#34;: <span style=color:#a31515>&#34;*&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      &#34;Effect&#34;: <span style=color:#a31515>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      &#34;Action&#34;: <span style=color:#a31515>&#34;elasticloadbalancing:*&#34;</span>,
</span></span><span style=display:flex><span>      &#34;Resource&#34;: <span style=color:#a31515>&#34;*&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      &#34;Action&#34;: [
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:GetInstanceProfile&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:GetPolicy&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:GetPolicyVersion&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:GetRole&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:GetRolePolicy&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:ListPolicyVersions&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:ListRolePolicies&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:ListAttachedRolePolicies&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:ListInstanceProfilesForRole&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:CreateInstanceProfile&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:CreatePolicy&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:CreatePolicyVersion&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:CreateRole&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:CreateServiceLinkedRole&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:AddRoleToInstanceProfile&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:AttachRolePolicy&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:DetachRolePolicy&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:RemoveRoleFromInstanceProfile&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:DeletePolicy&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:DeletePolicyVersion&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:DeleteRole&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:DeleteRolePolicy&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:DeleteInstanceProfile&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:PutRolePolicy&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:PassRole&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:UpdateAssumeRolePolicy&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      &#34;Effect&#34;: <span style=color:#a31515>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      &#34;Resource&#34;: <span style=color:#a31515>&#34;*&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:green>// The following permission set is only needed, if AWS Load Balancer controller is enabled (see ControlPlaneConfig)
</span></span></span><span style=display:flex><span><span style=color:green></span>    {
</span></span><span style=display:flex><span>      &#34;Effect&#34;: <span style=color:#a31515>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      &#34;Action&#34;: [
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;cognito-idp:DescribeUserPoolClient&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;acm:ListCertificates&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;acm:DescribeCertificate&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:ListServerCertificates&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;iam:GetServerCertificate&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;waf-regional:GetWebACL&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;waf-regional:GetWebACLForResource&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;waf-regional:AssociateWebACL&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;waf-regional:DisassociateWebACL&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;wafv2:GetWebACL&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;wafv2:GetWebACLForResource&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;wafv2:AssociateWebACL&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;wafv2:DisassociateWebACL&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;shield:GetSubscriptionState&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;shield:DescribeProtection&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;shield:CreateProtection&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;shield:DeleteProtection&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      &#34;Resource&#34;: <span style=color:#a31515>&#34;*&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></details><h2 id=infrastructureconfig><code>InfrastructureConfig</code></h2><p>The infrastructure configuration mainly describes how the network layout looks like in order to create the shoot worker nodes in a later step, thus, prepares everything relevant to create VMs, load balancers, volumes, etc.</p><p>An example <code>InfrastructureConfig</code> for the AWS extension looks as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>kind: InfrastructureConfig
</span></span><span style=display:flex><span>enableECRAccess: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>dualStack:
</span></span><span style=display:flex><span>  enabled: <span style=color:#00f>false</span>
</span></span><span style=display:flex><span>networks:
</span></span><span style=display:flex><span>  vpc: <span style=color:green># specify either &#39;id&#39; or &#39;cidr&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:green># id: vpc-123456</span>
</span></span><span style=display:flex><span>    cidr: 10.250.0.0/16
</span></span><span style=display:flex><span>  <span style=color:green># gatewayEndpoints:</span>
</span></span><span style=display:flex><span>  <span style=color:green># - s3</span>
</span></span><span style=display:flex><span>  zones:
</span></span><span style=display:flex><span>  - name: eu-west-1a
</span></span><span style=display:flex><span>    internal: 10.250.112.0/22
</span></span><span style=display:flex><span>    public: 10.250.96.0/22
</span></span><span style=display:flex><span>    workers: 10.250.0.0/19
</span></span><span style=display:flex><span>  <span style=color:green># elasticIPAllocationID: eipalloc-123456</span>
</span></span><span style=display:flex><span>ignoreTags:
</span></span><span style=display:flex><span>  keys: <span style=color:green># individual ignored tag keys</span>
</span></span><span style=display:flex><span>  - SomeCustomKey
</span></span><span style=display:flex><span>  - AnotherCustomKey
</span></span><span style=display:flex><span>  keyPrefixes: <span style=color:green># ignored tag key prefixes</span>
</span></span><span style=display:flex><span>  - user.specific/prefix/
</span></span></code></pre></div><p>The <code>enableECRAccess</code> flag specifies whether the AWS IAM role policy attached to all worker nodes of the cluster shall contain permissions to access the Elastic Container Registry of the respective AWS account.
If the flag is not provided it is defaulted to <code>true</code>.
Please note that if the <code>iamInstanceProfile</code> is set for a worker pool in the <code>WorkerConfig</code> (see below) then <code>enableECRAccess</code> does not have any effect.
It only applies for those worker pools whose <code>iamInstanceProfile</code> is not set.</p><details><summary>Click to expand the default AWS IAM policy document used for the instance profiles!</summary><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;Version&#34;: <span style=color:#a31515>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>  &#34;Statement&#34;: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      &#34;Effect&#34;: <span style=color:#a31515>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      &#34;Action&#34;: [
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;ec2:DescribeInstances&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      &#34;Resource&#34;: [
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;*&#34;</span>
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:green>// Only if `.enableECRAccess` is `true`.
</span></span></span><span style=display:flex><span><span style=color:green></span>    {
</span></span><span style=display:flex><span>      &#34;Effect&#34;: <span style=color:#a31515>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      &#34;Action&#34;: [
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;ecr:GetAuthorizationToken&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;ecr:BatchCheckLayerAvailability&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;ecr:GetDownloadUrlForLayer&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;ecr:GetRepositoryPolicy&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;ecr:DescribeRepositories&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;ecr:ListImages&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;ecr:BatchGetImage&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      &#34;Resource&#34;: [
</span></span><span style=display:flex><span>        <span style=color:#a31515>&#34;*&#34;</span>
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></details><p>The <code>dualStack.enabled</code> flag specifies whether dual-stack or IPv4-only should be supported by the infrastructure.
When the flag is set to true an Amazon provided IPv6 CIDR block will be attached to the VPC.
All subnets will receive a <code>/64</code> block from it and a route entry is added to the main route table to route all IPv6 traffic over the IGW.</p><p>The <code>networks.vpc</code> section describes whether you want to create the shoot cluster in an already existing VPC or whether to create a new one:</p><ul><li>If <code>networks.vpc.id</code> is given then you have to specify the VPC ID of the existing VPC that was created by other means (manually, other tooling, &mldr;).
Please make sure that the VPC has attached an internet gateway - the AWS controller won&rsquo;t create one automatically for existing VPCs. To make sure the nodes are able to join and operate in your cluster properly, please make sure that your VPC has enabled <a href=https://docs.aws.amazon.com/vpc/latest/userguide/vpc-dns.html>DNS Support</a>, explicitly the attributes <code>enableDnsHostnames</code> and <code>enableDnsSupport</code> must be set to <code>true</code>.</li><li>If <code>networks.vpc.cidr</code> is given then you have to specify the VPC CIDR of a new VPC that will be created during shoot creation.
You can freely choose a private CIDR range.</li><li>Either <code>networks.vpc.id</code> or <code>networks.vpc.cidr</code> must be present, but not both at the same time.</li><li><code>networks.vpc.gatewayEndpoints</code> is optional. If specified then each item is used as service name in a corresponding Gateway VPC Endpoint.</li></ul><p>The <code>networks.zones</code> section contains configuration for resources you want to create or use in availability zones.
For every zone, the AWS extension creates three subnets:</p><ul><li>The <code>internal</code> subnet is used for <a href=https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/elb-internal-load-balancers.html>internal AWS load balancers</a>.</li><li>The <code>public</code> subnet is used for <a href=https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/elb-internet-facing-load-balancers.html>public AWS load balancers</a>.</li><li>The <code>workers</code> subnet is used for all shoot worker nodes, i.e., VMs which later run your applications.</li></ul><p>For every subnet, you have to specify a CIDR range contained in the VPC CIDR specified above, or the VPC CIDR of your already existing VPC.
You can freely choose these CIDRs and it is your responsibility to properly design the network layout to suit your needs.</p><p>Also, the AWS extension creates a dedicated NAT gateway for each zone.
By default, it also creates a corresponding Elastic IP that it attaches to this NAT gateway and which is used for egress traffic.
The <code>elasticIPAllocationID</code> field allows you to specify the ID of an existing Elastic IP allocation in case you want to bring your own.
If provided, no new Elastic IP will be created and, instead, the Elastic IP specified by you will be used.</p><p>⚠️ If you change this field for an already existing infrastructure then it will disrupt egress traffic while AWS applies this change.
The reason is that the NAT gateway must be recreated with the new Elastic IP association.
Also, please note that the existing Elastic IP will be permanently deleted if it was earlier created by the AWS extension.</p><p>You can configure <a href=https://docs.aws.amazon.com/vpc/latest/userguide/vpce-gateway.html>Gateway VPC Endpoints</a> by adding items in the optional list <code>networks.vpc.gatewayEndpoints</code>. Each item in the list is used as a service name and a corresponding endpoint is created for it. All created endpoints point to the service within the cluster&rsquo;s region. For example, consider this (partial) shoot config:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  region: eu-central-1
</span></span><span style=display:flex><span>  provider:
</span></span><span style=display:flex><span>    type: aws
</span></span><span style=display:flex><span>    infrastructureConfig:
</span></span><span style=display:flex><span>      apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>      kind: InfrastructureConfig
</span></span><span style=display:flex><span>      networks:
</span></span><span style=display:flex><span>        vpc:
</span></span><span style=display:flex><span>          gatewayEndpoints:
</span></span><span style=display:flex><span>          - s3
</span></span></code></pre></div><p>The service name of the S3 Gateway VPC Endpoint in this example is <code>com.amazonaws.eu-central-1.s3</code>.</p><p>If you want to use multiple availability zones then add a second, third, &mldr; entry to the <code>networks.zones[]</code> list and properly specify the AZ name in <code>networks.zones[].name</code>.</p><p>Apart from the VPC and the subnets the AWS extension will also create DHCP options and an internet gateway (only if a new VPC is created), routing tables, security groups, elastic IPs, NAT gateways, EC2 key pairs, IAM roles, and IAM instance profiles.</p><p>The <code>ignoreTags</code> section allows to configure which resource tags on AWS resources managed by Gardener should be ignored during
infrastructure reconciliation. By default, all tags that are added outside of Gardener&rsquo;s
reconciliation will be removed during the next reconciliation. This field allows users and automation to add
custom tags on AWS resources created and managed by Gardener without loosing them on the next reconciliation.
Tags can ignored either by specifying exact key values (<code>ignoreTags.keys</code>) or key prefixes (<code>ignoreTags.keyPrefixes</code>).
In both cases it is forbidden to ignore the <code>Name</code> tag or any tag starting with <code>kubernetes.io</code> or <code>gardener.cloud</code>.
Please note though, that the tags are only ignored on resources created on behalf of the <code>Infrastructure</code> CR (i.e. VPC,
subnets, security groups, keypair, etc.), while tags on machines, volumes, etc. are not in the scope of this controller.</p><h2 id=controlplaneconfig><code>ControlPlaneConfig</code></h2><p>The control plane configuration mainly contains values for the AWS-specific control plane components.
Today, the only component deployed by the AWS extension is the <code>cloud-controller-manager</code>.</p><p>An example <code>ControlPlaneConfig</code> for the AWS extension looks as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>kind: ControlPlaneConfig
</span></span><span style=display:flex><span>cloudControllerManager:
</span></span><span style=display:flex><span><span style=color:green># featureGates:</span>
</span></span><span style=display:flex><span><span style=color:green>#   SomeKubernetesFeature: true</span>
</span></span><span style=display:flex><span>  useCustomRouteController: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span><span style=color:green># loadBalancerController:</span>
</span></span><span style=display:flex><span><span style=color:green>#   enabled: true</span>
</span></span><span style=display:flex><span><span style=color:green>#   ingressClassName: alb</span>
</span></span><span style=display:flex><span><span style=color:green># ipamController:</span>
</span></span><span style=display:flex><span><span style=color:green>#   enabled: true</span>
</span></span><span style=display:flex><span>storage:
</span></span><span style=display:flex><span>  managedDefaultClass: <span style=color:#00f>false</span>
</span></span></code></pre></div><p>The <code>cloudControllerManager.featureGates</code> contains a map of explicitly enabled or disabled feature gates.
For production usage it&rsquo;s not recommend to use this field at all as you can enable alpha features or disable beta/stable features, potentially impacting the cluster stability.
If you don&rsquo;t want to configure anything for the <code>cloudControllerManager</code> simply omit the key in the YAML specification.</p><p>The <code>cloudControllerManager.useCustomRouteController</code> controls if the <a href=https://github.com/gardener/aws-custom-route-controller>custom routes controller</a> should be enabled.
If enabled, it will add routes to the pod CIDRs for all nodes in the route tables for all zones.</p><p>The <code>storage.managedDefaultClass</code> controls if the <code>default</code> storage / volume snapshot classes are marked as default by Gardener. Set it to <code>false</code> to <a href=https://kubernetes.io/docs/tasks/administer-cluster/change-default-storage-class/>mark another storage / volume snapshot class as default</a> without Gardener overwriting this change. If unset, this field defaults to <code>true</code>.</p><p>If the <a href=https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/>AWS Load Balancer Controller</a> should be deployed, set <code>loadBalancerController.enabled</code> to <code>true</code>.
In this case, it is assumed that an <code>IngressClass</code> named <code>alb</code> is created <strong>by the user</strong>.
You can overwrite the name by setting <code>loadBalancerController.ingressClassName</code>.</p><p>Please note, that currently only the &ldquo;instance&rdquo; mode is supported.</p><h3 id=examples-for-ingress-and-service-managed-by-the-aws-load-balancer-controller>Examples for <code>Ingress</code> and <code>Service</code> managed by the AWS Load Balancer Controller:</h3><ol start=0><li>Prerequites</li></ol><p>Make sure you have created an <code>IngressClass</code>. For more details about parameters, please see <a href=https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/ingress/ingress_class/>AWS Load Balancer Controller - IngressClass</a></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: networking.k8s.io/v1
</span></span><span style=display:flex><span>kind: IngressClass
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: alb <span style=color:green># default name if not specified by `loadBalancerController.ingressClassName`</span>
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  controller: ingress.k8s.aws/alb
</span></span></code></pre></div><ol><li>Ingress</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: networking.k8s.io/v1
</span></span><span style=display:flex><span>kind: Ingress
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  namespace: default
</span></span><span style=display:flex><span>  name: echoserver
</span></span><span style=display:flex><span>  annotations:
</span></span><span style=display:flex><span>    <span style=color:green># complete set of annotations: https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/ingress/annotations/</span>
</span></span><span style=display:flex><span>    alb.ingress.kubernetes.io/scheme: internet-facing
</span></span><span style=display:flex><span>    alb.ingress.kubernetes.io/target-type: instance <span style=color:green># target-type &#34;ip&#34; NOT supported in Gardener</span>
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  ingressClassName: alb
</span></span><span style=display:flex><span>  rules:
</span></span><span style=display:flex><span>    - http:
</span></span><span style=display:flex><span>        paths:
</span></span><span style=display:flex><span>        - path: /
</span></span><span style=display:flex><span>          pathType: Prefix
</span></span><span style=display:flex><span>          backend:
</span></span><span style=display:flex><span>            service:
</span></span><span style=display:flex><span>              name: echoserver
</span></span><span style=display:flex><span>              port:
</span></span><span style=display:flex><span>                number: 80
</span></span></code></pre></div><p>For more details see <a href=https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/ingress/spec/>AWS Load Balancer Documentation - Ingress Specification</a></p><ol start=2><li>Service of Type <code>LoadBalancer</code></li></ol><p>This can be used to create a Network Load Balancer (NLB).</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Service
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  annotations:
</span></span><span style=display:flex><span>    <span style=color:green># complete set of annotations: https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/service/annotations/</span>
</span></span><span style=display:flex><span>    service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: instance <span style=color:green># target-type &#34;ip&#34; NOT supported in Gardener</span>
</span></span><span style=display:flex><span>    service.beta.kubernetes.io/aws-load-balancer-scheme: internet-facing
</span></span><span style=display:flex><span>  name: ingress-nginx-controller
</span></span><span style=display:flex><span>  namespace: ingress-nginx
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  type: LoadBalancer
</span></span><span style=display:flex><span>  loadBalancerClass: service.k8s.aws/nlb <span style=color:green># mandatory to be managed by AWS Load Balancer Controller (otherwise the Cloud Controller Manager will act on it)</span>
</span></span></code></pre></div><p>For more details see <a href=https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/service/nlb/>AWS Load Balancer Documentation - Network Load Balancer</a></p><p>⚠️ When using Network Load Balancers (NLB) as internal load balancers, it is crucial to add the annotation <code>service.beta.kubernetes.io/aws-load-balancer-target-group-attributes: preserve_client_ip.enabled=false</code>. Without this annotation, if a request is routed by the NLB to the same target instance from which it originated, the client IP and destination IP will be identical. This situation, known as the hairpinning effect, will prevent the request from being processed.</p><h2 id=workerconfig><code>WorkerConfig</code></h2><p>The AWS extension supports encryption for volumes plus support for additional data volumes per machine.
For each data volume, you have to specify a name.
By default (if not stated otherwise), all the disks (root & data volumes) are encrypted.
Please make sure that your <a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html>instance-type supports encryption</a>.
If your instance-type doesn&rsquo;t support encryption, you will have to disable encryption (which is enabled by default) by setting <code>volume.encrpyted</code> to <code>false</code> (refer below shown YAML snippet).</p><p>The following YAML is a snippet of a <code>Shoot</code> resource:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  provider:
</span></span><span style=display:flex><span>    workers:
</span></span><span style=display:flex><span>    - name: cpu-worker
</span></span><span style=display:flex><span>      ...
</span></span><span style=display:flex><span>      volume:
</span></span><span style=display:flex><span>        type: gp2
</span></span><span style=display:flex><span>        size: 20Gi
</span></span><span style=display:flex><span>        encrypted: <span style=color:#00f>false</span>
</span></span><span style=display:flex><span>      dataVolumes:
</span></span><span style=display:flex><span>      - name: kubelet-dir
</span></span><span style=display:flex><span>        type: gp2
</span></span><span style=display:flex><span>        size: 25Gi
</span></span><span style=display:flex><span>        encrypted: <span style=color:#00f>true</span>
</span></span></code></pre></div><blockquote><p>Note: The AWS extension does not support EBS volume (root & data volumes) encryption with <a href=https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk>customer managed CMK</a>. Support for <a href=https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk>customer managed CMK</a> is out of scope for now. Only <a href=https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#aws-managed-cmk>AWS managed CMK</a> is supported.</p></blockquote><p>Additionally, it is possible to provide further AWS-specific values for configuring the worker pools. The additional configuration must be specified in the <code>providerConfig</code> field of the respective worker.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  provider:
</span></span><span style=display:flex><span>    workers:
</span></span><span style=display:flex><span>      - name: cpu-worker
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>        providerConfig:
</span></span><span style=display:flex><span>          <span style=color:green># AWS worker config</span>
</span></span></code></pre></div><p>The configuration will be evaluated when the provider-aws will reconcile the worker pools for the respective shoot.</p><p>An example <code>WorkerConfig</code> for the AWS extension looks as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  provider:
</span></span><span style=display:flex><span>    workers:
</span></span><span style=display:flex><span>      - name: cpu-worker
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>        providerConfig:
</span></span><span style=display:flex><span>            apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>            kind: WorkerConfig
</span></span><span style=display:flex><span>            volume:
</span></span><span style=display:flex><span>              iops: 10000
</span></span><span style=display:flex><span>              throughput: 200
</span></span><span style=display:flex><span>            dataVolumes:
</span></span><span style=display:flex><span>            - name: kubelet-dir
</span></span><span style=display:flex><span>              iops: 12345
</span></span><span style=display:flex><span>              throughput: 150
</span></span><span style=display:flex><span>              snapshotID: snap-1234
</span></span><span style=display:flex><span>            iamInstanceProfile: <span style=color:green># (specify either ARN or name)</span>
</span></span><span style=display:flex><span>              name: my-profile
</span></span><span style=display:flex><span>            instanceMetadataOptions:
</span></span><span style=display:flex><span>              httpTokens: required
</span></span><span style=display:flex><span>              httpPutResponseHopLimit: 2
</span></span><span style=display:flex><span>            <span style=color:green># arn: my-instance-profile-arn</span>
</span></span><span style=display:flex><span>            nodeTemplate: <span style=color:green># (to be specified only if the node capacity would be different from cloudprofile info during runtime)</span>
</span></span><span style=display:flex><span>              capacity:
</span></span><span style=display:flex><span>                cpu: 2 <span style=color:green># inherited from pool&#39;s machine type if un-specified</span>
</span></span><span style=display:flex><span>                gpu: 0 <span style=color:green># inherited from pool&#39;s machine type if un-specified</span>
</span></span><span style=display:flex><span>                memory: 50Gi <span style=color:green># inherited from pool&#39;s machine type if un-specified</span>
</span></span><span style=display:flex><span>                ephemeral-storage: 10Gi <span style=color:green># override to specify explicit ephemeral-storage for scale fro zero</span>
</span></span><span style=display:flex><span>                resource.com/dongle: 4 <span style=color:green># Example of a custom, extended resource.</span>
</span></span></code></pre></div><p>The <code>.volume.iops</code> is the number of I/O operations per second (IOPS) that the volume supports.
For <code>io1</code> and <code>gp3</code> volume type, this represents the number of IOPS that are provisioned for the volume.
For <code>gp2</code> volume type, this represents the baseline performance of the volume and the rate at which the volume accumulates I/O credits for bursting. For more information about General Purpose SSD baseline performance, I/O credits, IOPS range and bursting, see Amazon EBS Volume Types (<a href=http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSVolumeTypes.html>http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSVolumeTypes.html</a>) in the Amazon Elastic Compute Cloud User Guide.<br>Constraint: IOPS should be a positive value. Validation of IOPS (i.e. whether it is allowed and is in the specified range for a particular volume type) is done on aws side.</p><p>The <code>volume.throughput</code> is the throughput that the volume supports, in <code>MiB/s</code>. As of <code>16th Aug 2022</code>, this parameter is valid only for <code>gp3</code> volume types and will return an error from the provider side if specified for other volume types. Its current range of throughput is from <code>125MiB/s</code> to <code>1000 MiB/s</code>. To know more about throughput and its range, see the official AWS documentation <a href=http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSVolumeTypes.html>here</a>.</p><p>The <code>.dataVolumes</code> can optionally contain configurations for the data volumes stated in the <code>Shoot</code> specification in the <code>.spec.provider.workers[].dataVolumes</code> list.
The <code>.name</code> must match to the name of the data volume in the shoot.
It is also possible to provide a snapshot ID. It allows to <a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-restoring-volume.html>restore the data volume from an existing snapshot</a>.</p><p>The <code>iamInstanceProfile</code> section allows to specify the IAM instance profile name xor ARN that should be used for this worker pool.
If not specified, a dedicated IAM instance profile created by the infrastructure controller is used (see above).</p><p>The <code>instanceMetadataOptions</code> controls access to the instance metadata service (IMDS) for members of the worker. You can do the following operations:</p><ul><li>access IMDSv1 (default)</li><li>access IMDSv2 - <code>httpPutResponseHopLimit >= 2</code></li><li>access IMDSv2 only (restrict access to IMDSv1) - <code>httpPutResponseHopLimit >=2</code>, <code>httpTokens = "required"</code></li><li>disable access to IMDS - <code>httpTokens = "required"</code></li></ul><blockquote><p>Note: The accessibility of IMDS discussed in the previous point is referenced from the point of view of containers <strong>NOT</strong> running in the host network.
By default on host network IMDSv2 is already enabled (but not accessible from inside the pods).
It is currently not possible to create a VM with complete restriction to the IMDS service. It is however possible to restrict access from inside the pods by setting <code>httpTokens</code> to <code>required</code> and not setting <code>httpPutResponseHopLimit</code> (or setting it to 1).</p></blockquote><p>You can find more information regarding the options in the <a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-IMDS-new-instances.html>AWS documentation</a>.</p><p><code>cpuOptions</code> grants more finegrained control over the worker&rsquo;s CPU configuration. It has two attributes:</p><ul><li><code>coreCount</code>: Specify a custom amount of cores the instance should be configured with.</li><li><code>threadsPerCore</code>: How many threads should there be on each core. Set to <code>1</code> to disable multi-threading.</li></ul><p>Note that if you decide to configure <code>cpuOptions</code> <em>both</em> these values need to be provided. For a list of valid combinations of these values refer to the <a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/cpu-options-supported-instances-values.html>AWS documentation</a>.</p><h2 id=example-shoot-manifest-one-availability-zone>Example <code>Shoot</code> manifest (one availability zone)</h2><p>Please find below an example <code>Shoot</code> manifest for one availability zone:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>kind: Shoot
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: johndoe-aws
</span></span><span style=display:flex><span>  namespace: garden-dev
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  cloudProfile:
</span></span><span style=display:flex><span>    name: aws
</span></span><span style=display:flex><span>  region: eu-central-1
</span></span><span style=display:flex><span>  secretBindingName: core-aws
</span></span><span style=display:flex><span>  provider:
</span></span><span style=display:flex><span>    type: aws
</span></span><span style=display:flex><span>    infrastructureConfig:
</span></span><span style=display:flex><span>      apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>      kind: InfrastructureConfig
</span></span><span style=display:flex><span>      networks:
</span></span><span style=display:flex><span>        vpc:
</span></span><span style=display:flex><span>          cidr: 10.250.0.0/16
</span></span><span style=display:flex><span>        zones:
</span></span><span style=display:flex><span>        - name: eu-central-1a
</span></span><span style=display:flex><span>          internal: 10.250.112.0/22
</span></span><span style=display:flex><span>          public: 10.250.96.0/22
</span></span><span style=display:flex><span>          workers: 10.250.0.0/19
</span></span><span style=display:flex><span>    controlPlaneConfig:
</span></span><span style=display:flex><span>      apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>      kind: ControlPlaneConfig
</span></span><span style=display:flex><span>    workers:
</span></span><span style=display:flex><span>    - name: worker-xoluy
</span></span><span style=display:flex><span>      machine:
</span></span><span style=display:flex><span>        type: m5.large
</span></span><span style=display:flex><span>      minimum: 2
</span></span><span style=display:flex><span>      maximum: 2
</span></span><span style=display:flex><span>      volume:
</span></span><span style=display:flex><span>        size: 50Gi
</span></span><span style=display:flex><span>        type: gp2
</span></span><span style=display:flex><span>    <span style=color:green># The following provider config is valid if the volume type is `io1`.</span>
</span></span><span style=display:flex><span>    <span style=color:green># providerConfig:</span>
</span></span><span style=display:flex><span>    <span style=color:green>#   apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1</span>
</span></span><span style=display:flex><span>    <span style=color:green>#   kind: WorkerConfig</span>
</span></span><span style=display:flex><span>    <span style=color:green>#   volume:</span>
</span></span><span style=display:flex><span>    <span style=color:green>#     iops: 10000</span>
</span></span><span style=display:flex><span>      zones:
</span></span><span style=display:flex><span>      - eu-central-1a
</span></span><span style=display:flex><span>  networking:
</span></span><span style=display:flex><span>    nodes: 10.250.0.0/16
</span></span><span style=display:flex><span>    type: calico
</span></span><span style=display:flex><span>  kubernetes:
</span></span><span style=display:flex><span>    version: 1.28.2
</span></span><span style=display:flex><span>  maintenance:
</span></span><span style=display:flex><span>    autoUpdate:
</span></span><span style=display:flex><span>      kubernetesVersion: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>      machineImageVersion: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>  addons:
</span></span><span style=display:flex><span>    kubernetesDashboard:
</span></span><span style=display:flex><span>      enabled: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>    nginxIngress:
</span></span><span style=display:flex><span>      enabled: <span style=color:#00f>true</span>
</span></span></code></pre></div><h2 id=example-shoot-manifest-three-availability-zones>Example <code>Shoot</code> manifest (three availability zones)</h2><p>Please find below an example <code>Shoot</code> manifest for three availability zones:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>kind: Shoot
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: johndoe-aws
</span></span><span style=display:flex><span>  namespace: garden-dev
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  cloudProfile:
</span></span><span style=display:flex><span>    name: aws
</span></span><span style=display:flex><span>  region: eu-central-1
</span></span><span style=display:flex><span>  secretBindingName: core-aws
</span></span><span style=display:flex><span>  provider:
</span></span><span style=display:flex><span>    type: aws
</span></span><span style=display:flex><span>    infrastructureConfig:
</span></span><span style=display:flex><span>      apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>      kind: InfrastructureConfig
</span></span><span style=display:flex><span>      networks:
</span></span><span style=display:flex><span>        vpc:
</span></span><span style=display:flex><span>          cidr: 10.250.0.0/16
</span></span><span style=display:flex><span>        zones:
</span></span><span style=display:flex><span>        - name: eu-central-1a
</span></span><span style=display:flex><span>          workers: 10.250.0.0/26
</span></span><span style=display:flex><span>          public: 10.250.96.0/26
</span></span><span style=display:flex><span>          internal: 10.250.112.0/26
</span></span><span style=display:flex><span>        - name: eu-central-1b
</span></span><span style=display:flex><span>          workers: 10.250.0.64/26
</span></span><span style=display:flex><span>          public: 10.250.96.64/26
</span></span><span style=display:flex><span>          internal: 10.250.112.64/26
</span></span><span style=display:flex><span>        - name: eu-central-1c
</span></span><span style=display:flex><span>          workers: 10.250.0.128/26
</span></span><span style=display:flex><span>          public: 10.250.96.128/26
</span></span><span style=display:flex><span>          internal: 10.250.112.128/26
</span></span><span style=display:flex><span>    controlPlaneConfig:
</span></span><span style=display:flex><span>      apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>      kind: ControlPlaneConfig
</span></span><span style=display:flex><span>    workers:
</span></span><span style=display:flex><span>    - name: worker-xoluy
</span></span><span style=display:flex><span>      machine:
</span></span><span style=display:flex><span>        type: m5.large
</span></span><span style=display:flex><span>      minimum: 3
</span></span><span style=display:flex><span>      maximum: 9
</span></span><span style=display:flex><span>      volume:
</span></span><span style=display:flex><span>        size: 50Gi
</span></span><span style=display:flex><span>        type: gp2
</span></span><span style=display:flex><span>      zones:
</span></span><span style=display:flex><span>      - eu-central-1a
</span></span><span style=display:flex><span>      - eu-central-1b
</span></span><span style=display:flex><span>      - eu-central-1c
</span></span><span style=display:flex><span>  networking:
</span></span><span style=display:flex><span>    nodes: 10.250.0.0/16
</span></span><span style=display:flex><span>    type: calico
</span></span><span style=display:flex><span>  kubernetes:
</span></span><span style=display:flex><span>    version: 1.28.2
</span></span><span style=display:flex><span>  maintenance:
</span></span><span style=display:flex><span>    autoUpdate:
</span></span><span style=display:flex><span>      kubernetesVersion: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>      machineImageVersion: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>  addons:
</span></span><span style=display:flex><span>    kubernetesDashboard:
</span></span><span style=display:flex><span>      enabled: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>    nginxIngress:
</span></span><span style=display:flex><span>      enabled: <span style=color:#00f>true</span>
</span></span></code></pre></div><h2 id=example-shoot-manifest-ipv6>Example <code>Shoot</code> manifest (IPv6)</h2><p>Please find below an example <code>Shoot</code> manifest for an IPv6 shoot cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>kind: Shoot
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: johndoe-aws-ipv6
</span></span><span style=display:flex><span>  namespace: garden-dev
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  cloudProfile:
</span></span><span style=display:flex><span>    name: aws
</span></span><span style=display:flex><span>  region: eu-central-1
</span></span><span style=display:flex><span>  secretBindingName: core-aws
</span></span><span style=display:flex><span>  provider:
</span></span><span style=display:flex><span>    type: aws
</span></span><span style=display:flex><span>    infrastructureConfig:
</span></span><span style=display:flex><span>      apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>      kind: InfrastructureConfig
</span></span><span style=display:flex><span>      networks:
</span></span><span style=display:flex><span>        vpc:
</span></span><span style=display:flex><span>          cidr: 10.250.0.0/16
</span></span><span style=display:flex><span>        zones:
</span></span><span style=display:flex><span>        - name: eu-central-1a
</span></span><span style=display:flex><span>          public: 10.250.96.0/22
</span></span><span style=display:flex><span>          internal: 10.250.112.0/22
</span></span><span style=display:flex><span>    controlPlaneConfig:
</span></span><span style=display:flex><span>      apiVersion: aws.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>      kind: ControlPlaneConfig
</span></span><span style=display:flex><span>    workers:
</span></span><span style=display:flex><span>    - ...
</span></span><span style=display:flex><span>  networking:
</span></span><span style=display:flex><span>    ipFamilies:
</span></span><span style=display:flex><span>    - IPv6
</span></span><span style=display:flex><span>    type: calico
</span></span><span style=display:flex><span>  kubernetes:
</span></span><span style=display:flex><span>    version: 1.28.2
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  addons:
</span></span><span style=display:flex><span>    kubernetesDashboard:
</span></span><span style=display:flex><span>      enabled: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>    nginxIngress:
</span></span><span style=display:flex><span>      enabled: <span style=color:#00f>false</span>
</span></span></code></pre></div><h2 id=csi-volume-provisioners>CSI volume provisioners</h2><p>Every AWS shoot cluster will be deployed with the AWS EBS CSI driver.
It is compatible with the legacy in-tree volume provisioner that was deprecated by the Kubernetes community and will be removed in future versions of Kubernetes.
End-users might want to update their custom <code>StorageClass</code>es to the new <code>ebs.csi.aws.com</code> provisioner.</p><h3 id=node-specific-volume-limits>Node-specific Volume Limits</h3><p>The Kubernetes scheduler allows configurable limit for the number of volumes that can be attached to a node. See <a href=https://k8s.io/docs/concepts/storage/storage-limits/#custom-limits>https://k8s.io/docs/concepts/storage/storage-limits/#custom-limits</a>.</p><p>CSI drivers usually have a different procedure for configuring this custom limit. By default, the EBS CSI driver parses the machine type name and then decides the volume limit. However, this is only a rough approximation and not good enough in most cases. Specifying the volume attach limit via command line flag (<code>--volume-attach-limit</code>) is currently the alternative until a more sophisticated solution presents itself (dynamically discovering the maximum number of attachable volume per EC2 machine type, see also <a href=https://github.com/kubernetes-sigs/aws-ebs-csi-driver/issues/347>https://github.com/kubernetes-sigs/aws-ebs-csi-driver/issues/347</a>). The AWS extension allows the <code>--volume-attach-limit</code> flag of the EBS CSI driver to be configurable via <code>aws.provider.extensions.gardener.cloud/volume-attach-limit</code> annotation on the <code>Shoot</code> resource. If the annotation is added to an existing <code>Shoot</code>, then reconciliation needs to be triggered manually (see <a href=/docs/gardener/shoot-operations/shoot_operations/#immediate-reconciliation>Immediate reconciliation</a>), as in general adding annotation to resource is not a change that leads to <code>.metadata.generation</code> increase in general.</p><h3 id=other-csi-options>Other CSI options</h3><p>The newer versions of EBS CSI driver are not readily compatible with the use of XFS volumes on nodes using a kernel version &lt;= 5.4.
A workaround was added that enables the use of a &ldquo;legacy XFS&rdquo; mode that introduces a backwards compatible volume formating for the older kernels. You can enable this option for your shoot by annotating it with <code>aws.provider.extensions.gardener.cloud/legacy-xfs=true</code>.</p><h2 id=kubernetes-versions-per-worker-pool>Kubernetes Versions per Worker Pool</h2><p>This extension supports <code>gardener/gardener</code>&rsquo;s <code>WorkerPoolKubernetesVersion</code> feature gate, i.e., having <a href=https://github.com/gardener/gardener/blob/8a9c88866ec5fce59b5acf57d4227eeeb73669d7/example/90-shoot.yaml#L69-L70>worker pools with overridden Kubernetes versions</a> since <code>gardener-extension-provider-aws@v1.34</code>.</p><h2 id=shoot-ca-certificate-and-serviceaccount-signing-key-rotation>Shoot CA Certificate and <code>ServiceAccount</code> Signing Key Rotation</h2><p>This extension supports <code>gardener/gardener</code>&rsquo;s <code>ShootCARotation</code> and <code>ShootSARotation</code> feature gates since <code>gardener-extension-provider-aws@v1.36</code>.</p><h2 id=flow-infrastructure-reconciler>Flow Infrastructure Reconciler</h2><p>The extension offers two different reconciler implementations for the infrastructure resource:</p><ul><li>terraform-based</li><li>native Go SDK based (dubbed the &ldquo;flow&rdquo;-based implementation)</li></ul><p>The default implementation currently is the terraform reconciler which uses the <code>https://github.com/gardener/terraformer</code> as the backend for managing the shoot&rsquo;s infrastructure.</p><p>The &ldquo;flow&rdquo; implementation is a newer implementation that is trying to solve issues we faced with managing terraform infrastructure on Kubernetes. The goal is to have more control over the reconciliation process and be able to perform fine-grained tuning over it. The implementation is completely backwards-compatible and offers a migration route from the legacy terraformer implementation.</p><p>For most users there will be no noticable difference. However for certain use-cases, users may notice a slight deviation from the previous behavior. For example, with flow-based infrastructure users may be able to perform certain modifications to infrastructure resources without having them reconciled back by terraform. Operations that would degrade the shoot infrastructure are still expected to be reverted back.</p><p>For the time-being, to take advantage of the flow reconcilier users have to &ldquo;opt-in&rdquo; by annotating the shoot manifest with: <code>aws.provider.extensions.gardener.cloud/use-flow="true"</code>. For existing shoots with this annotation, the migration will take place on the next infrastructure reconciliation (on maintenance window or if other infrastructure changes are requested). The migration is not revertible.</p></div></main></div></div><footer class="footer row d-print-none"><div class="container-fluid footer-wrapper"><ul class=nav><li><a href=https://gardener.cloud/blog/>Blogs</a></li><li><a href=https://gardener.cloud/community/>Community</a></li><li><a href=https://gardener.cloud/adopter/>Adopters</a></li><li><a href=/docs/>Documentation</a></li></ul><img src=/images/lp/gardener-logo.svg alt="Logo Gardener" class=logo><ul class=media-wr><li><a target=_blank href=https://kubernetes.slack.com/archives/CB57N0BFG><img src=/images/branding/slack-logo-white.svg class=media-icon><div class=media-text>Slack</div></a></li><li><a target=_blank href=https://github.com/gardener><img src=/images/branding/github-mark-logo.png class=media-icon><div class=media-text>GitHub</div></a></li><li><a target=_blank href=https://www.youtube.com/channel/UCwUhwKFREV8Su0gwAJQX7tw><img src=/images/branding/youtube-logo-dark.svg class=media-icon><div class=media-text>YouTube</div></a></li><li><a target=_blank href=https://twitter.com/GardenerProject><img src=/images/branding/twitter-logo-white.svg class=media-icon><div class=media-text>Twitter</div></a></li></ul><span class=copyright>Copyright 2019-2023 Gardener project authors. <a href=https://www.sap.com/corporate/en/legal/privacy.html>Privacy policy
<i class="fa fa-external-link" aria-hidden=true></i></a></span></div></footer></div><script src=/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>