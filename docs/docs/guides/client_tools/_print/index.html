<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.1"><link rel=canonical type=text/html href=https://gardener.cloud/docs/guides/client_tools/><link rel=alternate type=application/rss+xml href=https://gardener.cloud/docs/guides/client_tools/index.xml><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=icon type=image/x-icon href=https://gardener.cloud/images/favicon.ico><link rel=icon type=image/png href=https://gardener.cloud/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://gardener.cloud/images/favicon-16x16.png sizes=16x16><title>Set Up Client Tools | Gardener</title><meta name=description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta property="og:title" content="Set Up Client Tools"><meta property="og:description" content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta property="og:type" content="website"><meta property="og:url" content="https://gardener.cloud/docs/guides/client_tools/"><meta itemprop=name content="Set Up Client Tools"><meta itemprop=description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta name=twitter:card content="summary"><meta name=twitter:title content="Set Up Client Tools"><meta name=twitter:description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><link rel=preload href=/scss/main.min.122f9effc36493edf1f25030c2ce7965b16b3b0eaeb02528b9a50e0fa9110c15.css as=style><link href=/scss/main.min.122f9effc36493edf1f25030c2ce7965b16b3b0eaeb02528b9a50e0fa9110c15.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg width="90" height="90" viewBox="0 0 90 90" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>logo</title><desc>Created with Sketch.</desc><defs><path d="M41.8864954.994901575c.996545099999999-.479910833 2.6164002-.477918931 3.6088091.0L76.8159138 16.0781121C77.8124589 16.5580229 78.8208647 17.8257185 79.0659694 18.8995926l7.7355517 33.8916663C87.0476474 53.8696088 86.6852538 55.4484075 85.9984855 56.3095876L64.3239514 83.4885938C63.6343208 84.3533632 62.1740175 85.0543973 61.0725268 85.0543973H26.3092731c-1.1060816.0-2.5646564-.704623400000003-3.2514246-1.5658035L1.38331434 56.3095876C.693683723 55.4448182.335174016 53.865133.580278769 52.7912589L8.31583044 18.8995926C8.56195675 17.8212428 9.57347722 16.556031 10.5658861 16.0781121L41.8864954.994901575z" id="path-1"/><linearGradient x1="12.7542673%" y1="-18.6617048%" x2="88.2666158%" y2="84.6075483%" id="linearGradient-3"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="50%" y1="4.93673768%" x2="148.756007%" y2="175.514523%" id="linearGradient-4"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="19.1574381%" y1="-9.04800713%" x2="82.2203149%" y2="77.9084293%" id="linearGradient-5"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="57.4403751%" y1="26.3148481%" x2="137.966711%" y2="158.080556%" id="linearGradient-6"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="logo"><g id="Rectangle-2" transform="translate(1.000000, 0.000000)"><mask id="mask-2" fill="#fff"><use xlink:href="#path-1"/></mask><use id="Mask" fill="#009f76" xlink:href="#path-1"/><polygon fill="#000" opacity=".289628623" mask="url(#mask-2)" points="-17.6484375 54.5224609 30.8242188 25.0791016 63.4726562 58.5 24.7324219 92.6689453"/></g><path d="M56.8508631 39.260019C56.4193519 40.443987 55.6088085 41.581593 54.6736295 42.1938694l-8.0738997 5.2861089c-1.3854671.907087099999998-3.6247515.9116711-5.0172201.0L33.50861 42.1938694C32.123143 41.2867823 31 39.206345 31 37.545932V26.4150304c0-.725313.2131118-1.5301454.569268099999999-2.2825772L56.8508631 39.260019z" id="Combined-Shape" fill="url(#linearGradient-3)" transform="translate(43.925432, 36.147233) scale(-1, 1) translate(-43.925432, -36.147233)"/><path d="M56.0774672 25.1412464C56.4306829 25.8903325 56.6425556 26.6907345 56.6425556 27.4119019V38.5428034c0 1.6598979-1.1161415 3.73626640000001-2.50861 4.6479374l-8.0738997 5.286109c-1.3854671.907087000000004-3.6247516.911671000000005-5.0172201.0L32.9689261 43.1907408C32.2918101 42.7474223 31.6773514 42.0238435 31.2260376 41.206007L56.0774672 25.1412464z" id="Combined-Shape" fill="url(#linearGradient-4)" transform="translate(43.821278, 37.246598) scale(-1, 1) translate(-43.821278, -37.246598)"/><path d="M65.0702134 57.1846889C64.5985426 58.2007851 63.8367404 59.1236871 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.1597438 58.7930183 24 56.7816693 24 55.1323495V37.1145303C24 36.3487436 24.249712 35.5060005 24.6599102 34.7400631L65.0702134 57.1846889z" id="Combined-Shape" fill="url(#linearGradient-5)"/><path d="M65.0189476 34.954538C65.3636909 35.6617313 65.5692194 36.42021 65.5692194 37.1145303V55.1323495C65.5692194 56.7842831 64.4072119 58.7943252 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.9237304 59.2341061 25.3159155 58.5918431 24.8568495 57.8487596L65.0189476 34.954538z" id="Combined-Shape" fill="url(#linearGradient-6)"/></g></g></svg></span><span class=text-capitalize>Gardener</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/adopter><span>Adopters</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog><span>Blogs</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community><span>Community</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs><span>Documentation</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.9b00f9e78392dcee0b4e0428613357b2.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/guides/client_tools/>Return to the regular view of this page</a>.</p></div><h1 class=title>Set Up Client Tools</h1><div class=content></div></div><div class=td-content><h1 id=pg-33170d28a5e3a076ed0ed50fed19149e>1 - Automated deployment</h1><div class=lead>Automated deployment with kubectl</div><h2 id=introduction>Introduction</h2><p>With kubectl you can easily deploy an image from your local environment.</p><p>However, what if you want to use a automated deployment script on a CI server (e.g. Jenkins), but don&rsquo;t want to store
the KUBECONFIG on that server?</p><p>You can use kubectl and connect to the API-server of your cluster.</p><h2 id=prerequisites>Prerequisites</h2><ol><li><p>Create a service account user</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubectl create serviceaccount deploy-user -n default
</code></pre></div></li><li><p>Bind a role to the newly created serviceuser</p><blockquote><p><strong>!!! Warning !!!</strong> In this example the preconfigured role <code>edit</code> and the namespace <code>default</code> is being used, please adjust the role to a more strict scope! see <a href=https://kubernetes.io/docs/admin/authorization/rbac/>https://kubernetes.io/docs/admin/authorization/rbac/</a></p></blockquote><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubectl create rolebinding deploy-default-role --clusterrole=edit --serviceaccount=default:deploy-user --namespace=default
</code></pre></div></li><li><p>Get the URL of your API-server</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>APISERVER=$(kubectl config view | grep server | cut -f 2- -d &#34;:&#34; | tr -d &#34; &#34;)
</code></pre></div></li><li><p>Get the service account</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>SERVICEACCOUNT=$(kubectl get serviceaccount deploy-user -n default -o=jsonpath={.secrets[0].name})
</code></pre></div></li><li><p>Generate a token for the serviceaccount</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>TOKEN=$(kubectl get secret -n default $SERVICEACCOUNT -o=jsonpath={.data.token} | base64 -D)
</code></pre></div></li></ol><h2 id=usage>Usage</h2><p>You can deploy your app without setting the kubeconfig locally, you just need to pass the environment variables (e.g. store them in the Jenkins credentials store)</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubectl --server=${APIServer} --token=${TOKEN} --insecure-skip-tls-verify=true apply --filename myapp.yaml
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-6cfaa64f7452ed600c92ebe35f6920a7>2 - Kubeconfig context as bash prompt</h1><div class=lead>Expose the active kubeconfig into bash</div><p>Use the Kubernetes command-line tool, <em>kubectl</em>, to deploy and manage applications on Kubernetes.
Using kubectl, you can inspect cluster resources; create, delete, and update components</p><p><img src=/__resources/howto-kubeconfig-bash_526f23.gif alt=port-forward></p><p>By default, the kubectl configuration is located at <code>~/.kube/config</code>.</p><p>Suppose you have two clusters, one for development work and one for scratch work.</p><p>How to handle this easily without copying the used configuration always to the right place?</p><h2 id=export-the-kubeconfig-enviroment-variable>Export the KUBECONFIG enviroment variable</h2><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>bash$ <span class=nb>export</span> <span class=nv>KUBECONFIG</span><span class=o>=</span>&lt;PATH-TO-M&gt;-CONFIG&gt;/kubeconfig-dev.yaml
</code></pre></div><p>How to determine which cluster is used by the kubectl command?</p><h2 id=determine-active-cluster>Determine active cluster</h2><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>bash$ kubectl cluster-info
Kubernetes master is running at https://api.dev.garden.shoot.canary.k8s-hana.ondemand.com
KubeDNS is running at https://api.dev.garden.shoot.canary.k8s-hana.ondemand.com/api/v1/proxy/namespaces/kube-system/services/kube-dns

To further debug and diagnose cluster problems, use <span class=s1>&#39;kubectl cluster-info dump&#39;</span>.
bash$ 
</code></pre></div><h2 id=display-cluster-in-the-bash---linux-and-alike>Display cluster in the bash - Linux and alike</h2><p>I found this tip on Stackoverflow and find it worth to be added here.
Edit your <code>~/.bash_profile</code> and add the following code snippet to show the current k8s
context in the shell&rsquo;s prompt.</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>prompt_k8s<span class=o>(){</span>
  <span class=nv>k8s_current_context</span><span class=o>=</span><span class=k>$(</span>kubectl config current-context 2&gt; /dev/null<span class=k>)</span>
  <span class=k>if</span> <span class=o>[[</span> <span class=nv>$?</span> -eq <span class=m>0</span> <span class=o>]]</span> <span class=p>;</span> <span class=k>then</span> <span class=nb>echo</span> -e <span class=s2>&#34;(</span><span class=si>${</span><span class=nv>k8s_current_context</span><span class=si>}</span><span class=s2>) &#34;</span><span class=p>;</span> <span class=k>fi</span>
<span class=o>}</span>
 
 
<span class=nv>PS1</span><span class=o>+=</span><span class=s1>&#39;$(prompt_k8s)&#39;</span>

</code></pre></div><p>After this your bash command prompt contains the active KUBECONFIG context and you always know
which cluster is active - <em>develop</em> or <em>production</em>.</p><p>e.g.</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>bash$ <span class=nb>export</span> <span class=nv>KUBECONFIG</span><span class=o>=</span>/Users/d023280/Documents/workspace/gardener-ui/kubeconfig_gardendev.yaml 
bash <span class=o>(</span>garden_dev<span class=o>)</span>$ 
</code></pre></div><p>Note the <strong>(garden_dev)</strong> prefix in the bash command prompt.</p><p><strong>This helps immensely to avoid thoughtless mistakes.</strong></p><h2 id=display-cluster-in-the-powershell---windows>Display cluster in the PowerShell - Windows</h2><p>Display current k8s cluster in the title of PowerShell window.</p><p>Create a <a href=https://superuser.com/a/1045659>profile</a> file for your shell under <code>%UserProfile%\Documents\Windows­PowerShell\Microsoft.PowerShell_profile.ps1</code></p><p>Copy following code to <code>Microsoft.PowerShell_profile.ps1</code></p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh> <span class=k>function</span> prompt_k8s <span class=o>{</span>
     <span class=nv>$k8s_current_context</span> <span class=o>=</span> <span class=o>(</span>kubectl config current-context<span class=o>)</span> <span class=p>|</span> Out-String
     <span class=k>if</span><span class=o>(</span><span class=nv>$?</span><span class=o>)</span> <span class=o>{</span>
         <span class=k>return</span> <span class=nv>$k8s_current_context</span>
     <span class=o>}</span><span class=k>else</span> <span class=o>{</span>
         <span class=k>return</span> <span class=s2>&#34;No K8S contenxt found&#34;</span>
     <span class=o>}</span>
 <span class=o>}</span>

 <span class=nv>$host</span>.ui.rawui.WindowTitle <span class=o>=</span> prompt_k8s
</code></pre></div><p><img src=/__resources/howto-bash_kubeconfig_powershell_bccbee.png alt=port-forward></p><p>If you want to switch to different cluster, you can set <code>KUBECONFIG</code> to new value, and re-run the file <code>Microsoft.PowerShell_profile.ps1</code></p></div><div class=td-content style=page-break-before:always><h1 id=pg-4811effaf016a84906632f2b2585ac68>3 - Organizing Access Using kubeconfig Files</h1><h1 id=organizing-access-using-kubeconfig-files>Organizing Access Using kubeconfig Files</h1><p>The kubectl command-line tool uses <code>kubeconfig</code> files to find the information it needs to choose a cluster and
communicate with the API server of a cluster.</p><h2 id=problem>Problem</h2><p>If you&rsquo;ve become aware of a security breach that affects you, you may want to revoke or cycle credentials
in case anything was leaked. However, this is not possible with the initial or master <code>kubeconfig</code> from your
cluster.</p><p><img src=/__resources/teaser_52b532.svg alt=teaser></p><h2 id=pitfall>Pitfall</h2><p>Never distribute the <code>kubeconfig</code>, which you can download directly within the Gardener dashboard, for a productive cluster.</p><p><img src=/__resources/kubeconfig-initial_bd3079.png alt=kubeconfig-dont></p><h2 id=create-custom-kubeconfig-file-for-each-user>Create custom kubeconfig file for each user</h2><p>Create a separate <code>kubeconfig</code> for each user. One of the big advantages is, that you can revoke them and control
the permissions better. A limitation to single namespaces is also possible here.</p><p>The script creates a new <code>ServiceAccount</code> with read privileges in the whole cluster (Secretes are excluded).
To run the script <a href=https://stedolan.github.io/jq/>jq</a>, a lightweight and flexible command-line JSON processor, must
be installed.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=cp>#!/bin/bash
</span><span class=cp></span>
<span class=k>if</span> <span class=o>[[</span> -z <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=o>]]</span> <span class=p>;</span><span class=k>then</span>
  <span class=nb>echo</span> <span class=s2>&#34;usage: </span><span class=nv>$0</span><span class=s2> &lt;username&gt;&#34;</span>
  <span class=nb>exit</span> <span class=m>1</span>
<span class=k>fi</span>

<span class=nv>user</span><span class=o>=</span><span class=nv>$1</span>
kubectl create sa <span class=si>${</span><span class=nv>user</span><span class=si>}</span>
<span class=nv>secret</span><span class=o>=</span><span class=k>$(</span>kubectl get sa <span class=si>${</span><span class=nv>user</span><span class=si>}</span> -o json <span class=p>|</span> jq -r .secrets<span class=o>[]</span>.name<span class=k>)</span>
kubectl get secret <span class=si>${</span><span class=nv>secret</span><span class=si>}</span> -o json <span class=p>|</span> jq -r <span class=s1>&#39;.data[&#34;ca.crt&#34;]&#39;</span> <span class=p>|</span> base64 -D &gt; ca.crt

<span class=nv>user_token</span><span class=o>=</span><span class=k>$(</span>kubectl get secret <span class=si>${</span><span class=nv>secret</span><span class=si>}</span> -o json <span class=p>|</span> jq -r <span class=s1>&#39;.data[&#34;token&#34;]&#39;</span> <span class=p>|</span> base64 -D<span class=k>)</span>
<span class=nv>c</span><span class=o>=</span><span class=sb>`</span>kubectl config current-context<span class=sb>`</span>
<span class=nv>cluster_name</span><span class=o>=</span><span class=sb>`</span>kubectl config get-contexts <span class=nv>$c</span> <span class=p>|</span> awk <span class=s1>&#39;{print $3}&#39;</span> <span class=p>|</span> tail -n 1<span class=sb>`</span>
<span class=nv>endpoint</span><span class=o>=</span><span class=sb>`</span>kubectl config view -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s2>&#34;{.clusters[?(@.name == \&#34;</span><span class=si>${</span><span class=nv>cluster_name</span><span class=si>}</span><span class=s2>\&#34;)].cluster.server}&#34;</span><span class=sb>`</span>

<span class=c1># Set up the config</span>
<span class=nv>KUBECONFIG</span><span class=o>=</span>k8s-<span class=si>${</span><span class=nv>user</span><span class=si>}</span>-conf kubectl config set-cluster <span class=si>${</span><span class=nv>cluster_name</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>    --embed-certs<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span><span class=se></span>    --server<span class=o>=</span><span class=si>${</span><span class=nv>endpoint</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>    --certificate-authority<span class=o>=</span>./ca.crt

<span class=nv>KUBECONFIG</span><span class=o>=</span>k8s-<span class=si>${</span><span class=nv>user</span><span class=si>}</span>-conf kubectl config set-credentials <span class=si>${</span><span class=nv>user</span><span class=si>}</span>-<span class=si>${</span><span class=nv>cluster_name</span><span class=p>#cluster-</span><span class=si>}</span> --token<span class=o>=</span><span class=si>${</span><span class=nv>user_token</span><span class=si>}</span>
<span class=nv>KUBECONFIG</span><span class=o>=</span>k8s-<span class=si>${</span><span class=nv>user</span><span class=si>}</span>-conf kubectl config set-context <span class=si>${</span><span class=nv>user</span><span class=si>}</span>-<span class=si>${</span><span class=nv>cluster_name</span><span class=p>#cluster-</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>    --cluster<span class=o>=</span><span class=si>${</span><span class=nv>cluster_name</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>    --user<span class=o>=</span><span class=si>${</span><span class=nv>user</span><span class=si>}</span>-<span class=si>${</span><span class=nv>cluster_name</span><span class=p>#cluster-</span><span class=si>}</span>
<span class=nv>KUBECONFIG</span><span class=o>=</span>k8s-<span class=si>${</span><span class=nv>user</span><span class=si>}</span>-conf kubectl config use-context <span class=si>${</span><span class=nv>user</span><span class=si>}</span>-<span class=si>${</span><span class=nv>cluster_name</span><span class=p>#cluster-</span><span class=si>}</span>

cat <span class=s>&lt;&lt;EOF | kubectl create -f -
</span><span class=s>apiVersion: rbac.authorization.k8s.io/v1
</span><span class=s>kind: ClusterRoleBinding
</span><span class=s>metadata:
</span><span class=s>  name: view-${user}-global
</span><span class=s>subjects:
</span><span class=s>- kind: ServiceAccount
</span><span class=s>  name: ${user}
</span><span class=s>  namespace: default
</span><span class=s>roleRef:
</span><span class=s>  kind: ClusterRole
</span><span class=s>  name: view
</span><span class=s>  apiGroup: rbac.authorization.k8s.io
</span><span class=s>
</span><span class=s>EOF</span>


<span class=nb>echo</span> <span class=s2>&#34;done! Test with: &#34;</span>
<span class=nb>echo</span> <span class=s2>&#34;export KUBECONFIG=k8s-</span><span class=si>${</span><span class=nv>user</span><span class=si>}</span><span class=s2>-conf&#34;</span>
<span class=nb>echo</span> <span class=s2>&#34;kubectl get pods&#34;</span>
</code></pre></div><p>If <strong>edit</strong> or <strong>admin</strong> rights are to be assigned, the <code>ClusterRoleBinding</code> must be adapted in the <code>roleRef</code> section
with the roles listed below.</p><p>Furthermore, you can restrict this to a single namespace by not creating a <code>ClusterRoleBinding</code> but only a <code>RoleBinding</code>
within the desired namespace.</p><table><thead><tr><th>Default ClusterRole</th><th>Default ClusterRoleBinding</th><th>Description</th></tr></thead><tbody><tr><td>cluster-admin</td><td>system:masters group</td><td>Allows super-user access to perform any action on any resource. When used in a ClusterRoleBinding, it gives full control over every resource in the cluster and in all namespaces. When used in a RoleBinding, it gives full control over every resource in the rolebinding&rsquo;s namespace, including the namespace itself.</td></tr><tr><td>admin</td><td>None</td><td>Allows admin access, intended to be granted within a namespace using a RoleBinding. If used in a RoleBinding, allows read/write access to most resources in a namespace, including the ability to create roles and rolebindings within the namespace. It does not allow write access to resource quota or to the namespace itself.</td></tr><tr><td>edit</td><td>None</td><td>Allows read/write access to most objects in a namespace. It does not allow viewing or modifying roles or rolebindings.</td></tr><tr><td>view</td><td>None</td><td>Allows read-only access to see most objects in a namespace. It does not allow viewing roles or rolebindings. It does not allow viewing secrets, since those are escalating.</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-acb3d3deb29a8ddc337a39814f4ddbcb>4 - Use a Helm chart to deploy some application or service</h1><p>Basically, <a href=https://helm.sh/docs/topics/charts/>Helm Charts</a> can be installed as described e.g. in the Helm
<a href=https://helm.sh/docs/intro/quickstart/>QuickStart Guide</a>. However, our clusters come with
<a href=https://kubernetes.io/docs/reference/access-authn-authz/rbac/>RBAC</a> enabled by default hence Helm must be installed as follows:</p><h2 id=create-a-service-account>Create a Service Account</h2><p>Create a service account via the following command:</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>cat <span class=s>&lt;&lt;EOF | kubectl create -f -
</span><span class=s>apiVersion: v1
</span><span class=s>kind: ServiceAccount
</span><span class=s>metadata:
</span><span class=s> name: helm
</span><span class=s> namespace: kube-system
</span><span class=s>---
</span><span class=s>apiVersion: rbac.authorization.k8s.io/v1beta1
</span><span class=s>kind: ClusterRoleBinding
</span><span class=s>metadata:
</span><span class=s> name: helm
</span><span class=s>roleRef:
</span><span class=s> apiGroup: rbac.authorization.k8s.io
</span><span class=s> kind: ClusterRole
</span><span class=s> name: cluster-admin
</span><span class=s>subjects:
</span><span class=s> - kind: ServiceAccount
</span><span class=s>   name: helm
</span><span class=s>   namespace: kube-system
</span><span class=s>EOF</span>
</code></pre></div><h2 id=initialize-helm>Initialize Helm</h2><p>Initialise Helm via <code>helm init --service-account helm</code>. You can now use <code>helm</code>.</p><h2 id=in-case-of-failure>In case of failure</h2><p>In case you have already executed <code>helm init</code>, but without the above service account, you will get the following error:
<code>Error: User "system:serviceaccount:kube-system:default" cannot list configmaps in the namespace "kube-system". (get configmaps)</code> (e.g. when you run <code>helm list</code>). You will now need to delete the Tiller deployment (Helm backend
implicitly deployed to the Kubernetes cluster when you call <code>helm init</code>) as well as the local Helm files (usually
<code>$HELM_HOME</code> is set to <code>~/.helm</code>):</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>kubectl delete deployment tiller-deploy --namespace<span class=o>=</span>kube-system
kubectl delete service tiller-deploy --namespace<span class=o>=</span>kube-system 
rm -rf ~/.helm/
</code></pre></div><p>Now follow the instructions above. For more details see this
<a href=https://github.com/kubernetes/helm/issues/2687>Kubernetes Helm issue #2687</a>.</p></div></main></div></div><footer class="footer row d-print-none"><div class="container-fluid footer-wrapper"><ul class=nav><li><a href=/blog/>Blogs</a></li><li><a href=/community/>Community</a></li><li><a href=/adopter/>Adopters</a></li><li><a href=/docs/>Documentation</a></li></ul><img src=/images/lp/gardener-logo.svg alt="Logo Gardener" class=logo><ul class=media-wr><li><a target=_blank href=https://kubernetes.slack.com/archives/CB57N0BFG><img src=/images/branding/slack-logo-white.svg class=media-icon><div class=media-text>Slack</div></a></li><li><a target=_blank href=https://github.com/gardener><img src=/images/branding/github-mark-logo.png class=media-icon><div class=media-text>GitHub</div></a></li><li><a target=_blank href=https://www.youtube.com/channel/UCwUhwKFREV8Su0gwAJQX7tw><img src=/images/branding/youtube-logo-dark.svg class=media-icon><div class=media-text>YouTube</div></a></li><li><a target=_blank href=https://twitter.com/GardenerProject><img src=/images/branding/twitter-logo-white.svg class=media-icon><div class=media-text>Twitter</div></a></li></ul><span class=copyright>Copyright 2019-2021 Gardener project authors. <a href=https://www.sap.com/corporate/en/legal/privacy.html>Privacy policy
<i class="fa fa-external-link" aria-hidden=true></i></a></span></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/js/main.min.3b172c13b62c2bea8b1c9d2599cddc8cf89718a92d792c680871c81ba43d8c85.js integrity="sha256-OxcsE7YsK+qLHJ0lmc3cjPiXGKkteSxoCHHIG6Q9jIU=" crossorigin=anonymous></script></body></html>