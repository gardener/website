<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta name=copyright content="Copyright 2019-2021 Gardener project authors."><meta name=google-site-verification content="9EoGiMwk2aq0E_tVh16iJgJbp7fbyqkfWH9b5sGybl0"><title>Deploy a Gardenlet Manually :: Gardener</title><link rel=icon type=image/x-icon href=https://gardener.cloud/images/favicon.ico><link rel=icon type=image/png href=https://gardener.cloud/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://gardener.cloud/images/favicon-16x16.png sizes=16x16><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-W2FGNSX');</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-165447164-1');</script><link href=/css/font-awesome.min.css?1621013773 rel=stylesheet><link href=/css/skeleton.css?1621013773 rel=stylesheet><link rel=preload href=/fonts/sap-icofonts/sap-icofonts.woff as=font type=font/woff crossorigin=anonymous><link rel=preload href=/fonts/sapcom-icons/sapcom-icons.woff as=font type=font/woff crossorigin=anonymous><link rel=stylesheet href=/css/sapcom-icons.css><link rel=stylesheet href=/css/normalize.css><link rel=stylesheet href=/css/gardener.b459b7f22c26be8e2f608a181d5372c6e44f06cf007c350346ccf5fadbe04a74.css><script src=/js/moment.js?1621013773></script><script src=/js/inlineSVG.js?1621013773></script><script src=/js/jquery.min.js?1621013773></script><script src=/jquery-ui-1.12.1/jquery-ui.min.js?1621013773></script><script src=/js/fixed.js?1621013773></script><script src=/js/clipboard.min.js?1621013773></script><script src=https://platform.linkedin.com/in.js type=text/javascript>lang:en_US</script></head><body data-url=/v1.13.2/concepts/deployment/deploy_gardenlet_manually/ class=has-sticky-navigation><script>$(document).ready(function(){function initStickyNav(){var stickyPoint;var tln=document.querySelector(".tln");if(!tln){return;}
var stickyPointEl=document.querySelector(".sticky-nav-point");if(stickyPointEl==null){stickyPointEl=document.querySelector("body");stickyPoint=0;}else{stickyPoint=stickyPointEl.clientHeight+stickyPointEl.offsetTop;}
var bodySelector=document.getElementsByTagName("body")[0];var tlnHeight=tln.clientHeight;var stickyNavigation=function(){if(window.pageYOffset+tlnHeight>=stickyPoint){bodySelector.classList.add("has-sticky-navigation");tln.classList.add("sticky-top");}else{bodySelector.classList.remove("has-sticky-navigation");tln.classList.remove("sticky-top");}}
window.onscroll=function(){stickyNavigation();};}
initStickyNav();function closeAllSelect(){document.getElementById("docOptions").classList.remove("show");}
function show(e){e.stopPropagation();document.getElementById("docOptions").classList.add("show");}
document.addEventListener("click",closeAllSelect);document.getElementById("docSelector").addEventListener("click",show);});</script><div class="tln fixedsticky sticky-top"><header class=navigation><div class=container><div class=navigation-wrapper><a href=/ class=logo><img src=/images/gardener-logo.svg>
<span class=title>Gardener</span></a>
<a class="nav-button navbar-toggler" href=#><i class="fa fa-bars"></i></a><div class=navbar-collapse><ul class=links><li class=link><a href=/blog/>Blogs</a></li><li class=link><a href=/community/>Community</a></li><li class=link><a href=/adopter/>Adopters</a></li><li class="link has-child"><a href=/documentation/home>Documentation</a></li></ul></div></div></div></header></div><script>$(".navigation .navbar-toggler").click(function(evt){$(".navigation .navbar-collapse").toggle();$(".navigation").toggleClass("collapsed");$(".navigation .search-box").toggle();})</script><style>#docSelector{cursor:pointer}.doc-options{position:fixed;background-color:#0b8062;text-align:left;display:none}.doc-options ul li{margin-bottom:0}.doc-options ul li a:hover{background-color:#0c694f}.doc-options ul{list-style:none;padding:0;margin:0;text-align:left}.doc-options ul li a{padding:10px;margin:0}.doc-options .activeVersion{background-color:#ec682a}.show{display:block}</style><div class=sln><div class=overlay-band><ul class="nav-list container"><li title=Home><a class=navbar-link href=/v1.13.2/home/>Home</a></li><li title=Concepts><a class="navbar-link is-active" href=/v1.13.2/concepts/>Concepts</a></li><li title="How-To Guides"><a class=navbar-link href=/v1.13.2/guides/>How-To Guides</a></li><li title=Tutorials><a class=navbar-link href=/v1.13.2/tutorials/>Tutorials</a></li><li title="API Reference"><a class=navbar-link href=/v1.13.2/references/>API Reference</a></li><li title=Contribute><a class=navbar-link href=/v1.13.2/contribute/>Contribute</a></li></ul></div></div><div class="main container"><nav id=sidebar class="collapsed container menu"><div class=highlightable><ul class=topics><li data-nav-id=/v1.13.2/concepts/ title=Concepts class="dd-item parent root collapsible" data-depth=0><a href=/v1.13.2/concepts/><span class=menu-item-text>Concepts</span></a><ul><li data-nav-id=/v1.13.2/concepts/architecture/ title=Architecture class="dd-item top-level collapsible collapsed" data-depth=1><a href=/v1.13.2/concepts/architecture/><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Architecture</span></a><ul><li data-nav-id=/components/bouquet/ title=Bouquet class=dd-item data-depth=2><a href=/components/bouquet/><span class=toggle></span><span class=menu-item-text></span>Bouquet</span></a></a></li><li data-nav-id=/components/dashboard/ title=Dashboard class=dd-item data-depth=2><a href=/components/dashboard/><span class=toggle></span><span class=menu-item-text></span>Dashboard</span></a></a></li><li data-nav-id=/components/gardenctl/ title=gardenctl class=dd-item data-depth=2><a href=/components/gardenctl/><span class=toggle></span><span class=menu-item-text></span>gardenctl</span></a></a></li><li data-nav-id=/components/gardener/ title=Gardener class=dd-item data-depth=2><a href=/components/gardener/><span class=toggle></span><span class=menu-item-text></span>Gardener</span></a></a></li><li data-nav-id=/components/kubify/ title=kubify class=dd-item data-depth=2><a href=/components/kubify/><span class=toggle></span><span class=menu-item-text></span>kubify</span></a></a></li></ul></li><li data-nav-id=/v1.13.2/concepts/core-components/ title="Core Components" class="dd-item top-level collapsible collapsed" data-depth=1><a href=/documentation/concepts/core-components/api-server><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Core Components</span></a><ul><li data-nav-id=/v1.13.2/concepts/core-components/api-server/ title="Gardener API Server" class="dd-item collapsible collapsed" data-depth=2><a href=/v1.13.2/concepts/core-components/api-server/><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Gardener API Server</span></a><ul><li data-nav-id=/v1.13.2/concepts/core-components/api-server/apiserver_admission_plugins/ title="In-Tree Admission Plugins" class=dd-item data-depth=3><a href=/v1.13.2/concepts/core-components/api-server/apiserver_admission_plugins/><span class=toggle></span><span class=menu-item-text></span>In-Tree Admission Plugins</span></a></a></li></ul></li><li data-nav-id=/v1.13.2/concepts/core-components/scheduler/ title="Gardener Scheduler" class=dd-item data-depth=2><a href=/v1.13.2/concepts/core-components/scheduler/><span class=toggle></span><span class=menu-item-text></span>Gardener Scheduler</span></a></a></li><li data-nav-id=/v1.13.2/concepts/core-components/seed-admission-controller/ title="Gardener Seed Admission Controller" class=dd-item data-depth=2><a href=/v1.13.2/concepts/core-components/seed-admission-controller/><span class=toggle></span><span class=menu-item-text></span>Gardener Seed Admission Controller</span></a></a></li><li data-nav-id=/v1.13.2/concepts/core-components/gardenlet/ title=gardenlet class=dd-item data-depth=2><a href=/v1.13.2/concepts/core-components/gardenlet/><span class=toggle></span><span class=menu-item-text></span>gardenlet</span></a></a></li></ul></li><li data-nav-id=/v1.13.2/concepts/backup-restore/backup-restore/ title="Backup and Restore" class="dd-item top-level" data-depth=1><a href=/v1.13.2/concepts/backup-restore/backup-restore/><span class=toggle></span><span class=menu-item-text></span>Backup and Restore</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/ title=Extensions class="dd-item top-level collapsible collapsed" data-depth=1><a href=/v1.13.2/concepts/extensions/><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Extensions</span></a><ul><li data-nav-id=/v1.13.2/concepts/extensions/backupbucket/ title="BackupBucket resource" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/backupbucket/><span class=toggle></span><span class=menu-item-text></span>BackupBucket resource</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/backupentry/ title="BackupEntry resource" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/backupentry/><span class=toggle></span><span class=menu-item-text></span>BackupEntry resource</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/cluster/ title="Cluster resource" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/cluster/><span class=toggle></span><span class=menu-item-text></span>Cluster resource</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/shoot-health-status-conditions/ title="Contributing to shoot health status conditions" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/shoot-health-status-conditions/><span class=toggle></span><span class=menu-item-text></span>Contributing to shoot health status conditions</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/controlplane-webhooks/ title="Controlplane customization webhooks" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/controlplane-webhooks/><span class=toggle></span><span class=menu-item-text></span>Controlplane customization webhooks</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/controlplane/ title="ControlPlane resource" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/controlplane/><span class=toggle></span><span class=menu-item-text></span>ControlPlane resource</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/controlplane-exposure/ title="ControlPlane resource with purpose exposure" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/controlplane-exposure/><span class=toggle></span><span class=menu-item-text></span>ControlPlane resource with purpose exposure</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/dns/ title="DNSProvider and DNSEntry resources" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/dns/><span class=toggle></span><span class=menu-item-text></span>DNSProvider and DNSEntry resources</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/project-roles/ title="Extending project roles" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/project-roles/><span class=toggle></span><span class=menu-item-text></span>Extending project roles</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/overview/ title="Extensibility overview" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/overview/><span class=toggle></span><span class=menu-item-text></span>Extensibility overview</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/extension/ title="Extension resource" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/extension/><span class=toggle></span><span class=menu-item-text></span>Extension resource</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/containerruntime/ title="Gardener Container Runtime Extension" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/containerruntime/><span class=toggle></span><span class=menu-item-text></span>Gardener Container Runtime Extension</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/network/ title="Gardener Network Extension" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/network/><span class=toggle></span><span class=menu-item-text></span>Gardener Network Extension</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/conventions/ title="General conventions" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/conventions/><span class=toggle></span><span class=menu-item-text></span>General conventions</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/healthcheck-library/ title="Health Check Library" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/healthcheck-library/><span class=toggle></span><span class=menu-item-text></span>Health Check Library</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/infrastructure/ title="Infrastructure resource" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/infrastructure/><span class=toggle></span><span class=menu-item-text></span>Infrastructure resource</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/logging-and-monitoring/ title="Logging and Monitoring for Extensions" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/logging-and-monitoring/><span class=toggle></span><span class=menu-item-text></span>Logging and Monitoring for Extensions</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/operatingsystemconfig/ title="OperatingSystemConfig resource" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/operatingsystemconfig/><span class=toggle></span><span class=menu-item-text></span>OperatingSystemConfig resource</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/referenced-resources/ title="Referenced Resources" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/referenced-resources/><span class=toggle></span><span class=menu-item-text></span>Referenced Resources</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/controllerregistration/ title="Registering Extension Controllers" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/controllerregistration/><span class=toggle></span><span class=menu-item-text></span>Registering Extension Controllers</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/shoot-maintenance/ title="Shoot maintenance" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/shoot-maintenance/><span class=toggle></span><span class=menu-item-text></span>Shoot maintenance</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/shoot-webhooks/ title="Shoot resource customization webhooks" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/shoot-webhooks/><span class=toggle></span><span class=menu-item-text></span>Shoot resource customization webhooks</span></a></a></li><li data-nav-id=/v1.13.2/concepts/extensions/worker/ title="Worker resource" class=dd-item data-depth=2><a href=/v1.13.2/concepts/extensions/worker/><span class=toggle></span><span class=menu-item-text></span>Worker resource</span></a></a></li></ul></li><li data-nav-id=/v1.13.2/concepts/networking/ title=Networking class="dd-item top-level collapsible collapsed" data-depth=1><a href=/v1.13.2/concepts/networking/><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Networking</span></a><ul><li data-nav-id=/v1.13.2/concepts/networking/dns-managment/ title="DNS Management" class=dd-item data-depth=2><a href=/v1.13.2/concepts/networking/dns-managment/><span class=toggle></span><span class=menu-item-text></span>DNS Management</span></a></a></li><li data-nav-id=/v1.13.2/concepts/networking/cert-managment/ title="Certificates Management" class=dd-item data-depth=2><a href=/v1.13.2/concepts/networking/cert-managment/><span class=toggle></span><span class=menu-item-text></span>Certificates Management</span></a></a></li><li data-nav-id=/v1.13.2/concepts/networking/network_policies/ title="Network Policies" class=dd-item data-depth=2><a href=/v1.13.2/concepts/networking/network_policies/><span class=toggle></span><span class=menu-item-text></span>Network Policies</span></a></a></li></ul></li><li data-nav-id=/v1.13.2/concepts/monitoring/ title=Monitoring class="dd-item top-level collapsible collapsed" data-depth=1><a href=/v1.13.2/concepts/monitoring/><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Monitoring</span></a><ul><li data-nav-id=/v1.13.2/concepts/monitoring/alerting/ title=Alerting class=dd-item data-depth=2><a href=/v1.13.2/concepts/monitoring/alerting/><span class=toggle></span><span class=menu-item-text></span>Alerting</span></a></a></li><li data-nav-id=/v1.13.2/concepts/monitoring/extending/ title="Extending the Monitoring Stack" class=dd-item data-depth=2><a href=/v1.13.2/concepts/monitoring/extending/><span class=toggle></span><span class=menu-item-text></span>Extending the Monitoring Stack</span></a></a></li><li data-nav-id=/v1.13.2/concepts/monitoring/operator_alerts/ title="Operator Alerts" class=dd-item data-depth=2><a href=/v1.13.2/concepts/monitoring/operator_alerts/><span class=toggle></span><span class=menu-item-text></span>Operator Alerts</span></a></a></li><li data-nav-id=/v1.13.2/concepts/monitoring/user_alerts/ title="User Alerts" class=dd-item data-depth=2><a href=/v1.13.2/concepts/monitoring/user_alerts/><span class=toggle></span><span class=menu-item-text></span>User Alerts</span></a></a></li></ul></li><li data-nav-id=/v1.13.2/concepts/deployment/deploy_gardenlet_automatically/ title="Automatic Deployment of Gardenlets" class="dd-item top-level" data-depth=1><a href=/v1.13.2/concepts/deployment/deploy_gardenlet_automatically/><span class=toggle></span><span class=menu-item-text></span>Automatic Deployment of Gardenlets</span></a></a></li><li data-nav-id=/v1.13.2/concepts/deployment/deploy_gardenlet_manually/ title="Deploy a Gardenlet Manually" class="dd-item top-level active" data-depth=1><a href=/v1.13.2/concepts/deployment/deploy_gardenlet_manually/><span class=toggle></span><span class=menu-item-text></span>Deploy a Gardenlet Manually</span></a></a></li><li data-nav-id=/v1.13.2/concepts/deployment/deploy_gardenlet/ title="Deploying Gardenlets" class="dd-item top-level" data-depth=1><a href=/v1.13.2/concepts/deployment/deploy_gardenlet/><span class=toggle></span><span class=menu-item-text></span>Deploying Gardenlets</span></a></a></li><li data-nav-id=/v1.13.2/concepts/deployment/setup_gardener/ title="Deploying the Gardener into a Kubernetes cluster" class="dd-item top-level" data-depth=1><a href=/v1.13.2/concepts/deployment/setup_gardener/><span class=toggle></span><span class=menu-item-text></span>Deploying the Gardener into a Kubernetes cluster</span></a></a></li><li data-nav-id=/v1.13.2/concepts/deployment/aks/ title="Deploying the previous Gardener versions and a Seed into an AKS cluster" class="dd-item top-level" data-depth=1><a href=/v1.13.2/concepts/deployment/aks/><span class=toggle></span><span class=menu-item-text></span>Deploying the previous Gardener versions and a Seed into an AKS cluster</span></a></a></li><li data-nav-id=/v1.13.2/concepts/deployment/feature_gates/ title="Feature Gates" class="dd-item top-level" data-depth=1><a href=/v1.13.2/concepts/deployment/feature_gates/><span class=toggle></span><span class=menu-item-text></span>Feature Gates</span></a></a></li><li data-nav-id=/v1.13.2/concepts/deployment/image_vector/ title="Image Vector" class="dd-item top-level" data-depth=1><a href=/v1.13.2/concepts/deployment/image_vector/><span class=toggle></span><span class=menu-item-text></span>Image Vector</span></a></a></li><li data-nav-id=/v1.13.2/concepts/mcm/ title="Machine Controller Manager" class="dd-item top-level" data-depth=1><a href=/v1.13.2/concepts/mcm/><span class=toggle></span><span class=menu-item-text></span>Machine Controller Manager</span></a></a></li></ul></li></ul></div></nav><a href=# class=menu-toggler><i class="fa fa-angle-double-left"></i></a><script>$(document).ready(function(){$("#sidebar .dd-item:not(.top-level):not(.parent)").hide();$("#sidebar .dd-item.parent").siblings(".dd-item").show();$('.dd-item',"#sidebar .dd-item.parent").show();$(".menu-toggler").click(function(evt){$("#sidebar").toggleClass("collapsed");$(".menu-toggler span").toggleClass("fa-angle-double-left");$(".menu-toggler span").toggleClass("fa-angle-double-right");});})</script><section><div class="highlightable body-inner-wrapper"><div id=body-inner class=external><div class="docs page"><div class=git-wr><div class=page-contributors>Contributors to this page<div class=contributors-list><a href=mailto:jens.haley@sap.com><img class=user-icon src="https://avatars.githubusercontent.com/u/34343894?v=4" title="Jens Haley"></a>
<a href=mailto:rafael.franzke@sap.com><img class=user-icon src="https://avatars.githubusercontent.com/u/19169361?v=4" title="Rafael Franzke"></a>
<a href=mailto:daniel.foehr@sap.com><img class=user-icon src="https://avatars.githubusercontent.com/u/33809186?v=4" title="Daniel Föhr"></a>
<a href=mailto:s.rachev@sap.com><img class=user-icon src="https://avatars.githubusercontent.com/u/1867702?v=4" title="Stoyan Rachev"></a>
<a href=mailto:tim.usner@sap.com><img class=user-icon src="https://avatars.githubusercontent.com/u/40451181?v=4" title="Tim Usner"></a>
<a href=mailto:max.becker@sap.com><img class=user-icon src="https://avatars.githubusercontent.com/u/7465180?v=4" title="Max Becker"></a>
<img class=user-icon src="https://avatars.githubusercontent.com/u/45389730?v=4" title=hassbert></div></div><div class=origin-tools><div class=page-edit><div id=top-github-link><a class=github-link title="Edit page" href=https://github.com/gardener/gardener/blob/master/docs/deployment/deploy_gardenlet_manually.md target=blank><i class="fa fa-edit"></i><span id=top-github-link-text title="Edit page"></span></a></div></div></div></div><h1 id=deploy-a-gardenlet-manually>Deploy a Gardenlet Manually</h1><p>Manually deploying a gardenlet is required in the following cases:</p><ul><li><p>The Kubernetes cluster to be registered as a seed cluster has no public endpoint,
because it is behind a firewall.
The gardenlet must then be deployed into the cluster itself.</p></li><li><p>The Kubernetes cluster to be registered as a seed cluster is managed externally
(the Kubernetes cluster is not a shoot cluster, so <a href=/v1.13.2/concepts/deployment/deploy_gardenlet_automatically>Automatic Deployment of Gardenlets</a> cannot be used).</p></li><li><p>The gardenlet runs outside of the Kubernetes cluster
that should be registered as a seed cluster.
(The gardenlet is not restricted to run in the seed cluster or
to be deployed into a Kubernetes cluster at all).</p></li></ul><blockquote><p>Once you’ve deployed a gardenlet manually, for example, behind a firewall, you can deploy new gardenlets automatically. The manually deployed gardenlet is then used as a template for the new gardenlets. More information: <a href=/v1.13.2/concepts/deployment/deploy_gardenlet_automatically>Automatic Deployment of Gardenlets</a>.</p></blockquote><h2 id=prerequisites>Prerequisites</h2><h3 id=kubernetes-cluster-that-should-be-registered-as-a-seed-cluster>Kubernetes cluster that should be registered as a seed cluster</h3><ul><li><p>Verify that the cluster has a <a href=https://github.com/gardener/gardener/blob/master/docs/usage/supported_k8s_versions.md>supported Kubernetes version</a>.</p></li><li><p>Determine the nodes, pods, and services CIDR of the cluster.
You need to configure this information in the <code>Seed</code> configuration.
Gardener uses this information to check that the shoot cluster isn’t created with overlapping CIDR ranges.</p></li><li><p>Every Seed cluster needs an Ingress controller which distributes external requests to internal components like grafana and prometheus. Gardener supports two approaches to achieve this:</p></li></ul><p>a. Gardener managed Ingress controller and DNS records. For this configure the following lines in your <a href=https://github.com/gardener/gardener/blob/master/example/50-seed.yaml>Seed resource</a>:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>dns</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>aws-route53</span><span class=w>
</span><span class=w>      </span><span class=nt>secretRef</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ingress-secret</span><span class=w>
</span><span class=w>        </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>garden</span><span class=w>
</span><span class=w>  </span><span class=nt>ingress</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>domain</span><span class=p>:</span><span class=w> </span><span class=l>ingress.my-seed.example.com</span><span class=w>
</span><span class=w>    </span><span class=nt>controller</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span><span class=w>      </span><span class=nt>providerConfig</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=l>&lt;some-optional-provider-specific-config-for-the-ingressController&gt;</span><span class=w>
</span></code></pre></div><p>⚠ Please note that if you set <code>.spec.ingress</code> then <code>.spec.dns.ingressDomain</code> must be <code>nil</code>.</p><p>b. Self-managed DNS record and Ingress controller:</p><p>:warning:<br>There should exist a DNS record <code>*.ingress.&lt;SEED-CLUSTER-DOMAIN></code> where <code>&lt;SEED-CLUSTER-DOMAIN></code> is the value of the <code>.dns.ingressDomain</code> field of <a href=https://github.com/gardener/gardener/blob/master/example/50-seed.yaml>a Seed cluster resource</a> (or the <a href=https://github.com/gardener/gardener/blob/master/example/20-componentconfig-gardenlet.yaml#L84-L85>respective Gardenlet configuration</a>).</p><p><em>This is how it could be done for the Nginx ingress controller</em></p><p>Deploy nginx into the <code>kube-system</code> namespace in the Kubernetes cluster that should be registered as a <code>Seed</code>.</p><p>Nginx will on most cloud providers create the service with type <code>LoadBalancer</code> with an external ip.</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>NAME                        TYPE           CLUSTER-IP    EXTERNAL-IP
nginx-ingress-controller    LoadBalancer   10.0.15.46    34.200.30.30
</code></pre></div><p>Create a wildcard <code>A</code> record (e.g *.ingress.sweet-seed.<my-domain>. IN A 34.200.30.30) with your DNS provider and point it to the external ip of the ingress service. This ingress domain is later required to register the <code>Seed</code> cluster.</p><p>Please configure the ingress domain in the <code>Seed</code> specification as follows:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>dns</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>ingressDomain</span><span class=p>:</span><span class=w> </span><span class=l>ingress.sweet-seed.&lt;my-domain&gt;</span><span class=w>
</span></code></pre></div><p>⚠ Please note that if you set <code>.spec.dns.ingressDomain</code> then <code>.spec.ingress</code> must be <code>nil</code>.</p><h3 id=kubeconfig-for-the-seed-cluster><code>kubeconfig</code> for the Seed Cluster</h3><p>The <code>kubeconfig</code> is required to deploy the gardenlet Helm chart to the seed cluster.
This deployment requires admin privileges.
The Helm chart contains a service account <code>gardenlet</code>
that the gardenlet deployment uses by default to talk to the Seed API server.</p><blockquote><p>If the gardenlet isn’t deployed in the seed cluster,
the gardenlet can be configured to use a <code>kubeconfig</code>,
which also requires full admin rights, from a mounted directory.
The <code>kubeconfig</code> is specified in section <code>seedClientConnection.kubeconfig</code>
of the <a href=https://github.com/gardener/gardener/blob/master/example/20-componentconfig-gardenlet.yaml>Gardenlet configuration</a>.
This configuration option isn’t used in the following,<br>as this procedure only describes the recommended setup option
where the gardenlet is running in the seed cluster itself.</p></blockquote><h2 id=procedure-overview>Procedure Overview</h2><ol><li><p>Prepare the garden cluster:</p><ol><li><a href=#create-a-bootstrap-token-secret-in-the-kube-system-namespace-of-the-garden-cluster>Create a bootstrap token secret in the <code>kube-system</code> namespace of the garden cluster</a></li><li><a href=#create-rbac-roles-for-the-gardenlet-to-allow-bootstrapping-in-the-garden-cluster>Create RBAC roles for the gardenlet to allow bootstrapping in the garden cluster</a></li></ol></li><li><p><a href=#prepare-the-gardenlet-helm-chart>Prepare the gardenlet Helm chart</a>.</p></li><li><p><a href=#automatically-register-shoot-cluster-as-a-seed-cluster>Automatically register shoot cluster as a seed cluster</a>.</p></li><li><p><a href=#deploy-the-gardenlet>Deploy the gardenlet</a></p></li><li><p><a href=#check-that-the-gardenlet-is-successfully-deployed>Check that the gardenlet is successfully deployed</a></p></li></ol><h2 id=create-a-bootstrap-token-secret-in-the-kube-system-namespace-of-the-garden-cluster>Create a bootstrap token secret in the <code>kube-system</code> namespace of the garden cluster</h2><p>The gardenlet needs to talk to the <a href=/v1.13.2/concepts/core-components/api-server/apiserver>Gardener API server</a> residing in the garden cluster.</p><p>The gardenlet can be configured with an already existing garden cluster <code>kubeconfig</code> in one of the following ways:</p><ul><li><p>Either by specifying <code>gardenClientConnection.kubeconfig</code>
in the <a href=https://github.com/gardener/gardener/blob/master/example/20-componentconfig-gardenlet.yaml>Gardenlet configuration</a> or</p></li><li><p>by supplying the environment variable <code>GARDEN_KUBECONFIG</code> pointing to
a mounted <code>kubeconfig</code> file).</p></li></ul><p>The preferred way however, is to use the gardenlets ability to request
a signed certificate for the garden cluster by leveraging
<a href=https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/>Kubernetes Certificate Signing Requests</a>.
The gardenlet performs a TLS bootstrapping process that is similar to the
<a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/>Kubelet TLS Bootstrapping</a>.
Make sure that the API server of the garden cluster has
<a href=https://kubernetes.io/docs/reference/access-authn-authz/bootstrap-tokens/#enabling-bootstrap-token-authentication>bootstrap token authentication</a>
enabled.</p><p>The client credentials required for the gardenlets TLS bootstrapping process,
need to be either <code>token</code> or <code>certificate</code> (OIDC isn’t supported) and have permissions
to create a Certificate Signing Request (<a href=https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/>CSR</a>).
It’s recommended to use <a href=https://kubernetes.io/docs/reference/access-authn-authz/bootstrap-tokens/>bootstrap tokens</a>
due to their desirable security properties (such as a limited token lifetime).</p><p>Therefore, first create a bootstrap token secret for the garden cluster:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Secret</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=c># Name MUST be of form &#34;bootstrap-token-&lt;token id&gt;&#34;</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>bootstrap-token-07401b</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>kube-system</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c># Type MUST be &#39;bootstrap.kubernetes.io/token&#39;</span><span class=w>
</span><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>bootstrap.kubernetes.io/token</span><span class=w>
</span><span class=w></span><span class=nt>stringData</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=c># Human readable description. Optional.</span><span class=w>
</span><span class=w>  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Token to be used by the gardenlet for Seed `sweet-seed`.&#34;</span><span class=w>
</span><span class=w>
</span><span class=w>  </span><span class=c># Token ID and secret. Required.</span><span class=w>
</span><span class=w>  </span><span class=nt>token-id</span><span class=p>:</span><span class=w> </span><span class=l>07401b</span><span class=w> </span><span class=c># 6 characters</span><span class=w>
</span><span class=w>  </span><span class=nt>token-secret</span><span class=p>:</span><span class=w> </span><span class=l>f395accd246ae52d</span><span class=w> </span><span class=c># 16 characters</span><span class=w>
</span><span class=w>
</span><span class=w>  </span><span class=c># Expiration. Optional.</span><span class=w>
</span><span class=w>  </span><span class=c># expiration: 2017-03-10T03:22:11Z</span><span class=w>
</span><span class=w>
</span><span class=w>  </span><span class=c># Allowed usages.</span><span class=w>
</span><span class=w>  </span><span class=nt>usage-bootstrap-authentication</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span><span class=w>  </span><span class=nt>usage-bootstrap-signing</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></code></pre></div><p>When you later prepare the gardenlet Helm chart,
a <code>kubeconfig</code> based on this token is shared with the gardenlet upon deployment.</p><h2 id=create-rbac-roles-for-the-gardenlet-to-allow-bootstrapping-in-the-garden-cluster>Create RBAC roles for the gardenlet to allow bootstrapping in the garden cluster</h2><p>This step is only required if the gardenlet you deploy is the first gardenlet
in the Gardener installation.
Additionally, when using the <a href=../../charts/gardener/controlplane>control plane chart</a>,
the following resources are already contained in the Helm chart,
that is, if you use it you can skip these steps as the needed RBAC roles already exist.</p><p>The gardenlet uses the configured bootstrap <code>kubeconfig</code> in <code>gardenClientConnection.bootstrapKubeconfig</code> to request a signed certificate for the user <code>gardener.cloud:system:seed:&lt;seed-name></code> in the group <code>gardener.cloud:system:seeds</code>.</p><p>Create a <code>ClusterRole</code> and <code>ClusterRoleBinding</code> that grant full admin permissions to authenticated gardenlets.</p><p>Create the following resources in the garden cluster:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gardener.cloud:system:seeds</span><span class=w>
</span><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=s1>&#39;*&#39;</span><span class=w>
</span><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=s1>&#39;*&#39;</span><span class=w>
</span><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=s1>&#39;*&#39;</span><span class=w>
</span><span class=w></span><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRoleBinding</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gardener.cloud:system:seeds</span><span class=w>
</span><span class=w></span><span class=nt>roleRef</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gardener.cloud:system:seeds</span><span class=w>
</span><span class=w></span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Group</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gardener.cloud:system:seeds</span><span class=w>
</span><span class=w>    </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span><span class=w></span><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gardener.cloud:system:seed-bootstrapper</span><span class=w>
</span><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=l>certificates.k8s.io</span><span class=w>
</span><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=l>certificatesigningrequests</span><span class=w>
</span><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=l>create</span><span class=w>
</span><span class=w>      </span>- <span class=l>get</span><span class=w>
</span><span class=w></span><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=c># A kubelet/gardenlet authenticating using bootstrap tokens is authenticated as a user in the group system:bootstrappers</span><span class=w>
</span><span class=w></span><span class=c># Allows the Gardenlet to create a CSR</span><span class=w>
</span><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRoleBinding</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gardener.cloud:system:seed-bootstrapper</span><span class=w>
</span><span class=w></span><span class=nt>roleRef</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gardener.cloud:system:seed-bootstrapper</span><span class=w>
</span><span class=w></span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Group</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>system:bootstrappers</span><span class=w>
</span><span class=w>    </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></code></pre></div><p>ℹ️ After bootstrapping, the gardenlet has full administrative access to the garden cluster.
You might be interested to harden this and limit its permissions to only resources related to the seed cluster it is responsible for.
Please take a look into <a href=https://github.com/gardener/gardener/blob/master/docs/deployment/gardenlet_api_access.md>this document</a>.</p><h2 id=prepare-the-gardenlet-helm-chart>Prepare the gardenlet Helm chart</h2><p>This section only describes the minimal configuration,
using the global configuration values of the gardenlet Helm chart.
For an overview over all values, see the <a href=https://github.com/gardener/gardener/blob/master/charts/gardener/gardenlet/values.yaml>configuration values</a>.
We refer to the global configuration values as <em>gardenlet configuration</em> in the remaining procedure.</p><ol><li><p>Create a gardenlet configuration <code>gardenlet-values.yaml</code> based on <a href=https://github.com/gardener/gardener/blob/master/charts/gardener/gardenlet/values.yaml>this template</a>.</p></li><li><p>Create a bootstrap <code>kubeconfig</code> based on the bootstrap token created in the garden cluster.</p><p>Replace the <code>&lt;bootstrap-token></code> with <code>token-id.token-secret</code> (from our previous example: <code>07401b.f395accd246ae52d</code>) from the bootstrap token secret.</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Config</span><span class=w>
</span><span class=w></span><span class=nt>current-context</span><span class=p>:</span><span class=w> </span><span class=l>gardenlet-bootstrap@default</span><span class=w>
</span><span class=w></span><span class=nt>clusters</span><span class=p>:</span><span class=w>
</span><span class=w></span>- <span class=nt>cluster</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>certificate-authority-data</span><span class=p>:</span><span class=w> </span><span class=l>&lt;ca-of-garden-cluster&gt;</span><span class=w>
</span><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class=l>https://&lt;endpoint-of-garden-cluster&gt;</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span><span class=w></span><span class=nt>contexts</span><span class=p>:</span><span class=w>
</span><span class=w></span>- <span class=nt>context</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=l>gardenlet-bootstrap</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gardenlet-bootstrap@default</span><span class=w>
</span><span class=w></span><span class=nt>users</span><span class=p>:</span><span class=w>
</span><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gardenlet-bootstrap</span><span class=w>
</span><span class=w>  </span><span class=nt>user</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class=l>&lt;bootstrap-token&gt;</span><span class=w>
</span></code></pre></div></li><li><p>In section <code>gardenClientConnection.bootstrapKubeconfig</code> of your gardenlet configuration, provide the bootstrap <code>kubeconfig</code> together with a name and namespace to the gardenlet Helm chart.</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>gardenClientConnection</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>bootstrapKubeconfig</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gardenlet-kubeconfig-bootstrap</span><span class=w>
</span><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>garden</span><span class=w>
</span><span class=w>    </span><span class=nt>kubeconfig</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span><span class=sd>      </span><span class=w>      </span><span class=l>&lt;bootstrap-kubeconfig&gt; </span><span class=w> </span><span class=c># will be base64 encoded by helm</span><span class=w>
</span></code></pre></div><p>The bootstrap <code>kubeconfig</code> is stored in the specified secret.</p></li><li><p>In section <code>gardenClientConnection.kubeconfigSecret</code> of your gardenlet configuration,
define a name and a namespace where the gardenlet stores
the real <code>kubeconfig</code> that it creates during the bootstrap process. If the secret doesn&rsquo;t exist,
the gardenlet creates it for you.</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>gardenClientConnection</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>kubeconfigSecret</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gardenlet-kubeconfig</span><span class=w>
</span><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>garden</span><span class=w>
</span></code></pre></div></li></ol><h2 id=automatically-register-shoot-cluster-as-a-seed-cluster>Automatically register shoot cluster as a seed cluster</h2><p>A seed cluster can either be registered by manually creating
the <a href=https://github.com/gardener/gardener/blob/master/example/50-seed.yaml><code>Seed</code> resource</a>
or automatically by the gardenlet.<br>This functionality is useful for managed seed clusters,
as the gardenlet in the garden cluster deploys a copy of itself
into the cluster with automatic registration of the <code>Seed</code> configured.<br>However, it can also be used to have a streamlined seed cluster registration process when manually deploying the gardenlet.</p><blockquote><p>This procedure doesn’t describe all the possible configurations
for the <code>Seed</code> resource. For more information, see:</p><ul><li><a href=https://github.com/gardener/gardener/blob/master/example/50-seed.yaml>Example Seed resource</a></li><li><a href=https://github.com/gardener/gardener/blob/master/docs/usage/seed_settings.md>Configurable Seed settings</a>.</li></ul></blockquote><h3 id=adjust-the-gardenlet-component-configuration>Adjust the gardenlet component configuration</h3><ol><li><p>Supply the <code>Seed</code> resource in section <code>seedConfig</code> of your gardenlet configuration <code>gardenlet-values.yaml</code>.</p><blockquote><p>Note that with the <code>seedConfig</code> supplied, the gardenlet is only responsible to create and reconcile this one configured seed (in the previous example: <code>sweet-seed</code>). The gardenlet can also be configured to reconcile (but not create!) multiple Seeds <a href=https://github.com/gardener/gardener/blob/master/docs/concepts/gardenlet.md#seed-config-vs-seed-selector>based on a label selector</a>, which is only recommended <a href=https://github.com/gardener/gardener/blob/master/docs/development/local_setup.md#appendix>for a development setup</a>.</p></blockquote></li><li><p>Add the <code>seedConfig</code> to your gardenlet configuration <code>gardenlet-values.yaml</code>.
The field <code>seedConfig.spec.provider.type</code> specifies the infrastructure provider type (for example, <code>aws</code>) of the seed cluster.
For all supported infrastructure providers, see <a href=https://github.com/gardener/gardener/blob/master/extensions/README.md#known-extension-implementations>Known Extension Implementations</a>.</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nn>...</span><span class=l>.</span><span class=w>
</span><span class=w></span><span class=nt>seedConfig</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sweet-seed</span><span class=w>
</span><span class=w>  </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>dns</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>ingressDomain</span><span class=p>:</span><span class=w> </span><span class=l>ingress.sweet-seed.&lt;my-domain&gt;</span><span class=w> </span><span class=c># see prerequisites</span><span class=w>
</span><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w> </span><span class=c># see prerequisites</span><span class=w>
</span><span class=w>      </span><span class=nt>nodes</span><span class=p>:</span><span class=w> </span><span class=m>10.240.0.0</span><span class=l>/16</span><span class=w>
</span><span class=w>      </span><span class=nt>pods</span><span class=p>:</span><span class=w> </span><span class=m>100.244.0.0</span><span class=l>/16</span><span class=w>
</span><span class=w>      </span><span class=nt>services</span><span class=p>:</span><span class=w> </span><span class=m>100.32.0.0</span><span class=l>/13</span><span class=w>
</span><span class=w>      </span><span class=nt>shootDefaults: # optional</span><span class=p>:</span><span class=w> </span><span class=l>non-overlapping default CIDRs for shoot clusters of that Seed</span><span class=w>
</span><span class=w>        </span><span class=nt>pods</span><span class=p>:</span><span class=w> </span><span class=m>100.96.0.0</span><span class=l>/11</span><span class=w>
</span><span class=w>        </span><span class=nt>services</span><span class=p>:</span><span class=w> </span><span class=m>100.64.0.0</span><span class=l>/13</span><span class=w>
</span><span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>region</span><span class=p>:</span><span class=w> </span><span class=l>eu-west-1</span><span class=w>
</span><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>&lt;provider&gt;</span><span class=w>
</span></code></pre></div></li></ol><h3 id=optional-enable-backup-and-restore>Optional: Enable backup and restore</h3><p>The seed cluster can be set up with backup and restore
for the main <code>etcds</code> of shoot clusters.</p><p>Gardener uses <a href=https://github.com/gardener/etcd-backup-restore>etcd-backup-restore</a>
that <a href=https://github.com/gardener/etcd-backup-restore/blob/master/doc/usage/getting_started.md#usage>integrates with different storage providers</a>
to store the shoot cluster&rsquo;s main <code>etcd</code> backups.
Make sure to obtain client credentials that have sufficient permissions with the chosen storage provider.</p><p>Create a secret in the garden cluster with client credentials for the storage provider.
The format of the secret is cloud provider specific and can be found
in the repository of the respective Gardener extension.
For example, the secret for AWS S3 can be found in the AWS provider extension
(<a href=https://github.com/gardener/gardener-extension-provider-aws/blob/master/example/30-etcd-backup-secret.yaml>30-etcd-backup-secret.yaml</a>).</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Secret</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sweet-seed-backup</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>garden</span><span class=w>
</span><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Opaque</span><span class=w>
</span><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=c># client credentials format is provider specific</span><span class=w>
</span></code></pre></div><p>Configure the <code>Seed</code> resource in section <code>seedConfig</code> of your gardenlet configuration to use backup and restore:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nn>...</span><span class=w>
</span><span class=w></span><span class=nt>seedConfig</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sweet-seed</span><span class=w>
</span><span class=w>  </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>backup</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=l>&lt;provider&gt;</span><span class=w>
</span><span class=w>      </span><span class=nt>secretRef</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sweet-seed-backup</span><span class=w>
</span><span class=w>        </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>garden</span><span class=w>
</span></code></pre></div><h2 id=deploy-the-gardenlet>Deploy the gardenlet</h2><blockquote><p>The gardenlet doesn’t have to run in the same Kubernetes cluster as the seed cluster
it’s registering and reconciling, but it is in most cases advantageous
to use in-cluster communication to talk to the Seed API server.
Running a gardenlet outside of the cluster is mostly used for local development.</p></blockquote><p>The <code>gardenlet-values.yaml</code> looks something like this
(with automatic Seed registration and backup for shoot clusters enabled):</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>global</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=c># Gardenlet configuration values</span><span class=w>
</span><span class=w>  </span><span class=nt>gardenlet</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>    </span><span class=l>...</span><span class=w>
</span><span class=w>    </span><span class=l>&lt;default config&gt;</span><span class=w>
</span><span class=w>    </span><span class=l>...</span><span class=w>
</span><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>gardenClientConnection</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=l>...</span><span class=w>
</span><span class=w>        </span><span class=nt>bootstrapKubeconfig</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gardenlet-bootstrap-kubeconfig</span><span class=w>
</span><span class=w>          </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>garden</span><span class=w>
</span><span class=w>          </span><span class=nt>kubeconfig</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span><span class=sd>            apiVersion: v1
</span><span class=sd>            clusters:
</span><span class=sd>            - cluster:
</span><span class=sd>                certificate-authority-data: &lt;dummy&gt;
</span><span class=sd>                server: &lt;my-garden-cluster-endpoint&gt;
</span><span class=sd>              name: my-kubernetes-cluster
</span><span class=sd>            ....
</span><span class=sd>            </span><span class=w>            
</span><span class=w>        </span><span class=nt>kubeconfigSecret</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>gardenlet-kubeconfig</span><span class=w>
</span><span class=w>          </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>garden</span><span class=w>
</span><span class=w>      </span><span class=l>...</span><span class=w>
</span><span class=w>      </span><span class=l>&lt;default config&gt;</span><span class=w>
</span><span class=w>      </span><span class=l>...</span><span class=w>
</span><span class=w>      </span><span class=nt>seedConfig</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sweet-seed</span><span class=w>
</span><span class=w>        </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>dns</span><span class=p>:</span><span class=w>
</span><span class=w>            </span><span class=nt>ingressDomain</span><span class=p>:</span><span class=w> </span><span class=l>ingress.sweet-seed.&lt;my-domain&gt;</span><span class=w>
</span><span class=w>          </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span><span class=w>            </span><span class=nt>nodes</span><span class=p>:</span><span class=w> </span><span class=m>10.240.0.0</span><span class=l>/16</span><span class=w>
</span><span class=w>            </span><span class=nt>pods</span><span class=p>:</span><span class=w> </span><span class=m>100.244.0.0</span><span class=l>/16</span><span class=w>
</span><span class=w>            </span><span class=nt>services</span><span class=p>:</span><span class=w> </span><span class=m>100.32.0.0</span><span class=l>/13</span><span class=w>
</span><span class=w>            </span><span class=nt>shootDefaults</span><span class=p>:</span><span class=w>
</span><span class=w>              </span><span class=nt>pods</span><span class=p>:</span><span class=w> </span><span class=m>100.96.0.0</span><span class=l>/11</span><span class=w>
</span><span class=w>              </span><span class=nt>services</span><span class=p>:</span><span class=w> </span><span class=m>100.64.0.0</span><span class=l>/13</span><span class=w>
</span><span class=w>          </span><span class=nt>provider</span><span class=p>:</span><span class=w>
</span><span class=w>            </span><span class=nt>region</span><span class=p>:</span><span class=w> </span><span class=l>eu-west-1</span><span class=w>
</span><span class=w>            </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>&lt;provider&gt;</span><span class=w>
</span><span class=w>          </span><span class=nt>backup</span><span class=p>:</span><span class=w>
</span><span class=w>            </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=l>&lt;provider&gt;</span><span class=w>
</span><span class=w>            </span><span class=nt>secretRef</span><span class=p>:</span><span class=w>
</span><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sweet-seed-backup</span><span class=w>
</span><span class=w>              </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>garden</span><span class=w>
</span></code></pre></div><p>Deploy the gardenlet Helm chart to the Kubernetes cluster.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>helm install gardenlet charts/gardener/gardenlet <span class=se>\
</span><span class=se></span>  --namespace garden <span class=se>\
</span><span class=se></span>  -f gardenlet-values.yaml <span class=se>\
</span><span class=se></span>  --wait
</code></pre></div><p>This helm chart creates:</p><ul><li>A service account <code>gardenlet</code> that the gardenlet can use to talk to the Seed API server.</li><li>RBAC roles for the service account (full admin rights at the moment).</li><li>The secret (<code>garden</code>/<code>gardenlet-bootstrap-kubeconfig</code>) containing the bootstrap <code>kubeconfig</code>.</li><li>The gardenlet deployment in the <code>garden</code> namespace.</li></ul><h2 id=check-that-the-gardenlet-is-successfully-deployed>Check that the gardenlet is successfully deployed</h2><ol><li><p>Check that the gardenlets certificate bootstrap was successful.</p><p>Check if the secret <code>gardenlet-kubeconfig</code> in the namespace <code>garden</code> in the seed cluster
is created and contains a <code>kubeconfig</code> with a valid certificate.</p><ol><li><p>Get the <code>kubeconfig</code> from the created secret.</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl -n garden get secret gardenlet-kubeconfig -o json | jq -r .data.kubeconfig | base64 -d
</code></pre></div></li><li><p>Test against the garden cluster and verify it’s working.</p></li><li><p>Extract the <code>client-certificate-data</code> from the user <code>gardenlet</code>.</p></li><li><p>View the certificate:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>$ openssl x509 -in ./gardenlet-cert -noout -text
</code></pre></div><p>Check that the certificate is valid for a year (that is the lifetime of new certificates).</p></li></ol></li><li><p>Check that the bootstrap secret <code>gardenlet-bootstrap-kubeconfig</code> has been deleted from the seed cluster in namespace <code>garden</code>.</p></li><li><p>Check that the seed cluster is registered and <code>READY</code> in the garden cluster.</p><p>Check that the seed cluster <code>sweet-seed</code> exists and all conditions indicate that it’s available.
If so, the <a href=https://github.com/gardener/gardener/blob/master/docs/concepts/gardenlet.md#heartbeats>Gardenlet is sending regular heartbeats</a> and the <a href=https://github.com/gardener/gardener/blob/master/docs/usage/seed_bootstrapping.md>seed bootstrapping</a> was successful.</p><p>Check that the conditions on the <code>Seed</code> resource look similar to the following:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ kubectl get seed sweet-seed -o json <span class=p>|</span> jq .status.conditions
<span class=o>[</span>
  <span class=o>{</span>
    <span class=s2>&#34;lastTransitionTime&#34;</span>: <span class=s2>&#34;2020-07-17T09:17:29Z&#34;</span>,
    <span class=s2>&#34;lastUpdateTime&#34;</span>: <span class=s2>&#34;2020-07-17T09:17:29Z&#34;</span>,
    <span class=s2>&#34;message&#34;</span>: <span class=s2>&#34;Gardenlet is posting ready status.&#34;</span>,
    <span class=s2>&#34;reason&#34;</span>: <span class=s2>&#34;GardenletReady&#34;</span>,
    <span class=s2>&#34;status&#34;</span>: <span class=s2>&#34;True&#34;</span>,
    <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;GardenletReady&#34;</span>
  <span class=o>}</span>,
  <span class=o>{</span>
    <span class=s2>&#34;lastTransitionTime&#34;</span>: <span class=s2>&#34;2020-07-17T09:17:49Z&#34;</span>,
    <span class=s2>&#34;lastUpdateTime&#34;</span>: <span class=s2>&#34;2020-07-17T09:53:17Z&#34;</span>,
    <span class=s2>&#34;message&#34;</span>: <span class=s2>&#34;Seed cluster has been bootstrapped successfully.&#34;</span>,
    <span class=s2>&#34;reason&#34;</span>: <span class=s2>&#34;BootstrappingSucceeded&#34;</span>,
    <span class=s2>&#34;status&#34;</span>: <span class=s2>&#34;True&#34;</span>,
    <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;Bootstrapped&#34;</span>
  <span class=o>}</span>,
  <span class=o>{</span>
    <span class=s2>&#34;lastTransitionTime&#34;</span>: <span class=s2>&#34;2020-07-17T09:17:49Z&#34;</span>,
    <span class=s2>&#34;lastUpdateTime&#34;</span>: <span class=s2>&#34;2020-07-17T09:53:17Z&#34;</span>,
    <span class=s2>&#34;message&#34;</span>: <span class=s2>&#34;Backup Buckets are available.&#34;</span>,
    <span class=s2>&#34;reason&#34;</span>: <span class=s2>&#34;BackupBucketsAvailable&#34;</span>,
    <span class=s2>&#34;status&#34;</span>: <span class=s2>&#34;True&#34;</span>,
    <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;BackupBucketsReady&#34;</span>
  <span class=o>}</span>
<span class=o>]</span>
</code></pre></div></li></ol><h2 id=related-links>Related Links</h2><p><a href=https://github.com/gardener/gardener/issues/1724>Issue #1724: Harden Gardenlet RBAC privileges</a>.</p><p><a href=/v1.13.2/concepts/backup-restore/backup-restore>Backup and Restore</a>.</p></div></div></div><div class=howto_tickets><a href=https://github.com/gardener/gardener/issues/new/choose target=_blank><span>Let us know how can we improve.</span>
<span>Open<img src=https://gardener.cloud/images/branding/github-mark-logo-green.svg title=GitHub>issue <i class="fa fa-external-link" aria-hidden=true></i></span></a></div></section></div><style></style><footer class=footer><div class="container footer-wrapper"><ul class=nav><li><a href=/blog/>Blogs</a></li><li><a href=/community/>Community</a></li><li><a href=/adopter/>Adopters</a></li><li><a href=/documentation/home>Documentation</a></li></ul><img src=/images/lp/gardener-logo.svg alt="Logo Gardener" class=logo><ul class=media-wr><li><a target=_blank href=https://kubernetes.slack.com/archives/CB57N0BFG><img src=/images/branding/slack-logo-white.svg class=media-icon><div class=media-text>Slack</div></a></li><li><a target=_blank href=https://github.com/gardener><img src=/images/branding/github-mark-logo.png class=media-icon><div class=media-text>GitHub</div></a></li><li><a target=_blank href=https://www.youtube.com/channel/UCwUhwKFREV8Su0gwAJQX7tw><img src=/images/branding/youtube-logo-dark.svg class=media-icon><div class=media-text>YouTube</div></a></li><li><a target=_blank href=https://twitter.com/GardenerProject><img src=/images/branding/twitter-logo-white.svg class=media-icon><div class=media-text>Twitter</div></a></li></ul><span class=copyright>Copyright 2019-2021 Gardener project authors. <a href=https://www.sap.com/corporate/en/legal/privacy.html>Privacy policy
<i class="fa fa-external-link" aria-hidden=true></i></a></span></div></footer><script src=/js/jquery.sticky.js?1621013773></script><script src=/js/modernizr.custom.min.js?1621013773></script><script src=/js/code-snippets.js?1621013773></script><script>$(document).ready(function(){inlineSVG.init();$("[data-publishdate]").each(function(){$(this).text(moment($(this,"YYYY-MM-DD","YYYY-MM-DD hh:mm:ss").attr("data-publishdate")).fromNow());});new ClipboardJS('.clipboard-copy');$("body").codeSnippets();});</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W2FGNSX" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript></body></html>