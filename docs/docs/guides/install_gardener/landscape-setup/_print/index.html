<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.1"><link rel=canonical type=text/html href=https://gardener.cloud/docs/guides/install_gardener/landscape-setup/><link rel=alternate type=application/rss+xml href=https://gardener.cloud/docs/guides/install_gardener/landscape-setup/index.xml><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=icon type=image/x-icon href=https://gardener.cloud/images/favicon.ico><link rel=icon type=image/png href=https://gardener.cloud/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://gardener.cloud/images/favicon-16x16.png sizes=16x16><title>Landscape Setup | Gardener</title><meta name=description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta property="og:title" content="Landscape Setup"><meta property="og:description" content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta property="og:type" content="website"><meta property="og:url" content="https://gardener.cloud/docs/guides/install_gardener/landscape-setup/"><meta itemprop=name content="Landscape Setup"><meta itemprop=description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta name=twitter:card content="summary"><meta name=twitter:title content="Landscape Setup"><meta name=twitter:description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><link rel=preload href=/scss/main.min.122f9effc36493edf1f25030c2ce7965b16b3b0eaeb02528b9a50e0fa9110c15.css as=style><link href=/scss/main.min.122f9effc36493edf1f25030c2ce7965b16b3b0eaeb02528b9a50e0fa9110c15.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg width="90" height="90" viewBox="0 0 90 90" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>logo</title><desc>Created with Sketch.</desc><defs><path d="M41.8864954.994901575c.996545099999999-.479910833 2.6164002-.477918931 3.6088091.0L76.8159138 16.0781121C77.8124589 16.5580229 78.8208647 17.8257185 79.0659694 18.8995926l7.7355517 33.8916663C87.0476474 53.8696088 86.6852538 55.4484075 85.9984855 56.3095876L64.3239514 83.4885938C63.6343208 84.3533632 62.1740175 85.0543973 61.0725268 85.0543973H26.3092731c-1.1060816.0-2.5646564-.704623400000003-3.2514246-1.5658035L1.38331434 56.3095876C.693683723 55.4448182.335174016 53.865133.580278769 52.7912589L8.31583044 18.8995926C8.56195675 17.8212428 9.57347722 16.556031 10.5658861 16.0781121L41.8864954.994901575z" id="path-1"/><linearGradient x1="12.7542673%" y1="-18.6617048%" x2="88.2666158%" y2="84.6075483%" id="linearGradient-3"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="50%" y1="4.93673768%" x2="148.756007%" y2="175.514523%" id="linearGradient-4"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="19.1574381%" y1="-9.04800713%" x2="82.2203149%" y2="77.9084293%" id="linearGradient-5"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="57.4403751%" y1="26.3148481%" x2="137.966711%" y2="158.080556%" id="linearGradient-6"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="logo"><g id="Rectangle-2" transform="translate(1.000000, 0.000000)"><mask id="mask-2" fill="#fff"><use xlink:href="#path-1"/></mask><use id="Mask" fill="#009f76" xlink:href="#path-1"/><polygon fill="#000" opacity=".289628623" mask="url(#mask-2)" points="-17.6484375 54.5224609 30.8242188 25.0791016 63.4726562 58.5 24.7324219 92.6689453"/></g><path d="M56.8508631 39.260019C56.4193519 40.443987 55.6088085 41.581593 54.6736295 42.1938694l-8.0738997 5.2861089c-1.3854671.907087099999998-3.6247515.9116711-5.0172201.0L33.50861 42.1938694C32.123143 41.2867823 31 39.206345 31 37.545932V26.4150304c0-.725313.2131118-1.5301454.569268099999999-2.2825772L56.8508631 39.260019z" id="Combined-Shape" fill="url(#linearGradient-3)" transform="translate(43.925432, 36.147233) scale(-1, 1) translate(-43.925432, -36.147233)"/><path d="M56.0774672 25.1412464C56.4306829 25.8903325 56.6425556 26.6907345 56.6425556 27.4119019V38.5428034c0 1.6598979-1.1161415 3.73626640000001-2.50861 4.6479374l-8.0738997 5.286109c-1.3854671.907087000000004-3.6247516.911671000000005-5.0172201.0L32.9689261 43.1907408C32.2918101 42.7474223 31.6773514 42.0238435 31.2260376 41.206007L56.0774672 25.1412464z" id="Combined-Shape" fill="url(#linearGradient-4)" transform="translate(43.821278, 37.246598) scale(-1, 1) translate(-43.821278, -37.246598)"/><path d="M65.0702134 57.1846889C64.5985426 58.2007851 63.8367404 59.1236871 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.1597438 58.7930183 24 56.7816693 24 55.1323495V37.1145303C24 36.3487436 24.249712 35.5060005 24.6599102 34.7400631L65.0702134 57.1846889z" id="Combined-Shape" fill="url(#linearGradient-5)"/><path d="M65.0189476 34.954538C65.3636909 35.6617313 65.5692194 36.42021 65.5692194 37.1145303V55.1323495C65.5692194 56.7842831 64.4072119 58.7943252 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.9237304 59.2341061 25.3159155 58.5918431 24.8568495 57.8487596L65.0189476 34.954538z" id="Combined-Shape" fill="url(#linearGradient-6)"/></g></g></svg></span><span class=text-capitalize>Gardener</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/adopter><span>Adopters</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog><span>Blogs</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community><span>Community</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs><span>Documentation</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.f4af3dcf92ecc90d03b61037fcdad640.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/guides/install_gardener/landscape-setup/>Return to the regular view of this page</a>.</p></div><h1 class=title>Landscape Setup</h1><div class=content><h1 id=---deprecated--->&mdash;DEPRECATED&mdash;</h1><p><strong>This project is outdated and won&rsquo;t be updated anymore. Please use <a href=https://github.com/gardener/garden-setup>https://github.com/gardener/garden-setup</a> instead!</strong></p><h1 id=gardener-setup-scripts>Gardener Setup Scripts</h1><p>This README is the installation manual for a simple Gardener setup. The installation scripts in this repo are embedded in a configuration template in the <a href=https://github.com/gardener/landscape-setup-template>landscape-setup-template</a> project. You can find further information there.</p><p>We do recommend this simplified setup for demonstration purposes only. For productive workloads we do recommend that all components (Gardener/Seed/Shoot) run in their own IaaS accounts and that network policies are enabled and properly tested on the seed clusters. A documentation on how to do this is currently work in progress.</p><ul><li><a href=#---deprecated--->&mdash;DEPRECATED&mdash;</a></li><li><a href=#gardener-setup-scripts>Gardener Setup Scripts</a></li><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#gardener-installation>Gardener Installation</a><ul><li><a href=#tldr>TL;DR</a><ul><li><a href=#kubectl-aliases>Kubectl Aliases</a></li></ul></li><li><a href=#step-1-clone-the-repositories-and-get-dependencies>Step 1: Clone the Repositories and get Dependencies</a><ul><li><a href=#submodule-management>Submodule Management</a></li></ul></li><li><a href=#step-2-configure-the-landscape>Step 2: Configure the Landscape</a><ul><li><a href=#building-the-landscapeyaml-file>Building the &lsquo;landscape.yaml&rsquo; File</a></li><li><a href=#the-base-cluster>The Base Cluster</a><ul><li><a href=#kubify>Kubify</a></li><li><a href=#shoot-cluster>Shoot Cluster</a></li><li><a href=#using-an-arbitrary-base-cluster>Using an Arbitrary Base Cluster</a></li></ul></li></ul></li><li><a href=#step-3-build-and-run-docker-container>Step 3: Build and Run Docker Container</a></li><li><a href=#step-4-10-deploying-components>Step 4-10: Deploying Components</a><ul><li><a href=#undeploying-components>Undeploying Components</a></li><li><a href=#the-all-component>The &lsquo;all&rsquo; Component</a></li></ul></li><li><a href=#step-4-10-deploying-components-detailed>Step 4-10: Deploying Components (detailed)</a><ul><li><a href=#step-4-kubify--etcd>Step 4: Kubify / etcd</a></li><li><a href=#step-5-generate-certificates>Step 5: Generate Certificates</a></li><li><a href=#step-6-deploy-tiller>Step 6: Deploy tiller</a></li><li><a href=#step-7-deploy-gardener>Step 7: Deploy Gardener</a></li><li><a href=#step-8-register-garden-cluster-as-seed-cluster>Step 8: Register Garden Cluster as Seed Cluster</a><ul><li><a href=#configuring-additional-seeds>Configuring Additional Seeds</a></li><li><a href=#creating-a-shoot>Creating a Shoot</a></li></ul></li><li><a href=#step-9-install-identity-and-dashboard>Step 9: Install Identity and Dashboard</a><ul><li><a href=#create-cname-entry>Create CNAME Entry</a></li></ul></li><li><a href=#step-10-apply-valid-certificates>Step 10: Apply Valid Certificates</a></li><li><a href=#letsencrypt-quota-limits>Letsencrypt Quota Limits</a><ul><li><a href=#accessing-the-dashboard>Accessing the Dashboard</a></li></ul></li></ul></li></ul></li><li><a href=#tearing-down-the-landscape>Tearing Down the Landscape</a></li><li><a href=#cleanup>Cleanup</a></li></ul><h1 id=prerequisites>Prerequisites</h1><p>Before getting started make sure you have the following at hand:</p><ul><li>You need a cloud account with sufficient quota to set up a Kubernetes cluster with a couple of VMs. <strong>The Gardener supports AWS, Azure, GCP, and Openstack, but this simplified setup currently only supports AWS and Openstack.</strong></li><li>A Linux machine (virtual machine is fine) or a Mac with basic tools such as a git client and the Docker runtime installed.</li></ul><h1 id=gardener-installation>Gardener Installation</h1><p>Follow these steps to install Gardener. Do not proceed to the next step in case of errors.</p><h2 id=tldr>TL;DR</h2><p>If you are already familiar with the installation procedure and just want a short summary of the commands you have to use, here it is:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># setup</span>
git clone  --recursive https://github.com/gardener/landscape-setup-template.git landscape
<span class=c1># fill in landscape/landscape_config.yaml now</span>
<span class=nb>cd</span> landscape/setup
./docker_run.sh
deploy all

<span class=c1># -------------------------------------------------------------------</span>

<span class=c1># teardown</span>
undeploy all
./cleanup.sh
</code></pre></div><p>Otherwise, follow the detailed guide below.</p><h3 id=kubectl-aliases>Kubectl Aliases</h3><p>The following aliases can be used within the docker container:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>k =&gt; kubectl
ks =&gt; kubectl -n kube-system
kg =&gt; kubectl -n garden
kn =&gt; kubectl -n
ka =&gt; kubectl get --all-namespaces
</code></pre></div><p>Bash completion works for all of them except for <code>ka</code>.</p><h2 id=step-1-clone-the-repositories-and-get-dependencies>Step 1: Clone the Repositories and get Dependencies</h2><p>Get the <code>landscape-setup-template</code> from GitHub and initialize the submodules:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>git clone  --recursive https://github.com/gardener/landscape-setup-template.git landscape
<span class=nb>cd</span> landscape
</code></pre></div><p>After step 2, this repository will contain all passwords and keys for your landscape. You will be in trouble if you loose them so we recommend that you store this landscape configuration in a private repository. It might be a good idea to change the origin so you do not accidentally publish your secrets to the public template repository.</p><h3 id=submodule-management>Submodule Management</h3><p>This project needs the <a href=https://github.com/gardener/gardener>Gardener</a> and <a href=https://github.com/gardener/dashboard>dashboard</a> as submodules. To avoid conflicts between the checked out versions and the ones specified in the <code>landscape_base.yaml</code> file, automatic version management has been added. As long as the <code>managed</code> field in the chart area of each submodule is set to <code>true</code>, the version specified in the <code>tag</code> field will be checked out before deploying.</p><p>To check vor the correct version, the <code>VERSION</code> file in the submodule&rsquo;s main folder is read and compared to the tag in the config file. If the <code>VERSION</code> file doesn&rsquo;t exist, the component is added as a submodule. If it exists, but the versions differ, the fitting version will be checked out. If it exists and the versions are identical, nothing is done. The automatic version management will fail if a) the component is already added as a submodule, but the <code>VERSION</code> file is missing or b) the landscape folder is not a git repo.</p><p>It is also possible to trigger the version update manually: call the <code>manage_submodule</code> function with <code>gardener</code> or <code>dashboard</code> as an argument, or run the <code>manage_submodules.sh</code> script which will update Gardener and dashboard. Both will only work from inside the docker container / with sourced <code>init.sh</code> file.</p><h2 id=step-2-configure-the-landscape>Step 2: Configure the Landscape</h2><p>There is a <code>landscape_config.yaml</code> file in the landscape project. This is the only file that you need to modify - all other configuration files will be derived from this and the <code>landscape_base.yaml</code> file. The latter one contains the merging instructions as well as technical configurations and it shouldn&rsquo;t be touched unless you know what you are doing.</p><h4 id=building-the-landscapeyaml-file>Building the &lsquo;landscape.yaml&rsquo; File</h4><p>Both config files - <code>landscape_config.yaml</code> and <code>landscape_base.yaml</code> - are merged into one <code>landscape.yaml</code> file which is then used as configuration for the scripts. Sourcing the <code>init.sh</code> file (which happens automatically when entering the docker image) will perform this merge <strong>unless the file already exists.</strong> This means if you change something in one of the original config files after the <code>landscape.yaml</code> file has already been created, you need to manually rebuild it in order for the changes to take effect.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>./build_landscape_yaml.sh
</code></pre></div><p>This script will recreate the <code>landscape.yaml</code> file. It will also source the <code>init.sh</code> file again, as some of the environment variables are extracted from this file.</p><h4 id=the-base-cluster>The Base Cluster</h4><p>Gardener extends the Kubernetes apiserver, so in order to deploy it, you need a Kubernetes cluster first. This setup gives you two options for this:</p><h5 id=kubify>Kubify</h5><p>You can use <a href=https://github.com/gardener/kubify>Kubify</a> to create the initial cluster. Kubify uses Terraform to create the cluster and it is integrated into this project - you don&rsquo;t need to create the cluster yourself, just make sure you fill out all relevant parts of the config file.</p><h5 id=shoot-cluster>Shoot Cluster</h5><p>A shoot cluster is a cluster created by a Gardener instance and it can be used as a base cluster for this project. These flags have to be set for the kube-apiserver (if not set, the Gardener will still work, but the dashboard won&rsquo;t):</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml>--<span class=l>oidc-issuer-url=https://identity.ingress.&lt;your cluster domain&gt;</span><span class=w>
</span><span class=w></span>--<span class=l>oidc-client-id=kube-kubectl</span><span class=w>
</span><span class=w></span>--<span class=l>oidc-username-claim=email</span><span class=w>
</span><span class=w></span>--<span class=l>oidc-groups-claim=groups</span><span class=w>
</span></code></pre></div><p>For a shoot this can be done by setting <code>issuerUrl</code>, <code>clientID</code>, <code>usernameClaim</code>, and <code>groupsClaim</code> in <code>spec.kubernetes.kubeAPIServer.oidcConfig</code> in the shoot manifest.</p><p>Also make sure that the CIDRs of your base cluster and the from your Gardener spawned shoots don&rsquo;t overlap - if you want to be able to create shoots from the Gardener dashboard later, then don&rsquo;t use the default CIDRs for this base cluster.</p><p>Some fields in the <code>landscape_config.yaml</code> are marked with <code># kubify only</code>, they can be ignored when using a shoot as the base cluster. The etcd server address defaults to the address for Kubify and needs to be changed for the shoot setup (see the comments in the config file).</p><p>The <em>kubeconfig</em> for the base cluster is expected to be named <code>kubeconfig</code> and reside in the directory containing this project&rsquo;s directory (next to the <code>landscape_config.yaml</code> file).</p><h5 id=using-an-arbitrary-base-cluster>Using an Arbitrary Base Cluster</h5><p>While this setup has only been tested for clusters created by Kubify or the Gardener (shoot clusters), it is theoretically possible to use the shoot setup method to deploy the Gardener to an arbitrary kubernetes cluster.</p><h2 id=step-3-build-and-run-docker-container>Step 3: Build and Run Docker Container</h2><p>First, <code>cd</code> into the folder containing this project.</p><p>Then run the container:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>./docker_run.sh
</code></pre></div><p>After this,</p><ul><li>you will be connected to the container via an interactive shell</li><li>the landscape folder will be mounted in that container</li><li>your current working directory will be <code>setup</code> folder</li><li><code>setup/init.sh</code> is sourced, meaning<ul><li>the environment variables will be set</li><li>kubectl will be configured to communicate with your cluster</li><li><code>landscape.yaml</code> file will have been created if it didn&rsquo;t exist before</li></ul></li></ul><p>The <code>docker_run.sh</code> script searches for the image locally and pulls it from an image repository, if it isn&rsquo;t found.
If pulling the image doesn&rsquo;t work for whatever reason, you can use the <code>docker_build.sh</code> script to build the image locally.</p><h2 id=step-4-10-deploying-components>Step 4-10: Deploying Components</h2><p>The Gardener deployment is splitted into components. A single component can be easily deployed using</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>deploy &lt;component name&gt;
</code></pre></div><p>Please take care that most of the components depend on each other and therefore have to be deployed in the order given below.</p><p>The <code>deploy</code> command is added to the <code>PATH</code> environment variable and can thus be called from anywhere. Bash auto-completion can be used for the component names.</p><h4 id=undeploying-components>Undeploying Components</h4><p>It is also possible to &ldquo;undeploy&rdquo; a component using</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>undeploy &lt;component name&gt;
</code></pre></div><p>Components need to be undeployed in the inverse order. Do not undeploy components without undeploying their successors in the component order first. Take care to delete all shoots before undeploying the <code>gardener</code> or <code>seed-config</code> components (although both undeploy scripts will check for that and trigger a deletion themselves).</p><h4 id=the-all-component>The &lsquo;all&rsquo; Component</h4><p>The <code>all</code> component is a special component: it serves as a dummy to deploy several components in one go. Usually, manual intervention between deploying components is not necessary and most of them are deployed directly one after the other, so the <code>all</code> component makes the &ldquo;normal&rdquo; use-case easier.</p><p>For better control which components are deployed, a component range can be given as an argument. The argument should have the form <code>&lt;start component name>:&lt;end component name></code> and then the start component, the end component, and all components in between will be deployed. The order of the arguments is taken from the environment variables with the <code>$COMPONENT_ORDER_</code> prefix. The variable with the suffix that matches the <code>clusters.base_cluster</code> entry in the config file will be used.</p><p>It is also possible to drop one part of the range or to drop the whole argument. For missing parts the defaults will be used, which are the first and the last component of the active component order, respectively.</p><p>The <code>undeploy</code> command can also be used with the <code>all</code> component, but take care that the component order is inverted.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># Examples</span>
<span class=c1># (start and end component are always inclusive)</span>
deploy all                          <span class=c1># deploys all components</span>
deploy all gardener:dashboard       <span class=c1># deploys &#39;gardener&#39; through &#39;dashboard&#39; </span>
deploy all gardener:                <span class=c1># deploys all components starting from &#39;gardener&#39;</span>
deploy all :gardener                <span class=c1># deploys all components up to &#39;gardener&#39;</span>

<span class=c1># (all undeploy commands use the inverse component order)</span>
undeploy all                        <span class=c1># undeploys all components</span>
undeploy all :helm-tiller           <span class=c1># undeploys all components up to &#39;helm-tiller&#39;</span>
undeploy all dashboard:cert         <span class=c1># undeploys &#39;dashboard&#39; through &#39;cert&#39;</span>
</code></pre></div><h2 id=step-4-10-deploying-components-detailed>Step 4-10: Deploying Components (detailed)</h2><h3 id=step-4-kubify--etcd>Step 4: Kubify / etcd</h3><p>If you want to create a Kubify cluster, deploy the component:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>deploy kubify
</code></pre></div><p>The script will wait some time for the cluster to come up and then partly validate that the cluster is ready.</p><p>If you get errors during the cluster setup, just try to run the command again.</p><p>Once completed the following command should show all deployed pods:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>root@c41327633d6d:/landscape# kubectl get pods --all-namespaces
NAMESPACE       NAME                                                                  READY     STATUS    RESTARTS   AGE
kube-system     etcd-operator-75dcfcf4f7-xkm4h                                        1/1       Running   0          6m
kube-system     heapster-c8fb4f746-tvts6                                              2/2       Running   0          2m
kube-system     kube-apiserver-hcdnc                                                  1/1       Running   0          6m
[...]
</code></pre></div><hr><p>If you already have a cluster, you don&rsquo;t need Kubify. To deploy an etcd in your cluster, run</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>deploy etcd
</code></pre></div><p>This component is not meant to be used in combination with Kubify and might require manual steps to make it work.</p><p>It should also be possible to plug in your own etcd - check the deploy scripts for the <code>etcd</code> and <code>gardener</code> components for information on where to put the certificates, etc.</p><h3 id=step-5-generate-certificates>Step 5: Generate Certificates</h3><p>This step will generate a self-signed cluster CA and sign some certificates with it.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>deploy cert
</code></pre></div><h3 id=step-6-deploy-tiller>Step 6: Deploy tiller</h3><p>Tiller is needed to deploy the Helm charts of Gardener and other components.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>deploy helm-tiller
</code></pre></div><h3 id=step-7-deploy-gardener>Step 7: Deploy Gardener</h3><p>Now we can deploy Gardener. If the previous steps were executed successfully this should be completed in a couple of seconds.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>deploy gardener
</code></pre></div><p>You might see a couple of messages like these:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>Gardener API server not yet reachable. Waiting...
</code></pre></div><p>while the script waits for the Gardener to start. Once Gardener is up when the deployment script finished you can verify the correct setup by running the following command:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubectl get shoots
No resources found. 
</code></pre></div><p>As we do not have a seed cluster yet we cannot create any shoot clusters.
The Gardener itself is installed in the <code>garden</code> namespace:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubectl get po -n garden
NAME                                          READY     STATUS    RESTARTS   AGE
gardener-apiserver-56cc665667-nvrjl           1/1       Running   0          6m
gardener-controller-manager-5c9f8db55-hfcts   1/1       Running   0          6m
</code></pre></div><h3 id=step-8-register-garden-cluster-as-seed-cluster>Step 8: Register Garden Cluster as Seed Cluster</h3><p>In heterogeneous productive environments one would run Gardener and seed in separate clusters but for simplicity and resource consumption reasons we will register the Gardener cluster that we have just created also as the seed cluster. Make sure that the <code>seed_config</code> in the landscape file is correct and matches the region that you are using. Keep in mind that image ids differ between regions as well. Also, valid credentials for the seed provider have to be specified in the <code>authentication</code> part of the <code>landscape_config.yaml</code> file (the etcd backups of the shoot clusters are stored on the seed).</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>deploy seed-config
</code></pre></div><h4 id=configuring-additional-seeds>Configuring Additional Seeds</h4><p>By default, this step will create a seed for the cloud provider the Gardener has been deployed on and thus creating shoots on this provider will be possible. If you want to create shoots on other cloud providers, you will have to configure additional seeds. There are two options for that:</p><p>If the seed-config deploy script is called without any arguments (as shown above), it will create seeds for all providers specified in the <code>seed_config.seeds</code> section in the <code>landscape_config.yaml</code> file. By default, the only entry in that list is the cloud provider chosen for the Gardener cluster, but you can extend the list.</p><p>It is also possible to provide the seed-config deploy script with additional arguments specifying which seeds should be created. Multiple arguments can be given and the script will ignore the list in the <code>landscape_config.yaml</code> file when called with arguments. Only the specified seeds will be created, already existing seeds are not affected. If a given seed already exists, it will be updated to the current configuration.</p><p>In both cases, the corresponding variant nodes in <code>authentication</code> and <code>seed_config</code> have to be filled out in the config file.</p><p>Valid values for seeds are <code>aws</code>, <code>az</code> (for Azure), <code>gcp</code>, and <code>openstack</code>. Please note, that while it is possible to create seeds for any cloud provider on any cloud provider, shoot creation may not work across cloud providers for every combination. It should always work if seed (Gardener cluster in this setup) and shoot are on the same provider, though.</p><h4 id=creating-a-shoot>Creating a Shoot</h4><p>That&rsquo;s it! If everything went fine you should now be able to create shoot clusters.
You can start with a sample <a href=https://github.com/gardener/gardener/blob/master/example/90-shoot-aws.yaml>manifest</a> and create a shoot cluster by standard Kubernetes means:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>kubectl apply -f shoot-aws.yaml
</code></pre></div><h3 id=step-9-install-identity-and-dashboard>Step 9: Install Identity and Dashboard</h3><p>Creating clusters based on a shoot manifest is quite nice but also a little complex. While almost all aspects of a shoot cluster can be configured, it can be quite difficult for beginners, so go on and install the dashboard:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>deploy identity
<span class=o>[</span>...<span class=o>]</span>
deploy dashboard
<span class=o>[</span>...<span class=o>]</span>
</code></pre></div><h4 id=create-cname-entry>Create CNAME Entry</h4><p>Dashboard and identity need a CNAME entry pointing the domain <code>*.ingress.&lt;your cluster domain></code> to your cluster&rsquo;s nginx ingress ip/hostname. Kubify creates this entry automatically. If you are not using kubify to create your base cluster, you can create the CNAME entry with the corresponding component:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>deploy cname
</code></pre></div><p>The script uses the AWS CLI to create the entry, so it will only work for route53.</p><h3 id=step-10-apply-valid-certificates>Step 10: Apply Valid Certificates</h3><p>The following command will install the <a href=https://github.com/jetstack/cert-manager>cert-manager</a> and request valid letsencrypt certificates for both the identity and dashboard ingresses:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>deploy certmanager
</code></pre></div><p>After a few minutes valid certificates should be installed.</p><h3 id=letsencrypt-quota-limits>Letsencrypt Quota Limits</h3><p>Letsencrypt <a href=https://letsencrypt.org/docs/rate-limits/>limits</a> how many certificates you can get for the same host within a short time. To avoid hitting these limits, you can use the letsencrypt staging server for testing, which has a significantly higher rate limit but produces untrusted certificates.<br>The <code>charts.[certmanager].live</code> field in the config file allows to switch between live and staging server (remember to rebuild the <code>landscape.yaml</code> file after you changed something in the <code>landscape_config.yaml</code> file).</p><h4 id=accessing-the-dashboard>Accessing the Dashboard</h4><p>After step 9 you will be able to access the Gardener dashboard. There is a difference in how you access it depending on whether you used the letsencrypt live server or the staging one (and thus have untrusted credentials in the latter case).</p><p>The <code>print_dashboard_urls.sh</code> script constructs two URLs from the domain name given in the <code>landscape.yaml</code> file and prints them.</p><p>If you have trusted certificates, just use the second one (the one for the dashboard) and everything will be fine.</p><p>If you used the letsencrypt staging server, you will need to visit the first link first. Your browser will show a warning regarding untrusted certificates, you need to ignore that warning. You will then see a nearly blank page with some 404 message. After that, you can open the dashboard link, ignore the certificate warning again and should be able to login.
If you skip the first link, you will still be able to see the dashboard, but the login button probably won&rsquo;t work.
While you will be able to login and create projects with the untrusted certificates from the letsencrypt staging server, creating secrets or shoots won&rsquo;t be possible. You&rsquo;ll need trusted certificates for that.</p><p>To log into the dashboard, use the options you have specified in the identity chart part of the <code>landscape_config.yaml</code>.</p><h1 id=tearing-down-the-landscape>Tearing Down the Landscape</h1><p>Make sure that you delete all shoot clusters prior to tearing down the cluster. Not deleting <code>project</code> resources before deleting the Gardener can also cause troubles, because the namespaces associated with the projects have a finalizer which can&rsquo;t be handled anymore when the Gardener is gone. Both, shoots and projects, can be deleted using the <code>delete_all.sh</code> script (give &lsquo;shoots&rsquo; or &lsquo;projects&rsquo; as an argument). To delete a single shoot/project, use <a href=https://github.com/gardener/gardener/blob/master/hack/delete>this</a> script.</p><p>The following command should not return any shoot clusters:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubectl get shoots --all-namespaces
No resources found.
</code></pre></div><p>If you created your base cluster with the Kubify component, you can destroy it using the undeploy command:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>undeploy kubify
</code></pre></div><h1 id=cleanup>Cleanup</h1><p>After destroying the Kubify cluster, there will be some files left that prevent you from simply starting the project up again.</p><p><strong>ATTENTION: Only do this if you are sure the cluster has been completely destroyed!</strong>
Since this removes the terraform state, an automated deletion of resources won&rsquo;t be possible anymore - you will have to clean up any leftovers manually.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>./cleanup.sh
</code></pre></div><p>This will reset your landscape folder to its initial state (including the deletion of <code>landscape.yaml</code>).</p><p>The script takes an optional &ldquo;-y&rdquo; argument to skip the confirmation.</p></div></div></main></div></div><footer class="footer row d-print-none"><div class="container-fluid footer-wrapper"><ul class=nav><li><a href=/blog/>Blogs</a></li><li><a href=/community/>Community</a></li><li><a href=/adopter/>Adopters</a></li><li><a href=/docs/>Documentation</a></li></ul><img src=/images/lp/gardener-logo.svg alt="Logo Gardener" class=logo><ul class=media-wr><li><a target=_blank href=https://kubernetes.slack.com/archives/CB57N0BFG><img src=/images/branding/slack-logo-white.svg class=media-icon><div class=media-text>Slack</div></a></li><li><a target=_blank href=https://github.com/gardener><img src=/images/branding/github-mark-logo.png class=media-icon><div class=media-text>GitHub</div></a></li><li><a target=_blank href=https://www.youtube.com/channel/UCwUhwKFREV8Su0gwAJQX7tw><img src=/images/branding/youtube-logo-dark.svg class=media-icon><div class=media-text>YouTube</div></a></li><li><a target=_blank href=https://twitter.com/GardenerProject><img src=/images/branding/twitter-logo-white.svg class=media-icon><div class=media-text>Twitter</div></a></li></ul><span class=copyright>Copyright 2019-2021 Gardener project authors. <a href=https://www.sap.com/corporate/en/legal/privacy.html>Privacy policy
<i class="fa fa-external-link" aria-hidden=true></i></a></span></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/js/main.min.3b172c13b62c2bea8b1c9d2599cddc8cf89718a92d792c680871c81ba43d8c85.js integrity="sha256-OxcsE7YsK+qLHJ0lmc3cjPiXGKkteSxoCHHIG6Q9jIU=" crossorigin=anonymous></script></body></html>