<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://gardener.cloud/docs/gardener/monitoring/><link rel=alternate type=application/rss+xml href=https://gardener.cloud/docs/gardener/monitoring/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Monitoring | Gardener</title>
<meta name=description content="MonitoringRoles of the different Prometheus instances
Cache PrometheusDeployed in the garden namespace. Important scrape targets:
cadvisor node-exporter kube-state-metrics Purpose: Act as a reverse proxy that supports server-side filtering, which is not supported by Prometheus exporters but by federation. Metrics in this Prometheus are kept for a short amount of time (~1 day) since other Prometheus instances are expected to federate from it and move metrics over. For example, the shoot Prometheus queries this Prometheus to retrieve metrics corresponding to the shoot’s control plane. This way, we achieve isolation so that shoot owners are only able to query metrics for their shoots. Please note Prometheus does not support isolation features. Another example is if another Prometheus needs access to cadvisor metrics, which does not support server-side filtering, so it will query this Prometheus instead of the cadvisor. This strategy also reduces load on the kubelets and API Server."><meta property="og:url" content="https://gardener.cloud/docs/gardener/monitoring/"><meta property="og:site_name" content="Gardener"><meta property="og:title" content="Monitoring"><meta property="og:description" content="MonitoringRoles of the different Prometheus instances
Cache PrometheusDeployed in the garden namespace. Important scrape targets:
cadvisor node-exporter kube-state-metrics Purpose: Act as a reverse proxy that supports server-side filtering, which is not supported by Prometheus exporters but by federation. Metrics in this Prometheus are kept for a short amount of time (~1 day) since other Prometheus instances are expected to federate from it and move metrics over. For example, the shoot Prometheus queries this Prometheus to retrieve metrics corresponding to the shoot’s control plane. This way, we achieve isolation so that shoot owners are only able to query metrics for their shoots. Please note Prometheus does not support isolation features. Another example is if another Prometheus needs access to cadvisor metrics, which does not support server-side filtering, so it will query this Prometheus instead of the cadvisor. This strategy also reduces load on the kubelets and API Server."><meta property="og:locale" content="en_US"><meta property="og:type" content="website"><meta property="og:image" content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta itemprop=name content="Monitoring"><meta itemprop=description content="MonitoringRoles of the different Prometheus instances
Cache PrometheusDeployed in the garden namespace. Important scrape targets:
cadvisor node-exporter kube-state-metrics Purpose: Act as a reverse proxy that supports server-side filtering, which is not supported by Prometheus exporters but by federation. Metrics in this Prometheus are kept for a short amount of time (~1 day) since other Prometheus instances are expected to federate from it and move metrics over. For example, the shoot Prometheus queries this Prometheus to retrieve metrics corresponding to the shoot’s control plane. This way, we achieve isolation so that shoot owners are only able to query metrics for their shoots. Please note Prometheus does not support isolation features. Another example is if another Prometheus needs access to cadvisor metrics, which does not support server-side filtering, so it will query this Prometheus instead of the cadvisor. This strategy also reduces load on the kubelets and API Server."><meta itemprop=wordCount content="772"><meta itemprop=image content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta name=twitter:title content="Monitoring"><meta name=twitter:description content="MonitoringRoles of the different Prometheus instances
Cache PrometheusDeployed in the garden namespace. Important scrape targets:
cadvisor node-exporter kube-state-metrics Purpose: Act as a reverse proxy that supports server-side filtering, which is not supported by Prometheus exporters but by federation. Metrics in this Prometheus are kept for a short amount of time (~1 day) since other Prometheus instances are expected to federate from it and move metrics over. For example, the shoot Prometheus queries this Prometheus to retrieve metrics corresponding to the shoot’s control plane. This way, we achieve isolation so that shoot owners are only able to query metrics for their shoots. Please note Prometheus does not support isolation features. Another example is if another Prometheus needs access to cadvisor metrics, which does not support server-side filtering, so it will query this Prometheus instead of the cadvisor. This strategy also reduces load on the kubelets and API Server."><link rel=preload href=/scss/main.min.a0c8c4899ce282dcbb2306a0b99a4fae18db6c239ce7b3bc375f59e6ee82bdad.css as=style integrity="sha256-oMjEiZzigty7IwaguZpPrhjbbCOc57O8N19Z5u6Cva0=" crossorigin=anonymous><link href=/scss/main.min.a0c8c4899ce282dcbb2306a0b99a4fae18db6c239ce7b3bc375f59e6ee82bdad.css rel=stylesheet integrity="sha256-oMjEiZzigty7IwaguZpPrhjbbCOc57O8N19Z5u6Cva0=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg width="90" height="90" viewBox="0 0 90 90" xmlns:xlink="http://www.w3.org/1999/xlink"><title>logo</title><desc>Created with Sketch.</desc><defs><path d="M41.8864954.994901575c.996545099999999-.479910833 2.6164002-.477918931 3.6088091.0L76.8159138 16.0781121C77.8124589 16.5580229 78.8208647 17.8257185 79.0659694 18.8995926l7.7355517 33.8916663C87.0476474 53.8696088 86.6852538 55.4484075 85.9984855 56.3095876L64.3239514 83.4885938C63.6343208 84.3533632 62.1740175 85.0543973 61.0725268 85.0543973H26.3092731c-1.1060816.0-2.5646564-.704623400000003-3.2514246-1.5658035L1.38331434 56.3095876C.693683723 55.4448182.335174016 53.865133.580278769 52.7912589L8.31583044 18.8995926C8.56195675 17.8212428 9.57347722 16.556031 10.5658861 16.0781121L41.8864954.994901575z" id="path-1"/><linearGradient x1="12.7542673%" y1="-18.6617048%" x2="88.2666158%" y2="84.6075483%" id="linearGradient-3"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="50%" y1="4.93673768%" x2="148.756007%" y2="175.514523%" id="linearGradient-4"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="19.1574381%" y1="-9.04800713%" x2="82.2203149%" y2="77.9084293%" id="linearGradient-5"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="57.4403751%" y1="26.3148481%" x2="137.966711%" y2="158.080556%" id="linearGradient-6"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="logo"><g id="Rectangle-2" transform="translate(1.000000, 0.000000)"><mask id="mask-2" fill="#fff"><use xlink:href="#path-1"/></mask><use id="Mask" fill="#009f76" xlink:href="#path-1"/><polygon fill="#000" opacity=".289628623" mask="url(#mask-2)" points="-17.6484375 54.5224609 30.8242188 25.0791016 63.4726562 58.5 24.7324219 92.6689453"/></g><path d="M56.8508631 39.260019C56.4193519 40.443987 55.6088085 41.581593 54.6736295 42.1938694l-8.0738997 5.2861089c-1.3854671.907087099999998-3.6247515.9116711-5.0172201.0L33.50861 42.1938694C32.123143 41.2867823 31 39.206345 31 37.545932V26.4150304c0-.725313.2131118-1.5301454.569268099999999-2.2825772L56.8508631 39.260019z" id="Combined-Shape" fill="url(#linearGradient-3)" transform="translate(43.925432, 36.147233) scale(-1, 1) translate(-43.925432, -36.147233)"/><path d="M56.0774672 25.1412464C56.4306829 25.8903325 56.6425556 26.6907345 56.6425556 27.4119019V38.5428034c0 1.6598979-1.1161415 3.73626640000001-2.50861 4.6479374l-8.0738997 5.286109c-1.3854671.907087000000004-3.6247516.911671000000005-5.0172201.0L32.9689261 43.1907408C32.2918101 42.7474223 31.6773514 42.0238435 31.2260376 41.206007L56.0774672 25.1412464z" id="Combined-Shape" fill="url(#linearGradient-4)" transform="translate(43.821278, 37.246598) scale(-1, 1) translate(-43.821278, -37.246598)"/><path d="M65.0702134 57.1846889C64.5985426 58.2007851 63.8367404 59.1236871 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.1597438 58.7930183 24 56.7816693 24 55.1323495V37.1145303C24 36.3487436 24.249712 35.5060005 24.6599102 34.7400631L65.0702134 57.1846889z" id="Combined-Shape" fill="url(#linearGradient-5)"/><path d="M65.0189476 34.954538C65.3636909 35.6617313 65.5692194 36.42021 65.5692194 37.1145303V55.1323495C65.5692194 56.7842831 64.4072119 58.7943252 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.9237304 59.2341061 25.3159155 58.5918431 24.8568495 57.8487596L65.0189476 34.954538z" id="Combined-Shape" fill="url(#linearGradient-6)"/></g></g></svg></span><span class=navbar-brand__name>Gardener</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://demo.gardener.cloud target=_blank rel=noopener><span>Demo</span></a></li><li class=nav-item><a class=nav-link href=/adopter><span>Adopters</span></a></li><li class=nav-item><a class=nav-link href=/docs><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/blog><span>Blogs</span></a></li><li class=nav-item><a class=nav-link href=/community><span>Community</span></a></li><li class=nav-item><a class=nav-link href=https://join.slack.com/t/gardener-cloud/shared_invite/zt-33c9daems-3oOorhnqOSnldZPWqGmIBw target=_blank rel=noopener><span>Join us on</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.18390d69af608831bb602349133ecb5c.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/gardener/monitoring/>Return to the regular view of this page</a>.</p></div><h1 class=title>Monitoring</h1><div class=content><h1 id=monitoring>Monitoring<a class=td-heading-self-link href=#monitoring aria-label="Heading self-link"></a></h1><h2 id=roles-of-the-different-prometheus-instances>Roles of the different Prometheus instances<a class=td-heading-self-link href=#roles-of-the-different-prometheus-instances aria-label="Heading self-link"></a></h2><p><img src=/docs/gardener/monitoring/images/monitoring.png alt=monitoring></p><h3 id=cache-prometheus>Cache Prometheus<a class=td-heading-self-link href=#cache-prometheus aria-label="Heading self-link"></a></h3><p>Deployed in the <code>garden</code> namespace. Important scrape targets:</p><ul><li>cadvisor</li><li>node-exporter</li><li>kube-state-metrics</li></ul><p><strong>Purpose</strong>: Act as a reverse proxy that supports server-side filtering, which is not supported by Prometheus exporters but by federation. Metrics in this Prometheus are kept for a short amount of time (~1 day) since other Prometheus instances are expected to federate from it and move metrics over. For example, the <a href=/docs/gardener/monitoring/#shoot-prometheus>shoot Prometheus</a> queries this Prometheus to retrieve metrics corresponding to the shoot&rsquo;s control plane. This way, we achieve isolation so that shoot owners are only able to query metrics for their shoots. Please note Prometheus does not support isolation features. Another example is if another Prometheus needs access to cadvisor metrics, which does not support server-side filtering, so it will query this Prometheus instead of the cadvisor. This strategy also reduces load on the kubelets and API Server.</p><p>Note some of these Prometheus&rsquo; metrics have high cardinality (e.g., metrics related to all shoots managed by the seed). Some of these are aggregated with recording rules. These <em>pre-aggregated</em> metrics are scraped by the <a href=/docs/gardener/monitoring/#aggregate-prometheus>aggregate Prometheus</a>.</p><p>This Prometheus is not used for alerting.</p><h3 id=aggregate-prometheus>Aggregate Prometheus<a class=td-heading-self-link href=#aggregate-prometheus aria-label="Heading self-link"></a></h3><p>Deployed in the <code>garden</code> namespace. Important scrape targets:</p><ul><li>other Prometheus instances</li><li>logging components</li></ul><p><strong>Purpose</strong>: Store pre-aggregated data from the <a href=/docs/gardener/monitoring/#cache-prometheus>cache Prometheus</a> and <a href=/docs/gardener/monitoring/#shoot-prometheus>shoot Prometheus</a>. An ingress exposes this Prometheus allowing it to be scraped from another cluster. Such pre-aggregated data is also used for alerting.</p><h3 id=seed-prometheus>Seed Prometheus<a class=td-heading-self-link href=#seed-prometheus aria-label="Heading self-link"></a></h3><p>Deployed in the <code>garden</code> namespace. Important scrape targets:</p><ul><li>pods in extension namespaces annotated with:</li></ul><pre tabindex=0><code>prometheus.io/scrape=true
prometheus.io/port=&lt;port&gt;
prometheus.io/name=&lt;name&gt;
</code></pre><ul><li>cadvisor metrics from pods in the garden and extension namespaces</li></ul><p>The job name label will be applied to all metrics from that service.</p><p><strong>Purpose</strong>: Entrypoint for operators when debugging issues with extensions or other garden components.</p><p>This Prometheus is not used for alerting.</p><h3 id=shoot-prometheus>Shoot Prometheus<a class=td-heading-self-link href=#shoot-prometheus aria-label="Heading self-link"></a></h3><p>Deployed in the shoot control plane namespace. Important scrape targets:</p><ul><li>control plane components</li><li>shoot nodes (node-exporter)</li><li>blackbox-exporter used to measure <a href=/docs/gardener/monitoring/connectivity/>connectivity</a></li></ul><p><strong>Purpose</strong>: Monitor all relevant components belonging to a shoot cluster managed by Gardener. Shoot owners can view the metrics in Plutono dashboards and receive alerts based on these metrics. For alerting internals refer to <a href=/docs/gardener/monitoring/alerting/>this</a> document.</p><h4 id=federate-from-the-shoot-prometheus-to-an-external-prometheus>Federate from the Shoot Prometheus to an External Prometheus<a class=td-heading-self-link href=#federate-from-the-shoot-prometheus-to-an-external-prometheus aria-label="Heading self-link"></a></h4><p>Shoot owners that are interested in collecting metrics for their shoot&rsquo;s control-planes can do so by federating from their shoot Prometheus instances. This allows shoot owners to selectively pull metrics from the shoot Prometheus into their own Prometheus instance. Collecting shoot&rsquo;s control-plane metrics by directly scraping control-plane resources will not work because such resources are managed by Gardener and are either not accessible to shoot owners or are behind a load balancer.</p><p>Note Gardener is working on an OpenTelemetry-based approach for observability, but there is no official timeline for its release yet.</p><h5 id=step-1-retrieve-prometheus-credentials-and-url>Step 1: Retrieve Prometheus Credentials and URL<a class=td-heading-self-link href=#step-1-retrieve-prometheus-credentials-and-url aria-label="Heading self-link"></a></h5><p>Gardener provides access to the shoot control plane Prometheus instance through a monitoring secret stored in the virtual garden cluster. The necessary credentials can be found in the dashboard or by following these steps:</p><ol><li><p>Target the shoot&rsquo;s project using <code>gardenctl</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>gardenctl target --garden &lt;garden-name&gt; --project &lt;project-name&gt;
</span></span></code></pre></div></li><li><p>Retrieve the shoot&rsquo;s monitoring secret:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get secret &lt;shoot-name&gt;.monitoring -o yaml
</span></span></code></pre></div></li><li><p>Extract the Prometheus URL from the secret’s annotations:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>metadata.annotations.prometheus-url
</span></span></code></pre></div></li><li><p>Extract the credentials from the secret’s data fields:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>echo <span style=color:#a31515>&#34;</span><span style=color:#00f>$(</span>kubectl get secret &lt;shoot-name&gt;.monitoring -o jsonpath=<span style=color:#a31515>&#39;{.data.username}&#39;</span> | base64 --decode<span style=color:#00f>)</span><span style=color:#a31515>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#a31515>&#34;</span><span style=color:#00f>$(</span>kubectl get secret &lt;shoot-name&gt;.monitoring -o jsonpath=<span style=color:#a31515>&#39;{.data.password}&#39;</span> | base64 --decode<span style=color:#00f>)</span><span style=color:#a31515>&#34;</span>
</span></span></code></pre></div></li></ol><h5 id=step-2-configure-federation-in-your-prometheus>Step 2: Configure Federation in Your Prometheus<a class=td-heading-self-link href=#step-2-configure-federation-in-your-prometheus aria-label="Heading self-link"></a></h5><p>Once the Prometheus URL, username, and password are obtained, federation can be configured in the external Prometheus instance.</p><ol><li><p>Edit the external Prometheus configuration to add a federation job:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>scrape_configs:
</span></span><span style=display:flex><span>  - job_name: <span style=color:#a31515>&#39;gardener-federation&#39;</span>
</span></span><span style=display:flex><span>    honor_labels: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>    metrics_path: <span style=color:#a31515>&#39;/federate&#39;</span>
</span></span><span style=display:flex><span>    params:
</span></span><span style=display:flex><span>      &#39;match[]&#39;:
</span></span><span style=display:flex><span>        - <span style=color:#a31515>&#39;{job=&#34;kube-apiserver&#34;}&#39;</span>
</span></span><span style=display:flex><span>    scheme: https
</span></span><span style=display:flex><span>    basic_auth:
</span></span><span style=display:flex><span>      username: <span style=color:#a31515>&#39;&lt;prometheus-username&gt;&#39;</span>
</span></span><span style=display:flex><span>      password: <span style=color:#a31515>&#39;&lt;prometheus-password&gt;&#39;</span>
</span></span><span style=display:flex><span>    static_configs:
</span></span><span style=display:flex><span>      - targets:
</span></span><span style=display:flex><span>        - <span style=color:#a31515>&#39;&lt;prometheus-url&gt;&#39;</span>
</span></span></code></pre></div><p>Replace <code>&lt;prometheus-username></code>, <code>&lt;prometheus-password></code>, and <code>&lt;prometheus-url></code> with the values obtained earlier. In this example, the federation job is configured to federate metrics scraped by the <code>kube-apiserver</code> job, but <code>match[]</code> entry should be adjusted to the specific use-case.</p></li><li><p>Restart Prometheus to apply the configuration.</p></li></ol><h2 id=collect-all-shoot-prometheus-with-remote-write>Collect all shoot Prometheus with remote write<a class=td-heading-self-link href=#collect-all-shoot-prometheus-with-remote-write aria-label="Heading self-link"></a></h2><p>An optional collection of all shoot Prometheus metrics to a central Prometheus (or cortex) instance is possible with the <code>monitoring.shoot</code> setting in <code>GardenletConfiguration</code>:</p><pre tabindex=0><code>monitoring:
  shoot:
    remoteWrite:
      url: https://remoteWriteUrl # remote write URL
      keep:# metrics that should be forwarded to the external write endpoint. If empty all metrics get forwarded
      - kube_pod_container_info
    externalLabels: # add additional labels to metrics to identify it on the central instance
      additional: label
</code></pre><p>If basic auth is needed it can be set via secret in garden namespace (Gardener API Server). <a href=https://github.com/gardener/gardener/blob/master/example/10-secret-remote-write.yaml>Example secret</a></p><h2 id=disable-gardener-monitoring>Disable Gardener Monitoring<a class=td-heading-self-link href=#disable-gardener-monitoring aria-label="Heading self-link"></a></h2><p>If you wish to disable metric collection for every shoot and roll your own then you can simply set.</p><pre tabindex=0><code>monitoring:
  shoot:
    enabled: false
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-954b7364e06db9899aa6264a5b0a9e91>1 - Alerting</h1><h1 id=alerting>Alerting<a class=td-heading-self-link href=#alerting aria-label="Heading self-link"></a></h1><p>Gardener uses <a href=https://prometheus.io/>Prometheus</a> to gather metrics from each component. A Prometheus is deployed in each shoot control plane (on the seed) which is responsible for gathering control plane and cluster metrics. Prometheus can be configured to fire alerts based on these metrics and send them to an <a href=https://prometheus.io/docs/alerting/alertmanager/>Alertmanager</a>. The Alertmanager is responsible for sending the alerts to users and operators. This document describes how to setup alerting for:</p><ul><li><a href=/docs/gardener/monitoring/alerting/#alerting-for-users>end-users/stakeholders/customers</a></li><li><a href=/docs/gardener/monitoring/alerting/#alerting-for-operators>operators/administrators</a></li></ul><h1 id=alerting-for-users>Alerting for Users<a class=td-heading-self-link href=#alerting-for-users aria-label="Heading self-link"></a></h1><p>To receive email alerts as a user, set the following values in the shoot spec:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  monitoring:
</span></span><span style=display:flex><span>    alerting:
</span></span><span style=display:flex><span>      emailReceivers:
</span></span><span style=display:flex><span>      - john.doe@example.com
</span></span></code></pre></div><p><code>emailReceivers</code> is a list of emails that will receive alerts if something is wrong with the shoot cluster.</p><h1 id=alerting-for-operators>Alerting for Operators<a class=td-heading-self-link href=#alerting-for-operators aria-label="Heading self-link"></a></h1><p>Currently, Gardener supports two options for alerting:</p><ul><li><a href=/docs/gardener/monitoring/alerting/#email-alerting>Email Alerting</a></li><li><a href=/docs/gardener/monitoring/alerting/#external-alertmanager>Sending Alerts to an External Alertmanager</a></li></ul><h2 id=email-alerting>Email Alerting<a class=td-heading-self-link href=#email-alerting aria-label="Heading self-link"></a></h2><p>Gardener provides the option to deploy an Alertmanager into each seed. This Alertmanager is responsible for sending out alerts to operators for each shoot cluster in the seed. Only email alerts are supported by the Alertmanager managed by Gardener. This is configurable by setting the Gardener controller manager configuration values <code>alerting</code>. See <a href=/docs/gardener/configuration/>Gardener Configuration and Usage</a> on how to configure the Gardener&rsquo;s SMTP secret. If the values are set, a secret with the label <code>gardener.cloud/role: alerting</code> will be created in the garden namespace of the garden cluster. This secret will be used by each Alertmanager in each seed.</p><h2 id=external-alertmanager>External Alertmanager<a class=td-heading-self-link href=#external-alertmanager aria-label="Heading self-link"></a></h2><p>The Alertmanager supports different kinds of <a href=https://prometheus.io/docs/alerting/configuration/>alerting configurations</a>. The Alertmanager provided by Gardener only supports email alerts. If email is not sufficient, then alerts can be sent to an external Alertmanager. Prometheus will send alerts to a URL and then alerts will be handled by the external Alertmanager. This external Alertmanager is operated and configured by the operator (i.e. Gardener does not configure or deploy this Alertmanager). To configure sending alerts to an external Alertmanager, create a secret in the virtual garden cluster in the garden namespace with the label: <code>gardener.cloud/role: alerting</code>. This secret needs to contain a URL to the external Alertmanager and information regarding authentication. Supported authentication types are:</p><ul><li>No Authentication (none)</li><li>Basic Authentication (basic)</li><li>Mutual TLS (certificate)</li></ul><h3 id=remote-alertmanager-examples>Remote Alertmanager Examples<a class=td-heading-self-link href=#remote-alertmanager-examples aria-label="Heading self-link"></a></h3><blockquote><p><strong>Note:</strong> The <code>url</code> value cannot be prepended with <code>http</code> or <code>https</code>.</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green># No Authentication</span>
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Secret
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    gardener.cloud/role: alerting
</span></span><span style=display:flex><span>  name: alerting-auth
</span></span><span style=display:flex><span>  namespace: garden
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  <span style=color:green># No Authentication</span>
</span></span><span style=display:flex><span>  auth_type: base64(none)
</span></span><span style=display:flex><span>  url: base64(external.alertmanager.foo)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:green># Basic Auth</span>
</span></span><span style=display:flex><span>  auth_type: base64(basic)
</span></span><span style=display:flex><span>  url: base64(external.alertmanager.foo)
</span></span><span style=display:flex><span>  username: base64(admin)
</span></span><span style=display:flex><span>  password: base64(password)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:green># Mutual TLS</span>
</span></span><span style=display:flex><span>  auth_type: base64(certificate)
</span></span><span style=display:flex><span>  url: base64(external.alertmanager.foo)
</span></span><span style=display:flex><span>  ca.crt: base64(ca)
</span></span><span style=display:flex><span>  tls.crt: base64(certificate)
</span></span><span style=display:flex><span>  tls.key: base64(key)
</span></span><span style=display:flex><span>  insecure_skip_verify: base64(false)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:green># Email Alerts (internal alertmanager)</span>
</span></span><span style=display:flex><span>  auth_type: base64(smtp)
</span></span><span style=display:flex><span>  auth_identity: base64(internal.alertmanager.auth_identity)
</span></span><span style=display:flex><span>  auth_password: base64(internal.alertmanager.auth_password)
</span></span><span style=display:flex><span>  auth_username: base64(internal.alertmanager.auth_username)
</span></span><span style=display:flex><span>  from: base64(internal.alertmanager.from)
</span></span><span style=display:flex><span>  smarthost: base64(internal.alertmanager.smarthost)
</span></span><span style=display:flex><span>  to: base64(internal.alertmanager.to)
</span></span><span style=display:flex><span>type: Opaque
</span></span></code></pre></div><h3 id=configuring-your-external-alertmanager>Configuring Your External Alertmanager<a class=td-heading-self-link href=#configuring-your-external-alertmanager aria-label="Heading self-link"></a></h3><p>Please refer to the <a href=https://prometheus.io/docs/alerting/alertmanager/>Alertmanager</a> documentation on how to configure an Alertmanager.</p><p>We recommend you use at least the following inhibition rules in your Alertmanager configuration to prevent excessive alerts:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>inhibit_rules:
</span></span><span style=display:flex><span><span style=color:green># Apply inhibition if the alert name is the same.</span>
</span></span><span style=display:flex><span>- source_match:
</span></span><span style=display:flex><span>    severity: critical
</span></span><span style=display:flex><span>  target_match:
</span></span><span style=display:flex><span>    severity: warning
</span></span><span style=display:flex><span>  equal: [<span style=color:#a31515>&#39;alertname&#39;</span>, <span style=color:#a31515>&#39;service&#39;</span>, <span style=color:#a31515>&#39;cluster&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># Stop all alerts for type=shoot if there are VPN problems.</span>
</span></span><span style=display:flex><span>- source_match:
</span></span><span style=display:flex><span>    service: vpn
</span></span><span style=display:flex><span>  target_match_re:
</span></span><span style=display:flex><span>    type: shoot
</span></span><span style=display:flex><span>  equal: [<span style=color:#a31515>&#39;type&#39;</span>, <span style=color:#a31515>&#39;cluster&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># Stop warning and critical alerts if there is a blocker</span>
</span></span><span style=display:flex><span>- source_match:
</span></span><span style=display:flex><span>    severity: blocker
</span></span><span style=display:flex><span>  target_match_re:
</span></span><span style=display:flex><span>    severity: ^(critical|warning)$
</span></span><span style=display:flex><span>  equal: [<span style=color:#a31515>&#39;cluster&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># If the API server is down inhibit no worker nodes alert. No worker nodes depends on kube-state-metrics which depends on the API server.</span>
</span></span><span style=display:flex><span>- source_match:
</span></span><span style=display:flex><span>    service: kube-apiserver
</span></span><span style=display:flex><span>  target_match_re:
</span></span><span style=display:flex><span>    service: nodes
</span></span><span style=display:flex><span>  equal: [<span style=color:#a31515>&#39;cluster&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># If API server is down inhibit kube-state-metrics alerts.</span>
</span></span><span style=display:flex><span>- source_match:
</span></span><span style=display:flex><span>    service: kube-apiserver
</span></span><span style=display:flex><span>  target_match_re:
</span></span><span style=display:flex><span>    severity: info
</span></span><span style=display:flex><span>  equal: [<span style=color:#a31515>&#39;cluster&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># No Worker nodes depends on kube-state-metrics. Inhibit no worker nodes if kube-state-metrics is down.</span>
</span></span><span style=display:flex><span>- source_match:
</span></span><span style=display:flex><span>    service: kube-state-metrics-shoot
</span></span><span style=display:flex><span>  target_match_re:
</span></span><span style=display:flex><span>    service: nodes
</span></span><span style=display:flex><span>  equal: [<span style=color:#a31515>&#39;cluster&#39;</span>]
</span></span></code></pre></div><p>Below is a graph visualizing the inhibition rules:</p><p><img src=/docs/gardener/content/alertinhibitiongraph.png alt=inhibitionGraph></p></div><div class=td-content style=page-break-before:always><h1 id=pg-7c33abee93181fcc22c3692c1a9c8f2a>2 - Connectivity</h1><h1 id=connectivity>Connectivity<a class=td-heading-self-link href=#connectivity aria-label="Heading self-link"></a></h1><h2 id=shoot-connectivity>Shoot Connectivity<a class=td-heading-self-link href=#shoot-connectivity aria-label="Heading self-link"></a></h2><p>We measure the connectivity from the shoot to the API Server. This is done via the <code>blackbox exporter</code> which is deployed in the shoot&rsquo;s <code>kube-system</code> namespace. Prometheus will scrape the <code>blackbox exporter</code> and then the exporter will try to access the API Server. Metrics are exposed if the connection was successful or not. This can be seen in the <code>Kubernetes Control Plane Status</code> dashboard under the <code>API Server Connectivity</code> panel. The <code>shoot</code> line represents the connectivity from the shoot.</p><p><img src=/docs/gardener/monitoring/images/panel.png alt=image></p><h2 id=seed-connectivity>Seed Connectivity<a class=td-heading-self-link href=#seed-connectivity aria-label="Heading self-link"></a></h2><p>In addition to the shoot connectivity, we also measure the seed connectivity. This means trying to reach the API Server from the seed via the external fully qualified domain name of the API server. The connectivity is also displayed in the above panel as the <code>seed</code> line. Both <code>seed</code> and <code>shoot</code> connectivity are shown below.</p><p><img src=/docs/gardener/monitoring/images/connectivity.png alt=image></p></div><div class=td-content style=page-break-before:always><h1 id=pg-4bd3553c7141772a5c5be0814ce3145b>3 - Profiling</h1><h1 id=profiling-gardener-components>Profiling Gardener Components<a class=td-heading-self-link href=#profiling-gardener-components aria-label="Heading self-link"></a></h1><p>Similar to Kubernetes, Gardener components support profiling using <a href=https://golang.org/doc/diagnostics#profiling>standard Go tools</a> for analyzing CPU and memory usage by different code sections and more.
This document shows how to enable and use profiling handlers with Gardener components.</p><p>Enabling profiling handlers and the ports on which they are exposed differs between components.
However, once the handlers are enabled, they provide profiles via the same HTTP endpoint paths, from which you can retrieve them via <code>curl</code>/<code>wget</code> or directly using <code>go tool pprof</code>.
(You might need to use <code>kubectl port-forward</code> in order to access HTTP endpoints of Gardener components running in clusters.)</p><p>For example (gardener-controller-manager):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl http://localhost:2718/debug/pprof/heap &gt; /tmp/heap-controller-manager
</span></span><span style=display:flex><span>$ go tool pprof /tmp/heap-controller-manager
</span></span><span style=display:flex><span>Type: inuse_space
</span></span><span style=display:flex><span>Time: Sep 3, 2021 at 10:05am (CEST)
</span></span><span style=display:flex><span>Entering interactive mode (type <span style=color:#a31515>&#34;help&#34;</span> <span style=color:#00f>for</span> commands, <span style=color:#a31515>&#34;o&#34;</span> <span style=color:#00f>for</span> options)
</span></span><span style=display:flex><span>(pprof)
</span></span></code></pre></div><p>or</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ go tool pprof http://localhost:2718/debug/pprof/heap
</span></span><span style=display:flex><span>Fetching profile over HTTP from http://localhost:2718/debug/pprof/heap
</span></span><span style=display:flex><span>Saved profile in /Users/timebertt/pprof/pprof.alloc_objects.alloc_space.inuse_objects.inuse_space.008.pb.gz
</span></span><span style=display:flex><span>Type: inuse_space
</span></span><span style=display:flex><span>Time: Sep 3, 2021 at 10:05am (CEST)
</span></span><span style=display:flex><span>Entering interactive mode (type <span style=color:#a31515>&#34;help&#34;</span> <span style=color:#00f>for</span> commands, <span style=color:#a31515>&#34;o&#34;</span> <span style=color:#00f>for</span> options)
</span></span><span style=display:flex><span>(pprof)
</span></span></code></pre></div><h2 id=gardener-apiserver>gardener-apiserver<a class=td-heading-self-link href=#gardener-apiserver aria-label="Heading self-link"></a></h2><p><code>gardener-apiserver</code> provides the same flags as <code>kube-apiserver</code> for enabling profiling handlers (enabled by default):</p><pre tabindex=0><code>--contention-profiling    Enable lock contention profiling, if profiling is enabled
--profiling               Enable profiling via web interface host:port/debug/pprof/ (default true)
</code></pre><p>The handlers are served on the same port as the API endpoints (configured via <code>--secure-port</code>).
This means that you will also have to authenticate against the API server according to the configured authentication and authorization policy.</p><h2 id=gardener-admission-controllercontroller-managerschedulerresource-manager-gardenlet>gardener-{admission-controller,controller-manager,scheduler,resource-manager}, gardenlet<a class=td-heading-self-link href=#gardener-admission-controllercontroller-managerschedulerresource-manager-gardenlet aria-label="Heading self-link"></a></h2><p><code>gardener-controller-manager</code>, <code>gardener-admission-controller</code>, <code>gardener-scheduler</code>, <code>gardener-resource-manager</code> and <code>gardenlet</code> also allow enabling profiling handlers via their respective component configs (currently disabled by default).
Here is an example for the <code>gardener-admission-controller</code>&rsquo;s configuration and how to enable it (it looks similar for the other components):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: admissioncontroller.config.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>kind: AdmissionControllerConfiguration
</span></span><span style=display:flex><span><span style=color:green># ...</span>
</span></span><span style=display:flex><span>server:
</span></span><span style=display:flex><span>  metrics:
</span></span><span style=display:flex><span>    port: 2723
</span></span><span style=display:flex><span>debugging:
</span></span><span style=display:flex><span>  enableProfiling: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>  enableContentionProfiling: <span style=color:#00f>true</span>
</span></span></code></pre></div><p>However, the handlers are served on the same port as configured in <code>server.metrics.port</code> via HTTP.</p><p>For example (gardener-admission-controller):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl http://localhost:2723/debug/pprof/heap &gt; /tmp/heap
</span></span><span style=display:flex><span>$ go tool pprof /tmp/heap
</span></span></code></pre></div></div></main></div></div><footer class="footer row d-print-none"><div class="container-fluid footer-wrapper"><ul class=nav><li><a href=https://demo.gardener.cloud>Demo</a></li><li><a href=https://gardener.cloud/adopter/>Adopters</a></li><li><a href=/docs/>Documentation</a></li><li><a href=https://gardener.cloud/blog/>Blogs</a></li><li><a href=https://gardener.cloud/community/>Community</a></li></ul><img src=/images/lp/gardener-logo.svg alt="Logo Gardener" class=logo><ul class=media-wr><li><a target=_blank href=https://gardener-cloud.slack.com/><img src=/images/branding/slack-logo-white.svg class=media-icon><div class=media-text>Slack</div></a></li><li><a target=_blank href=https://github.com/gardener><img src=/images/branding/github-mark-logo.png class=media-icon><div class=media-text>GitHub</div></a></li><li><a target=_blank href=https://www.youtube.com/channel/UCwUhwKFREV8Su0gwAJQX7tw><img src=/images/branding/youtube-logo-dark.svg class=media-icon><div class=media-text>YouTube</div></a></li><li><a target=_blank href=https://x.com/GardenerProject><img src=/images/branding/x-logo-white.svg class=media-icon><div class=media-text>X</div></a></li></ul><span class=copyright>Copyright 2019-2025 Gardener project authors.
<a href=https://www.sap.com/about/legal/terms-of-use.html>Terms of Use
<i class="fa fa-external-link" aria-hidden=true></i>
</a>|
<a href=https://www.sap.com/about/legal/terms-of-use.html>Privacy Statement
<i class="fa fa-external-link" aria-hidden=true></i>
</a>|
<a href=https://www.sap.com/about/legal/terms-of-use.html>Legal Disclosure
<i class="fa fa-external-link" aria-hidden=true></i></a></span></div></footer></div><script src=/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script><script src=/js/navbar.js></script><script src=/js/filtering.js></script><script src=/js/page-content.js></script></body></html>