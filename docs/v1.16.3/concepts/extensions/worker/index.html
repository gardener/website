<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta name=copyright content="Copyright 2019-2021 Gardener project authors."><meta name=google-site-verification content="9EoGiMwk2aq0E_tVh16iJgJbp7fbyqkfWH9b5sGybl0"><title>Worker resource :: Gardener</title><link rel=icon type=image/x-icon href=https://gardener.cloud/images/favicon.ico><link rel=icon type=image/png href=https://gardener.cloud/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://gardener.cloud/images/favicon-16x16.png sizes=16x16><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-W2FGNSX');</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-165447164-1');</script><link href=/css/font-awesome.min.css?1618334501 rel=stylesheet><link href=/css/skeleton.css?1618334501 rel=stylesheet><link rel=preload href=/fonts/sap-icofonts/sap-icofonts.woff as=font type=font/woff crossorigin=anonymous><link rel=preload href=/fonts/sapcom-icons/sapcom-icons.woff as=font type=font/woff crossorigin=anonymous><link rel=stylesheet href=/css/sapcom-icons.css><link rel=stylesheet href=/css/normalize.css><link rel=stylesheet href=/css/gardener.b459b7f22c26be8e2f608a181d5372c6e44f06cf007c350346ccf5fadbe04a74.css><script src=/js/moment.js?1618334501></script><script src=/js/inlineSVG.js?1618334501></script><script src=/js/jquery.min.js?1618334501></script><script src=/jquery-ui-1.12.1/jquery-ui.min.js?1618334501></script><script src=/js/fixed.js?1618334501></script><script src=/js/clipboard.min.js?1618334501></script><script src=https://platform.linkedin.com/in.js type=text/javascript>lang:en_US</script></head><body data-url=/v1.16.3/concepts/extensions/worker/ class=has-sticky-navigation><script>$(document).ready(function(){function initStickyNav(){var stickyPoint;var tln=document.querySelector(".tln");if(!tln){return;}
var stickyPointEl=document.querySelector(".sticky-nav-point");if(stickyPointEl==null){stickyPointEl=document.querySelector("body");stickyPoint=0;}else{stickyPoint=stickyPointEl.clientHeight+stickyPointEl.offsetTop;}
var bodySelector=document.getElementsByTagName("body")[0];var tlnHeight=tln.clientHeight;var stickyNavigation=function(){if(window.pageYOffset+tlnHeight>=stickyPoint){bodySelector.classList.add("has-sticky-navigation");tln.classList.add("sticky-top");}else{bodySelector.classList.remove("has-sticky-navigation");tln.classList.remove("sticky-top");}}
window.onscroll=function(){stickyNavigation();};}
initStickyNav();function closeAllSelect(){document.getElementById("docOptions").classList.remove("show");}
function show(e){e.stopPropagation();document.getElementById("docOptions").classList.add("show");}
document.addEventListener("click",closeAllSelect);document.getElementById("docSelector").addEventListener("click",show);});</script><div class="tln fixedsticky sticky-top"><header class=navigation><div class=container><div class=navigation-wrapper><a href=/ class=logo><img src=/images/gardener-logo.svg>
<span class=title>Gardener</span></a>
<a class="nav-button navbar-toggler" href=#><i class="fa fa-bars"></i></a><div class=navbar-collapse><ul class=links><li class=link><a href=/blog/>Blogs</a></li><li class=link><a href=/community/>Community</a></li><li class=link><a href=/adopter/>Adopters</a></li><li class="link has-child active"><a id=docSelector>Documentation v1.16.3</a><div id=docOptions class=doc-options><ul><li><a href=/documentation/home>Documentation
v1.17.1</a></li><li><a href=/v1.16.3/home class=activeVersion>Documentation
v1.16.3</a></li><li><a href=/v1.15.5/home>Documentation
v1.15.5</a></li></ul></div></li></ul></div></div></div></header></div><script>$(".navigation .navbar-toggler").click(function(evt){$(".navigation .navbar-collapse").toggle();$(".navigation").toggleClass("collapsed");$(".navigation .search-box").toggle();})</script><style>#docSelector{cursor:pointer}.doc-options{position:fixed;background-color:#0b8062;text-align:left;display:none}.doc-options ul li{margin-bottom:0}.doc-options ul li a:hover{background-color:#0c694f}.doc-options ul{list-style:none;padding:0;margin:0;text-align:left}.doc-options ul li a{padding:10px;margin:0}.doc-options .activeVersion{background-color:#ec682a}.show{display:block}</style><div class=sln><div class=overlay-band><ul class="nav-list container"><li title=Home><a class=navbar-link href=/v1.16.3/home/>Home</a></li><li title=Concepts><a class="navbar-link is-active" href=/v1.16.3/concepts/>Concepts</a></li><li title="How-To Guides"><a class=navbar-link href=/v1.16.3/guides/>How-To Guides</a></li><li title=Tutorials><a class=navbar-link href=/v1.16.3/tutorials/>Tutorials</a></li><li title="API Reference"><a class=navbar-link href=/v1.16.3/references/>API Reference</a></li><li title=Contribute><a class=navbar-link href=/v1.16.3/contribute/>Contribute</a></li></ul></div></div><div class="main container"><nav id=sidebar class="collapsed container menu"><div class=highlightable><ul class=topics><li data-nav-id=/v1.16.3/concepts/ title=Concepts class="dd-item parent root collapsible" data-depth=0><a href=/v1.16.3/concepts/><span class=menu-item-text>Concepts</span></a><ul><li data-nav-id=/v1.16.3/concepts/architecture/ title=Architecture class="dd-item top-level collapsible collapsed" data-depth=1><a href=/v1.16.3/concepts/architecture/><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Architecture</span></a><ul><li data-nav-id=/components/bouquet/ title=Bouquet class=dd-item data-depth=2><a href=/components/bouquet/><span class=toggle></span><span class=menu-item-text></span>Bouquet</span></a></a></li><li data-nav-id=/components/dashboard/ title=Dashboard class=dd-item data-depth=2><a href=/components/dashboard/><span class=toggle></span><span class=menu-item-text></span>Dashboard</span></a></a></li><li data-nav-id=/components/gardenctl/ title=gardenctl class=dd-item data-depth=2><a href=/components/gardenctl/><span class=toggle></span><span class=menu-item-text></span>gardenctl</span></a></a></li><li data-nav-id=/components/gardener/ title=Gardener class=dd-item data-depth=2><a href=/components/gardener/><span class=toggle></span><span class=menu-item-text></span>Gardener</span></a></a></li><li data-nav-id=/components/kubify/ title=kubify class=dd-item data-depth=2><a href=/components/kubify/><span class=toggle></span><span class=menu-item-text></span>kubify</span></a></a></li></ul></li><li data-nav-id=/v1.16.3/concepts/core-components/ title="Core Components" class="dd-item top-level collapsible collapsed" data-depth=1><a href=/documentation/concepts/core-components/api-server><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Core Components</span></a><ul><li data-nav-id=/v1.16.3/concepts/core-components/api-server/ title="Gardener API Server" class="dd-item collapsible collapsed" data-depth=2><a href=/v1.16.3/concepts/core-components/api-server/><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Gardener API Server</span></a><ul><li data-nav-id=/v1.16.3/concepts/core-components/api-server/apiserver_admission_plugins/ title="In-Tree Admission Plugins" class=dd-item data-depth=3><a href=/v1.16.3/concepts/core-components/api-server/apiserver_admission_plugins/><span class=toggle></span><span class=menu-item-text></span>In-Tree Admission Plugins</span></a></a></li></ul></li><li data-nav-id=/v1.16.3/concepts/core-components/scheduler/ title="Gardener Scheduler" class=dd-item data-depth=2><a href=/v1.16.3/concepts/core-components/scheduler/><span class=toggle></span><span class=menu-item-text></span>Gardener Scheduler</span></a></a></li><li data-nav-id=/v1.16.3/concepts/core-components/seed-admission-controller/ title="Gardener Seed Admission Controller" class=dd-item data-depth=2><a href=/v1.16.3/concepts/core-components/seed-admission-controller/><span class=toggle></span><span class=menu-item-text></span>Gardener Seed Admission Controller</span></a></a></li><li data-nav-id=/v1.16.3/concepts/core-components/gardenlet/ title=gardenlet class=dd-item data-depth=2><a href=/v1.16.3/concepts/core-components/gardenlet/><span class=toggle></span><span class=menu-item-text></span>gardenlet</span></a></a></li></ul></li><li data-nav-id=/v1.16.3/concepts/backup-restore/backup-restore/ title="Backup and Restore" class="dd-item top-level" data-depth=1><a href=/v1.16.3/concepts/backup-restore/backup-restore/><span class=toggle></span><span class=menu-item-text></span>Backup and Restore</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/ title=Extensions class="dd-item parent top-level collapsible" data-depth=1><a href=/v1.16.3/concepts/extensions/><span class="toggle fa fa-angle-down"></span><span class=menu-item-text>Extensions</span></a><ul><li data-nav-id=/v1.16.3/concepts/extensions/backupbucket/ title="BackupBucket resource" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/backupbucket/><span class=toggle></span><span class=menu-item-text></span>BackupBucket resource</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/backupentry/ title="BackupEntry resource" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/backupentry/><span class=toggle></span><span class=menu-item-text></span>BackupEntry resource</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/cluster/ title="Cluster resource" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/cluster/><span class=toggle></span><span class=menu-item-text></span>Cluster resource</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/shoot-health-status-conditions/ title="Contributing to shoot health status conditions" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/shoot-health-status-conditions/><span class=toggle></span><span class=menu-item-text></span>Contributing to shoot health status conditions</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/controlplane-webhooks/ title="Controlplane customization webhooks" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/controlplane-webhooks/><span class=toggle></span><span class=menu-item-text></span>Controlplane customization webhooks</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/controlplane/ title="ControlPlane resource" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/controlplane/><span class=toggle></span><span class=menu-item-text></span>ControlPlane resource</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/controlplane-exposure/ title="ControlPlane resource with purpose exposure" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/controlplane-exposure/><span class=toggle></span><span class=menu-item-text></span>ControlPlane resource with purpose exposure</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/dns/ title="DNSProvider and DNSEntry resources" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/dns/><span class=toggle></span><span class=menu-item-text></span>DNSProvider and DNSEntry resources</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/project-roles/ title="Extending project roles" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/project-roles/><span class=toggle></span><span class=menu-item-text></span>Extending project roles</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/overview/ title="Extensibility overview" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/overview/><span class=toggle></span><span class=menu-item-text></span>Extensibility overview</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/extension/ title="Extension resource" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/extension/><span class=toggle></span><span class=menu-item-text></span>Extension resource</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/containerruntime/ title="Gardener Container Runtime Extension" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/containerruntime/><span class=toggle></span><span class=menu-item-text></span>Gardener Container Runtime Extension</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/network/ title="Gardener Network Extension" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/network/><span class=toggle></span><span class=menu-item-text></span>Gardener Network Extension</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/conventions/ title="General conventions" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/conventions/><span class=toggle></span><span class=menu-item-text></span>General conventions</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/healthcheck-library/ title="Health Check Library" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/healthcheck-library/><span class=toggle></span><span class=menu-item-text></span>Health Check Library</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/infrastructure/ title="Infrastructure resource" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/infrastructure/><span class=toggle></span><span class=menu-item-text></span>Infrastructure resource</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/logging-and-monitoring/ title="Logging and Monitoring for Extensions" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/logging-and-monitoring/><span class=toggle></span><span class=menu-item-text></span>Logging and Monitoring for Extensions</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/operatingsystemconfig/ title="OperatingSystemConfig resource" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/operatingsystemconfig/><span class=toggle></span><span class=menu-item-text></span>OperatingSystemConfig resource</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/referenced-resources/ title="Referenced Resources" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/referenced-resources/><span class=toggle></span><span class=menu-item-text></span>Referenced Resources</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/controllerregistration/ title="Registering Extension Controllers" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/controllerregistration/><span class=toggle></span><span class=menu-item-text></span>Registering Extension Controllers</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/shoot-maintenance/ title="Shoot maintenance" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/shoot-maintenance/><span class=toggle></span><span class=menu-item-text></span>Shoot maintenance</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/shoot-webhooks/ title="Shoot resource customization webhooks" class=dd-item data-depth=2><a href=/v1.16.3/concepts/extensions/shoot-webhooks/><span class=toggle></span><span class=menu-item-text></span>Shoot resource customization webhooks</span></a></a></li><li data-nav-id=/v1.16.3/concepts/extensions/worker/ title="Worker resource" class="dd-item active" data-depth=2><a href=/v1.16.3/concepts/extensions/worker/><span class=toggle></span><span class=menu-item-text></span>Worker resource</span></a></a></li></ul></li><li data-nav-id=/v1.16.3/concepts/networking/ title=Networking class="dd-item top-level collapsible collapsed" data-depth=1><a href=/v1.16.3/concepts/networking/><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Networking</span></a><ul><li data-nav-id=/v1.16.3/concepts/networking/dns-managment/ title="DNS Management" class=dd-item data-depth=2><a href=/v1.16.3/concepts/networking/dns-managment/><span class=toggle></span><span class=menu-item-text></span>DNS Management</span></a></a></li><li data-nav-id=/v1.16.3/concepts/networking/cert-managment/ title="Certificates Management" class=dd-item data-depth=2><a href=/v1.16.3/concepts/networking/cert-managment/><span class=toggle></span><span class=menu-item-text></span>Certificates Management</span></a></a></li><li data-nav-id=/v1.16.3/concepts/networking/network_policies/ title="Network Policies" class=dd-item data-depth=2><a href=/v1.16.3/concepts/networking/network_policies/><span class=toggle></span><span class=menu-item-text></span>Network Policies</span></a></a></li></ul></li><li data-nav-id=/v1.16.3/concepts/monitoring/ title=Monitoring class="dd-item top-level collapsible collapsed" data-depth=1><a href=/v1.16.3/concepts/monitoring/><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Monitoring</span></a><ul><li data-nav-id=/v1.16.3/concepts/monitoring/alerting/ title=Alerting class=dd-item data-depth=2><a href=/v1.16.3/concepts/monitoring/alerting/><span class=toggle></span><span class=menu-item-text></span>Alerting</span></a></a></li><li data-nav-id=/v1.16.3/concepts/monitoring/extending/ title="Extending the Monitoring Stack" class=dd-item data-depth=2><a href=/v1.16.3/concepts/monitoring/extending/><span class=toggle></span><span class=menu-item-text></span>Extending the Monitoring Stack</span></a></a></li><li data-nav-id=/v1.16.3/concepts/monitoring/operator_alerts/ title="Operator Alerts" class=dd-item data-depth=2><a href=/v1.16.3/concepts/monitoring/operator_alerts/><span class=toggle></span><span class=menu-item-text></span>Operator Alerts</span></a></a></li><li data-nav-id=/v1.16.3/concepts/monitoring/user_alerts/ title="User Alerts" class=dd-item data-depth=2><a href=/v1.16.3/concepts/monitoring/user_alerts/><span class=toggle></span><span class=menu-item-text></span>User Alerts</span></a></a></li></ul></li><li data-nav-id=/v1.16.3/concepts/deployment/deploy_gardenlet_automatically/ title="Automatic Deployment of Gardenlets" class="dd-item top-level" data-depth=1><a href=/v1.16.3/concepts/deployment/deploy_gardenlet_automatically/><span class=toggle></span><span class=menu-item-text></span>Automatic Deployment of Gardenlets</span></a></a></li><li data-nav-id=/v1.16.3/concepts/deployment/deploy_gardenlet_manually/ title="Deploy a Gardenlet Manually" class="dd-item top-level" data-depth=1><a href=/v1.16.3/concepts/deployment/deploy_gardenlet_manually/><span class=toggle></span><span class=menu-item-text></span>Deploy a Gardenlet Manually</span></a></a></li><li data-nav-id=/v1.16.3/concepts/deployment/deploy_gardenlet/ title="Deploying Gardenlets" class="dd-item top-level" data-depth=1><a href=/v1.16.3/concepts/deployment/deploy_gardenlet/><span class=toggle></span><span class=menu-item-text></span>Deploying Gardenlets</span></a></a></li><li data-nav-id=/v1.16.3/concepts/deployment/setup_gardener/ title="Deploying the Gardener into a Kubernetes cluster" class="dd-item top-level" data-depth=1><a href=/v1.16.3/concepts/deployment/setup_gardener/><span class=toggle></span><span class=menu-item-text></span>Deploying the Gardener into a Kubernetes cluster</span></a></a></li><li data-nav-id=/v1.16.3/concepts/deployment/aks/ title="Deploying the previous Gardener versions and a Seed into an AKS cluster" class="dd-item top-level" data-depth=1><a href=/v1.16.3/concepts/deployment/aks/><span class=toggle></span><span class=menu-item-text></span>Deploying the previous Gardener versions and a Seed into an AKS cluster</span></a></a></li><li data-nav-id=/v1.16.3/concepts/deployment/feature_gates/ title="Feature Gates" class="dd-item top-level" data-depth=1><a href=/v1.16.3/concepts/deployment/feature_gates/><span class=toggle></span><span class=menu-item-text></span>Feature Gates</span></a></a></li><li data-nav-id=/v1.16.3/concepts/deployment/image_vector/ title="Image Vector" class="dd-item top-level" data-depth=1><a href=/v1.16.3/concepts/deployment/image_vector/><span class=toggle></span><span class=menu-item-text></span>Image Vector</span></a></a></li><li data-nav-id=/v1.16.3/concepts/mcm/ title="Machine Controller Manager" class="dd-item top-level" data-depth=1><a href=/v1.16.3/concepts/mcm/><span class=toggle></span><span class=menu-item-text></span>Machine Controller Manager</span></a></a></li></ul></li></ul></div></nav><a href=# class=menu-toggler><i class="fa fa-angle-double-left"></i></a><script>$(document).ready(function(){$("#sidebar .dd-item:not(.top-level):not(.parent)").hide();$("#sidebar .dd-item.parent").siblings(".dd-item").show();$('.dd-item',"#sidebar .dd-item.parent").show();$(".menu-toggler").click(function(evt){$("#sidebar").toggleClass("collapsed");$(".menu-toggler span").toggleClass("fa-angle-double-left");$(".menu-toggler span").toggleClass("fa-angle-double-right");});})</script><section><div class="highlightable body-inner-wrapper"><div id=body-inner class=external><div class="docs page"><div class=git-wr><div class=page-contributors>Contributors to this page<div class=contributors-list><a href=mailto:rafael.franzke@sap.com><img class=user-icon src="https://avatars.githubusercontent.com/u/19169361?v=4" title="Rafael Franzke"></a>
<a href=mailto:i.alidjikov@gmail.com><img class=user-icon src="https://avatars.githubusercontent.com/u/9372594?v=4" title=ialidzhikov></a>
<a href=mailto:hardik.dodiya@sap.com><img class=user-icon src="https://avatars.githubusercontent.com/u/12736827?v=4" title="Hardik Dodiya"></a></div></div><div class=origin-tools><div class=page-edit><div id=top-github-link><a class=github-link title="Edit page" href=https://github.com/gardener/gardener/blob/master/docs/extensions/worker.md target=blank><i class="fa fa-edit"></i><span id=top-github-link-text title="Edit page"></span></a></div></div></div></div><h1 id=contract-worker-resource>Contract: <code>Worker</code> resource</h1><p>While the control plane of a shoot cluster is living in the seed and deployed as native Kubernetes workload, the worker nodes of the shoot clusters are normal virtual machines (VMs) in the end-users infrastructure account.
The Gardener project features a sub-project called <a href=https://github.com/gardener/machine-controller-manager>machine-controller-manager</a>.
This controller is extending the Kubernetes API using custom resource definitions to represent actual VMs as <code>Machine</code> objects inside a Kubernetes system.
This approach unlocks the possibility to manage virtual machines in the Kubernetes style and benefit from all its design principles.</p><h2 id=what-is-the-machine-controller-manager-exactly-doing>What is the machine-controller-manager exactly doing?</h2><p>Generally, there are provider-specific <code>MachineClass</code> objects (<code>AWSMachineClass</code>, <code>AzureMachineClass</code>, etc.; similar to <code>StorageClass</code>), and <code>MachineDeployment</code>, <code>MachineSet</code>, and <code>Machine</code> objects (similar to <code>Deployment</code>, <code>ReplicaSet</code>, and <code>Pod</code>).
A machine class describes <strong>where</strong> and <strong>how</strong> to create virtual machines (in which networks, region, availability zone, SSH key, user-data for bootstrapping, etc.) while a <code>Machine</code> results in an actual virtual machine.
You can read up <a href=https://github.com/gardener/machine-controller-manager>more information</a> in the machine-controller-manager&rsquo;s <a href=https://github.com/gardener/machine-controller-manager>repository</a>.</p><p>Before the introduction of the <code>Worker</code> extension resource Gardener was deploying the machine-controller-manager, the machine classes, and the machine deployments itself.
Now, Gardener commissions an external, provider-specific controller to take over these tasks.</p><h2 id=what-needs-to-be-implemented-to-support-a-new-worker-provider>What needs to be implemented to support a new worker provider?</h2><p>As part of the shoot flow Gardener will create a special CRD in the seed cluster that needs to be reconciled by an extension controller, for example:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>extensions.gardener.cloud/v1alpha1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Worker</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>bar</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>azure</span><span class=w>
</span><span class=w>  </span><span class=nt>region</span><span class=p>:</span><span class=w> </span><span class=l>eu-west-1</span><span class=w>
</span><span class=w>  </span><span class=nt>secretRef</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cloudprovider</span><span class=w>
</span><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar</span><span class=w>
</span><span class=w>  </span><span class=nt>infrastructureProviderStatus</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>aws.provider.extensions.gardener.cloud/v1alpha1</span><span class=w>
</span><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>InfrastructureStatus</span><span class=w>
</span><span class=w>    </span><span class=nt>ec2</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>keyName</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-ssh-publickey</span><span class=w>
</span><span class=w>    </span><span class=nt>iam</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>instanceProfiles</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-nodes</span><span class=w>
</span><span class=w>        </span><span class=nt>purpose</span><span class=p>:</span><span class=w> </span><span class=l>nodes</span><span class=w>
</span><span class=w>      </span><span class=nt>roles</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=nt>arn</span><span class=p>:</span><span class=w> </span><span class=l>arn:aws:iam::0123456789:role/shoot--foo--bar-nodes</span><span class=w>
</span><span class=w>        </span><span class=nt>purpose</span><span class=p>:</span><span class=w> </span><span class=l>nodes</span><span class=w>
</span><span class=w>    </span><span class=nt>vpc</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>vpc-0123456789</span><span class=w>
</span><span class=w>      </span><span class=nt>securityGroups</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>sg-1234567890</span><span class=w>
</span><span class=w>        </span><span class=nt>purpose</span><span class=p>:</span><span class=w> </span><span class=l>nodes</span><span class=w>
</span><span class=w>      </span><span class=nt>subnets</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>subnet-01234</span><span class=w>
</span><span class=w>        </span><span class=nt>purpose</span><span class=p>:</span><span class=w> </span><span class=l>nodes</span><span class=w>
</span><span class=w>        </span><span class=nt>zone</span><span class=p>:</span><span class=w> </span><span class=l>eu-west-1b</span><span class=w>
</span><span class=w>      </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>subnet-56789</span><span class=w>
</span><span class=w>        </span><span class=nt>purpose</span><span class=p>:</span><span class=w> </span><span class=l>public</span><span class=w>
</span><span class=w>        </span><span class=nt>zone</span><span class=p>:</span><span class=w> </span><span class=l>eu-west-1b</span><span class=w>
</span><span class=w>      </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>subnet-0123a</span><span class=w>
</span><span class=w>        </span><span class=nt>purpose</span><span class=p>:</span><span class=w> </span><span class=l>nodes</span><span class=w>
</span><span class=w>        </span><span class=nt>zone</span><span class=p>:</span><span class=w> </span><span class=l>eu-west-1c</span><span class=w>
</span><span class=w>      </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>subnet-5678a</span><span class=w>
</span><span class=w>        </span><span class=nt>purpose</span><span class=p>:</span><span class=w> </span><span class=l>public</span><span class=w>
</span><span class=w>        </span><span class=nt>zone</span><span class=p>:</span><span class=w> </span><span class=l>eu-west-1c</span><span class=w>
</span><span class=w>  </span><span class=nt>pools</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cpu-worker</span><span class=w>
</span><span class=w>    </span><span class=nt>minimum</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span><span class=w>    </span><span class=nt>maximum</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span><span class=w>    </span><span class=nt>maxSurge</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span><span class=w>    </span><span class=nt>maxUnavailable</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span><span class=w>    </span><span class=nt>machineType</span><span class=p>:</span><span class=w> </span><span class=l>m4.large</span><span class=w>
</span><span class=w>    </span><span class=nt>machineImage</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>coreos</span><span class=w>
</span><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1967.5.0</span><span class=w>
</span><span class=w>    </span><span class=nt>userData</span><span class=p>:</span><span class=w> </span><span class=l>c29tZSBkYXRhIHRvIGJvb3RzdHJhcCB0aGUgVk0K</span><span class=w>
</span><span class=w>    </span><span class=nt>volume</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>size</span><span class=p>:</span><span class=w> </span><span class=l>20Gi</span><span class=w>
</span><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>gp2</span><span class=w>
</span><span class=w>    </span><span class=nt>zones</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=l>eu-west-1b</span><span class=w>
</span><span class=w>    </span>- <span class=l>eu-west-1c</span><span class=w>
</span><span class=w>    </span><span class=nt>machineControllerManager</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>drainTimeout</span><span class=p>:</span><span class=w> </span><span class=l>10m</span><span class=w>
</span><span class=w>      </span><span class=nt>healthTimeout</span><span class=p>:</span><span class=w> </span><span class=l>10m</span><span class=w>
</span><span class=w>      </span><span class=nt>creationTimeout</span><span class=p>:</span><span class=w> </span><span class=l>10m</span><span class=w>
</span><span class=w>      </span><span class=nt>maxEvictRetries</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span><span class=w>      </span><span class=nt>nodeConditions</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=l>ReadonlyFilesystem</span><span class=w>
</span><span class=w>      </span>- <span class=l>DiskPressure</span><span class=w>
</span><span class=w>      </span>- <span class=l>KernelDeadlock</span><span class=w>
</span></code></pre></div><p>The <code>.spec.secretRef</code> contains a reference to the provider secret pointing to the account that shall be used to create the needed virtual machines.
Also, as you can see, Gardener copies the output of the infrastructure creation (<code>.spec.infrastructureProviderStatus</code>), see <a href=/v1.16.3/concepts/extensions/infrastructure><code>Infrastructure</code> resource</a>, into the <code>.spec</code>.</p><p>In the <code>.spec.pools[]</code> field the desired worker pools are listed.
In the above example, one pool with machine type <code>m4.large</code> and <code>min=3</code>, <code>max=5</code> machines shall be spread over two availability zones (<code>eu-west-1b</code>, <code>eu-west-1c</code>).
This information together with the infrastructure status must be used to determine the proper configuration for the machine classes.</p><p>The <code>spec.pools[].machineControllerManager</code> field allows to configure the settings for machine-controller-manager component. Providers must populate these settings on worker-pool to the related <a href=https://github.com/gardener/machine-controller-manager/blob/master/kubernetes/machine_objects/machine-deployment.yaml#L30-L34>fields</a> in MachineDeployment.</p><p>When seeing such a resource your controller must make sure that it deploys the machine-controller-manager next to the control plane in the seed cluster.
After that, it must compute the desired machine classes and the desired machine deployments.
Typically, one class maps to one deployment, and one class/deployment is created per availability zone.
Following this convention, the created resource would look like this:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Secret</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z1-3db65</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar</span><span class=w>
</span><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>gardener.cloud/purpose</span><span class=p>:</span><span class=w> </span><span class=l>machineclass</span><span class=w>
</span><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Opaque</span><span class=w>
</span><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>providerAccessKeyId</span><span class=p>:</span><span class=w> </span><span class=l>eW91ci1hd3MtYWNjZXNzLWtleS1pZAo=</span><span class=w>
</span><span class=w>  </span><span class=nt>providerSecretAccessKey</span><span class=p>:</span><span class=w> </span><span class=l>eW91ci1hd3Mtc2VjcmV0LWFjY2Vzcy1rZXkK</span><span class=w>
</span><span class=w>  </span><span class=nt>userData</span><span class=p>:</span><span class=w> </span><span class=l>c29tZSBkYXRhIHRvIGJvb3RzdHJhcCB0aGUgVk0K</span><span class=w>
</span><span class=w></span><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>machine.sapcloud.io/v1alpha1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>AWSMachineClass</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z1-3db65</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>ami</span><span class=p>:</span><span class=w> </span><span class=l>ami-0123456789</span><span class=w> </span><span class=c># Your controller must map the stated version to the provider specific machine image information, in the AWS case the AMI.</span><span class=w>
</span><span class=w>  </span><span class=nt>blockDevices</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>ebs</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>volumeSize</span><span class=p>:</span><span class=w> </span><span class=m>20</span><span class=w>
</span><span class=w>      </span><span class=nt>volumeType</span><span class=p>:</span><span class=w> </span><span class=l>gp2</span><span class=w>
</span><span class=w>  </span><span class=nt>iam</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-nodes</span><span class=w>
</span><span class=w>  </span><span class=nt>keyName</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-ssh-publickey</span><span class=w>
</span><span class=w>  </span><span class=nt>machineType</span><span class=p>:</span><span class=w> </span><span class=l>m4.large</span><span class=w>
</span><span class=w>  </span><span class=nt>networkInterfaces</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>securityGroupIDs</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=l>sg-1234567890</span><span class=w>
</span><span class=w>    </span><span class=nt>subnetID</span><span class=p>:</span><span class=w> </span><span class=l>subnet-01234</span><span class=w>
</span><span class=w>  </span><span class=nt>region</span><span class=p>:</span><span class=w> </span><span class=l>eu-west-1</span><span class=w>
</span><span class=w>  </span><span class=nt>secretRef</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z1-3db65</span><span class=w>
</span><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar</span><span class=w>
</span><span class=w>  </span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>kubernetes.io/cluster/shoot--foo--bar</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span><span class=w>    </span><span class=nt>kubernetes.io/role/node</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span><span class=w></span><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>machine.sapcloud.io/v1alpha1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>MachineDeployment</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z1</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z1</span><span class=w>
</span><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>RollingUpdate</span><span class=w>
</span><span class=w>    </span><span class=nt>rollingUpdate</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>maxSurge</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span><span class=w>      </span><span class=nt>maxUnavailable</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z1</span><span class=w>
</span><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>class</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>AWSMachineClass</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z1-3db65</span><span class=w>
</span></code></pre></div><p>for the first availability zone <code>eu-west-1b</code>, and</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Secret</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z2-5z6as</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar</span><span class=w>
</span><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>gardener.cloud/purpose</span><span class=p>:</span><span class=w> </span><span class=l>machineclass</span><span class=w>
</span><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Opaque</span><span class=w>
</span><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>providerAccessKeyId</span><span class=p>:</span><span class=w> </span><span class=l>eW91ci1hd3MtYWNjZXNzLWtleS1pZAo=</span><span class=w>
</span><span class=w>  </span><span class=nt>providerSecretAccessKey</span><span class=p>:</span><span class=w> </span><span class=l>eW91ci1hd3Mtc2VjcmV0LWFjY2Vzcy1rZXkK</span><span class=w>
</span><span class=w>  </span><span class=nt>userData</span><span class=p>:</span><span class=w> </span><span class=l>c29tZSBkYXRhIHRvIGJvb3RzdHJhcCB0aGUgVk0K</span><span class=w>
</span><span class=w></span><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>machine.sapcloud.io/v1alpha1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>AWSMachineClass</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z2-5z6as</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>ami</span><span class=p>:</span><span class=w> </span><span class=l>ami-0123456789</span><span class=w> </span><span class=c># Your controller must map the stated version to the provider specific machine image information, in the AWS case the AMI.</span><span class=w>
</span><span class=w>  </span><span class=nt>blockDevices</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>ebs</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>volumeSize</span><span class=p>:</span><span class=w> </span><span class=m>20</span><span class=w>
</span><span class=w>      </span><span class=nt>volumeType</span><span class=p>:</span><span class=w> </span><span class=l>gp2</span><span class=w>
</span><span class=w>  </span><span class=nt>iam</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-nodes</span><span class=w>
</span><span class=w>  </span><span class=nt>keyName</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-ssh-publickey</span><span class=w>
</span><span class=w>  </span><span class=nt>machineType</span><span class=p>:</span><span class=w> </span><span class=l>m4.large</span><span class=w>
</span><span class=w>  </span><span class=nt>networkInterfaces</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>securityGroupIDs</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=l>sg-1234567890</span><span class=w>
</span><span class=w>    </span><span class=nt>subnetID</span><span class=p>:</span><span class=w> </span><span class=l>subnet-0123a</span><span class=w>
</span><span class=w>  </span><span class=nt>region</span><span class=p>:</span><span class=w> </span><span class=l>eu-west-1</span><span class=w>
</span><span class=w>  </span><span class=nt>secretRef</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z2-5z6as</span><span class=w>
</span><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar</span><span class=w>
</span><span class=w>  </span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>kubernetes.io/cluster/shoot--foo--bar</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span><span class=w>    </span><span class=nt>kubernetes.io/role/node</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span><span class=w></span><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>machine.sapcloud.io/v1alpha1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>MachineDeployment</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z1</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z1</span><span class=w>
</span><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>RollingUpdate</span><span class=w>
</span><span class=w>    </span><span class=nt>rollingUpdate</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>maxSurge</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span><span class=w>      </span><span class=nt>maxUnavailable</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z1</span><span class=w>
</span><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>class</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>AWSMachineClass</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z2-5z6as</span><span class=w>
</span></code></pre></div><p>for the second availability zone <code>eu-west-1c</code>.</p><p>Another convention is the 5-letter hash at the end of the machine class names.
Most controllers compute a checksum out of the specification of the machine class.
This helps to trigger a rolling update of the worker nodes if, for example, the machine image version changes.
In this case, a new checksum will be generated which results in the creation of a new machine class.
The <code>MachineDeployment</code>&rsquo;s machine class reference (<code>.spec.template.spec.class.name</code>) is updated which triggers the rolling update process in the machine-controller-manager.
However, all of this is only a convention that eases writing the controller, but you can do it completely differently if you desire - as long as you make sure that the described behaviours are implemented correctly.</p><p>After the machine classes and machine deployments have been created the machine-controller-manager will start talking to the provider&rsquo;s IaaS API and create the virtual machines.
Gardener makes sure that the content of the <code>userData</code> field that is used to bootstrap the machines contain the required configuration for installation of the kubelet and registering the VM as worker node in the shoot cluster.
The <code>Worker</code> extension controller shall wait until all the created <code>MachineDeployment</code>s indicate healthiness/readiness before it ends the control loop.</p><h2 id=does-gardener-need-some-information-that-must-be-returned-back>Does Gardener need some information that must be returned back?</h2><p>Another important benefit of the machine-controller-manager&rsquo;s design principles (extending the Kubernetes API using CRDs) is that the <a href=https://github.com/gardener/autoscaler>cluster-autoscaler</a> can be used <strong>without</strong> any provider-specific implementation.
We have forked the <a href=https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler>upstream Kubernetes community&rsquo;s cluster-autoscaler</a> and extended it so that it understands the machine API.
Definitely, we will merge it back into the community&rsquo;s versions once it has been adapted properly.</p><p>Our cluster-autoscaler only needs to know the minimum and maximum number of replicas <strong>per</strong> <code>MachineDeployment</code> and is ready to act without that it needs to talk to the provider APIs (it just modifies the <code>.spec.replicas</code> field in the <code>MachineDeployment</code> object).
Gardener deploys this autoscaler if there is at least one worker pool that specifies <code>max>min</code>.
In order to know how it needs to configure it, the provider-specific <code>Worker</code> extension controller must expose which <code>MachineDeployment</code>s it had created and how the <code>min</code>/<code>max</code> numbers should look like.</p><p>Consequently, your controller should write this information into the <code>Worker</code> resource&rsquo;s <code>.status.machineDeployments</code> field:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>extensions.gardener.cloud/v1alpha1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Worker</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>worker</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=l>...</span><span class=w>
</span><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>lastOperation</span><span class=p>:</span><span class=w> </span><span class=l>...</span><span class=w>
</span><span class=w>  </span><span class=nt>machineDeployments</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z1</span><span class=w>
</span><span class=w>    </span><span class=nt>minimum</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span><span class=w>    </span><span class=nt>maximum</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--foo--bar-cpu-worker-z2</span><span class=w>
</span><span class=w>    </span><span class=nt>minimum</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span><span class=w>    </span><span class=nt>maximum</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></code></pre></div><p>In order to support a new worker provider you need to write a controller that watches all <code>Worker</code>s with <code>.spec.type=&lt;my-provider-name></code>.
You can take a look at the below referenced example implementation for the AWS provider.</p><h2 id=that-sounds-like-a-lot-that-needs-to-be-done-can-you-help-me>That sounds like a lot that needs to be done, can you help me?</h2><p>All of the described behaviour is mostly the same for every provider.
The only difference is maybe the version/configuration of the machine-controller-manager, and the machine class specification itself.
You can take a look at our <a href=https://github.com/gardener/gardener/blob/master/extensions>extension library</a>, especially the <a href=https://github.com/gardener/gardener/tree/master/extensions/pkg/controller/worker>worker controller</a> part where you will find a lot of utilities that you can use.
Also, using the library you only need to implement your provider specifics - all the things that can be handled generically can be taken for free and do not need to be re-implemented.
Take a look at the <a href=https://github.com/gardener/gardener-extension-provider-aws/tree/master/pkg/controller/worker>AWS worker controller</a> for finding an example.</p><h2 id=non-provider-specific-information-required-for-worker-creation>Non-provider specific information required for worker creation</h2><p>All the providers require further information that is not provider specific but already part of the shoot resource.
One example for such information is whether the shoot is hibernated or not.
In this case all the virtual machines should be deleted/terminated, and after that the machine controller-manager should be scaled down.
You can take a look at the <a href=https://github.com/gardener/gardener-extension-provider-aws/tree/master/pkg/controller/worker>AWS worker controller</a> to see how it reads this information and how it is used.
As Gardener cannot know which information is required by providers it simply mirrors the <code>Shoot</code>, <code>Seed</code>, and <code>CloudProfile</code> resources into the seed.
They are part of the <a href=/v1.16.3/concepts/extensions/cluster><code>Cluster</code> extension resource</a> and can be used to extract information that is not part of the <code>Worker</code> resource itself.</p><h2 id=references-and-additional-resources>References and additional resources</h2><ul><li><a href=https://github.com/gardener/gardener/blob/master/pkg/apis/extensions/v1alpha1/types_worker.go><code>Worker</code> API (Golang specification)</a></li><li><a href=https://github.com/gardener/gardener/blob/master/extensions>Extension controller library</a></li><li><a href=https://github.com/gardener/gardener/tree/master/extensions/pkg/controller/worker>Generic worker controller</a></li><li><a href=https://github.com/gardener/gardener-extension-provider-aws/tree/master/pkg/controller/worker>Exemplary implementation for the AWS provider</a></li></ul></div></div></div><div class=howto_tickets><a href=https://github.com/gardener/gardener/issues/new/choose target=_blank><span>Let us know how can we improve.</span>
<span>Open<img src=https://gardener.cloud/images/branding/github-mark-logo-green.svg title=GitHub>issue <i class="fa fa-external-link" aria-hidden=true></i></span></a></div></section></div><style></style><footer class=footer><div class="container footer-wrapper"><ul class=nav><li><a href=/blog/>Blogs</a></li><li><a href=/community/>Community</a></li><li><a href=/adopter/>Adopters</a></li><li><a href=/documentation/home>Documentation</a></li></ul><img src=/images/lp/gardener-logo.svg alt="Logo Gardener" class=logo><ul class=media-wr><li><a target=_blank href=https://kubernetes.slack.com/archives/CB57N0BFG><img src=/images/branding/slack-logo-white.svg class=media-icon><div class=media-text>Slack</div></a></li><li><a target=_blank href=https://github.com/gardener><img src=/images/branding/github-mark-logo.png class=media-icon><div class=media-text>GitHub</div></a></li><li><a target=_blank href=https://www.youtube.com/channel/UCwUhwKFREV8Su0gwAJQX7tw><img src=/images/branding/youtube-logo-dark.svg class=media-icon><div class=media-text>YouTube</div></a></li><li><a target=_blank href=https://twitter.com/GardenerProject><img src=/images/branding/twitter-logo-white.svg class=media-icon><div class=media-text>Twitter</div></a></li></ul><span class=copyright>Copyright 2019-2021 Gardener project authors. <a href=https://www.sap.com/corporate/en/legal/privacy.html>Privacy policy
<i class="fa fa-external-link" aria-hidden=true></i></a></span></div></footer><script src=/js/jquery.sticky.js?1618334501></script><script src=/js/modernizr.custom.min.js?1618334501></script><script src=/js/code-snippets.js?1618334501></script><script>$(document).ready(function(){inlineSVG.init();$("[data-publishdate]").each(function(){$(this).text(moment($(this,"YYYY-MM-DD","YYYY-MM-DD hh:mm:ss").attr("data-publishdate")).fromNow());});new ClipboardJS('.clipboard-copy');$("body").codeSnippets();});</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W2FGNSX" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript></body></html>