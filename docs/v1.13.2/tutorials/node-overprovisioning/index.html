<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta name=copyright content="Copyright 2019-2021 Gardener project authors."><meta name=google-site-verification content="9EoGiMwk2aq0E_tVh16iJgJbp7fbyqkfWH9b5sGybl0"><title>Cluster Overprovisioning :: Gardener</title><link rel=icon type=image/x-icon href=https://gardener.cloud/images/favicon.ico><link rel=icon type=image/png href=https://gardener.cloud/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://gardener.cloud/images/favicon-16x16.png sizes=16x16><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-W2FGNSX');</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-165447164-1');</script><link href=/css/font-awesome.min.css?1620754543 rel=stylesheet><link href=/css/skeleton.css?1620754543 rel=stylesheet><link rel=preload href=/fonts/sap-icofonts/sap-icofonts.woff as=font type=font/woff crossorigin=anonymous><link rel=preload href=/fonts/sapcom-icons/sapcom-icons.woff as=font type=font/woff crossorigin=anonymous><link rel=stylesheet href=/css/sapcom-icons.css><link rel=stylesheet href=/css/normalize.css><link rel=stylesheet href=/css/gardener.b459b7f22c26be8e2f608a181d5372c6e44f06cf007c350346ccf5fadbe04a74.css><script src=/js/moment.js?1620754543></script><script src=/js/inlineSVG.js?1620754543></script><script src=/js/jquery.min.js?1620754543></script><script src=/jquery-ui-1.12.1/jquery-ui.min.js?1620754543></script><script src=/js/fixed.js?1620754543></script><script src=/js/clipboard.min.js?1620754543></script><script src=https://platform.linkedin.com/in.js type=text/javascript>lang:en_US</script></head><body data-url=/v1.13.2/tutorials/node-overprovisioning/ class=has-sticky-navigation><script>$(document).ready(function(){function initStickyNav(){var stickyPoint;var tln=document.querySelector(".tln");if(!tln){return;}
var stickyPointEl=document.querySelector(".sticky-nav-point");if(stickyPointEl==null){stickyPointEl=document.querySelector("body");stickyPoint=0;}else{stickyPoint=stickyPointEl.clientHeight+stickyPointEl.offsetTop;}
var bodySelector=document.getElementsByTagName("body")[0];var tlnHeight=tln.clientHeight;var stickyNavigation=function(){if(window.pageYOffset+tlnHeight>=stickyPoint){bodySelector.classList.add("has-sticky-navigation");tln.classList.add("sticky-top");}else{bodySelector.classList.remove("has-sticky-navigation");tln.classList.remove("sticky-top");}}
window.onscroll=function(){stickyNavigation();};}
initStickyNav();function closeAllSelect(){document.getElementById("docOptions").classList.remove("show");}
function show(e){e.stopPropagation();document.getElementById("docOptions").classList.add("show");}
document.addEventListener("click",closeAllSelect);document.getElementById("docSelector").addEventListener("click",show);});</script><div class="tln fixedsticky sticky-top"><header class=navigation><div class=container><div class=navigation-wrapper><a href=/ class=logo><img src=/images/gardener-logo.svg>
<span class=title>Gardener</span></a>
<a class="nav-button navbar-toggler" href=#><i class="fa fa-bars"></i></a><div class=navbar-collapse><ul class=links><li class=link><a href=/blog/>Blogs</a></li><li class=link><a href=/community/>Community</a></li><li class=link><a href=/adopter/>Adopters</a></li><li class="link has-child"><a href=/documentation/home>Documentation</a></li></ul></div></div></div></header></div><script>$(".navigation .navbar-toggler").click(function(evt){$(".navigation .navbar-collapse").toggle();$(".navigation").toggleClass("collapsed");$(".navigation .search-box").toggle();})</script><style>#docSelector{cursor:pointer}.doc-options{position:fixed;background-color:#0b8062;text-align:left;display:none}.doc-options ul li{margin-bottom:0}.doc-options ul li a:hover{background-color:#0c694f}.doc-options ul{list-style:none;padding:0;margin:0;text-align:left}.doc-options ul li a{padding:10px;margin:0}.doc-options .activeVersion{background-color:#ec682a}.show{display:block}</style><div class=sln><div class=overlay-band><ul class="nav-list container"><li title=Home><a class=navbar-link href=/v1.13.2/home/>Home</a></li><li title=Concepts><a class=navbar-link href=/v1.13.2/concepts/>Concepts</a></li><li title="How-To Guides"><a class=navbar-link href=/v1.13.2/guides/>How-To Guides</a></li><li title=Tutorials><a class="navbar-link is-active" href=/v1.13.2/tutorials/>Tutorials</a></li><li title="API Reference"><a class=navbar-link href=/v1.13.2/references/>API Reference</a></li><li title=Contribute><a class=navbar-link href=/v1.13.2/contribute/>Contribute</a></li></ul></div></div><div class="main container"><section><div class="highlightable body-inner-wrapper"><div id=body-inner class=external><style>.docs .title{margin:0 0 4rem}</style><div class="docs page"><div class=git-wr><div class=page-contributors>Contributors to this page<div class=contributors-list><a href=mailto:andreas.herz@sap.com><img class=user-icon src="https://avatars.githubusercontent.com/u/1155039?v=4" title="Andreas Herz"></a></div></div><div class=origin-tools><div class=page-edit><div id=top-github-link><a class=github-link title="Edit page" href=https://github.com/gardener-samples/kube-overprovisioning/blob/master/README.md target=blank><i class="fa fa-edit"></i><span id=top-github-link-text title="Edit page"></span></a></div></div></div></div><h1 id=cluster-overprovisioning>Cluster Overprovisioning</h1><p>This tutorial describes how to overprovisioning of cluster nodes for scaling and failover. This is desired
when you have work loads that need to scale up quickly without waiting for the new cluster nodes to be created
and join the cluster.</p><p><img src=https://github.com/gardener-samples/kube-overprovisioning/raw/master/images/teaser.png alt=teaser></p><p>A similar problem occurs when crashing a node from the Hyperscaler. This must be replaced by Kubernetes as fast
as possible. The solution can be <strong>overprovisioning</strong> of nodes</p><blockquote><p>Overprovisioning: Allocating more computer resources than is strictly necessary</p><p><em><a href=https://en.wikipedia.org/wiki/Overprovisioning>https://en.wikipedia.org/wiki/Overprovisioning</a></em></p></blockquote><h2 id=when-does-the-autoscaler-change-the-size-of-the-cluster>When does the autoscaler change the size of the cluster?</h2><p>Below is a description of how the cluster behaves when there is a requirement to scale.</p><h3 id=scaling-without-overprovisioning>Scaling without overprovisioning</h3><ol><li>load hits the cluster (or a node is crashed)</li><li>cannot schedule application-pods due to insufficient resources, scaling fails ðŸ’€</li><li>cluster-autoscaler notices and begins to provision new instance</li><li>wait for instance to be provisioned, boot, join the cluster and become ready</li><li>kube-scheduler will notice there is somewhere to put the application-pods and will schedule them</li></ol><h3 id=scaling-with-overprovisioning>Scaling with Overprovisioning</h3><ol><li>load hits the cluster (or a node is crashed)</li><li><em>placeholder-pods</em> are evicted,</li><li><strong>scaling of application-pod is immediately successful</strong></li><li>placeholder-pods cannot be scheduled due to insufficient resources</li><li>wait for instance to be provisioned, boot, join the cluster and become ready</li><li>kube-scheduler will notice there is somewhere to put the placeholder pods and will schedule them</li></ol><p>You can apply the above scenario one-to-one to the case when a node of the Hyperscaler dies.</p><h2 id=real-scenario-test>Real Scenario Test</h2><p>We executed <em>normal</em> and <em>overprovisioning</em> tests on a gardener cluster on different infrastructure provider (aws, azure, gcp,
alicloud). All of them tested the downtime of the application pod running in the cluster, when a node dies.</p><p>The test results for the different IaaS provider are shown below.</p><h2 id=results>Results</h2><p>The results provided should only show how long the downtimes can be approximately.</p><blockquote><p><em>The downtime results could vary +- 1 min, because the minimum request interval in UpTime is 1 minute</em></p></blockquote><h2 id=img-srchttpsgithubcomgardener-sampleskube-overprovisioningblobmasterimageslogosawspng-classinline-styledisplay-inline-blockmargin0height30px-amazon><img src=https://github.com/gardener-samples/kube-overprovisioning/blob/master/images/logos/aws.png class=inline style=display:inline-block;margin:0;height:30px> Amazon</h2><h3 id=normal>Normal</h3><p><img src=https://github.com/gardener-samples/kube-overprovisioning/raw/master/images/result/normal/aws.png alt=chart></p><h3 id=overprovisioning>Overprovisioning</h3><p><img src=https://github.com/gardener-samples/kube-overprovisioning/raw/master/images/result/overprovision/aws.png alt=chart></p><h2 id=img-srchttpsgithubcomgardener-sampleskube-overprovisioningblobmasterimageslogosazurepng-classinline-styledisplay-inline-blockmargin0height30px-azure><img src=https://github.com/gardener-samples/kube-overprovisioning/blob/master/images/logos/azure.png class=inline style=display:inline-block;margin:0;height:30px> Azure</h2><h3 id=normal-1>Normal</h3><p><img src=https://github.com/gardener-samples/kube-overprovisioning/raw/master/images/result/normal/azure.png alt=chart></p><h3 id=overprovisioning-1>Overprovisioning</h3><p><img src=https://github.com/gardener-samples/kube-overprovisioning/raw/master/images/result/overprovision/azure.png alt=chart></p><h2 id=img-srchttpsgithubcomgardener-sampleskube-overprovisioningblobmasterimageslogosgcppng-classinline-styledisplay-inline-blockmargin0height30px-gcp><img src=https://github.com/gardener-samples/kube-overprovisioning/blob/master/images/logos/gcp.png class=inline style=display:inline-block;margin:0;height:30px> GCP</h2><h3 id=normal-2>Normal</h3><p><img src=https://github.com/gardener-samples/kube-overprovisioning/raw/master/images/result/normal/gcp.png alt=chart></p><h3 id=overprovisioning-2>Overprovisioning</h3><p><img src=https://github.com/gardener-samples/kube-overprovisioning/raw/master/images/result/overprovision/gcp.png alt=chart></p><h2 id=img-srchttpsgithubcomgardener-sampleskube-overprovisioningblobmasterimageslogosalicloudpng-classinline-styledisplay-inline-blockmargin0height30px-alicloud><img src=https://github.com/gardener-samples/kube-overprovisioning/blob/master/images/logos/alicloud.png class=inline style=display:inline-block;margin:0;height:30px> AliCloud</h2><h3 id=normal-3>Normal</h3><p><img src=https://github.com/gardener-samples/kube-overprovisioning/raw/master/images/result/normal/alicloud.png alt=chart></p><h3 id=overprovisioning-3>Overprovisioning</h3><p><img src=https://github.com/gardener-samples/kube-overprovisioning/raw/master/images/result/overprovision/alicloud.png alt=chart></p><h2 id=summary-of-results>Summary of results</h2><h3 id=normal-4>Normal</h3><table><thead><tr><th>Provider</th><th>AWS</th><th>Azure</th><th>GCP</th><th>AliCloud</th></tr></thead><tbody><tr><td>Node deleted</td><td>08:56</td><td>09:32</td><td>09:39</td><td>09:53</td></tr><tr><td>Pod rescheduled</td><td>09:17</td><td>09:50</td><td>09:53</td><td>10:14</td></tr><tr><td><strong>Downtime</strong></td><td>21 min</td><td>18 min</td><td>14 min</td><td>21 min</td></tr></tbody></table><h3 id=overprovisioning-4>Overprovisioning</h3><table><thead><tr><th>Provider</th><th>AWS</th><th>Azure</th><th>GCP</th><th>AliCloud</th></tr></thead><tbody><tr><td>Node deleted</td><td>14:20</td><td>06:00</td><td>06:05</td><td>08:23</td></tr><tr><td>Pod rescheduled</td><td>14:22</td><td>06:02</td><td>06:06</td><td>08:25</td></tr><tr><td><strong>Downtime</strong></td><td>2 min</td><td>2 min</td><td>1 min</td><td>2 min</td></tr></tbody></table><h2 id=test-description>Test Description</h2><p>We deployed a nginx web server and a service of type LoadBalancer to expose it. So we are able to call our
endpoint with external tools like UpTime to check the availability of our nginx. It takes only a few seconds
to deploy a nginx web server on kubernetes, so we could say: when your endpoint works, your node is up and running.</p><p>We wanted to test how much time it takes, when your node gets killed and your cluster has to create a new one to run
your application on it.</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubectl get nodes

# select the node where your nginx is running on
kubectl delete node &lt;NGINX-HOSTED-NODE&gt;
</code></pre></div><p>The downtime is tested with UpTime, which does every minute a request to our endpoint. Further we checked manually,
if the node startup time and the timestamps on UpTime are almost similar.</p><p>Next, deploy the <strong>overprovisioned</strong> version of our demo application and kill the node with the NGINX.
As you can see - the pod comes up very fast and can serve content again.</p></div></div></div><div class=howto_tickets><a href=https://github.com/gardener-samples/kube-overprovisioning/issues/new/choose target=_blank><span>Let us know how can we improve.</span>
<span>Open<img src=https://gardener.cloud/images/branding/github-mark-logo-green.svg title=GitHub>issue <i class="fa fa-external-link" aria-hidden=true></i></span></a></div></section></div><style></style><footer class=footer><div class="container footer-wrapper"><ul class=nav><li><a href=/blog/>Blogs</a></li><li><a href=/community/>Community</a></li><li><a href=/adopter/>Adopters</a></li><li><a href=/documentation/home>Documentation</a></li></ul><img src=/images/lp/gardener-logo.svg alt="Logo Gardener" class=logo><ul class=media-wr><li><a target=_blank href=https://kubernetes.slack.com/archives/CB57N0BFG><img src=/images/branding/slack-logo-white.svg class=media-icon><div class=media-text>Slack</div></a></li><li><a target=_blank href=https://github.com/gardener><img src=/images/branding/github-mark-logo.png class=media-icon><div class=media-text>GitHub</div></a></li><li><a target=_blank href=https://www.youtube.com/channel/UCwUhwKFREV8Su0gwAJQX7tw><img src=/images/branding/youtube-logo-dark.svg class=media-icon><div class=media-text>YouTube</div></a></li><li><a target=_blank href=https://twitter.com/GardenerProject><img src=/images/branding/twitter-logo-white.svg class=media-icon><div class=media-text>Twitter</div></a></li></ul><span class=copyright>Copyright 2019-2021 Gardener project authors. <a href=https://www.sap.com/corporate/en/legal/privacy.html>Privacy policy
<i class="fa fa-external-link" aria-hidden=true></i></a></span></div></footer><script src=/js/jquery.sticky.js?1620754543></script><script src=/js/modernizr.custom.min.js?1620754543></script><script src=/js/code-snippets.js?1620754543></script><script>$(document).ready(function(){inlineSVG.init();$("[data-publishdate]").each(function(){$(this).text(moment($(this,"YYYY-MM-DD","YYYY-MM-DD hh:mm:ss").attr("data-publishdate")).fromNow());});new ClipboardJS('.clipboard-copy');$("body").codeSnippets();});</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W2FGNSX" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript></body></html>