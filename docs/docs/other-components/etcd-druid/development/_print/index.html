<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.95.0"><link rel=canonical type=text/html href=https://gardener.cloud/docs/other-components/etcd-druid/development/><link rel=alternate type=application/rss+xml href=https://gardener.cloud/docs/other-components/etcd-druid/development/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Development | Gardener</title><meta name=description content><meta property="og:title" content="Development"><meta property="og:description" content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta property="og:type" content="website"><meta property="og:url" content="https://gardener.cloud/docs/other-components/etcd-druid/development/"><meta property="og:image" content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta itemprop=name content="Development"><meta itemprop=description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta name=twitter:title content="Development"><meta name=twitter:description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><link rel=preload href=/scss/main.min.b5b806bb2cd9fe9ed809539377398aa9df0eb8ca0c983a6eae0b413d528d8f0e.css as=style><link href=/scss/main.min.b5b806bb2cd9fe9ed809539377398aa9df0eb8ca0c983a6eae0b413d528d8f0e.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7N3XF5XLGV"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-7N3XF5XLGV",{anonymize_ip:!1})}</script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg width="90" height="90" viewBox="0 0 90 90" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>logo</title><desc>Created with Sketch.</desc><defs><path d="M41.8864954.994901575c.996545099999999-.479910833 2.6164002-.477918931 3.6088091.0L76.8159138 16.0781121C77.8124589 16.5580229 78.8208647 17.8257185 79.0659694 18.8995926l7.7355517 33.8916663C87.0476474 53.8696088 86.6852538 55.4484075 85.9984855 56.3095876L64.3239514 83.4885938C63.6343208 84.3533632 62.1740175 85.0543973 61.0725268 85.0543973H26.3092731c-1.1060816.0-2.5646564-.704623400000003-3.2514246-1.5658035L1.38331434 56.3095876C.693683723 55.4448182.335174016 53.865133.580278769 52.7912589L8.31583044 18.8995926C8.56195675 17.8212428 9.57347722 16.556031 10.5658861 16.0781121L41.8864954.994901575z" id="path-1"/><linearGradient x1="12.7542673%" y1="-18.6617048%" x2="88.2666158%" y2="84.6075483%" id="linearGradient-3"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="50%" y1="4.93673768%" x2="148.756007%" y2="175.514523%" id="linearGradient-4"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="19.1574381%" y1="-9.04800713%" x2="82.2203149%" y2="77.9084293%" id="linearGradient-5"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="57.4403751%" y1="26.3148481%" x2="137.966711%" y2="158.080556%" id="linearGradient-6"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="logo"><g id="Rectangle-2" transform="translate(1.000000, 0.000000)"><mask id="mask-2" fill="#fff"><use xlink:href="#path-1"/></mask><use id="Mask" fill="#009f76" xlink:href="#path-1"/><polygon fill="#000" opacity=".289628623" mask="url(#mask-2)" points="-17.6484375 54.5224609 30.8242188 25.0791016 63.4726562 58.5 24.7324219 92.6689453"/></g><path d="M56.8508631 39.260019C56.4193519 40.443987 55.6088085 41.581593 54.6736295 42.1938694l-8.0738997 5.2861089c-1.3854671.907087099999998-3.6247515.9116711-5.0172201.0L33.50861 42.1938694C32.123143 41.2867823 31 39.206345 31 37.545932V26.4150304c0-.725313.2131118-1.5301454.569268099999999-2.2825772L56.8508631 39.260019z" id="Combined-Shape" fill="url(#linearGradient-3)" transform="translate(43.925432, 36.147233) scale(-1, 1) translate(-43.925432, -36.147233)"/><path d="M56.0774672 25.1412464C56.4306829 25.8903325 56.6425556 26.6907345 56.6425556 27.4119019V38.5428034c0 1.6598979-1.1161415 3.73626640000001-2.50861 4.6479374l-8.0738997 5.286109c-1.3854671.907087000000004-3.6247516.911671000000005-5.0172201.0L32.9689261 43.1907408C32.2918101 42.7474223 31.6773514 42.0238435 31.2260376 41.206007L56.0774672 25.1412464z" id="Combined-Shape" fill="url(#linearGradient-4)" transform="translate(43.821278, 37.246598) scale(-1, 1) translate(-43.821278, -37.246598)"/><path d="M65.0702134 57.1846889C64.5985426 58.2007851 63.8367404 59.1236871 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.1597438 58.7930183 24 56.7816693 24 55.1323495V37.1145303C24 36.3487436 24.249712 35.5060005 24.6599102 34.7400631L65.0702134 57.1846889z" id="Combined-Shape" fill="url(#linearGradient-5)"/><path d="M65.0189476 34.954538C65.3636909 35.6617313 65.5692194 36.42021 65.5692194 37.1145303V55.1323495C65.5692194 56.7842831 64.4072119 58.7943252 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.9237304 59.2341061 25.3159155 58.5918431 24.8568495 57.8487596L65.0189476 34.954538z" id="Combined-Shape" fill="url(#linearGradient-6)"/></g></g></svg></span><span class=text-capitalize>Gardener</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/adopter><span>Adopters</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog><span>Blogs</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community><span>Community</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.646d7cdbc65a1b6ecc930e6f92d056cc.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/other-components/etcd-druid/development/>Return to the regular view of this page</a>.</p></div><h1 class=title>Development</h1><div class=content></div></div><div class=td-content><h1 id=pg-0c90938490d04d322f741df0488294f7>1 - etcd Network Latency</h1><h1 id=network-latency-analysis-sn-etcd-sz-vs--mn-etcd-sz-vs-mn-etcd-mz>Network Latency analysis: <code>sn-etcd-sz</code> vs <code>mn-etcd-sz</code> vs <code>mn-etcd-mz</code></h1><p>This page captures the etcd cluster latency analysis for below scenarios using the benchmark tool (build from <a href=https://github.com/seshachalam-yv/etcd>etcd benchmark tool</a>).</p><p><code>sn-etcd-sz</code> -> single-node etcd single zone (Only single replica of etcd will be running)</p><p><code>mn-etcd-sz</code> -> multi-node etcd single zone (Multiple replicas of etcd pods will be running across nodes in a single zone)</p><p><code>mn-etcd-mz</code> -> multi-node etcd multi zone (Multiple replicas of etcd pods will be running across nodes in multiple zones)</p><h2 id=put-analysis>PUT Analysis</h2><h3 id=summary>Summary</h3><ul><li><code>sn-etcd-sz</code> latency is <strong>~20% less than</strong> <code>mn-etcd-sz</code> when benchmark tool with single client.</li><li><code>mn-etcd-sz</code> latency is less than <code>mn-etcd-mz</code> but the difference is <code>~+/-5%</code>.</li><li>Compared to <code>mn-etcd-sz</code>, <code>sn-etcd-sz</code> latency is higher and gradually grows with more clients and larger value size.</li><li>Compared to <code>mn-etcd-mz</code>, <code>mn-etcd-sz</code> latency is higher and gradually grows with more clients and larger value size.</li><li><em>Compared to <code>follower</code>, <code>leader</code> latency is less</em>, when benchmark tool with single client for all cases.</li><li><em>Compared to <code>follower</code>, <code>leader</code> latency is high</em>, when benchmark tool with multiple clients for all cases.</li></ul><p>Sample commands:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:green># write to leader</span>
</span></span><span style=display:flex><span>benchmark put --target-leader --conns=1 --clients=1 --precise <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --sequential-keys --key-starts 0 --val-size=256 --total=10000 <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --endpoints=$ETCD_HOST 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># write to follower</span>
</span></span><span style=display:flex><span>benchmark put  --conns=1 --clients=1 --precise <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --sequential-keys --key-starts 0 --val-size=256 --total=10000 <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --endpoints=$ETCD_FOLLOWER_HOST
</span></span></code></pre></div><h3 id=latency-analysis-during-put-requests-to-etcd>Latency analysis during PUT requests to etcd</h3><ul><li><details><summary>In this case benchmark tool tries to put key with random 256 bytes value.</summary><ul><li><p>Benchmark tool loads key/value to <code>leader</code> with single client .</p><ul><li><code>sn-etcd-sz</code> latency (~0.815ms) is <strong>~50% lesser than</strong> <code>mn-etcd-sz</code> (~1.74ms ).</li><li><ul><li><code>mn-etcd-sz</code> latency (~1.74ms ) is slightly lesser than <code>mn-etcd-mz</code> (~1.8ms) but the difference is negligible (within same ms).</li></ul></li><li><table><thead><tr><th style=text-align:center>Number of keys</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>leader</td><td style=text-align:center>1220.0520</td><td style=text-align:center>0.815ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>leader</td><td style=text-align:center>586.545</td><td style=text-align:center>1.74ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>leader</td><td style=text-align:center>554.0155654442634</td><td style=text-align:center>1.8ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p>Benchmark tool loads key/value to <code>follower</code> with single client.</p><ul><li><code>mn-etcd-sz</code> latency(<code>~2.2ms</code>) is <strong>20% to 30% lesser than</strong> <code>mn-etcd-mz</code>(<code>~2.7ms</code>).</li><li><em>Compare to <code>follower</code>, <code>leader</code> has lower latency.</em></li><li><table><thead><tr><th style=text-align:center>Number of keys</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>follower-1</td><td style=text-align:center>445.743</td><td style=text-align:center>2.23ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>follower-1</td><td style=text-align:center>378.9366747610789</td><td style=text-align:center>2.63ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table><table><thead><tr><th style=text-align:center>Number of keys</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>follower-2</td><td style=text-align:center>457.967</td><td style=text-align:center>2.17ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-2</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>follower-2</td><td style=text-align:center>345.6586129825796</td><td style=text-align:center>2.89ms</td><td style=text-align:center>eu-west-1b</td><td style=text-align:center>etcd-main-2</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p>Benchmark tool loads key/value to <code>leader</code> with multiple clients.</p><ul><li><code>sn-etcd-sz</code> latency(<code>~78.3ms</code>) is <strong>~10% greater than</strong> <code>mn-etcd-sz</code>(<code>~71.81ms</code>).</li><li><code>mn-etcd-sz</code> latency(<code>~71.81ms</code>) is less than <code>mn-etcd-mz</code>(<code>~72.5ms</code>) but the difference is negligible.</li><li><table><thead><tr><th style=text-align:center>Number of keys</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>leader</td><td style=text-align:center>12638.905</td><td style=text-align:center>78.32ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>leader</td><td style=text-align:center>13789.248</td><td style=text-align:center>71.81ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>leader</td><td style=text-align:center>13728.446436395223</td><td style=text-align:center>72.5ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p>Benchmark tool loads key/value to <code>follower</code> with multiple clients.</p><ul><li><code>mn-etcd-sz</code> latency(<code>~69.8ms</code>) is <strong>~5% greater than</strong> <code>mn-etcd-mz</code>(<code>~72.6ms</code>).</li><li><em>Compare to <code>leader</code>, <code>follower</code> has lower latency</em>.</li><li><table><thead><tr><th style=text-align:center>Number of keys</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>follower-1</td><td style=text-align:center>14271.983</td><td style=text-align:center>69.80ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>follower-1</td><td style=text-align:center>13695.98</td><td style=text-align:center>72.62ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table><table><thead><tr><th style=text-align:center>Number of keys</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>follower-2</td><td style=text-align:center>14325.436</td><td style=text-align:center>69.47ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-2</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>follower-2</td><td style=text-align:center>15750.409490407475</td><td style=text-align:center>63.3ms</td><td style=text-align:center>eu-west-1b</td><td style=text-align:center>etcd-main-2</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li></ul></details></li><li><details><summary>In this case benchmark tool tries to put key with random 1 MB value.</summary><ul><li><p>Benchmark tool loads key/value to <code>leader</code> with single client.</p><ul><li><code>sn-etcd-sz</code> latency(<code>~16.35ms</code>) is <strong>~20% lesser than</strong> <code>mn-etcd-sz</code>(<code>~20.64ms</code>).</li><li><code>mn-etcd-sz</code> latency(<code>~20.64ms</code>) is less than <code>mn-etcd-mz</code>(<code>~21.08ms</code>) but the difference is negligible..</li><li><table><thead><tr><th style=text-align:center>Number of keys</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>leader</td><td style=text-align:center>61.117</td><td style=text-align:center>16.35ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>leader</td><td style=text-align:center>48.416</td><td style=text-align:center>20.64ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>leader</td><td style=text-align:center>45.7517341664802</td><td style=text-align:center>21.08ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p>Benchmark tool loads key/value withto <code>follower</code> single client.</p><ul><li><code>mn-etcd-sz</code> latency(<code>~23.10ms</code>) is <strong>~10% greater than</strong> <code>mn-etcd-mz</code>(<code>~21.8ms</code>).</li><li><em>Compare to <code>follower</code>, <code>leader</code> has lower latency</em>.</li><li><table><thead><tr><th style=text-align:center>Number of keys</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>follower-1</td><td style=text-align:center>43.261</td><td style=text-align:center>23.10ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>follower-1</td><td style=text-align:center>45.7517341664802</td><td style=text-align:center>21.8ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>follower-1</td><td style=text-align:center>45.33</td><td style=text-align:center>22.05ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table><table><thead><tr><th style=text-align:center>Number of keys</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>follower-2</td><td style=text-align:center>40.0518</td><td style=text-align:center>24.95ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-2</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>follower-2</td><td style=text-align:center>43.28573155709838</td><td style=text-align:center>23.09ms</td><td style=text-align:center>eu-west-1b</td><td style=text-align:center>etcd-main-2</td><td style=text-align:center>mn-etcd-mz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>follower-2</td><td style=text-align:center>45.92</td><td style=text-align:center>21.76ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>follower-2</td><td style=text-align:center>35.5705</td><td style=text-align:center>28.1ms</td><td style=text-align:center>eu-west-1b</td><td style=text-align:center>etcd-main-2</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p>Benchmark tool loads key/value to <code>leader</code> with multiple clients.</p><ul><li><code>sn-etcd-sz</code> latency(<code>~6.0375secs</code>) is <strong>~30% greater than</strong> <code>mn-etcd-sz``~4.000secs</code>).</li><li><code>mn-etcd-sz</code> latency(<code>~4.000secs</code>) is less than <code>mn-etcd-mz</code>(<code>~ 4.09secs</code>) but the difference is negligible.</li><li><table><thead><tr><th style=text-align:center>Number of keys</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>300</td><td style=text-align:center>leader</td><td style=text-align:center>55.373</td><td style=text-align:center>6.0375secs</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>300</td><td style=text-align:center>leader</td><td style=text-align:center>67.319</td><td style=text-align:center>4.000secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>300</td><td style=text-align:center>leader</td><td style=text-align:center>65.91914167957594</td><td style=text-align:center>4.09secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p>Benchmark tool loads key/value to <code>follower</code> with multiple clients.</p><ul><li><em><code>mn-etcd-sz</code> latency(<code>~4.04secs</code>) is <strong>~5% greater than</strong> <code>mn-etcd-mz</code>(<code>~ 3.90secs</code>).</em></li><li><em>Compare to <code>leader</code>, <code>follower</code> has lower latency</em>.</li><li><table><thead><tr><th style=text-align:center>Number of keys</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>300</td><td style=text-align:center>follower-1</td><td style=text-align:center>66.528</td><td style=text-align:center>4.0417secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>300</td><td style=text-align:center>follower-1</td><td style=text-align:center>70.6493461856332</td><td style=text-align:center>3.90secs</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>300</td><td style=text-align:center>follower-1</td><td style=text-align:center>71.95</td><td style=text-align:center>3.84secs</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table><table><thead><tr><th style=text-align:center>Number of keys</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>300</td><td style=text-align:center>follower-2</td><td style=text-align:center>66.447</td><td style=text-align:center>4.0164secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-2</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>300</td><td style=text-align:center>follower-2</td><td style=text-align:center>67.53038086369484</td><td style=text-align:center>3.87secs</td><td style=text-align:center>eu-west-1b</td><td style=text-align:center>etcd-main-2</td><td style=text-align:center>mn-etcd-mz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>300</td><td style=text-align:center>follower-2</td><td style=text-align:center>68.46</td><td style=text-align:center>3.92secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li></ul></details></li></ul><hr><br><h2 id=range-analysis>Range Analysis</h2><p>Sample commands are:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:green># Single connection read request with sequential keys</span>
</span></span><span style=display:flex><span>benchmark range 0 --target-leader --conns=1 --clients=1 --precise <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --sequential-keys --key-starts 0  --total=10000 <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --consistency=l <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --endpoints=$ETCD_HOST 
</span></span><span style=display:flex><span><span style=color:green># --consistency=s [Serializable]</span>
</span></span><span style=display:flex><span>benchmark range 0 --target-leader --conns=1 --clients=1 --precise <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --sequential-keys --key-starts 0  --total=10000 <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --consistency=s <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --endpoints=$ETCD_HOST 
</span></span><span style=display:flex><span><span style=color:green># Each read request with range query matches key 0 9999 and repeats for total number of requests.  </span>
</span></span><span style=display:flex><span>benchmark range 0 9999 --target-leader --conns=1 --clients=1 --precise <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --total=10 <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --consistency=s <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --endpoints=https://etcd-main-client:2379
</span></span><span style=display:flex><span><span style=color:green># Read requests with multiple connections</span>
</span></span><span style=display:flex><span>benchmark range 0 --target-leader --conns=100 --clients=1000 --precise <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --sequential-keys --key-starts 0  --total=100000 <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --consistency=l <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --endpoints=$ETCD_HOST 
</span></span><span style=display:flex><span>benchmark range 0 --target-leader --conns=100 --clients=1000 --precise <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --sequential-keys --key-starts 0  --total=100000 <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --consistency=s <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --endpoints=$ETCD_HOST 
</span></span></code></pre></div><h3 id=latency-analysis-during-range-requests-to-etcd>Latency analysis during Range requests to etcd</h3><ul><li><details><summary>In this case benchmark tool tries to get specific key with random 256 bytes value.</summary><ul><li><p>Benchmark tool range requests to <code>leader</code> with single client.</p><ul><li><p><code>sn-etcd-sz</code> latency(<code>~1.24ms</code>) is <strong>~40% greater than</strong> <code>mn-etcd-sz</code>(<code>~0.67ms</code>).</p></li><li><p><code>mn-etcd-sz</code> latency(<code>~0.67ms</code>) is <strong>~20% lesser than</strong> <code>mn-etcd-mz</code>(<code>~0.85ms</code>).</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>800.272</td><td style=text-align:center>1.24ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>1173.9081</td><td style=text-align:center>0.67ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>999.3020189178693</td><td style=text-align:center>0.85ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li><li><p>Compare to consistency <code>Linearizable</code>, <code>Serializable</code> is <strong>~40% less</strong> for all cases</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>1411.229</td><td style=text-align:center>0.70ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>2033.131</td><td style=text-align:center>0.35ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>2100.2426362012025</td><td style=text-align:center>0.47ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p>Benchmark tool range requests to <code>follower</code> with single client .</p><ul><li><code>mn-etcd-sz</code> latency(<code>~1.3ms</code>) is <strong>~20% lesser than</strong> <code>mn-etcd-mz</code>(<code>~1.6ms</code>).</li><li><em>Compare to <code>follower</code>, <code>leader</code> read request latency is <strong>~50% less</strong> for both <code>mn-etcd-sz</code>, <code>mn-etcd-mz</code></em></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>follower-1</td><td style=text-align:center>765.325</td><td style=text-align:center>1.3ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>follower-1</td><td style=text-align:center>596.1</td><td style=text-align:center>1.6ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li><li>Compare to consistency <code>Linearizable</code>, <code>Serializable</code> is <strong>~50% less</strong> for all cases</li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>follower-1</td><td style=text-align:center>1823.631</td><td style=text-align:center>0.54ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>follower-1</td><td style=text-align:center>1442.6</td><td style=text-align:center>0.69ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>follower-1</td><td style=text-align:center>1416.39</td><td style=text-align:center>0.70ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr><tr><td style=text-align:center>10000</td><td style=text-align:center>256</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>follower-1</td><td style=text-align:center>2077.449</td><td style=text-align:center>0.47ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p>Benchmark tool range requests to <code>leader</code> with multiple client.</p><ul><li><p><code>sn-etcd-sz</code> latency(<code>~84.66ms</code>) is <strong>~20% greater than</strong> <code>mn-etcd-sz</code>(<code>~73.95ms</code>).</p></li><li><p><code>mn-etcd-sz</code> latency(<code>~73.95ms</code>) is <strong>more or less equal to</strong> <code>mn-etcd-mz</code>(<code>~ 73.8ms</code>).</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>11775.721</td><td style=text-align:center>84.66ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>13446.9598</td><td style=text-align:center>73.95ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>13527.19810605353</td><td style=text-align:center>73.8ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li><li><p>Compare to consistency <code>Linearizable</code>, <code>Serializable</code> is <strong>~20% lesser</strong> for all cases</p></li><li><p><code>sn-etcd-sz</code> latency(<code>~69.37ms</code>) is <strong>more or less equal to</strong> <code>mn-etcd-sz</code>(<code>~69.89ms</code>).</p></li><li><p><code>mn-etcd-sz</code> latency(<code>~69.89ms</code>) is <strong>slightly higher than</strong> <code>mn-etcd-mz</code>(<code>~67.63ms</code>).</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>14334.9027</td><td style=text-align:center>69.37ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>14270.008</td><td style=text-align:center>69.89ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>14715.287354023869</td><td style=text-align:center>67.63ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p>Benchmark tool range requests to <code>follower</code> with multiple client.</p><ul><li><p><code>mn-etcd-sz</code> latency(<code>~60.69ms</code>) is <strong>~20% lesser than</strong> <code>mn-etcd-mz</code>(<code>~70.76ms</code>).</p></li><li><p>Compare to <code>leader</code>, <code>follower</code> has lower read request latency.</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>follower-1</td><td style=text-align:center>11586.032</td><td style=text-align:center>60.69ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>follower-1</td><td style=text-align:center>14050.5</td><td style=text-align:center>70.76ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li><li><p><code>mn-etcd-sz</code> latency(<code>~86.09ms</code>) is <strong>~20 higher than</strong> <code>mn-etcd-mz</code>(<code>~64.6ms</code>).</p></li><li><ul><li>Compare to <code>mn-etcd-sz</code> consistency <code>Linearizable</code>, <code>Serializable</code> is <strong>~20% higher</strong>.*</li></ul></li><li><p>Compare to <code>mn-etcd-mz</code> consistency <code>Linearizable</code>, <code>Serializable</code> is <strong>~slightly less</strong>.</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>follower-1</td><td style=text-align:center>11582.438</td><td style=text-align:center>86.09ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>100000</td><td style=text-align:center>256</td><td style=text-align:center>100</td><td style=text-align:center>1000</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>follower-1</td><td style=text-align:center>15422.2</td><td style=text-align:center>64.6ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p>Benchmark tool range requests to <code>leader</code> all keys.</p><ul><li><p><code>sn-etcd-sz</code> latency(<code>~678.77ms</code>) is <strong>~5% slightly lesser than</strong> <code>mn-etcd-sz</code>(<code>~697.29ms</code>).</p></li><li><p><code>mn-etcd-sz</code> latency(<code>~697.29ms</code>) is less than <code>mn-etcd-mz</code>(<code>~701ms</code>) but the difference is negligible.</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>20</td><td style=text-align:center>256</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>6.8875</td><td style=text-align:center>678.77ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>20</td><td style=text-align:center>256</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>6.720</td><td style=text-align:center>697.29ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>20</td><td style=text-align:center>256</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>6.7</td><td style=text-align:center>701ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li><li><ul><li>Compare to consistency <code>Linearizable</code>, <code>Serializable</code> is <strong>~5% slightly higher</strong> for all cases</li></ul></li><li><p><code>sn-etcd-sz</code> latency(<code>~687.36ms</code>) is less than <code>mn-etcd-sz</code>(<code>~692.68ms</code>) but the difference is negligible.</p></li><li><p><code>mn-etcd-sz</code> latency(<code>~692.68ms</code>) is <strong>~5% slightly lesser than</strong> <code>mn-etcd-mz</code>(<code>~735.7ms</code>).</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>20</td><td style=text-align:center>256</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>6.76</td><td style=text-align:center>687.36ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>20</td><td style=text-align:center>256</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>6.635</td><td style=text-align:center>692.68ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>20</td><td style=text-align:center>256</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>6.3</td><td style=text-align:center>735.7ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p>Benchmark tool range requests to <code>follower</code> all keys</p><ul><li><p><code>mn-etcd-sz</code>(<code>~737.68ms</code>) latency is <strong>~5% slightly higher than</strong> <code>mn-etcd-mz</code>(<code>~713.7ms</code>).</p></li><li><p>Compare to <code>leader</code> consistency <code>Linearizable</code>read request, <code>follower</code> is <em>~5% slightly higher</em>.</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>20</td><td style=text-align:center>256</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>l</td><td style=text-align:center>follower-1</td><td style=text-align:center>6.163</td><td style=text-align:center>737.68ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>20</td><td style=text-align:center>256</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>l</td><td style=text-align:center>follower-1</td><td style=text-align:center>6.52</td><td style=text-align:center>713.7ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li><li><p><code>mn-etcd-sz</code> latency(<code>~757.73ms</code>) is <strong>~10% higher than</strong> <code>mn-etcd-mz</code>(<code>~690.4ms</code>).</p></li><li><p>Compare to <code>follower</code> consistency <code>Linearizable</code>read request, <code>follower</code> consistency <code>Serializable</code> is <em>~3% slightly higher</em> for <code>mn-etcd-sz</code>.</p></li><li><p><em>Compare to <code>follower</code> consistency <code>Linearizable</code>read request, <code>follower</code> consistency <code>Serializable</code> is <em>~5% less</em> for <code>mn-etcd-mz</code>.</em></p></li><li><p>*Compare to <code>leader</code> consistency <code>Serializable</code>read request, <code>follower</code> consistency <code>Serializable</code> is <em>~5% less</em> for <code>mn-etcd-mz</code>. *</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>20</td><td style=text-align:center>256</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>s</td><td style=text-align:center>follower-1</td><td style=text-align:center>6.0295</td><td style=text-align:center>757.73ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>20</td><td style=text-align:center>256</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>s</td><td style=text-align:center>follower-1</td><td style=text-align:center>6.87</td><td style=text-align:center>690.4ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li></ul><hr><br></details></li><li><details><summary>In this case benchmark tool tries to get specific key with random `1MB` value.</summary><ul><li><p>Benchmark tool range requests to <code>leader</code> with single client.</p><ul><li><p><code>sn-etcd-sz</code> latency(<code>~5.96ms</code>) is <strong>~5% lesser than</strong> <code>mn-etcd-sz</code>(<code>~6.28ms</code>).</p></li><li><p><code>mn-etcd-sz</code> latency(<code>~6.28ms</code>) is <strong>~10% higher than</strong> <code>mn-etcd-mz</code>(<code>~5.3ms</code>).</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>167.381</td><td style=text-align:center>5.96ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>158.822</td><td style=text-align:center>6.28ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>187.94</td><td style=text-align:center>5.3ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li><li><p>Compare to consistency <code>Linearizable</code>, <code>Serializable</code> is <strong>~15% less</strong> for <code>sn-etcd-sz</code>, <code>mn-etcd-sz</code>, <code>mn-etcd-mz</code></p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>184.95</td><td style=text-align:center>5.398ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>176.901</td><td style=text-align:center>5.64ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>209.99</td><td style=text-align:center>4.7ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p>Benchmark tool range requests to <code>follower</code> with single client.</p><ul><li><p><code>mn-etcd-sz</code> latency(<code>~6.66ms</code>) is <strong>~10% higher than</strong> <code>mn-etcd-mz</code>(<code>~6.16ms</code>).</p></li><li><p><em>Compare to <code>leader</code>, <code>follower</code> read request latency is <strong>~10% high</strong> for <code>mn-etcd-sz</code></em></p></li><li><p><em>Compare to <code>leader</code>, <code>follower</code> read request latency is <strong>~20% high</strong> for <code>mn-etcd-mz</code></em></p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>follower-1</td><td style=text-align:center>150.680</td><td style=text-align:center>6.66ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>follower-1</td><td style=text-align:center>162.072</td><td style=text-align:center>6.16ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li><li><p>Compare to consistency <code>Linearizable</code>, <code>Serializable</code> is <strong>~15% less</strong> for <code>mn-etcd-sz</code>(<code>~5.84ms</code>), <code>mn-etcd-mz</code>(<code>~5.01ms</code>).</p></li><li><p><em>Compare to <code>leader</code>, <code>follower</code> read request latency is <strong>~5% slightly high</strong> for <code>mn-etcd-sz</code>, <code>mn-etcd-mz</code></em></p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>follower-1</td><td style=text-align:center>170.918</td><td style=text-align:center>5.84ms</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>1</td><td style=text-align:center>1</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>follower-1</td><td style=text-align:center>199.01</td><td style=text-align:center>5.01ms</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p>Benchmark tool range requests to <code>leader</code> with multiple clients.</p><ul><li><code>sn-etcd-sz</code> latency(<code>~1.593secs</code>) is <strong>~20% lesser than</strong> <code>mn-etcd-sz</code>(<code>~1.974secs</code>).</li><li><code>mn-etcd-sz</code> latency(<code>~1.974secs</code>) is <strong>~5% greater than</strong> <code>mn-etcd-mz</code>(<code>~1.81secs</code>).</li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>500</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>252.149</td><td style=text-align:center>1.593secs</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>500</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>205.589</td><td style=text-align:center>1.974secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>500</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>230.42</td><td style=text-align:center>1.81secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p><em>Compare to consistency <code>Linearizable</code>, <code>Serializable</code> is <strong>more or less same</strong> for <code>sn-etcd-sz</code>(<code>~1.57961secs</code>), <code>mn-etcd-mz</code>(<code>~1.8secs</code>) not a big difference</em></p></li><li><p>Compare to consistency <code>Linearizable</code>, <code>Serializable</code> is <strong>~10% high</strong> for <code>mn-etcd-sz</code>(<code>~ 2.277secs</code>).</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>500</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>252.406</td><td style=text-align:center>1.57961secs</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>500</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>181.905</td><td style=text-align:center>2.277secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>500</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>227.64</td><td style=text-align:center>1.8secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li><li><p>Benchmark tool range requests to <code>follower</code> with multiple client.</p><ul><li><code>mn-etcd-sz</code> latency is <strong>~20% less than</strong> <code>mn-etcd-mz</code>.</li><li>Compare to <code>leader</code> consistency <code>Linearizable</code>, <code>follower</code> read request latency is ~15 less for <code>mn-etcd-sz</code>(<code>~1.694secs</code>).</li><li>Compare to <code>leader</code> consistency <code>Linearizable</code>, <code>follower</code> read request latency is ~10% higher for <code>mn-etcd-sz</code>(<code>~1.977secs</code>).</li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>500</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>follower-1</td><td style=text-align:center>248.489</td><td style=text-align:center>1.694secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>500</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>follower-1</td><td style=text-align:center>210.22</td><td style=text-align:center>1.977secs</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>500</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>follower-2</td><td style=text-align:center>205.765</td><td style=text-align:center>1.967secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-2</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>500</td><td style=text-align:center>true</td><td style=text-align:center>l</td><td style=text-align:center>follower-2</td><td style=text-align:center>195.2</td><td style=text-align:center>2.159secs</td><td style=text-align:center>eu-west-1b</td><td style=text-align:center>etcd-main-2</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table><ul><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>500</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>follower-1</td><td style=text-align:center>231.458</td><td style=text-align:center>1.7413secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>500</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>follower-1</td><td style=text-align:center>214.80</td><td style=text-align:center>1.907secs</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>500</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>follower-2</td><td style=text-align:center>183.320</td><td style=text-align:center>2.2810secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-2</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>1000</td><td style=text-align:center>1000000</td><td style=text-align:center>100</td><td style=text-align:center>500</td><td style=text-align:center>true</td><td style=text-align:center>s</td><td style=text-align:center>follower-2</td><td style=text-align:center>195.40</td><td style=text-align:center>2.164secs</td><td style=text-align:center>eu-west-1b</td><td style=text-align:center>etcd-main-2</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li><li><p>Benchmark tool range requests to <code>leader</code> all keys.</p><ul><li><p><code>sn-etcd-sz</code> latency(<code>~8.993secs</code>) is <strong>~3% slightly lower than</strong> <code>mn-etcd-sz</code>(<code>~9.236secs</code>).</p></li><li><p><code>mn-etcd-sz</code> latency(<code>~9.236secs</code>) is <strong>~2% slightly lower than</strong> <code>mn-etcd-mz</code>(<code>~9.100secs</code>).</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>20</td><td style=text-align:center>1000000</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>0.5139</td><td style=text-align:center>8.993secs</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>20</td><td style=text-align:center>1000000</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>0.506</td><td style=text-align:center>9.236secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>20</td><td style=text-align:center>1000000</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>l</td><td style=text-align:center>leader</td><td style=text-align:center>0.508</td><td style=text-align:center>9.100secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li><li><p>Compare to consistency <code>Linearizable</code>read request, <code>follower</code> for <code>sn-etcd-sz</code>(<code>~9.secs</code>) is <strong>a slight difference <code>10ms</code></strong>.</p></li><li><p>Compare to consistency <code>Linearizable</code>read request, <code>follower</code> for <code>mn-etcd-sz</code>(<code>~9.113secs</code>) is <strong>~1% less</strong>, not a big difference.</p></li><li><p>Compare to consistency <code>Linearizable</code>read request, <code>follower</code> for <code>mn-etcd-mz</code>(<code>~8.799secs</code>) is <strong>~3% less</strong>, not a big difference.</p></li><li><p><code>sn-etcd-sz</code> latency(<code>~9.secs</code>) is <strong>~1% slightly less than</strong> <code>mn-etcd-sz</code>(<code>~9.113secs</code>).</p></li><li><p><em><code>mn-etcd-sz</code> latency(<code>~9.113secs</code>) is <strong>~3% slightly higher than</strong> <code>mn-etcd-mz</code>(<code>~8.799secs</code>)</em>.</p><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>20</td><td style=text-align:center>1000000</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>0.51125</td><td style=text-align:center>9.0003secs</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>sn-etcd-sz</td></tr><tr><td style=text-align:center>20</td><td style=text-align:center>1000000</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>0.4993</td><td style=text-align:center>9.113secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>20</td><td style=text-align:center>1000000</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>s</td><td style=text-align:center>leader</td><td style=text-align:center>0.522</td><td style=text-align:center>8.799secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-1</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li><li><p>Benchmark tool range requests to <code>follower</code> all keys</p><ul><li><p><code>mn-etcd-sz</code> latency(<code>~9.065secs</code>) is <strong>~1% slightly higher than</strong> <code>mn-etcd-mz</code>(<code>~9.007secs</code>).</p></li><li><p>Compare to <code>leader</code> consistency <code>Linearizable</code>read request, <code>follower</code> is <em>~1% slightly higher</em> for both cases <code>mn-etcd-sz</code>, <code>mn-etcd-mz</code> .</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>20</td><td style=text-align:center>1000000</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>l</td><td style=text-align:center>follower-1</td><td style=text-align:center>0.512</td><td style=text-align:center>9.065secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>20</td><td style=text-align:center>1000000</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>l</td><td style=text-align:center>follower-1</td><td style=text-align:center>0.533</td><td style=text-align:center>9.007secs</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li><li><p>Compare to consistency <code>Linearizable</code>read request, <code>follower</code> for <code>mn-etcd-sz</code>(<code>~9.553secs</code>) is <strong>~5% high</strong>.</p></li><li><p><em>Compare to consistency <code>Linearizable</code>read request, <code>follower</code> for <code>mn-etcd-mz</code>(<code>~7.7433secs</code>) is <strong>~15% less</strong></em>.</p></li><li><p><em><code>mn-etcd-sz</code>(<code>~9.553secs</code>) latency is <strong>~20% higher than</strong> <code>mn-etcd-mz</code>(<code>~7.7433secs</code>)</em>.</p></li><li><table><thead><tr><th style=text-align:center>Number of requests</th><th style=text-align:center>Value size</th><th style=text-align:center>Number of connections</th><th style=text-align:center>Number of clients</th><th style=text-align:center>sequential-keys</th><th style=text-align:center>Consistency</th><th style=text-align:center>Target etcd server</th><th style=text-align:center>Average write QPS</th><th style=text-align:center>Average latency per request</th><th style=text-align:center>zone</th><th style=text-align:center>server name</th><th style=text-align:center>Test name</th></tr></thead><tbody><tr><td style=text-align:center>20</td><td style=text-align:center>1000000</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>s</td><td style=text-align:center>follower-1</td><td style=text-align:center>0.4743</td><td style=text-align:center>9.553secs</td><td style=text-align:center>eu-west-1a</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-sz</td></tr><tr><td style=text-align:center>20</td><td style=text-align:center>1000000</td><td style=text-align:center>2</td><td style=text-align:center>5</td><td style=text-align:center>false</td><td style=text-align:center>s</td><td style=text-align:center>follower-1</td><td style=text-align:center>0.5500</td><td style=text-align:center>7.7433secs</td><td style=text-align:center>eu-west-1c</td><td style=text-align:center>etcd-main-0</td><td style=text-align:center>mn-etcd-mz</td></tr></tbody></table></li></ul></li></ul><hr><br></details></li></ul><hr><br><br><blockquote><p>NOTE: This Network latency analysis is inspired by <a href=https://etcd.io/docs/v3.5/op-guide/performance/>etcd performance</a>.</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-48230a8cc284565a1dacea23838ecffd>2 - Local e2e Tests</h1><h1 id=e2e-test-suite>e2e Test Suite</h1><p>Developers can run extended e2e tests, in addition to unit tests, for Etcd-Druid in or from
their local environments. This is recommended to verify the desired behavior of several features
and to avoid regressions in future releases.</p><p>The very same tests typically run as part of the component&rsquo;s release job as well as on demand, e.g.,
when triggered by Etcd-Druid maintainers for open pull requests.</p><p>Testing Etcd-Druid automatically involves a certain test coverage for <a href=https://github.com/gardener/etcd-backup-restore/>gardener/etcd-backup-restore</a>
which is deployed as a side-car to the actual <code>etcd</code> container.</p><h2 id=prerequisites>Prerequisites</h2><p>The e2e test lifecycle is managed with the help of <a href=https://skaffold.dev/>skaffold</a>. Every involved step like <code>setup</code>,
<code>deploy</code>, <code>undeploy</code> or <code>cleanup</code> is executed against a <strong>Kubernetes</strong> cluster which makes it a mandatory prerequisite at the same time.
Only <a href=https://skaffold.dev/>skaffold</a> itself with involved <code>docker</code>, <code>helm</code> and <code>kubectl</code> executions as well as
the e2e-tests are executed locally. Required binaries are automatically downloaded if you use the corresponding <code>make</code> target,
as described in this document.</p><p>It&rsquo;s expected that especially the <code>deploy</code> step is run against a Kubernetes cluster which doesn&rsquo;t contain an Druid deployment or any left-overs like <code>druid.gardener.cloud</code> CRDs.
The <code>deploy</code> step will likely fail in such scenarios.</p><blockquote><p>Tip: Create a fresh <a href=https://kind.sigs.k8s.io/>KinD</a> cluster or a similar one with a small footprint before executing the tests.</p></blockquote><h2 id=providers>Providers</h2><p>The following providers are supported for e2e tests:</p><ul><li>AWS</li><li>Azure</li><li>GCP</li><li>Local</li></ul><blockquote><p>Valid credentials need to be provided when tests are executed with mentioned cloud providers.</p></blockquote><h2 id=flow>Flow</h2><p>An e2e test execution involves the following steps:</p><table><thead><tr><th>Step</th><th>Description</th></tr></thead><tbody><tr><td><code>setup</code></td><td>Create a storage bucket which is used for etcd backups (only with cloud providers).</td></tr><tr><td><code>deploy</code></td><td>Build Docker image, upload it to registry (if remote cluster - see <a href=https://skaffold.dev/docs/pipeline-stages/builders/docker/>Docker build</a>), deploy Helm chart (<code>charts/druid</code>) to Kubernetes cluster.</td></tr><tr><td><code>test</code></td><td>Execute e2e tests as defined in <code>test/e2e</code>.</td></tr><tr><td><code>undeploy</code></td><td>Remove the deployed artifacts from Kubernetes cluster.</td></tr><tr><td><code>cleanup</code></td><td>Delete storage bucket and Druid deployment from test cluster.</td></tr></tbody></table><h3 id=make-target>Make target</h3><p>Executing e2e-tests is as easy as executing the following command <strong>with defined Env-Vars as desribed in the following
section and as needed for your test scenario</strong>.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make test-e2e
</span></span></code></pre></div><h3 id=common-env-variables>Common Env Variables</h3><p>The following environment variables influence how the flow described above is executed:</p><ul><li><code>PROVIDERS</code>: Providers used for testing (<code>all</code>, <code>aws</code>, <code>azure</code>, <code>gcp</code>, <code>local</code>). Multiple entries must be comma separated.<blockquote><p><strong>Note</strong>: Some tests will use very first entry from env <code>PROVIDERS</code> for e2e testing (ex: multi-node tests). So for multi-node tests to use specific provider, specify that provider as first entry in env <code>PROVIDERS</code>.</p></blockquote></li><li><code>KUBECONFIG</code>: Kubeconfig pointing to cluster where Etcd-Druid will be deployed (preferably <a href=https://kind.sigs.k8s.io>KinD</a>).</li><li><code>TEST_ID</code>: Some ID which is used to create assets for and during testing.</li><li><code>STEPS</code>: Steps executed by <code>make</code> target (<code>setup</code>, <code>deploy</code>, <code>test</code>, <code>undeploy</code>, <code>cleanup</code> - default: all steps).</li></ul><h3 id=aws-env-variables>AWS Env Variables</h3><ul><li><code>AWS_ACCESS_KEY_ID</code>: Key ID of the user.</li><li><code>AWS_SECRET_ACCESS_KEY</code>: Access key of the user.</li><li><code>AWS_REGION</code>: Region in which the test bucket is created.</li></ul><p>Example:</p><pre tabindex=0><code>make \
  AWS_ACCESS_KEY_ID=&#34;abc&#34; \
  AWS_SECRET_ACCESS_KEY=&#34;xyz&#34; \
  AWS_REGION=&#34;eu-central-1&#34; \
  KUBECONFIG=&#34;$HOME/.kube/config&#34; \
  PROVIDERS=&#34;aws&#34; \
  TEST_ID=&#34;some-test-id&#34; \
  STEPS=&#34;setup,deploy,test,undeploy,cleanup&#34; \
test-e2e
</code></pre><h3 id=azure-env-variables>Azure Env Variables</h3><ul><li><code>STORAGE_ACCOUNT</code>: Storage account used for managing the storage container.</li><li><code>STORAGE_KEY</code>: Key of storage account.</li></ul><p>Example:</p><pre tabindex=0><code>make \
  STORAGE_ACCOUNT=&#34;abc&#34; \
  STORAGE_KEY=&#34;eHl6Cg==&#34; \
  KUBECONFIG=&#34;$HOME/.kube/config&#34; \
  PROVIDERS=&#34;azure&#34; \
  TEST_ID=&#34;some-test-id&#34; \
  STEPS=&#34;setup,deploy,test,undeploy,cleanup&#34; \
test-e2e
</code></pre><h3 id=gcp-env-variables>GCP Env Variables</h3><ul><li><code>GCP_SERVICEACCOUNT_JSON_PATH</code>: Path to the service account json file used for this test.</li><li><code>GCP_PROJECT_ID</code>: ID of the GCP project.</li></ul><p>Example:</p><pre tabindex=0><code>make \
  GCP_SERVICEACCOUNT_JSON_PATH=&#34;/var/lib/secrets/serviceaccount.json&#34; \
  GCP_PROJECT_ID=&#34;xyz-project&#34; \
  KUBECONFIG=&#34;$HOME/.kube/config&#34; \
  PROVIDERS=&#34;gcp&#34; \
  TEST_ID=&#34;some-test-id&#34; \
  STEPS=&#34;setup,deploy,test,undeploy,cleanup&#34; \
test-e2e
</code></pre><h3 id=local-env-variables>Local Env Variables</h3><p>No special environment variables are required for running e2e tests with <code>Local</code> provider.</p><p>Example:</p><pre tabindex=0><code>make \
  KUBECONFIG=&#34;$HOME/.kube/config&#34; \
  PROVIDERS=&#34;local&#34; \
  TEST_ID=&#34;some-test-id&#34; \
  STEPS=&#34;setup,deploy,test,undeploy,cleanup&#34; \
test-e2e
</code></pre><h2 id=e2e-test-with-localstack>e2e test with localstack</h2><p>The above-mentioned e2e tests need storage from real cloud providers to be setup. But there is a tool named <a href=https://docs.localstack.cloud/user-guide/aws/s3/>localstack</a> that enables to run e2e test with mock AWS storage. We can also provision KIND cluster for e2e tests. So, together with localstack and KIND cluster, we don&rsquo;t need to depend on any actual cloud provider infrastructure to be setup to run e2e tests.</p><h3 id=how-are-the-kind-cluster-and-localstack-set-up>How are the KIND cluster and localstack set up</h3><p>KIND or Kubernetes-In-Docker is a kubernetes cluster that is set up inside a docker container. This cluster is with limited capability as it does not have much compute power. But this cluster can easily be setup inside a container and can be tear down easily just by removing a container. That&rsquo;s why KIND cluster is very easy to use for e2e tests. <code>Makefile</code> command helps to spin up a KIND cluster and use the cluster to run e2e tests.</p><p>There is a docker image for localstack. The image is deployed as pod inside the KIND cluster through <code>hack/e2e-test/infrastructure/localstack/localstack.yaml</code>. <code>Makefile</code> takes care of deploying the yaml file in a KIND cluster.</p><p>The developer needs to run <code>make ci-e2e-kind</code> command. This command in turn runs <code>hack/ci-e2e-kind.sh</code> which spin up the KIND cluster and deploy localstack in it and then run the e2e tests using localstack as mock AWS storage provider. e2e tests are actually run on host machine but deploy the druid controller inside KIND cluster. Druid controller spawns multinode etcd clusters inside KIND cluster. e2e tests verify whether the druid controller performs its jobs correctly or not. Mock localstack storage is cleaned up after every e2e tests. That&rsquo;s why the e2e tests need to access the localstack pod running inside KIND cluster. The network traffic between host machine and localstack pod is resolved via mapping localstack pod port to host port while setting up the KIND cluster via <code>hack/e2e-test/infrastructure/kind/cluster.yaml</code></p><h3 id=how-to-execute-e2e-tests-with-localstack-and-kind-cluster>How to execute e2e tests with localstack and KIND cluster</h3><p>Run the following <code>make</code> command to spin up a KinD cluster, deploy localstack and run the e2e tests with provider <code>aws</code>:</p><pre tabindex=0><code>make ci-e2e-kind
</code></pre></div></main></div></div><footer class="footer row d-print-none"><div class="container-fluid footer-wrapper"><ul class=nav><li><a href=https://gardener.cloud/blog/>Blogs</a></li><li><a href=https://gardener.cloud/community/>Community</a></li><li><a href=https://gardener.cloud/adopter/>Adopters</a></li><li><a href=/docs/>Documentation</a></li></ul><img src=/images/lp/gardener-logo.svg alt="Logo Gardener" class=logo><ul class=media-wr><li><a target=_blank href=https://kubernetes.slack.com/archives/CB57N0BFG><img src=/images/branding/slack-logo-white.svg class=media-icon><div class=media-text>Slack</div></a></li><li><a target=_blank href=https://github.com/gardener><img src=/images/branding/github-mark-logo.png class=media-icon><div class=media-text>GitHub</div></a></li><li><a target=_blank href=https://www.youtube.com/channel/UCwUhwKFREV8Su0gwAJQX7tw><img src=/images/branding/youtube-logo-dark.svg class=media-icon><div class=media-text>YouTube</div></a></li><li><a target=_blank href=https://twitter.com/GardenerProject><img src=/images/branding/twitter-logo-white.svg class=media-icon><div class=media-text>Twitter</div></a></li></ul><span class=copyright>Copyright 2019-2023 Gardener project authors. <a href=https://www.sap.com/corporate/en/legal/privacy.html>Privacy policy
<i class="fa fa-external-link" aria-hidden=true></i></a></span></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid@8.13.4/dist/mermaid.min.js integrity="sha512-JERecFUBbsm75UpkVheAuDOE8NdHjQBrPACfEQYPwvPG+fjgCpHAz1Jw2ci9EXmd3DdfiWth3O3CQvcfEg8gsA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.7b24c0fb082ffb2de6cb14d6c95e9f8053053709ffcf8c761ef8e9ad2f8021e4.js integrity="sha256-eyTA+wgv+y3myxTWyV6fgFMFNwn/z4x2HvjprS+AIeQ=" crossorigin=anonymous></script></body></html>