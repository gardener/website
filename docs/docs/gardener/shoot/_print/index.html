<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://gardener.cloud/docs/gardener/shoot/><link rel=alternate type=application/rss+xml href=https://gardener.cloud/docs/gardener/shoot/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Shoot | Gardener</title>
<meta name=description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta property="og:url" content="https://gardener.cloud/docs/gardener/shoot/"><meta property="og:site_name" content="Gardener"><meta property="og:title" content="Shoot"><meta property="og:description" content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta property="og:locale" content="en_US"><meta property="og:type" content="website"><meta property="og:image" content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta itemprop=name content="Shoot"><meta itemprop=description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta itemprop=image content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta name=twitter:title content="Shoot"><meta name=twitter:description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><link rel=preload href=/scss/main.min.a0c8c4899ce282dcbb2306a0b99a4fae18db6c239ce7b3bc375f59e6ee82bdad.css as=style integrity="sha256-oMjEiZzigty7IwaguZpPrhjbbCOc57O8N19Z5u6Cva0=" crossorigin=anonymous><link href=/scss/main.min.a0c8c4899ce282dcbb2306a0b99a4fae18db6c239ce7b3bc375f59e6ee82bdad.css rel=stylesheet integrity="sha256-oMjEiZzigty7IwaguZpPrhjbbCOc57O8N19Z5u6Cva0=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg width="90" height="90" viewBox="0 0 90 90" xmlns:xlink="http://www.w3.org/1999/xlink"><title>logo</title><desc>Created with Sketch.</desc><defs><path d="M41.8864954.994901575c.996545099999999-.479910833 2.6164002-.477918931 3.6088091.0L76.8159138 16.0781121C77.8124589 16.5580229 78.8208647 17.8257185 79.0659694 18.8995926l7.7355517 33.8916663C87.0476474 53.8696088 86.6852538 55.4484075 85.9984855 56.3095876L64.3239514 83.4885938C63.6343208 84.3533632 62.1740175 85.0543973 61.0725268 85.0543973H26.3092731c-1.1060816.0-2.5646564-.704623400000003-3.2514246-1.5658035L1.38331434 56.3095876C.693683723 55.4448182.335174016 53.865133.580278769 52.7912589L8.31583044 18.8995926C8.56195675 17.8212428 9.57347722 16.556031 10.5658861 16.0781121L41.8864954.994901575z" id="path-1"/><linearGradient x1="12.7542673%" y1="-18.6617048%" x2="88.2666158%" y2="84.6075483%" id="linearGradient-3"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="50%" y1="4.93673768%" x2="148.756007%" y2="175.514523%" id="linearGradient-4"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="19.1574381%" y1="-9.04800713%" x2="82.2203149%" y2="77.9084293%" id="linearGradient-5"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="57.4403751%" y1="26.3148481%" x2="137.966711%" y2="158.080556%" id="linearGradient-6"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="logo"><g id="Rectangle-2" transform="translate(1.000000, 0.000000)"><mask id="mask-2" fill="#fff"><use xlink:href="#path-1"/></mask><use id="Mask" fill="#009f76" xlink:href="#path-1"/><polygon fill="#000" opacity=".289628623" mask="url(#mask-2)" points="-17.6484375 54.5224609 30.8242188 25.0791016 63.4726562 58.5 24.7324219 92.6689453"/></g><path d="M56.8508631 39.260019C56.4193519 40.443987 55.6088085 41.581593 54.6736295 42.1938694l-8.0738997 5.2861089c-1.3854671.907087099999998-3.6247515.9116711-5.0172201.0L33.50861 42.1938694C32.123143 41.2867823 31 39.206345 31 37.545932V26.4150304c0-.725313.2131118-1.5301454.569268099999999-2.2825772L56.8508631 39.260019z" id="Combined-Shape" fill="url(#linearGradient-3)" transform="translate(43.925432, 36.147233) scale(-1, 1) translate(-43.925432, -36.147233)"/><path d="M56.0774672 25.1412464C56.4306829 25.8903325 56.6425556 26.6907345 56.6425556 27.4119019V38.5428034c0 1.6598979-1.1161415 3.73626640000001-2.50861 4.6479374l-8.0738997 5.286109c-1.3854671.907087000000004-3.6247516.911671000000005-5.0172201.0L32.9689261 43.1907408C32.2918101 42.7474223 31.6773514 42.0238435 31.2260376 41.206007L56.0774672 25.1412464z" id="Combined-Shape" fill="url(#linearGradient-4)" transform="translate(43.821278, 37.246598) scale(-1, 1) translate(-43.821278, -37.246598)"/><path d="M65.0702134 57.1846889C64.5985426 58.2007851 63.8367404 59.1236871 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.1597438 58.7930183 24 56.7816693 24 55.1323495V37.1145303C24 36.3487436 24.249712 35.5060005 24.6599102 34.7400631L65.0702134 57.1846889z" id="Combined-Shape" fill="url(#linearGradient-5)"/><path d="M65.0189476 34.954538C65.3636909 35.6617313 65.5692194 36.42021 65.5692194 37.1145303V55.1323495C65.5692194 56.7842831 64.4072119 58.7943252 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.9237304 59.2341061 25.3159155 58.5918431 24.8568495 57.8487596L65.0189476 34.954538z" id="Combined-Shape" fill="url(#linearGradient-6)"/></g></g></svg></span><span class=navbar-brand__name>Gardener</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://demo.gardener.cloud target=_blank rel=noopener><span>Demo</span></a></li><li class=nav-item><a class=nav-link href=/adopter><span>Adopters</span></a></li><li class=nav-item><a class=nav-link href=/docs><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/blog><span>Blogs</span></a></li><li class=nav-item><a class=nav-link href=/community><span>Community</span></a></li><li class=nav-item><a class=nav-link href=https://join.slack.com/t/gardener-cloud/shared_invite/zt-33c9daems-3oOorhnqOSnldZPWqGmIBw target=_blank rel=noopener><span>Join us on</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.337429dc093bf8913965bee6259fbc21.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/gardener/shoot/>Return to the regular view of this page</a>.</p></div><h1 class=title>Shoot</h1><div class=content></div></div><div class=td-content><h1 id=pg-1906b3f6af78919a9542e612d3cec356>1 - Access Restrictions</h1><h1 id=access-restrictions>Access Restrictions<a class=td-heading-self-link href=#access-restrictions aria-label="Heading self-link"></a></h1><p>Access restrictions can be configured in the <code>CloudProfile</code>, <code>Seed</code>, and <code>Shoot</code> APIs.
They can be used to implement access restrictions for seed and shoot clusters (e.g., if you want to ensure &ldquo;EU access&rdquo;-only or similar policies).</p><h2 id=cloudprofile><code>CloudProfile</code><a class=td-heading-self-link href=#cloudprofile aria-label="Heading self-link"></a></h2><p>The <code>.spec.regions</code> list contains all regions that can be selected by <code>Shoot</code>s.
Operators can configure them with a list of access restrictions that apply for each region, for example:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  regions:
</span></span><span style=display:flex><span>  - name: europe-central-1
</span></span><span style=display:flex><span>    accessRestrictions:
</span></span><span style=display:flex><span>    - name: eu-access-only
</span></span><span style=display:flex><span>  - name: us-west-1
</span></span></code></pre></div><p>This configuration means that <code>Shoot</code>s selecting the <code>europe-central-1</code> region <strong>can</strong> configure an <code>eu-access-only</code> access restriction.
<code>Shoot</code>s running in other regions cannot configure this access restriction in their specification.</p><h2 id=seed><code>Seed</code><a class=td-heading-self-link href=#seed aria-label="Heading self-link"></a></h2><p>The <code>Seed</code> specification also allows to configure access restrictions that apply for this specific seed cluster, for example:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  accessRestrictions:
</span></span><span style=display:flex><span>  - name: eu-access-only
</span></span></code></pre></div><p>This configuration means that this seed cluster can host shoot clusters that also have the <code>eu-access-only</code> access restriction.
In addition, this seed cluster can also host shoot clusters without any access restrictions at all.</p><h2 id=shoot><code>Shoot</code><a class=td-heading-self-link href=#shoot aria-label="Heading self-link"></a></h2><p>If the <code>CloudProfile</code> allows to configure access restrictions for the selected <code>.spec.region</code> in the <code>Shoot</code> (see <a href=/docs/gardener/shoot/access_restrictions/#cloudprofile>above</a>), then they can also be provided in the specification of the <code>Shoot</code>, for example:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  region: europe-central-1
</span></span><span style=display:flex><span>  accessRestrictions:
</span></span><span style=display:flex><span>  - name: eu-access-only
</span></span><span style=display:flex><span><span style=color:green>#   options:</span>
</span></span><span style=display:flex><span><span style=color:green>#     support.gardener.cloud/eu-access-for-cluster-addons: &#34;false&#34;</span>
</span></span><span style=display:flex><span><span style=color:green>#     support.gardener.cloud/eu-access-for-cluster-nodes: &#34;true&#34;</span>
</span></span></code></pre></div><p>In addition, it is possible to specify arbitrary options (key-value pairs) for the access restriction.
These options are not interpreted by Gardener, but can be helpful when evaluated by other tools (e.g., <a href=https://github.com/gardener/gardenctl-v2><code>gardenctl</code></a> implements some of them).</p><p>Above configuration means that the <code>Shoot</code> shall only be accessible by operators in the EU.
When configured for</p><ul><li>a newly created <code>Shoot</code>, <code>gardener-scheduler</code> will automatically filter for <code>Seed</code>s also supporting this access restriction.
All other <code>Seed</code>s are not considered for scheduling.</li><li>an existing <code>Shoot</code>, <code>gardener-apiserver</code> will allow removing access restrictions, but adding them is only possible if the currently selected <code>Seed</code> supports them.
If it does not support them, the <code>Shoot</code> must first be migrated to another eligible <code>Seed</code> before they can be added.</li><li>an existing <code>Shoot</code> that is migrated, <code>gardener-apiserver</code> will only allow the migration in case the targeted <code>Seed</code> also supports the access restrictions configured on the <code>Shoot</code>.</li></ul><blockquote class="alert alert-important"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>message-outline</title><path d="M20 2H4C2.9 2 2 2.9 2 4V22l4-4H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2m0 14H5.2L4 17.2V4H20V16z"/></svg><p>Important</p></div><p>There is no technical enforcement of these access restrictions - they are purely informational.
Hence, it is the responsibility of the operator to ensure that they enforce the configured access restrictions.</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-5c5f5eb5d5aeb385d1e8f49739650b83>2 - Accessing Shoot Clusters</h1><h1 id=accessing-shoot-clusters>Accessing Shoot Clusters<a class=td-heading-self-link href=#accessing-shoot-clusters aria-label="Heading self-link"></a></h1><p>After creation of a shoot cluster, end-users require a <code>kubeconfig</code> to access it. There are several options available to get to such <code>kubeconfig</code>.</p><h2 id=shootsadminkubeconfig-subresource><code>shoots/adminkubeconfig</code> Subresource<a class=td-heading-self-link href=#shootsadminkubeconfig-subresource aria-label="Heading self-link"></a></h2><p>The <a href=https://github.com/gardener/gardener/blob/master/docs/proposals/16-adminkubeconfig-subresource.md><code>shoots/adminkubeconfig</code></a> subresource allows users to dynamically generate temporary <code>kubeconfig</code>s that can be used to access shoot cluster with <code>cluster-admin</code> privileges. The credentials associated with this <code>kubeconfig</code> are client certificates which have a very short validity and must be renewed before they expire (by calling the subresource endpoint again).</p><p>The username associated with such <code>kubeconfig</code> will be the same which is used for authenticating to the Gardener API. Apart from this advantage, the created <code>kubeconfig</code> will not be persisted anywhere.</p><p>In order to request such a <code>kubeconfig</code>, you can run the following commands (targeting the garden cluster):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export NAMESPACE=garden-my-namespace
</span></span><span style=display:flex><span>export SHOOT_NAME=my-shoot
</span></span><span style=display:flex><span>export KUBECONFIG=&lt;kubeconfig <span style=color:#00f>for</span> garden cluster&gt;  <span style=color:green># can be set using &#34;gardenctl target --garden &lt;landscape&gt;&#34;</span>
</span></span><span style=display:flex><span>kubectl create <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    -f &lt;(printf <span style=color:#a31515>&#39;{&#34;spec&#34;:{&#34;expirationSeconds&#34;:600}}&#39;</span>) <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --raw /apis/core.gardener.cloud/v1beta1/namespaces/<span style=color:#a31515>${</span>NAMESPACE<span style=color:#a31515>}</span>/shoots/<span style=color:#a31515>${</span>SHOOT_NAME<span style=color:#a31515>}</span>/adminkubeconfig | <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    jq -r <span style=color:#a31515>&#34;.status.kubeconfig&#34;</span> | <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    base64 -d
</span></span></code></pre></div><p>You also can use controller-runtime <code>client</code> (>= v0.14.3) to create such a kubeconfig from your go code like so:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>expiration := 10 * time.Minute
</span></span><span style=display:flex><span>expirationSeconds := int64(expiration.Seconds())
</span></span><span style=display:flex><span>adminKubeconfigRequest := &amp;authenticationv1alpha1.AdminKubeconfigRequest{
</span></span><span style=display:flex><span>  Spec: authenticationv1alpha1.AdminKubeconfigRequestSpec{
</span></span><span style=display:flex><span>    ExpirationSeconds: &amp;expirationSeconds,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>err := client.SubResource(<span style=color:#a31515>&#34;adminkubeconfig&#34;</span>).Create(ctx, shoot, adminKubeconfigRequest)
</span></span><span style=display:flex><span><span style=color:#00f>if</span> err != <span style=color:#00f>nil</span> {
</span></span><span style=display:flex><span>  <span style=color:#00f>return</span> err
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>config = adminKubeconfigRequest.Status.Kubeconfig
</span></span></code></pre></div><p>In Python, you can use the native <a href=https://github.com/kubernetes-client/python><code>kubernetes</code> client</a> to create such a kubeconfig like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:green># This script first loads an existing kubeconfig from your system, and then sends a request to the Gardener API to create a new kubeconfig for a shoot cluster. </span>
</span></span><span style=display:flex><span><span style=color:green># The received kubeconfig is then decoded and a new API client is created for interacting with the shoot cluster.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00f>import</span> base64
</span></span><span style=display:flex><span><span style=color:#00f>import</span> json
</span></span><span style=display:flex><span><span style=color:#00f>from</span> kubernetes <span style=color:#00f>import</span> client, config
</span></span><span style=display:flex><span><span style=color:#00f>import</span> yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># Set configuration options</span>
</span></span><span style=display:flex><span>shoot_name=<span style=color:#a31515>&#34;my-shoot&#34;</span> <span style=color:green># Name of the shoot</span>
</span></span><span style=display:flex><span>project_namespace=<span style=color:#a31515>&#34;garden-my-namespace&#34;</span> <span style=color:green># Namespace of the project</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># Load kubeconfig from default ~/.kube/config</span>
</span></span><span style=display:flex><span>config.load_kube_config()
</span></span><span style=display:flex><span>api = client.ApiClient()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># Create kubeconfig request</span>
</span></span><span style=display:flex><span>kubeconfig_request = {
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#39;apiVersion&#39;</span>: <span style=color:#a31515>&#39;authentication.gardener.cloud/v1alpha1&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#39;kind&#39;</span>: <span style=color:#a31515>&#39;AdminKubeconfigRequest&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#39;spec&#39;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#a31515>&#39;expirationSeconds&#39;</span>: 600
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>response = api.call_api(resource_path=<span style=color:#a31515>f</span><span style=color:#a31515>&#39;/apis/core.gardener.cloud/v1beta1/namespaces/</span><span style=color:#a31515>{</span>project_namespace<span style=color:#a31515>}</span><span style=color:#a31515>/shoots/</span><span style=color:#a31515>{</span>shoot_name<span style=color:#a31515>}</span><span style=color:#a31515>/adminkubeconfig&#39;</span>,
</span></span><span style=display:flex><span>                        method=<span style=color:#a31515>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>                        body=kubeconfig_request,
</span></span><span style=display:flex><span>                        auth_settings=[<span style=color:#a31515>&#39;BearerToken&#39;</span>],
</span></span><span style=display:flex><span>                        _preload_content=<span style=color:#00f>False</span>,
</span></span><span style=display:flex><span>                        _return_http_data_only=<span style=color:#00f>True</span>,
</span></span><span style=display:flex><span>                       )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>decoded_kubeconfig = base64.b64decode(json.loads(response.data)[<span style=color:#a31515>&#34;status&#34;</span>][<span style=color:#a31515>&#34;kubeconfig&#34;</span>]).decode(<span style=color:#a31515>&#39;utf-8&#39;</span>)
</span></span><span style=display:flex><span>print(decoded_kubeconfig)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># Create an API client to interact with the shoot cluster</span>
</span></span><span style=display:flex><span>shoot_api_client = config.new_client_from_config_dict(yaml.safe_load(decoded_kubeconfig))
</span></span><span style=display:flex><span>v1 = client.CoreV1Api(shoot_api_client)
</span></span></code></pre></div><blockquote><p><strong>Note:</strong> The <a href=https://github.com/gardener/gardenctl-v2><code>gardenctl-v2</code></a> tool simplifies targeting shoot clusters. It automatically downloads a kubeconfig that uses the <a href=https://github.com/gardener/gardenlogin>gardenlogin</a> kubectl auth plugin. This transparently manages authentication and certificate renewal without containing any credentials.</p></blockquote><h2 id=shootsviewerkubeconfig-subresource><code>shoots/viewerkubeconfig</code> Subresource<a class=td-heading-self-link href=#shootsviewerkubeconfig-subresource aria-label="Heading self-link"></a></h2><p>The <code>shoots/viewerkubeconfig</code> subresource works similar to the <a href=/docs/gardener/shoot/shoot_access/#shootsadminkubeconfig-subresource><code>shoots/adminkubeconfig</code></a>.
The difference is that it returns a kubeconfig with read-only access for all APIs except the <code>core/v1.Secret</code> API and the resources which are specified in the <code>spec.kubernetes.kubeAPIServer.encryptionConfig</code> field in the Shoot (see <a href=/docs/gardener/security/etcd_encryption_config/>this document</a>).</p><p>In order to request such a <code>kubeconfig</code>, you can run follow almost the same code as above - the only difference is that you need to use the <code>viewerkubeconfig</code> subresource.
For example, in bash this looks like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export NAMESPACE=garden-my-namespace
</span></span><span style=display:flex><span>export SHOOT_NAME=my-shoot
</span></span><span style=display:flex><span>kubectl create <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    -f &lt;(printf <span style=color:#a31515>&#39;{&#34;spec&#34;:{&#34;expirationSeconds&#34;:600}}&#39;</span>) <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --raw /apis/core.gardener.cloud/v1beta1/namespaces/<span style=color:#a31515>${</span>NAMESPACE<span style=color:#a31515>}</span>/shoots/<span style=color:#a31515>${</span>SHOOT_NAME<span style=color:#a31515>}</span>/viewerkubeconfig | <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    jq -r <span style=color:#a31515>&#34;.status.kubeconfig&#34;</span> | <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    base64 -d
</span></span></code></pre></div><p>The examples for other programming languages are similar to <a href=/docs/gardener/shoot/shoot_access/#shootsadminkubeconfig-subresource>the above</a> and can be adapted accordingly.</p><blockquote class="alert alert-tip"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>lightbulb-on-outline</title><path d="M20 11h3v2H20V11M1 11H4v2H1V11M13 1V4H11V1h2M4.92 3.5 7.05 5.64 5.63 7.05 3.5 4.93 4.92 3.5M16.95 5.63 19.07 3.5 20.5 4.93 18.37 7.05 16.95 5.63M12 6a6 6 0 016 6c0 2.22-1.21 4.16-3 5.2V19a1 1 0 01-1 1H10A1 1 0 019 19V17.2C7.21 16.16 6 14.22 6 12a6 6 0 016-6m2 15v1a1 1 0 01-1 1H11a1 1 0 01-1-1V21h4m-3-3h2V15.87c1.73-.44 3-2.01 3-3.87A4 4 0 0012 8 4 4 0 008 12c0 1.86 1.27 3.43 3 3.87V18z"/></svg><p>Tip</p></div><p>If the Gardener operator has configured a <a href=/docs/gardener/trusted-tls-for-control-planes/#register-a-trusted-wildcard-certificate>&ldquo;control plane wildcard certificate&rdquo;</a>, the issued kubeconfigs have a dedicated <code>Cluster</code> entry containing an endpoint that is served with this wildcard certificate.
This could be a generally trusted certificate, e.g. from <a href=https://letsencrypt.org>Let&rsquo;s Encrypt</a> or a similar certificate authority, i.e., it does not require you to specify the certificate authority bundle.</p><p>⚠️ This endpoint is specific to the seed cluster your <code>Shoot</code> is scheduled to, i.e., if the seed cluster changes (<code>.spec.seedName</code>, for example because of a <a href=/docs/gardener/control_plane_migration/>control plane migration</a>), the endpoint changes as well. Have this in mind in case you consider using it!</p></blockquote><h2 id=structured-authentication>Structured Authentication<a class=td-heading-self-link href=#structured-authentication aria-label="Heading self-link"></a></h2><p>For shoots with Kubernetes version <code>>= 1.30</code>, which have <code>StructuredAuthenticationConfiguration</code> feature gate enabled (enabled by default), <code>kube-apiserver</code> of shoot clusters can be provided with <a href=https://kubernetes.io/docs/reference/access-authn-authz/authentication/#using-authentication-configuration>Structured Authentication configuration</a> via the Shoot spec:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>kind: Shoot
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  kubernetes:
</span></span><span style=display:flex><span>    kubeAPIServer:
</span></span><span style=display:flex><span>      structuredAuthentication:
</span></span><span style=display:flex><span>        configMapName: name-of-configmap-containing-authentication-config
</span></span></code></pre></div><p>The <code>configMapName</code> references a user created <code>ConfigMap</code> in the project namespace containing the <code>AuthenticationConfiguration</code> in it&rsquo;s <code>config.yaml</code> data field.
Here is an example of such <code>ConfigMap</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: ConfigMap
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: name-of-configmap-containing-authentication-config
</span></span><span style=display:flex><span>  namespace: garden-my-project
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  config.yaml: |<span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515>    apiVersion: apiserver.config.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#a31515>    kind: AuthenticationConfiguration
</span></span></span><span style=display:flex><span><span style=color:#a31515>    jwt:
</span></span></span><span style=display:flex><span><span style=color:#a31515>    - issuer:
</span></span></span><span style=display:flex><span><span style=color:#a31515>        url: https://issuer1.example.com
</span></span></span><span style=display:flex><span><span style=color:#a31515>        audiences:
</span></span></span><span style=display:flex><span><span style=color:#a31515>        - audience1
</span></span></span><span style=display:flex><span><span style=color:#a31515>        - audience2
</span></span></span><span style=display:flex><span><span style=color:#a31515>        audienceMatchPolicy: MatchAny
</span></span></span><span style=display:flex><span><span style=color:#a31515>      claimMappings:
</span></span></span><span style=display:flex><span><span style=color:#a31515>        username:
</span></span></span><span style=display:flex><span><span style=color:#a31515>          expression: &#39;claims.username&#39;
</span></span></span><span style=display:flex><span><span style=color:#a31515>        groups:
</span></span></span><span style=display:flex><span><span style=color:#a31515>          expression: &#39;claims.groups&#39;
</span></span></span><span style=display:flex><span><span style=color:#a31515>        uid:
</span></span></span><span style=display:flex><span><span style=color:#a31515>          expression: &#39;claims.uid&#39;
</span></span></span><span style=display:flex><span><span style=color:#a31515>      claimValidationRules:
</span></span></span><span style=display:flex><span><span style=color:#a31515>      - expression: &#39;claims.hd == &#34;example.com&#34;&#39;
</span></span></span><span style=display:flex><span><span style=color:#a31515>        message: &#34;the hosted domain name must be example.com&#34;</span>    
</span></span></code></pre></div><p>The user is responsible for the validity of the configured <code>JWTAuthenticator</code>s.
Be aware that changing the configuration in the <code>ConfigMap</code> will be applied in the next <code>Shoot</code> reconciliation, but this is not automatically triggered.
If you want the changes to roll out immediately, <a href=/docs/gardener/shoot-operations/shoot_operations/#immediate-reconciliation>trigger a reconciliation explicitly</a>.</p><h2 id=structured-authorization>Structured Authorization<a class=td-heading-self-link href=#structured-authorization aria-label="Heading self-link"></a></h2><p>For shoots with Kubernetes version <code>>= 1.30</code>, which have <code>StructuredAuthorizationConfiguration</code> feature gate enabled (enabled by default), <code>kube-apiserver</code> of shoot clusters can be provided with <a href=https://kubernetes.io/docs/reference/access-authn-authz/authorization/#using-configuration-file-for-authorization>Structured Authorization configuration</a> via the Shoot spec:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>kind: Shoot
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  kubernetes:
</span></span><span style=display:flex><span>    kubeAPIServer:
</span></span><span style=display:flex><span>      structuredAuthorization:
</span></span><span style=display:flex><span>        configMapName: name-of-configmap-containing-authorization-config
</span></span><span style=display:flex><span>        kubeconfigs:
</span></span><span style=display:flex><span>        - authorizerName: my-webhook
</span></span><span style=display:flex><span>          secretName: webhook-kubeconfig
</span></span></code></pre></div><p>The <code>configMapName</code> references a user created <code>ConfigMap</code> in the project namespace containing the <code>AuthorizationConfiguration</code> in it&rsquo;s <code>config.yaml</code> data field.
Here is an example of such <code>ConfigMap</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: ConfigMap
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: name-of-configmap-containing-authorization-config
</span></span><span style=display:flex><span>  namespace: garden-my-project
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  config.yaml: |<span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515>    apiVersion: apiserver.config.k8s.io/v1beta1
</span></span></span><span style=display:flex><span><span style=color:#a31515>    kind: AuthorizationConfiguration
</span></span></span><span style=display:flex><span><span style=color:#a31515>    authorizers:
</span></span></span><span style=display:flex><span><span style=color:#a31515>    - type: Webhook
</span></span></span><span style=display:flex><span><span style=color:#a31515>      name: my-webhook
</span></span></span><span style=display:flex><span><span style=color:#a31515>      webhook:
</span></span></span><span style=display:flex><span><span style=color:#a31515>        timeout: 3s
</span></span></span><span style=display:flex><span><span style=color:#a31515>        subjectAccessReviewVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#a31515>        matchConditionSubjectAccessReviewVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#a31515>        failurePolicy: Deny
</span></span></span><span style=display:flex><span><span style=color:#a31515>        matchConditions:
</span></span></span><span style=display:flex><span><span style=color:#a31515>        - expression: request.resourceAttributes.namespace == &#39;kube-system&#39;</span>    
</span></span></code></pre></div><p>In addition, it is required to provide a <code>Secret</code> for each authorizer.
This <code>Secret</code> should contain a kubeconfig with the server address of the webhook server, and optionally credentials for authentication:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Secret
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: webhook-kubeconfig
</span></span><span style=display:flex><span>  namespace: garden-my-project
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  kubeconfig: &lt;base64-encoded-kubeconfig-for-authz-webhook&gt;
</span></span></code></pre></div><p>The user is responsible for the validity of the configured authorizers.
Be aware that changing the configuration in the <code>ConfigMap</code> will be applied in the next <code>Shoot</code> reconciliation, but this is not automatically triggered.
If you want the changes to roll out immediately, <a href=/docs/gardener/shoot-operations/shoot_operations/#immediate-reconciliation>trigger a reconciliation explicitly</a>.</p><blockquote class="alert alert-note"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>information-outline</title><path d="M11 9h2V7H11m1 13c-4.41.0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2M11 17h2V11H11v6z"/></svg><p>Note</p></div><p>You can have one or more authorizers of type <code>Webhook</code> (no other types are supported).</p><p>You are not allowed to specify the <code>authorizers[].webhook.connectionInfo</code> field.
Instead, as mentioned above, provide a kubeconfig file containing the server address (and optionally, credentials that can be used by <code>kube-apiserver</code> in order to authenticate with the webhook server) by creating a <code>Secret</code> containing the kubeconfig (in the <code>.data.kubeconfig</code> key).
Reference this <code>Secret</code> by adding it to <code>.spec.kubernetes.kubeAPIServer.structuredAuthorization.kubeconfigs[]</code> (choose the proper <code>authorizerName</code>, see example above).</p></blockquote><p>Be aware of the fact that all webhook authorizers are added only after the <code>RBAC</code>/<code>Node</code> authorizers.
Hence, if RBAC already allows a request, your webhook authorizer might not get called.</p><h2 id=openid-connect>OpenID Connect<a class=td-heading-self-link href=#openid-connect aria-label="Heading self-link"></a></h2><blockquote class="alert alert-warning"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>alert-outline</title><path d="M12 2 1 21H23M12 6l7.53 13H4.47M11 10v4h2V10m-2 6v2h2V16"/></svg><p>Warning</p></div><p>OpenID Connect is deprecated in favor of <a href=/docs/gardener/shoot/shoot_access/#structured-authentication>Structured Authentication configuration</a>. Setting OpenID Connect configurations is forbidden for clusters with Kubernetes version <code>>= 1.32</code>.</p></blockquote><p>The <code>kube-apiserver</code> of shoot clusters can be provided with <a href=https://kubernetes.io/docs/reference/access-authn-authz/authentication/#openid-connect-tokens>OpenID Connect configuration</a> via the Shoot spec:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>kind: Shoot
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  kubernetes:
</span></span><span style=display:flex><span>    oidcConfig:
</span></span><span style=display:flex><span>      ...
</span></span></code></pre></div><p>It is the end-user&rsquo;s responsibility to incorporate the OpenID Connect configurations in the <code>kubeconfig</code> for accessing the cluster (i.e., Gardener will not automatically generate the <code>kubeconfig</code> based on these OIDC settings).
The recommended way is using the <code>kubectl</code> plugin called <a href=https://github.com/int128/kubelogin><code>kubectl oidc-login</code></a> for OIDC authentication.</p><p>If you want to use the same OIDC configuration for all your shoots by default, then you can use the <code>ClusterOpenIDConnectPreset</code> and <code>OpenIDConnectPreset</code> API resources. They allow defaulting the <code>.spec.kubernetes.kubeAPIServer.oidcConfig</code> fields for newly created <code>Shoot</code>s such that you don&rsquo;t have to repeat yourself every time (similar to <code>PodPreset</code> resources in Kubernetes).
<code>ClusterOpenIDConnectPreset</code> specified OIDC configuration applies to <code>Projects</code> and <code>Shoots</code> cluster-wide (hence, only available to Gardener operators), while <code>OpenIDConnectPreset</code> is <code>Project</code>-scoped.
Shoots have to &ldquo;opt-in&rdquo; for such defaulting by using the <code>oidc=enable</code> label.</p><p>For further information on <code>(Cluster)OpenIDConnectPreset</code>, refer to <a href=/docs/gardener/security/openidconnect-presets/>ClusterOpenIDConnectPreset and OpenIDConnectPreset</a>.</p><p>For shoots with Kubernetes version <code>>= 1.30</code>, which have <code>StructuredAuthenticationConfiguration</code> feature gate enabled (enabled by default), it is advised to use Structured Authentication instead of configuring <code>.spec.kubernetes.kubeAPIServer.oidcConfig</code>.
If <code>oidcConfig</code> is configured, it is translated into an <code>AuthenticationConfiguration</code> file to use for <a href=https://kubernetes.io/docs/reference/access-authn-authz/authentication/#using-authentication-configuration>Structured Authentication configuration</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f289dab5cf317642d3bd5f5cf9552ecc>3 - Shoot Cluster Limits</h1><h1 id=shoot-cluster-limits>Shoot Cluster Limits<a class=td-heading-self-link href=#shoot-cluster-limits aria-label="Heading self-link"></a></h1><p>Gardener operators can configure limits for shoot clusters in the <code>CloudProfile.spec.limits</code> section, where they can also be looked up by shoot owners.
The limits are enforced on all shoot clusters using the respective <code>CloudProfile</code>.
If a certain limit is not configured, no limit is enforced.</p><p>The configured limits of a <code>CloudProfile</code> can be overridden by configuring limits in a <code>NamespacedCloudProfile</code>.
To increase a <code>CloudProfile</code> limit, a user must have permission by the appropriate custom verbs.
Setting a stricter limit is always allowed without requiring special permissions.
For more information, see the <a href=/docs/gardener/project/namespaced-cloud-profiles/#field-modification-restrictions>NamespacedCloudProfile documentation</a>.</p><p>This document explains the limits that can be configured in the <code>CloudProfile</code>.</p><h2 id=maximum-node-count>Maximum Node Count<a class=td-heading-self-link href=#maximum-node-count aria-label="Heading self-link"></a></h2><p>The <code>CloudProfile.spec.limits.maxNodesTotal</code> configures the maximum supported node count of shoot clusters in a Gardener installation.</p><p>If this limit is set, Gardener ensures that</p><ul><li>the total minimum node count of all worker pools (i.e., the total initial node count) does not exceed the configured limit</li><li>the maximum node count of an individual worker pool does not exceed the configured limit</li><li>cluster-autoscaler does not provision more nodes than the configured limit (<code>--max-nodes-total</code> flag)</li></ul><p>The maximum node count of a shoot cluster can be lower than the configured limit, if the cluster&rsquo;s networking configurations don&rsquo;t allow it (see <a href=/docs/gardener/networking/shoot_networking/>this doc page</a>).</p><p>Gardener operators must ensure that no existing shoot cluster exceeds the limit when adding it.
Because Gardener API server itself cannot verify that all shoot clusters would comply with a given limit set in an API request, it does not allow decreasing the limit, which could be disruptive for existing shoots.
Increasing and removing the limits is allowed.</p><p>Note that the node count limit during runtime is applied by the cluster-autoscaler only.
E.g., performing a rolling update can cause shoots to exceed <code>maxNodesTotal</code> by the total <code>maxSurge</code> of all worker pools.
Also, when a shoot owner adds another worker pool to a cluster that has already reached the maximum node count via cluster autoscaling, Gardener would initially deploy the new worker pool with the minimum number of nodes.
This would cause the shoot to temporarily exceed the configured limit until cluster-autoscaler scales the cluster down again.
In other words, <code>CloudProfile.spec.limits.maxNodesTotal</code> doesn&rsquo;t enforce a hard limit, but rather ensures that shoot clusters stay within a reasonable size that the Gardener operator can and wants to support.
Shoot owners should keep the limit configured in the <code>CloudProfile</code> in mind when configuring the initial node count of new worker pools.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-37f2aa43c6680409f1e09059cba8cd43>4 - Shoot Cluster Purposes</h1><div class=lead>Available Shoot cluster purposes and the behavioral differences between them</div><h1 id=shoot-cluster-purpose>Shoot Cluster Purpose<a class=td-heading-self-link href=#shoot-cluster-purpose aria-label="Heading self-link"></a></h1><p>The <code>Shoot</code> resource contains a <code>.spec.purpose</code> field indicating how the shoot is used, whose allowed values are as follows:</p><ul><li><code>evaluation</code> (default): Indicates that the shoot cluster is for evaluation scenarios.</li><li><code>development</code>: Indicates that the shoot cluster is for development scenarios.</li><li><code>testing</code>: Indicates that the shoot cluster is for testing scenarios.</li><li><code>production</code>: Indicates that the shoot cluster is for production scenarios.</li><li><code>infrastructure</code>: Indicates that the shoot cluster is for infrastructure scenarios (only allowed for shoots in the <code>garden</code> namespace).</li></ul><h2 id=behavioral-differences>Behavioral Differences<a class=td-heading-self-link href=#behavioral-differences aria-label="Heading self-link"></a></h2><p>The following enlists the differences in the way the shoot clusters are set up based on the selected purpose:</p><ul><li><code>testing</code> shoot clusters <strong>do not</strong> get a monitoring or a logging stack as part of their control planes.</li><li>for <code>production</code> and <code>infrastructure</code> shoot clusters auto-scaling scale down of the main ETCD is disabled.</li><li>shoot addons like <code>nginxIngress</code> and <code>kubernetesDashboard</code> can only be enabled for <code>evaluation</code> shoot clusters.</li></ul><p>There are also differences with respect to how <code>testing</code> shoots are scheduled after creation, please consult the <a href=/docs/gardener/concepts/scheduler/>Scheduler documentation</a>.</p><h2 id=future-steps>Future Steps<a class=td-heading-self-link href=#future-steps aria-label="Heading self-link"></a></h2><p>We might introduce more behavioral difference depending on the shoot purpose in the future.
As of today, there are no plans yet.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f46c83903c14e2b655bccd3a95986d37>5 - Shoot cluster supported Kubernetes versions and specifics</h1><div class=lead>Defining the differences and requirements for upgrading to a supported Kubernetes version</div><h1 id=shoot-kubernetes-minor-version-upgrades>Shoot Kubernetes Minor Version Upgrades<a class=td-heading-self-link href=#shoot-kubernetes-minor-version-upgrades aria-label="Heading self-link"></a></h1><p>Breaking changes may be introduced with new Kubernetes versions.
This documentation describes the differences and requirements for upgrading to a supported Kubernetes version.</p><h2 id=upgrading-to-kubernetes-v133>Upgrading to Kubernetes <code>v1.33</code><a class=td-heading-self-link href=#upgrading-to-kubernetes-v133 aria-label="Heading self-link"></a></h2><ul><li>A new <code>deny-all</code> <code>NetworkPolicy</code> is deployed into the <code>kube-system</code> namespace of the <code>Shoot</code> cluster. <code>Shoot</code> owners that run workloads in the <code>kube-system</code> namespace are required to explicitly allow their expected <code>Ingress</code> and <code>Egress</code> traffic in <code>kube-system</code> via <code>NetworkPolicies</code>.</li></ul><h2 id=upgrading-to-kubernetes-v132>Upgrading to Kubernetes <code>v1.32</code><a class=td-heading-self-link href=#upgrading-to-kubernetes-v132 aria-label="Heading self-link"></a></h2><ul><li>The <code>Shoot</code>&rsquo;s field <code>spec.kubernetes.kubeAPIServer.oidcConfig</code> is forbidden. <code>Shoot</code> owners that have used <code>oidcConfig</code> are recommended to configure <code>StructuredAuthentication</code>. More information about <code>StructuredAuthentication</code> can be found <a href=/docs/gardener/shoot/shoot_access/#structured-authentication>here</a></li></ul><h2 id=upgrading-to-kubernetes-v131>Upgrading to Kubernetes <code>v1.31</code><a class=td-heading-self-link href=#upgrading-to-kubernetes-v131 aria-label="Heading self-link"></a></h2><ul><li>The <code>Shoot</code>&rsquo;s field <code>spec.kubernetes.kubeAPIServer.oidcConfig.clientAuthentication</code> is forbidden.</li><li>The <code>Shoot</code>&rsquo;s fields <code>.spec.kubernetes.kubelet.systemReserved</code> and <code>.spec.provider.workers[].kubernetes.kubelet.systemReserved</code> are forbidden. <code>Shoot</code> owners should use the <code>.spec.kubernetes.kubelet.kubeReserved</code> and <code>.spec.provider.workers[].kubernetes.kubelet.kubeReserved</code> fields.</li></ul><h2 id=upgrading-to-kubernetes-v130>Upgrading to Kubernetes <code>v1.30</code><a class=td-heading-self-link href=#upgrading-to-kubernetes-v130 aria-label="Heading self-link"></a></h2><ul><li>The <code>kubelet</code> <code>UnlimitedSwap</code> behavior, configured in the <code>Shoot</code>&rsquo;s <code>.spec.{kubernetes,provider.workers[]}.kubelet.memorySwap.swapBehavior</code> fields, can no longer be used.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-dfc826997a73deac3edb75a2b2a8ba93>6 - Shoot Hibernation</h1><div class=lead>What is hibernation? Manual hibernation/wake up and specifying a hibernation schedule</div><h1 id=shoot-hibernation>Shoot Hibernation<a class=td-heading-self-link href=#shoot-hibernation aria-label="Heading self-link"></a></h1><p>Clusters are only needed 24 hours a day if they run productive workload. So whenever you do development in a cluster, or just use it for tests or demo purposes, you can save a lot of money if you scale-down your Kubernetes resources whenever you don&rsquo;t need them. However, scaling them down manually can become time-consuming the more resources you have.</p><p>Gardener offers a clever way to automatically scale-down all resources to zero: cluster hibernation. You can either hibernate a cluster by pushing a button, or by defining a hibernation schedule.</p><blockquote><p>To save costs, it&rsquo;s recommended to define a hibernation schedule before the creation of a cluster. You can hibernate your cluster or wake up your cluster manually even if there&rsquo;s a schedule for its hibernation.</p></blockquote><ul><li><a href=/docs/gardener/shoot/shoot_hibernate/#hibernate-a-cluster>Hibernate a Cluster</a><ul><li><a href=/docs/gardener/shoot/shoot_hibernate/#what-is-hibernation>What Is Hibernation?</a></li><li><a href=/docs/gardener/shoot/shoot_hibernate/#what-isnt-affected-by-the-hibernation>What Isn’t Affected by the Hibernation?</a></li><li><a href=/docs/gardener/shoot/shoot_hibernate/#hibernate-your-cluster-manually>Hibernate Your Cluster Manually</a></li><li><a href=/docs/gardener/shoot/shoot_hibernate/#wake-up-your-cluster-manually>Wake Up Your Cluster Manually</a></li><li><a href=/docs/gardener/shoot/shoot_hibernate/#create-a-schedule-to-hibernate-your-cluster>Create a Schedule to Hibernate Your Cluster</a></li></ul></li></ul><h2 id=what-is-hibernation>What Is Hibernation?<a class=td-heading-self-link href=#what-is-hibernation aria-label="Heading self-link"></a></h2><p>When a cluster is hibernated, Gardener scales down the worker nodes and the cluster&rsquo;s control plane to free resources at the IaaS provider. This affects:</p><ul><li>Your workload, for example, pods, deployments, custom resources.</li><li>The virtual machines running your workload.</li><li>The resources of the control plane of your cluster.</li></ul><h2 id=what-isnt-affected-by-the-hibernation>What Isn’t Affected by the Hibernation?<a class=td-heading-self-link href=#what-isnt-affected-by-the-hibernation aria-label="Heading self-link"></a></h2><p>To scale up everything where it was before hibernation, Gardener doesn’t delete state-related information, that is, information stored in persistent volumes. The cluster state as persistent in <code>etcd</code> is also preserved.</p><h2 id=hibernate-your-cluster-manually>Hibernate Your Cluster Manually<a class=td-heading-self-link href=#hibernate-your-cluster-manually aria-label="Heading self-link"></a></h2><p>The <code>.spec.hibernation.enabled</code> field specifies whether the cluster needs to be hibernated or not. If the field is set to <code>true</code>, the cluster&rsquo;s desired state is to be hibernated. If it is set to <code>false</code> or not specified at all, the cluster&rsquo;s desired state is to be awakened.</p><p>To hibernate your cluster, you can run the following <code>kubectl</code> command:</p><pre tabindex=0><code>$ kubectl patch shoot -n $NAMESPACE $SHOOT_NAME -p &#39;{&#34;spec&#34;:{&#34;hibernation&#34;:{&#34;enabled&#34;: true}}}&#39;
</code></pre><h2 id=wake-up-your-cluster-manually>Wake Up Your Cluster Manually<a class=td-heading-self-link href=#wake-up-your-cluster-manually aria-label="Heading self-link"></a></h2><p>To wake up your cluster, you can run the following <code>kubectl</code> command:</p><pre tabindex=0><code>$ kubectl patch shoot -n $NAMESPACE $SHOOT_NAME -p &#39;{&#34;spec&#34;:{&#34;hibernation&#34;:{&#34;enabled&#34;: false}}}&#39;
</code></pre><h2 id=create-a-schedule-to-hibernate-your-cluster>Create a Schedule to Hibernate Your Cluster<a class=td-heading-self-link href=#create-a-schedule-to-hibernate-your-cluster aria-label="Heading self-link"></a></h2><p>You can specify a hibernation schedule to automatically hibernate/wake up a cluster.</p><p>Let&rsquo;s have a look into the following example:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>  hibernation:
</span></span><span style=display:flex><span>    enabled: <span style=color:#00f>false</span>
</span></span><span style=display:flex><span>    schedules:
</span></span><span style=display:flex><span>    - start: <span style=color:#a31515>&#34;0 20 * * *&#34;</span> <span style=color:green># Start hibernation every day at 8PM</span>
</span></span><span style=display:flex><span>      end: <span style=color:#a31515>&#34;0 6 * * *&#34;</span>    <span style=color:green># Stop hibernation every day at 6AM</span>
</span></span><span style=display:flex><span>      location: <span style=color:#a31515>&#34;America/Los_Angeles&#34;</span> <span style=color:green># Specify a location for the cron to run in</span>
</span></span></code></pre></div><p>The above section configures a hibernation schedule that hibernates the cluster every day at 08:00 PM and wakes it up at 06:00 AM. The <code>start</code> or <code>end</code> fields can be omitted, though at least one of them has to be specified. Hence, it is possible to configure a hibernation schedule that only hibernates or wakes up a cluster. The <code>location</code> field is the time location used to evaluate the cron expressions.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7bd4b1f7121b6901cae1aa24bc92d7e9>7 - Shoot Info Configmap</h1><h1 id=shoot-info-configmap>Shoot Info <code>ConfigMap</code><a class=td-heading-self-link href=#shoot-info-configmap aria-label="Heading self-link"></a></h1><h2 id=overview>Overview<a class=td-heading-self-link href=#overview aria-label="Heading self-link"></a></h2><p>The gardenlet maintains a <a href=https://kubernetes.io/docs/concepts/configuration/configmap/>ConfigMap</a> inside the Shoot cluster that contains information about the cluster itself. The ConfigMap is named <code>shoot-info</code> and located in the <code>kube-system</code> namespace.</p><h2 id=fields>Fields<a class=td-heading-self-link href=#fields aria-label="Heading self-link"></a></h2><p>The following fields are provided:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: ConfigMap
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: shoot-info
</span></span><span style=display:flex><span>  namespace: kube-system
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  domain: crazy-botany.core.my-custom-domain.com     <span style=color:green># .spec.dns.domain field from the Shoot resource</span>
</span></span><span style=display:flex><span>  extensions: foobar,foobaz                          <span style=color:green># List of extensions that are enabled</span>
</span></span><span style=display:flex><span>  kubernetesVersion: 1.25.4                          <span style=color:green># .spec.kubernetes.version field from the Shoot resource</span>
</span></span><span style=display:flex><span>  maintenanceBegin: 220000+0100                      <span style=color:green># .spec.maintenance.timeWindow.begin field from the Shoot resource</span>
</span></span><span style=display:flex><span>  maintenanceEnd: 230000+0100                        <span style=color:green># .spec.maintenance.timeWindow.end field from the Shoot resource</span>
</span></span><span style=display:flex><span>  nodeNetwork: 10.250.0.0/16                         <span style=color:green># .spec.networking.nodes field from the Shoot resource</span>
</span></span><span style=display:flex><span>  podNetwork: 100.96.0.0/11                          <span style=color:green># .spec.networking.pods field from the Shoot resource</span>
</span></span><span style=display:flex><span>  projectName: dev                                   <span style=color:green># .metadata.name of the Project</span>
</span></span><span style=display:flex><span>  provider: &lt;some-provider-name&gt;                     <span style=color:green># .spec.provider.type field from the Shoot resource</span>
</span></span><span style=display:flex><span>  region: europe-central-1                           <span style=color:green># .spec.region field from the Shoot resource</span>
</span></span><span style=display:flex><span>  serviceNetwork: 100.64.0.0/13                      <span style=color:green># .spec.networking.services field from the Shoot resource</span>
</span></span><span style=display:flex><span>  shootName: crazy-botany                            <span style=color:green># .metadata.name from the Shoot resource</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-f2b8d9e824320f2c5aca9601d96eaec9>8 - Shoot Maintenance</h1><div class=lead>Defining the maintenance time window, configuring automatic version updates, confining reconciliations to only happen during maintenance, adding an additional maintenance operation, etc.</div><h1 id=shoot-maintenance>Shoot Maintenance<a class=td-heading-self-link href=#shoot-maintenance aria-label="Heading self-link"></a></h1><p>Shoots configure a maintenance time window in which Gardener performs certain operations that may restart the control plane, roll out the nodes, result in higher network traffic, etc. A summary of what was changed in the last maintenance time window in shoot specification is kept in the shoot status <code>.status.lastMaintenance</code> field.</p><p>This document outlines what happens during a shoot maintenance.</p><h2 id=time-window>Time Window<a class=td-heading-self-link href=#time-window aria-label="Heading self-link"></a></h2><p>Via the <code>.spec.maintenance.timeWindow</code> field in the shoot specification, end-users can configure the time window in which maintenance operations are executed.
Gardener runs one maintenance operation per day in this time window:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  maintenance:
</span></span><span style=display:flex><span>    timeWindow:
</span></span><span style=display:flex><span>      begin: 220000+0100
</span></span><span style=display:flex><span>      end: 230000+0100
</span></span></code></pre></div><p>The offset (<code>+0100</code>) is considered with respect to UTC time.
The minimum time window is <code>30m</code> and the maximum is <code>6h</code>.</p><p>⚠️ Please note that there is no guarantee that a maintenance operation that, e.g., starts a node roll-out will finish <em>within</em> the time window.
Especially for large clusters, it may take several hours until a graceful rolling update of the worker nodes succeeds (also depending on the workload and the configured pod disruption budgets/termination grace periods).</p><p>Internally, Gardener is subtracting <code>15m</code> from the end of the time window to (best-effort) try to finish the maintenance until the end is reached, however, this might not work in all cases.</p><p>If you don&rsquo;t specify a time window, then Gardener will randomly compute it.
You can change it later, of course.</p><h2 id=automatic-version-updates>Automatic Version Updates<a class=td-heading-self-link href=#automatic-version-updates aria-label="Heading self-link"></a></h2><p>The <code>.spec.maintenance.autoUpdate</code> field in the shoot specification allows you to control how/whether automatic updates of Kubernetes patch and machine image versions are performed.
Machine image versions are updated per worker pool.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  maintenance:
</span></span><span style=display:flex><span>    autoUpdate:
</span></span><span style=display:flex><span>      kubernetesVersion: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>      machineImageVersion: <span style=color:#00f>true</span>
</span></span></code></pre></div><p>During the daily maintenance, the Gardener Controller Manager updates the Shoot&rsquo;s Kubernetes and machine image version if any of the following criteria applies:</p><ul><li>There is a higher version available and the Shoot opted-in for automatic version updates.</li><li>The currently used version is <code>expired</code>.</li></ul><p>The target version for machine image upgrades is controlled by the <code>updateStrategy</code> field for the machine image in the CloudProfile. Allowed update strategies are <code>patch</code>, <code>minor</code> and <code>major</code>.</p><p>Gardener (gardener-controller-manager) populates the <code>lastMaintenance</code> field in the Shoot status with the maintenance results.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>Last Maintenance:
</span></span><span style=display:flex><span>    Description:     <span style=color:#a31515>&#34;All maintenance operations successful. Control Plane: Updated Kubernetes version from 1.26.4 to 1.27.1. Reason: Kubernetes version expired - force update required&#34;</span>
</span></span><span style=display:flex><span>    State:           Succeeded
</span></span><span style=display:flex><span>    Triggered Time:  2023-07-28T09:07:27Z
</span></span></code></pre></div><p>Additionally, Gardener creates events with the type <code>MachineImageVersionMaintenance</code> or <code>KubernetesVersionMaintenance</code> on the Shoot describing the action performed during maintenance, including the reason why an update has been triggered.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>LAST SEEN   TYPE      REASON                           OBJECT          MESSAGE
</span></span><span style=display:flex><span>30m         Normal    MachineImageVersionMaintenance   shoot/local     Worker pool &#34;local&#34;: Updated image from &#39;gardenlinux&#39; version &#39;xy&#39; to version &#39;abc&#39;. Reason: Automatic update of the machine image version is configured (image update strategy: major).
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>30m         Normal    KubernetesVersionMaintenance     shoot/local     Control Plane: Updated Kubernetes version from &#34;1.26.4&#34; to &#34;1.27.1&#34;. Reason: Kubernetes version expired - force update required.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>15m         Normal    KubernetesVersionMaintenance     shoot/local     Worker pool &#34;local&#34;: Updated Kubernetes version &#39;1.26.3&#39; to version &#39;1.27.1&#39;. Reason: Kubernetes version expired - force update required.
</span></span></code></pre></div><p>If at least one maintenance operation fails, the <code>lastMaintenance</code> field in the Shoot status is set to <code>Failed</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>Last Maintenance:
</span></span><span style=display:flex><span>  Description:     <span style=color:#a31515>&#34;(1/2) maintenance operations successful: Control Plane: Updated Kubernetes version from 1.26.4 to 1.27.1. Reason: Kubernetes version expired - force update required, Worker pool x: &#39;gardenlinux&#39; machine image version maintenance failed. Reason for update: machine image version expired&#34;</span>
</span></span><span style=display:flex><span>  FailureReason:   <span style=color:#a31515>&#34;Worker pool x: either the machine image &#39;gardenlinux&#39; is reaching end of life and migration to another machine image is required or there is a misconfiguration in the CloudProfile.&#34;</span>
</span></span><span style=display:flex><span>  State:           Failed
</span></span><span style=display:flex><span>  Triggered Time:  2023-07-28T09:07:27Z
</span></span></code></pre></div><p>Please refer to the <a href=/docs/gardener/shoot-operations/shoot_versions/>Shoot Kubernetes and Operating System Versioning in Gardener</a> topic for more information about Kubernetes and machine image versions in Gardener.</p><h2 id=cluster-reconciliation>Cluster Reconciliation<a class=td-heading-self-link href=#cluster-reconciliation aria-label="Heading self-link"></a></h2><p>Gardener administrators/operators can configure the gardenlet in a way that it only reconciles shoot clusters during their maintenance time windows.
This behaviour is not controllable by end-users but might make sense for large Gardener installations.
Concretely, your shoot will be reconciled regularly during its maintenance time window.
Outside of the maintenance time window it will only reconcile if you change the specification or if you explicitly trigger it, see also <a href=/docs/gardener/shoot-operations/shoot_operations/>Trigger Shoot Operations</a>.</p><h2 id=confine-specification-changesupdates-roll-out>Confine Specification Changes/Updates Roll Out<a class=td-heading-self-link href=#confine-specification-changesupdates-roll-out aria-label="Heading self-link"></a></h2><p>Via the <code>.spec.maintenance.confineSpecUpdateRollout</code> field you can control whether you want to make Gardener roll out changes/updates to your shoot specification only during the maintenance time window.
It is <code>false</code> by default, i.e., any change to your shoot specification triggers a reconciliation (even outside of the maintenance time window).
This is helpful if you want to update your shoot but don&rsquo;t want the changes to be applied immediately. One example use-case would be a Kubernetes version upgrade that you want to roll out during the maintenance time window.
Any update to the specification will not increase the <code>.metadata.generation</code> of the <code>Shoot</code>, which is something you should be aware of.
Also, even if Gardener administrators/operators have not enabled the &ldquo;reconciliation in maintenance time window only&rdquo; configuration (as mentioned above), then your shoot will only reconcile in the maintenance time window.
The reason is that Gardener cannot differentiate between create/update/reconcile operations.</p><p>⚠️ If <code>confineSpecUpdateRollout=true</code>, please note that if you change the maintenance time window itself, then it will only be effective after the upcoming maintenance.</p><p>⚠️ As exceptions to the above rules, <a href=/docs/gardener/shoot-operations/shoot_operations/#immediate-reconciliation>manually triggered reconciliations</a> and changes to the <code>.spec.hibernation.enabled</code> field trigger immediate rollouts.
I.e., if you hibernate or wake-up your shoot, or you explicitly tell Gardener to reconcile your shoot, then Gardener gets active right away.</p><h2 id=shoot-operations>Shoot Operations<a class=td-heading-self-link href=#shoot-operations aria-label="Heading self-link"></a></h2><p>In case you would like to perform a <a href=/docs/gardener/shoot-operations/shoot_operations/#credentials-rotation-operations>shoot credential rotation</a> or a <code>reconcile</code> operation during your maintenance time window, you can annotate the <code>Shoot</code> with</p><pre tabindex=0><code>maintenance.gardener.cloud/operation=&lt;operation&gt;
</code></pre><p>This will execute the specified <code>&lt;operation></code> during the next maintenance reconciliation.
Note that Gardener will remove this annotation after it has been performed in the maintenance reconciliation.</p><blockquote><p>⚠️ This is skipped when the <code>Shoot</code>&rsquo;s <code>.status.lastOperation.state=Failed</code>. Make sure to <a href=/docs/gardener/shoot-operations/shoot_operations/#retry-failed-reconciliation>retry</a> your shoot reconciliation beforehand.</p></blockquote><h2 id=special-operations-during-maintenance>Special Operations During Maintenance<a class=td-heading-self-link href=#special-operations-during-maintenance aria-label="Heading self-link"></a></h2><p>The shoot maintenance controller triggers special operations that are performed as part of the shoot reconciliation.</p><h3 id=infrastructure-and-dnsrecord-reconciliation><code>Infrastructure</code> and <code>DNSRecord</code> Reconciliation<a class=td-heading-self-link href=#infrastructure-and-dnsrecord-reconciliation aria-label="Heading self-link"></a></h3><p>The reconciliation of the <code>Infrastructure</code> and <code>DNSRecord</code> extension resources is only demanded during the shoot&rsquo;s maintenance time window.
The rationale behind it is to prevent sending too many requests against the cloud provider APIs, especially on large landscapes or if a user has many shoot clusters in the same cloud provider account.</p><h3 id=restart-control-plane-controllers>Restart Control Plane Controllers<a class=td-heading-self-link href=#restart-control-plane-controllers aria-label="Heading self-link"></a></h3><p>Gardener operators can make Gardener restart/delete certain control plane pods during a shoot maintenance.
This feature helps to automatically solve service denials of controllers due to stale caches, dead-locks or starving routines.</p><p>Please note that these are exceptional cases but they are observed from time to time.
Gardener, for example, takes this precautionary measure for <code>kube-controller-manager</code> pods.</p><p>See <a href=/docs/gardener/extensions/shoot-maintenance/>Shoot Maintenance</a> to see how extension developers can extend this behaviour.</p><h3 id=restart-some-core-addons>Restart Some Core Addons<a class=td-heading-self-link href=#restart-some-core-addons aria-label="Heading self-link"></a></h3><p>Gardener operators can make Gardener restart some core addons (at the moment only CoreDNS) during a shoot maintenance.</p><p>CoreDNS benefits from this feature as it automatically solve problems with clients stuck to single replica of the deployment and thus overloading it.
Please note that these are exceptional cases but they are observed from time to time.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-895792a062b713d4cc082950c6d5de11>9 - Shoot Scheduling Profiles</h1><div class=lead>Introducing <code>balanced</code> and <code>bin-packing</code> scheduling profiles</div><h1 id=shoot-scheduling-profiles>Shoot Scheduling Profiles<a class=td-heading-self-link href=#shoot-scheduling-profiles aria-label="Heading self-link"></a></h1><p>This guide describes the available scheduling profiles and how they can be configured in the Shoot cluster. It also clarifies how a custom scheduling profile can be configured.</p><h2 id=scheduling-profiles>Scheduling Profiles<a class=td-heading-self-link href=#scheduling-profiles aria-label="Heading self-link"></a></h2><p>The scheduling process in the <a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kube-scheduler/>kube-scheduler</a> happens in a series of stages. A <a href=https://kubernetes.io/docs/reference/scheduling/config/#profiles>scheduling profile</a> allows configuring the different stages of the scheduling.</p><p>As of today, Gardener supports two predefined scheduling profiles:</p><ul><li><p><code>balanced</code> (default)</p><p><strong>Overview</strong></p><p>The <code>balanced</code> profile attempts to spread Pods evenly across Nodes to obtain a more balanced resource usage. This profile provides the default kube-scheduler behavior.</p><p><strong>How it works?</strong></p><p>The kube-scheduler is started without any profiles. In such case, by default, one profile with the scheduler name <code>default-scheduler</code> is created. This profile includes the default plugins. If a Pod doesn&rsquo;t specify the <code>.spec.schedulerName</code> field, kube-apiserver sets it to <code>default-scheduler</code>. Then, the Pod gets scheduled by the <code>default-scheduler</code> accordingly.</p></li><li><p><code>bin-packing</code></p><p><strong>Overview</strong></p><p>The <code>bin-packing</code> profile scores Nodes based on the allocation of resources. It prioritizes Nodes with the most allocated resources. By favoring the Nodes with the most allocation, some of the other Nodes become under-utilized over time (because new Pods keep being scheduled to the most allocated Nodes). Then, the cluster-autoscaler identifies such under-utilized Nodes and removes them from the cluster. In this way, this profile provides a greater overall resource utilization (compared to the <code>balanced</code> profile).</p><blockquote><p><strong>Note:</strong> The decision of when to remove a Node is a trade-off between optimizing for utilization or the availability of resources. Removing under-utilized Nodes improves cluster utilization, but new workloads might have to wait for resources to be provisioned again before they can run.</p></blockquote><p><strong>How it works?</strong></p><p>The kube-scheduler is configured with the following bin packing profile:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: kubescheduler.config.k8s.io/v1beta3
</span></span><span style=display:flex><span>kind: KubeSchedulerConfiguration
</span></span><span style=display:flex><span>profiles:
</span></span><span style=display:flex><span>- schedulerName: bin-packing-scheduler
</span></span><span style=display:flex><span>  pluginConfig:
</span></span><span style=display:flex><span>  - name: NodeResourcesFit
</span></span><span style=display:flex><span>    args:
</span></span><span style=display:flex><span>      scoringStrategy:
</span></span><span style=display:flex><span>        type: MostAllocated
</span></span><span style=display:flex><span>  plugins:
</span></span><span style=display:flex><span>    score:
</span></span><span style=display:flex><span>      disabled:
</span></span><span style=display:flex><span>      - name: NodeResourcesBalancedAllocation
</span></span></code></pre></div><p>To impose the new profile, a <code>MutatingWebhookConfiguration</code> is deployed in the Shoot cluster. The <code>MutatingWebhookConfiguration</code> intercepts <code>CREATE</code> operations for Pods and sets the <code>.spec.schedulerName</code> field to <code>bin-packing-scheduler</code>. Then, the Pod gets scheduled by the <code>bin-packing-scheduler</code> accordingly. Pods that specify a custom scheduler (i.e., having <code>.spec.schedulerName</code> different from <code>default-scheduler</code> and <code>bin-packing-scheduler</code>) are not affected.</p></li></ul><h2 id=configuring-the-scheduling-profile>Configuring the Scheduling Profile<a class=td-heading-self-link href=#configuring-the-scheduling-profile aria-label="Heading self-link"></a></h2><p>The scheduling profile can be configured via the <code>.spec.kubernetes.kubeScheduler.profile</code> field in the Shoot:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  <span style=color:green># ...</span>
</span></span><span style=display:flex><span>  kubernetes:
</span></span><span style=display:flex><span>    kubeScheduler:
</span></span><span style=display:flex><span>      profile: <span style=color:#a31515>&#34;balanced&#34;</span> <span style=color:green># or &#34;bin-packing&#34;</span>
</span></span></code></pre></div><h2 id=custom-scheduling-profiles>Custom Scheduling Profiles<a class=td-heading-self-link href=#custom-scheduling-profiles aria-label="Heading self-link"></a></h2><p>The kube-scheduler&rsquo;s component configs allows configuring custom scheduling profiles to match the cluster needs. As of today, Gardener supports only two predefined scheduling profiles. The profile configuration in the component config is quite expressive and it is not possible to easily define profiles that would match the needs of every cluster. Because of these reasons, there are no plans to add support for new predefined scheduling profiles. If a cluster owner wants to use a custom scheduling profile, then they have to deploy (and maintain) a dedicated kube-scheduler deployment in the cluster itself.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-97a232b30f478d1117b6c9bf7807d757>10 - Shoot Status</h1><div class=lead>Shoot conditions, constraints, and error codes</div><h1 id=shoot-status>Shoot Status<a class=td-heading-self-link href=#shoot-status aria-label="Heading self-link"></a></h1><p>This document provides an overview of the <a href=/docs/gardener/api-reference/core/#shootstatus>ShootStatus</a>.</p><h2 id=conditions>Conditions<a class=td-heading-self-link href=#conditions aria-label="Heading self-link"></a></h2><p>The Shoot status consists of a set of conditions. A <a href=/docs/gardener/api-reference/core/#condition>Condition</a> has the following fields:</p><table><thead><tr><th>Field name</th><th>Description</th></tr></thead><tbody><tr><td><code>type</code></td><td>Name of the condition.</td></tr><tr><td><code>status</code></td><td>Indicates whether the condition is applicable, with possible values <code>True</code>, <code>False</code>, <code>Unknown</code> or <code>Progressing</code>.</td></tr><tr><td><code>lastTransitionTime</code></td><td>Timestamp for when the condition last transitioned from one status to another.</td></tr><tr><td><code>lastUpdateTime</code></td><td>Timestamp for when the condition was updated. Usually changes when <code>reason</code> or <code>message</code> in condition is updated.</td></tr><tr><td><code>reason</code></td><td>Machine-readable, UpperCamelCase text indicating the reason for the condition&rsquo;s last transition.</td></tr><tr><td><code>message</code></td><td>Human-readable message indicating details about the last status transition.</td></tr><tr><td><code>codes</code></td><td>Well-defined error codes in case the condition reports a problem.</td></tr></tbody></table><p>Currently, the available Shoot condition types are:</p><ul><li><code>APIServerAvailable</code></li><li><code>ControlPlaneHealthy</code></li><li><code>EveryNodeReady</code></li><li><code>ObservabilityComponentsHealthy</code></li><li><code>SystemComponentsHealthy</code></li></ul><p>The Shoot conditions are maintained by the <a href=https://github.com/gardener/gardener/blob/master/pkg/gardenlet/controller/shoot/care/reconciler.go>shoot care reconciler</a> of the gardenlet.
Find more information in the <a href=/docs/gardener/concepts/gardenlet/#shoot-controller>gardelent documentation</a>.</p><h3 id=sync-period>Sync Period<a class=td-heading-self-link href=#sync-period aria-label="Heading self-link"></a></h3><p>The condition checks are executed periodically at an interval which is configurable in the <code>GardenletConfiguration</code> (<code>.controllers.shootCare.syncPeriod</code>, defaults to <code>1m</code>).</p><h3 id=condition-thresholds>Condition Thresholds<a class=td-heading-self-link href=#condition-thresholds aria-label="Heading self-link"></a></h3><p>The <code>GardenletConfiguration</code> also allows configuring condition thresholds (<code>controllers.shootCare.conditionThresholds</code>). A condition threshold is the amount of time to consider a condition as <code>Processing</code> on condition status changes.</p><p>Let&rsquo;s check the following example to get a better understanding. Let&rsquo;s say that the <code>APIServerAvailable</code> condition of our Shoot is with status <code>True</code>. If the next condition check fails (for example kube-apiserver becomes unreachable), then the condition first goes to <code>Processing</code> state. Only if this state remains for condition threshold amount of time, then the condition is finally updated to <code>False</code>.</p><h3 id=constraints>Constraints<a class=td-heading-self-link href=#constraints aria-label="Heading self-link"></a></h3><p>Constraints represent conditions of a Shoot’s current state that constraint some operations on it.
The current constraints are:</p><p><strong><code>HibernationPossible</code></strong>:</p><p>This constraint indicates whether a Shoot is allowed to be hibernated.
The rationale behind this constraint is that a Shoot can have <code>ValidatingWebhookConfiguration</code>s or <code>MutatingWebhookConfiguration</code>s acting on resources that are critical for waking up a cluster.
For example, if a webhook has rules for <code>CREATE/UPDATE</code> Pods or Nodes and <code>failurePolicy=Fail</code>, the webhook will block joining <code>Nodes</code> and creating critical system component Pods and thus block the entire wakeup operation, because the server backing the webhook is not running.</p><p>Even if the <code>failurePolicy</code> is set to <code>Ignore</code>, high timeouts (<code>>15s</code>) can lead to blocking requests of control plane components.
That&rsquo;s because most control-plane API calls are made with a client-side timeout of <code>30s</code>, so if a webhook has <code>timeoutSeconds=30</code>
the overall request might still fail as there is overhead in communication with the API server and potential other webhooks.</p><p>Generally, it&rsquo;s <a href=https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#timeouts>best practice</a> to specify low timeouts in WebhookConfigs.</p><p>As an effort to correct this common problem, the webhook remediator has been created. This is enabled by setting <code>.controllers.shootCare.webhookRemediatorEnabled=true</code> in the <code>gardenlet</code>&rsquo;s configuration. This feature simply checks whether webhook configurations in shoot clusters match a set of rules described <a href=https://github.com/gardener/gardener/blob/master/pkg/gardenlet/operation/botanist/matchers/matcher.go>here</a>. If at least one of the rules matches, it will change set <code>status=False</code> for the <code>.status.constraints</code> of type <code>HibernationPossible</code> and <code>MaintenancePreconditionsSatisfied</code> in the <code>Shoot</code> resource. In addition, the <code>failurePolicy</code> in the affected webhook configurations will be set from <code>Fail</code> to <code>Ignore</code>. Gardenlet will also add an annotation to make it visible to end-users that their webhook configurations were mutated and should be fixed/adapted according to the rules and best practices.</p><p>In most cases, you can avoid this by simply excluding the <code>kube-system</code> namespace from your webhook via the <code>namespaceSelector</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: admissionregistration.k8s.io/v1
</span></span><span style=display:flex><span>kind: MutatingWebhookConfiguration
</span></span><span style=display:flex><span>webhooks:
</span></span><span style=display:flex><span>  - name: my-webhook.example.com
</span></span><span style=display:flex><span>    namespaceSelector:
</span></span><span style=display:flex><span>      matchExpressions:
</span></span><span style=display:flex><span>      - key: gardener.cloud/purpose
</span></span><span style=display:flex><span>        operator: NotIn
</span></span><span style=display:flex><span>        values:
</span></span><span style=display:flex><span>          - kube-system
</span></span><span style=display:flex><span>    rules:
</span></span><span style=display:flex><span>      - operations: [<span style=color:#a31515>&#34;*&#34;</span>]
</span></span><span style=display:flex><span>        apiGroups: [<span style=color:#a31515>&#34;&#34;</span>]
</span></span><span style=display:flex><span>        apiVersions: [<span style=color:#a31515>&#34;v1&#34;</span>]
</span></span><span style=display:flex><span>        resources: [<span style=color:#a31515>&#34;pods&#34;</span>]
</span></span><span style=display:flex><span>        scope: <span style=color:#a31515>&#34;Namespaced&#34;</span>
</span></span></code></pre></div><p>However, some other resources (some of them cluster-scoped) might still trigger the remediator, namely:</p><ul><li>endpoints</li><li>nodes</li><li>clusterroles</li><li>clusterrolebindings</li><li>customresourcedefinitions</li><li>apiservices</li><li>certificatesigningrequests</li><li>priorityclasses</li></ul><p>If one of the above resources triggers the remediator, the preferred solution is to remove that particular resource from your webhook&rsquo;s <code>rules</code>. You can also use the <code>objectSelector</code> to reduce the scope of webhook&rsquo;s <code>rules</code>. However, in special cases where a webhook is absolutely needed for the workload, it is possible to add the <code>remediation.webhook.shoot.gardener.cloud/exclude=true</code> label to your webhook so that the remediator ignores it. This label <strong>should not be used to silence an alert</strong>, but rather to confirm that a webhook won&rsquo;t cause problems. Note that all of this is no perfect solution and just done on a best effort basis, and only the owner of the webhook can know whether it indeed is problematic and configured correctly.</p><p>In a special case, if a webhook has a rule for <code>CREATE/UPDATE</code> lease resources in <code>kube-system</code> namespace, its <code>timeoutSeconds</code> is updated to 3 seconds. This is required to ensure the proper functioning of the leader election of essential control plane controllers.</p><p>You can also find more help from the <a href=https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#best-practices-and-warnings>Kubernetes documentation</a></p><p><strong><code>MaintenancePreconditionsSatisfied</code></strong>:</p><p>This constraint indicates whether all preconditions for a safe maintenance operation are satisfied (see <a href=/docs/gardener/shoot/shoot_maintenance/>Shoot Maintenance</a> for more information about what happens during a shoot maintenance).
As of today, the same checks as in the <code>HibernationPossible</code> constraint are being performed (user-deployed webhooks that might interfere with potential rolling updates of shoot worker nodes).
There is no further action being performed on this constraint&rsquo;s status (maintenance is still being performed).
It is meant to make the user aware of potential problems that might occur due to his configurations.</p><p><strong><code>CACertificateValiditiesAcceptable</code></strong>:</p><p>This constraint indicates that there is at least one CA certificate which expires in less than <code>1y</code>.
It will not be added to the <code>.status.constraints</code> if there is no such CA certificate.
However, if it&rsquo;s visible, then a <a href=/docs/gardener/shoot-operations/shoot_credentials_rotation/#certificate-authorities>credentials rotation operation</a> should be considered.</p><p><strong><code>CRDsWithProblematicConversionWebhooks</code></strong>:</p><p>This constraint indicates that there is at least one <code>CustomResourceDefinition</code> in the cluster which has multiple stored versions and a conversion webhook configured. This could break the reconciliation flow of a <code>Shoot</code> cluster in some cases. See <a href=https://github.com/gardener/gardener/issues/7471>https://github.com/gardener/gardener/issues/7471</a> for more details.
It will not be added to the <code>.status.constraints</code> if there is no such CRD.
However, if it&rsquo;s visible, then you should consider upgrading the existing objects to the current stored version. See <a href=https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definition-versioning/#upgrade-existing-objects-to-a-new-stored-version>Upgrade existing objects to a new stored version</a> for detailed steps.</p><p><strong><code>ManualInPlaceWorkersUpdated</code></strong>:</p><p>This constraint indicates that at least one worker pool with the update strategy <code>ManualInPlaceUpdate</code> is pending an update. Despite this, the <code>Shoot</code> reconciliation will still succeed.
The constraint is not added to <code>.status.constraints</code> if all such worker pools are already up-to-date.
Once the user manually labels all the relevant nodes with <code>node.machine.sapcloud.io/selected-for-update</code> and the update process completes, the constraint will be automatically removed.</p><h3 id=last-operation>Last Operation<a class=td-heading-self-link href=#last-operation aria-label="Heading self-link"></a></h3><p>The Shoot status holds information about the last operation that is performed on the Shoot. The last operation field reflects overall progress and the tasks that are currently being executed. Allowed operation types are <code>Create</code>, <code>Reconcile</code>, <code>Delete</code>, <code>Migrate</code>, and <code>Restore</code>. Allowed operation states are <code>Processing</code>, <code>Succeeded</code>, <code>Error</code>, <code>Failed</code>, <code>Pending</code>, and <code>Aborted</code>. An operation in <code>Error</code> state is an operation that will be retried for a configurable amount of time (<code>controllers.shoot.retryDuration</code> field in <code>GardenletConfiguration</code>, defaults to <code>12h</code>). If the operation cannot complete successfully for the configured retry duration, it will be marked as <code>Failed</code>. An operation in <code>Failed</code> state is an operation that won&rsquo;t be retried automatically (to retry such an operation, see <a href=/docs/gardener/shoot-operations/shoot_operations/#retry-failed-operation>Retry failed operation</a>).</p><h3 id=last-errors>Last Errors<a class=td-heading-self-link href=#last-errors aria-label="Heading self-link"></a></h3><p>The Shoot status also contains information about the last occurred error(s) (if any) during an operation. A <a href=/docs/gardener/api-reference/core/#lasterror>LastError</a> consists of identifier of the task returned error, human-readable message of the error and error codes (if any) associated with the error.</p><h3 id=error-codes>Error Codes<a class=td-heading-self-link href=#error-codes aria-label="Heading self-link"></a></h3><p>Known error codes and their classification are:</p><table><thead><tr><th>Error code</th><th style=text-align:center>User error</th><th>Description</th></tr></thead><tbody><tr><td><code>ERR_INFRA_UNAUTHENTICATED</code></td><td style=text-align:center>true</td><td>Indicates that the last error occurred due to the client request not being completed because it lacks valid authentication credentials for the requested resource. It is classified as a non-retryable error code.</td></tr><tr><td><code>ERR_INFRA_UNAUTHORIZED</code></td><td style=text-align:center>true</td><td>Indicates that the last error occurred due to the server understanding the request but refusing to authorize it. It is classified as a non-retryable error code.</td></tr><tr><td><code>ERR_INFRA_QUOTA_EXCEEDED</code></td><td style=text-align:center>true</td><td>Indicates that the last error occurred due to infrastructure quota limits. It is classified as a non-retryable error code.</td></tr><tr><td><code>ERR_INFRA_RATE_LIMITS_EXCEEDED</code></td><td style=text-align:center>false</td><td>Indicates that the last error occurred due to exceeded infrastructure request rate limits.</td></tr><tr><td><code>ERR_INFRA_DEPENDENCIES</code></td><td style=text-align:center>true</td><td>Indicates that the last error occurred due to dependent objects on the infrastructure level. It is classified as a non-retryable error code.</td></tr><tr><td><code>ERR_RETRYABLE_INFRA_DEPENDENCIES</code></td><td style=text-align:center>false</td><td>Indicates that the last error occurred due to dependent objects on the infrastructure level, but the operation should be retried.</td></tr><tr><td><code>ERR_INFRA_RESOURCES_DEPLETED</code></td><td style=text-align:center>true</td><td>Indicates that the last error occurred due to depleted resource in the infrastructure.</td></tr><tr><td><code>ERR_CLEANUP_CLUSTER_RESOURCES</code></td><td style=text-align:center>true</td><td>Indicates that the last error occurred due to resources in the cluster that are stuck in deletion.</td></tr><tr><td><code>ERR_CONFIGURATION_PROBLEM</code></td><td style=text-align:center>true</td><td>Indicates that the last error occurred due to a configuration problem. It is classified as a non-retryable error code.</td></tr><tr><td><code>ERR_RETRYABLE_CONFIGURATION_PROBLEM</code></td><td style=text-align:center>true</td><td>Indicates that the last error occurred due to a retryable configuration problem. &ldquo;Retryable&rdquo; means that the occurred error is likely to be resolved in a ungraceful manner after given period of time.</td></tr><tr><td><code>ERR_PROBLEMATIC_WEBHOOK</code></td><td style=text-align:center>true</td><td>Indicates that the last error occurred due to a webhook not following the <a href=https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#best-practices-and-warnings>Kubernetes best practices</a>.</td></tr></tbody></table><p><strong>Please note:</strong> Errors classified as <code>User error: true</code> do not require a Gardener operator to resolve but can be remediated by the user (e.g. by refreshing expired infrastructure credentials).
Even though <code>ERR_INFRA_RATE_LIMITS_EXCEEDED</code> and <code>ERR_RETRYABLE_INFRA_DEPENDENCIES</code> is mentioned as User error: false` operator can&rsquo;t provide any resolution because it is related to cloud provider issue.</p><h3 id=status-label>Status Label<a class=td-heading-self-link href=#status-label aria-label="Heading self-link"></a></h3><p>Shoots will be automatically labeled with the <code>shoot.gardener.cloud/status</code> label.
Its value might either be <code>healthy</code>, <code>progressing</code>, <code>unhealthy</code> or <code>unknown</code> depending on the <code>.status.conditions</code>, <code>.status.lastOperation</code>, and <code>status.lastErrors</code> of the <code>Shoot</code>.
This can be used as an easy filter method to find shoots based on their &ldquo;health&rdquo; status.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-2035fd4318a48d60599ab8fb863230b5>11 - Shoot Supported Architectures</h1><h1 id=supported-cpu-architectures-for-shoot-worker-nodes>Supported CPU Architectures for Shoot Worker Nodes<a class=td-heading-self-link href=#supported-cpu-architectures-for-shoot-worker-nodes aria-label="Heading self-link"></a></h1><p>Users can create shoot clusters with worker groups having virtual machines of different architectures. CPU architecture of each worker pool can be specified in the <code>Shoot</code> specification as follows:</p><h2 id=example-usage-in-a-shoot>Example Usage in a <code>Shoot</code><a class=td-heading-self-link href=#example-usage-in-a-shoot aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  provider:
</span></span><span style=display:flex><span>    workers:
</span></span><span style=display:flex><span>    - name: cpu-worker
</span></span><span style=display:flex><span>      machine:
</span></span><span style=display:flex><span>        architecture: &lt;some-cpu-architecture&gt; <span style=color:green># optional</span>
</span></span></code></pre></div><p>If no value is specified for the architecture field, it defaults to <code>amd64</code>. For a valid shoot object, a machine type should be present in the respective <code>CloudProfile</code> with the same CPU architecture as specified in the <code>Shoot</code> yaml. Also, a valid machine image should be present in the <code>CloudProfile</code> that supports the required architecture specified in the <code>Shoot</code> worker pool.</p><h2 id=example-usage-in-a-cloudprofile>Example Usage in a <code>CloudProfile</code><a class=td-heading-self-link href=#example-usage-in-a-cloudprofile aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  machineImages:
</span></span><span style=display:flex><span>  - name: test-image
</span></span><span style=display:flex><span>    versions:
</span></span><span style=display:flex><span>    - architectures: <span style=color:green># optional</span>
</span></span><span style=display:flex><span>      - &lt;architecture-1&gt;
</span></span><span style=display:flex><span>      - &lt;architecture-2&gt;
</span></span><span style=display:flex><span>      version: 1.2.3
</span></span><span style=display:flex><span>  machineTypes:
</span></span><span style=display:flex><span>  - architecture: &lt;some-cpu-architecture&gt;
</span></span><span style=display:flex><span>    cpu: <span style=color:#a31515>&#34;2&#34;</span>
</span></span><span style=display:flex><span>    gpu: <span style=color:#a31515>&#34;0&#34;</span>
</span></span><span style=display:flex><span>    memory: 8Gi
</span></span><span style=display:flex><span>    name: test-machine
</span></span></code></pre></div><p>Currently, Gardener supports two of the most widely used CPU architectures:</p><ul><li><code>amd64</code></li><li><code>arm64</code></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b04ae190489412df5144674217c1de7e>12 - Shoot Worker Nodes Settings</h1><div class=lead>Configuring SSH Access through &lsquo;.spec.provider.workersSettings`</div><h1 id=shoot-worker-nodes-settings>Shoot Worker Nodes Settings<a class=td-heading-self-link href=#shoot-worker-nodes-settings aria-label="Heading self-link"></a></h1><p>Users can configure settings affecting all worker nodes via <code>.spec.provider.workersSettings</code> in the <code>Shoot</code> resource.</p><h2 id=ssh-access>SSH Access<a class=td-heading-self-link href=#ssh-access aria-label="Heading self-link"></a></h2><p><code>SSHAccess</code> indicates whether the <code>sshd.service</code> should be running on the worker nodes. This is ensured by a systemd service called <code>sshd-ensurer.service</code> which runs every 15 seconds on each worker node. When set to <code>true</code>, the systemd service ensures that the <code>sshd.service</code> is unmasked, enabled and running. If it is set to <code>false</code>, the systemd service ensures that <code>sshd.service</code> is disabled, masked and stopped. This also terminates all established SSH connections on the host. In addition, when this value is set to <code>false</code>, existing <code>Bastion</code> resources are deleted during <code>Shoot</code> reconciliation and new ones are prevented from being created, SSH keypairs are not created/rotated, SSH keypair secrets are deleted from the Garden cluster, and the <code>gardener-user.service</code> is not deployed to the worker nodes.</p><p><code>sshAccess.enabled</code> is set to <code>true</code> by default.</p><h3 id=example-usage-in-a-shoot>Example Usage in a <code>Shoot</code><a class=td-heading-self-link href=#example-usage-in-a-shoot aria-label="Heading self-link"></a></h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  provider:
</span></span><span style=display:flex><span>    workersSettings:
</span></span><span style=display:flex><span>      sshAccess:
</span></span><span style=display:flex><span>        enabled: <span style=color:#00f>false</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-7ee42cd3cfa8dab6f22edee54663a915>13 - Workerless `Shoot`s</h1><div class=lead>What is a Workerless Shoot and how to create one</div><h1 id=workerless-shoots>Workerless <code>Shoot</code>s<a class=td-heading-self-link href=#workerless-shoots aria-label="Heading self-link"></a></h1><p>Starting from <code>v1.71</code>, users can create a <code>Shoot</code> without any workers, known as a &ldquo;workerless <code>Shoot</code>&rdquo;. Previously, worker nodes had to always be included even if users only needed the Kubernetes control plane. With workerless <code>Shoot</code>s, Gardener will not create any worker nodes or anything related to them.</p><p>Here&rsquo;s an example manifest for a local workerless <code>Shoot</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>kind: Shoot
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: local
</span></span><span style=display:flex><span>  namespace: garden-local
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  cloudProfile:
</span></span><span style=display:flex><span>    name: local
</span></span><span style=display:flex><span>  region: local
</span></span><span style=display:flex><span>  provider:
</span></span><span style=display:flex><span>    type: local
</span></span><span style=display:flex><span>  kubernetes:
</span></span><span style=display:flex><span>    version: 1.31.1
</span></span></code></pre></div><blockquote><p>&#9888;&#xfe0f; It&rsquo;s important to note that a workerless <code>Shoot</code> cannot be converted to a <code>Shoot</code> with workers or vice versa.</p></blockquote><p>As part of the control plane, the following components are deployed in the seed cluster for workerless <code>Shoot</code>:</p><ul><li>etcds</li><li>kube-apiserver</li><li>kube-controller-manager</li><li>gardener-resource-manager</li><li>logging and monitoring components</li><li>extension components (if they support workerless <code>Shoot</code>s, see <a href=/docs/gardener/extensions/resources/extension/#what-is-required-to-register-and-support-an-extension-type>here</a>)</li></ul></div></main></div></div><footer class="footer row d-print-none"><div class="container-fluid footer-wrapper"><ul class=nav><li><a href=https://demo.gardener.cloud>Demo</a></li><li><a href=https://gardener.cloud/adopter/>Adopters</a></li><li><a href=/docs/>Documentation</a></li><li><a href=https://gardener.cloud/blog/>Blogs</a></li><li><a href=https://gardener.cloud/community/>Community</a></li></ul><img src=/images/lp/gardener-logo.svg alt="Logo Gardener" class=logo><ul class=media-wr><li><a target=_blank href=https://gardener-cloud.slack.com/><img src=/images/branding/slack-logo-white.svg class=media-icon><div class=media-text>Slack</div></a></li><li><a target=_blank href=https://github.com/gardener><img src=/images/branding/github-mark-logo.png class=media-icon><div class=media-text>GitHub</div></a></li><li><a target=_blank href=https://www.youtube.com/channel/UCwUhwKFREV8Su0gwAJQX7tw><img src=/images/branding/youtube-logo-dark.svg class=media-icon><div class=media-text>YouTube</div></a></li><li><a target=_blank href=https://x.com/GardenerProject><img src=/images/branding/x-logo-white.svg class=media-icon><div class=media-text>X</div></a></li></ul><span class=copyright>Copyright 2019-2025 Gardener project authors.
<a href=https://www.sap.com/about/legal/terms-of-use.html>Terms of Use
<i class="fa fa-external-link" aria-hidden=true></i>
</a>|
<a href=https://www.sap.com/about/legal/terms-of-use.html>Privacy Statement
<i class="fa fa-external-link" aria-hidden=true></i>
</a>|
<a href=https://www.sap.com/about/legal/terms-of-use.html>Legal Disclosure
<i class="fa fa-external-link" aria-hidden=true></i></a></span></div></footer></div><script src=/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script><script src=/js/navbar.js></script><script src=/js/filtering.js></script><script src=/js/page-content.js></script></body></html>