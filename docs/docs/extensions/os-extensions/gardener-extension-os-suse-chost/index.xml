<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Gardener â€“ SUSE CHost OS</title><link>https://gardener.cloud/docs/extensions/os-extensions/gardener-extension-os-suse-chost/</link><description>Recent content in SUSE CHost OS on Gardener</description><generator>Hugo -- gohugo.io</generator><language>en-US</language><atom:link href="https://gardener.cloud/docs/extensions/os-extensions/gardener-extension-os-suse-chost/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: Usage As End User</title><link>https://gardener.cloud/docs/extensions/os-extensions/gardener-extension-os-suse-chost/docs/usage-as-end-user/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://gardener.cloud/docs/extensions/os-extensions/gardener-extension-os-suse-chost/docs/usage-as-end-user/</guid><description>
&lt;h1 id="using-the-suse-chost-extension-with-gardener-as-end-user">Using the SuSE CHost extension with Gardener as end-user&lt;/h1>
&lt;p>The &lt;a href="https://github.com/gardener/gardener/blob/master/example/90-shoot.yaml">&lt;code>core.gardener.cloud/v1beta1.Shoot&lt;/code> resource&lt;/a> declares a few fields that must be considered when this OS extension is used.&lt;/p>
&lt;p>In this document we describe how this configuration looks like and under which circumstances your attention may be required.&lt;/p>
&lt;h2 id="aws-vpc-settings-for-suse-chost-workers">AWS VPC settings for SuSE CHost workers&lt;/h2>
&lt;p>Gardener allows you to create SuSE CHost based worker nodes by:&lt;/p>
&lt;ol>
&lt;li>Using a Gardener managed VPC&lt;/li>
&lt;li>Reusing a VPC that already exists (VPC &lt;code>id&lt;/code> specified in &lt;a href="https://github.com/gardener/gardener-extension-provider-aws/blob/master/docs/usage-as-end-user.md#infrastructureconfig">InfrastructureConfig&lt;/a>]&lt;/li>
&lt;/ol>
&lt;p>If the second option applies to your use-case please make sure that your VPC has enabled &lt;strong>DNS Support&lt;/strong>. Otherwise SuSE CHost based nodes aren&amp;rsquo;t able to join or operate in your cluster properly.&lt;/p>
&lt;p>&lt;strong>&lt;a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-dns.html">DNS&lt;/a>&lt;/strong> settings (required):&lt;/p>
&lt;ul>
&lt;li>&lt;code>enableDnsHostnames&lt;/code>: true&lt;/li>
&lt;li>&lt;code>enableDnsSupport&lt;/code>: true&lt;/li>
&lt;/ul>
&lt;h2 id="support-for-vsmp-memoryone">Support for vSMP MemoryOne&lt;/h2>
&lt;p>This extension controller is also capable of generating user-data for the &lt;a href="https://www.scalemp.com/products/vsmp-memoryone/">vSMP MemoryOne&lt;/a> operating system in conjunction with SuSE CHost.
It reacts on the &lt;code>memoryone-chost&lt;/code> extension type.
Additionally, it allows certain customizations with the following configuration:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">memoryone-chost.os.extensions.gardener.cloud/v1alpha1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">OperatingSystemConfiguration&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">memoryTopology&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;3&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">systemMemory&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;7x&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>The &lt;code>memoryTopology&lt;/code> field controls the &lt;code>mem_topology&lt;/code> setting. If it&amp;rsquo;s not provided then it will default to &lt;code>2&lt;/code>.&lt;/li>
&lt;li>The &lt;code>systemMemory&lt;/code> field controls the &lt;code>system_memory&lt;/code> setting. If it&amp;rsquo;s not provided then it defaults to &lt;code>6x&lt;/code>.&lt;/li>
&lt;/ul>
&lt;p>Please note that it was only e2e-tested on AWS.
Additionally, you need a snapshot ID of a SuSE CHost/CHost volume (see below how to create it).&lt;/p>
&lt;p>An exemplary worker pool configuration inside a &lt;code>Shoot&lt;/code> resource using for the vSMP MemoryOne operating system would look as follows:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">core.gardener.cloud/v1beta1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Shoot&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">vsmp-memoryone&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">garden-foo&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">workers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cpu-worker3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">minimum&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">maximum&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">maxSurge&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">maxUnavailable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">machine&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">memoryone-chost&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">9.5.195&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">providerConfig&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">memoryone-chost.os.extensions.gardener.cloud/v1alpha1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">OperatingSystemConfiguration&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">memoryTopology&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">systemMemory&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;6x&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">c5d.metal&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volume&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">size&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">20Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">gp2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">dataVolumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">chost&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">size&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">50Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">gp2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">providerConfig&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">aws.provider.extensions.gardener.cloud/v1alpha1&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">WorkerConfig&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">dataVolumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">chost&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">snapshotID&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">snap-123456&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">zones&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">eu-central-1b&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Please note that vSMP MemoryOne only works for EC2 bare-metal instance types such as &lt;code>M5d&lt;/code>, &lt;code>R5&lt;/code>, &lt;code>C5&lt;/code>, &lt;code>C5d&lt;/code>, etc. - please consult &lt;a href="https://aws.amazon.com/ec2/instance-types/">the EC2 instance types overview page&lt;/a> and the documentation of vSMP MemoryOne to find out whether the instance type in question is eligible.&lt;/p>
&lt;h3 id="generating-an-aws-snapshot-id-for-the-chostchost-operating-system">Generating an AWS snapshot ID for the CHost/CHost operating system&lt;/h3>
&lt;p>The following script will help to generate the snapshot ID on AWS.
It runs in the region that is selected in your &lt;code>$HOME/.aws/config&lt;/code> file.
Consequently, if you want to generate the snapshot in multiple regions, you have to run in multiple times after configuring the respective region using &lt;code>aws configure&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="nv">ami&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;ami-1234&amp;#34;&lt;/span> &lt;span class="c1">#Replace the ami with the intended one. &lt;/span>
&lt;span class="nv">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>aws ec2 describe-images --image-ids &lt;span class="nv">$ami&lt;/span> --query&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Images[].Name&amp;#34;&lt;/span> --output&lt;span class="o">=&lt;/span>text&lt;span class="sb">`&lt;/span>
&lt;span class="nv">cur&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>aws ec2 describe-snapshots --filter&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Name=description,Values=snap-&lt;/span>&lt;span class="nv">$name&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> --query&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Snapshots[].Description&amp;#34;&lt;/span> --output&lt;span class="o">=&lt;/span>text&lt;span class="sb">`&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> -n &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$cur&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;AMI &lt;/span>&lt;span class="nv">$name&lt;/span>&lt;span class="s2"> exists as snapshot &lt;/span>&lt;span class="nv">$cur&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;span class="k">continue&lt;/span>
&lt;span class="k">fi&lt;/span>
&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;AMI &lt;/span>&lt;span class="nv">$name&lt;/span>&lt;span class="s2"> ... creating private snapshot&amp;#34;&lt;/span>
&lt;span class="nv">inst&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>aws ec2 run-instances --instance-type t3.nano --image-id &lt;span class="nv">$ami&lt;/span> --query &lt;span class="s1">&amp;#39;Instances[0].InstanceId&amp;#39;&lt;/span> --output&lt;span class="o">=&lt;/span>text --subnet-id subnet-1234 --tag-specifications &lt;span class="s1">&amp;#39;ResourceType=instance,Tags=[{Key=scalemp-test,Value=scalemp-test}]&amp;#39;&lt;/span>&lt;span class="sb">`&lt;/span> &lt;span class="c1">#Replace the subnet-id with the intended one.&lt;/span>
aws ec2 &lt;span class="nb">wait&lt;/span> instance-running --instance-ids &lt;span class="nv">$inst&lt;/span>
&lt;span class="nv">vol&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>aws ec2 describe-instances --instance-ids &lt;span class="nv">$inst&lt;/span> --query &lt;span class="s2">&amp;#34;Reservations[].Instances[].BlockDeviceMappings[0].Ebs.VolumeId&amp;#34;&lt;/span> --output&lt;span class="o">=&lt;/span>text&lt;span class="sb">`&lt;/span>
&lt;span class="nv">snap&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>aws ec2 create-snapshot --description &lt;span class="s2">&amp;#34;snap-&lt;/span>&lt;span class="nv">$name&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> --volume-id &lt;span class="nv">$vol&lt;/span> --query&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;SnapshotId&amp;#39;&lt;/span> --tag-specifications &lt;span class="s2">&amp;#34;ResourceType=snapshot,Tags=[{Key=Name,Value=\&amp;#34;&lt;/span>&lt;span class="nv">$name&lt;/span>&lt;span class="s2">\&amp;#34;}]&amp;#34;&lt;/span> --output&lt;span class="o">=&lt;/span>text&lt;span class="sb">`&lt;/span>
aws ec2 &lt;span class="nb">wait&lt;/span> snapshot-completed --snapshot-ids &lt;span class="nv">$snap&lt;/span>
aws ec2 terminate-instances --instance-id &lt;span class="nv">$inst&lt;/span> &amp;gt; /dev/null
&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$snap&lt;/span>
&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>