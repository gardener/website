<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://gardener.cloud/docs/gardener/deployment/><link rel=alternate type=application/rss+xml href=https://gardener.cloud/docs/gardener/deployment/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Deployment | Gardener</title><meta name=description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta property="og:url" content="https://gardener.cloud/docs/gardener/deployment/"><meta property="og:site_name" content="Gardener"><meta property="og:title" content="Deployment"><meta property="og:description" content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta property="og:locale" content="en_US"><meta property="og:type" content="website"><meta property="og:image" content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta itemprop=name content="Deployment"><meta itemprop=description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta itemprop=image content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta name=twitter:title content="Deployment"><meta name=twitter:description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><link rel=preload href=/scss/main.min.64d56283aba037cc3a217d684edadfb4e3c57ca54122947d2f030f74bcd28a27.css as=style integrity="sha256-ZNVig6ugN8w6IX1oTtrftOPFfKVBIpR9LwMPdLzSiic=" crossorigin=anonymous><link href=/scss/main.min.64d56283aba037cc3a217d684edadfb4e3c57ca54122947d2f030f74bcd28a27.css rel=stylesheet integrity="sha256-ZNVig6ugN8w6IX1oTtrftOPFfKVBIpR9LwMPdLzSiic=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg width="90" height="90" viewBox="0 0 90 90" xmlns:xlink="http://www.w3.org/1999/xlink"><title>logo</title><desc>Created with Sketch.</desc><defs><path d="M41.8864954.994901575c.996545099999999-.479910833 2.6164002-.477918931 3.6088091.0L76.8159138 16.0781121C77.8124589 16.5580229 78.8208647 17.8257185 79.0659694 18.8995926l7.7355517 33.8916663C87.0476474 53.8696088 86.6852538 55.4484075 85.9984855 56.3095876L64.3239514 83.4885938C63.6343208 84.3533632 62.1740175 85.0543973 61.0725268 85.0543973H26.3092731c-1.1060816.0-2.5646564-.704623400000003-3.2514246-1.5658035L1.38331434 56.3095876C.693683723 55.4448182.335174016 53.865133.580278769 52.7912589L8.31583044 18.8995926C8.56195675 17.8212428 9.57347722 16.556031 10.5658861 16.0781121L41.8864954.994901575z" id="path-1"/><linearGradient x1="12.7542673%" y1="-18.6617048%" x2="88.2666158%" y2="84.6075483%" id="linearGradient-3"><stop stop-color="#FFF" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="50%" y1="4.93673768%" x2="148.756007%" y2="175.514523%" id="linearGradient-4"><stop stop-color="#FFF" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="19.1574381%" y1="-9.04800713%" x2="82.2203149%" y2="77.9084293%" id="linearGradient-5"><stop stop-color="#FFF" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="57.4403751%" y1="26.3148481%" x2="137.966711%" y2="158.080556%" id="linearGradient-6"><stop stop-color="#FFF" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="logo"><g id="Rectangle-2" transform="translate(1.000000, 0.000000)"><mask id="mask-2" fill="#fff"><use xlink:href="#path-1"/></mask><use id="Mask" fill="#009F76" xlink:href="#path-1"/><polygon fill="#000" opacity=".289628623" mask="url(#mask-2)" points="-17.6484375 54.5224609 30.8242188 25.0791016 63.4726562 58.5 24.7324219 92.6689453"/></g><path d="M56.8508631 39.260019C56.4193519 40.443987 55.6088085 41.581593 54.6736295 42.1938694l-8.0738997 5.2861089c-1.3854671.907087099999998-3.6247515.9116711-5.0172201.0L33.50861 42.1938694C32.123143 41.2867823 31 39.206345 31 37.545932V26.4150304c0-.725313.2131118-1.5301454.569268099999999-2.2825772L56.8508631 39.260019z" id="Combined-Shape" fill="url(#linearGradient-3)" transform="translate(43.925432, 36.147233) scale(-1, 1) translate(-43.925432, -36.147233)"/><path d="M56.0774672 25.1412464C56.4306829 25.8903325 56.6425556 26.6907345 56.6425556 27.4119019V38.5428034c0 1.6598979-1.1161415 3.73626640000001-2.50861 4.6479374l-8.0738997 5.286109c-1.3854671.907087000000004-3.6247516.911671000000005-5.0172201.0L32.9689261 43.1907408C32.2918101 42.7474223 31.6773514 42.0238435 31.2260376 41.206007L56.0774672 25.1412464z" id="Combined-Shape" fill="url(#linearGradient-4)" transform="translate(43.821278, 37.246598) scale(-1, 1) translate(-43.821278, -37.246598)"/><path d="M65.0702134 57.1846889C64.5985426 58.2007851 63.8367404 59.1236871 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.1597438 58.7930183 24 56.7816693 24 55.1323495V37.1145303C24 36.3487436 24.249712 35.5060005 24.6599102 34.7400631L65.0702134 57.1846889z" id="Combined-Shape" fill="url(#linearGradient-5)"/><path d="M65.0189476 34.954538C65.3636909 35.6617313 65.5692194 36.42021 65.5692194 37.1145303V55.1323495C65.5692194 56.7842831 64.4072119 58.7943252 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.9237304 59.2341061 25.3159155 58.5918431 24.8568495 57.8487596L65.0189476 34.954538z" id="Combined-Shape" fill="url(#linearGradient-6)"/></g></g></svg></span><span class=navbar-brand__name>Gardener</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://demo.gardener.cloud target=_blank rel=noopener><span>Demo</span></a></li><li class=nav-item><a class=nav-link href=/adopter><span>Adopters</span></a></li><li class=nav-item><a class=nav-link href=/docs><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/blog><span>Blogs</span></a></li><li class=nav-item><a class=nav-link href=/community><span>Community</span></a></li><li class=nav-item><a class=nav-link href=https://join.slack.com/t/gardener-cloud/shared_invite/zt-33c9daems-3oOorhnqOSnldZPWqGmIBw target=_blank rel=noopener><span>Join us on</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.0364fcacf5988c666dfcede3b5edb6bd.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/gardener/deployment/>Return to the regular view of this page</a>.</p></div><h1 class=title>Deployment</h1><div class=content></div></div><div class=td-content><h1 id=pg-b1cfab34422422de1f43457e8491a94f>1 - Authentication Gardener Control Plane</h1><h1 id=authentication-of-gardener-control-plane-components-against-the-garden-cluster>Authentication of Gardener Control Plane Components Against the Garden Cluster<a class=td-heading-self-link href=#authentication-of-gardener-control-plane-components-against-the-garden-cluster aria-label="Heading self-link"></a></h1><blockquote><p><strong>Note:</strong> This document refers to Gardener&rsquo;s API server, admission controller, controller manager and scheduler components. Any reference to the term <strong>Gardener control plane component</strong> can be replaced with any of the mentioned above.</p></blockquote><p>There are several authentication possibilities depending on whether or not <a href=https://github.com/gardener/garden-setup#concept-the-virtual-cluster>the concept of Virtual Garden</a> is used.</p><h2 id=virtual-garden-is-not-used-ie-the-runtime-garden-cluster-is-also-the-target-garden-cluster>Virtual Garden is not used, i.e., the <code>runtime</code> Garden cluster is also the <code>target</code> Garden cluster.<a class=td-heading-self-link href=#virtual-garden-is-not-used-ie-the-runtime-garden-cluster-is-also-the-target-garden-cluster aria-label="Heading self-link"></a></h2><h3 id=automounted-service-account-token>Automounted Service Account Token<a class=td-heading-self-link href=#automounted-service-account-token aria-label="Heading self-link"></a></h3><p>The easiest way to deploy a <strong>Gardener control plane component</strong> is to not provide a <code>kubeconfig</code> at all. This way in-cluster configuration and an automounted service account token will be used. The drawback of this approach is that the automounted token will not be automatically rotated.</p><h3 id=service-account-token-volume-projection>Service Account Token Volume Projection<a class=td-heading-self-link href=#service-account-token-volume-projection aria-label="Heading self-link"></a></h3><p>Another solution is to use <a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#service-account-token-volume-projection>Service Account Token Volume Projection</a> combined with a <code>kubeconfig</code> referencing a token file (see the example below).</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Config
</span></span><span style=display:flex><span>clusters:
</span></span><span style=display:flex><span>- cluster:
</span></span><span style=display:flex><span>    certificate-authority-data: &lt;CA-DATA&gt;
</span></span><span style=display:flex><span>    server: https://default.kubernetes.svc.cluster.local
</span></span><span style=display:flex><span>  name: garden
</span></span><span style=display:flex><span>contexts:
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>    cluster: garden
</span></span><span style=display:flex><span>    user: garden
</span></span><span style=display:flex><span>  name: garden
</span></span><span style=display:flex><span>current-context: garden
</span></span><span style=display:flex><span>users:
</span></span><span style=display:flex><span>- name: garden
</span></span><span style=display:flex><span>  user:
</span></span><span style=display:flex><span>    tokenFile: /var/run/secrets/projected/serviceaccount/token
</span></span></code></pre></div><p>This will allow for automatic rotation of the service account token by the <code>kubelet</code>. The configuration can be achieved by setting both <code>.Values.global.&lt;GardenerControlPlaneComponent>.serviceAccountTokenVolumeProjection.enabled: true</code> and <code>.Values.global.&lt;GardenerControlPlaneComponent>.kubeconfig</code> in the respective chart&rsquo;s <code>values.yaml</code> file.</p><h2 id=virtual-garden-is-used-ie-the-runtime-garden-cluster-is-different-from-the-target-garden-cluster>Virtual Garden is used, i.e., the <code>runtime</code> Garden cluster is different from the <code>target</code> Garden cluster.<a class=td-heading-self-link href=#virtual-garden-is-used-ie-the-runtime-garden-cluster-is-different-from-the-target-garden-cluster aria-label="Heading self-link"></a></h2><h3 id=service-account>Service Account<a class=td-heading-self-link href=#service-account aria-label="Heading self-link"></a></h3><p>The easiest way to setup the authentication is to create a service account and the respective roles will be bound to this service account in the <code>target</code> cluster. Then use the generated service account token and craft a <code>kubeconfig</code>, which will be used by the workload in the <code>runtime</code> cluster. This approach does not provide a solution for the rotation of the service account token. However, this setup can be achieved by setting <code>.Values.global.deployment.virtualGarden.enabled: true</code> and following these steps:</p><ol><li>Deploy the <code>application</code> part of the charts in the <code>target</code> cluster.</li><li>Get the service account token and craft the <code>kubeconfig</code>.</li><li>Set the crafted <code>kubeconfig</code> and deploy the <code>runtime</code> part of the charts in the <code>runtime</code> cluster.</li></ol><h3 id=client-certificate>Client Certificate<a class=td-heading-self-link href=#client-certificate aria-label="Heading self-link"></a></h3><p>Another solution is to bind the roles in the <code>target</code> cluster to a <code>User</code> subject instead of a service account and use a client certificate for authentication. This approach does not provide a solution for the client certificate rotation. However, this setup can be achieved by setting both <code>.Values.global.deployment.virtualGarden.enabled: true</code> and <code>.Values.global.deployment.virtualGarden.&lt;GardenerControlPlaneComponent>.user.name</code>, then following these steps:</p><ol><li>Generate a client certificate for the <code>target</code> cluster for the respective user.</li><li>Deploy the <code>application</code> part of the charts in the <code>target</code> cluster.</li><li>Craft a <code>kubeconfig</code> using the already generated client certificate.</li><li>Set the crafted <code>kubeconfig</code> and deploy the <code>runtime</code> part of the charts in the <code>runtime</code> cluster.</li></ol><h3 id=projected-service-account-token>Projected Service Account Token<a class=td-heading-self-link href=#projected-service-account-token aria-label="Heading self-link"></a></h3><p>This approach requires an already deployed and configured <a href=https://github.com/gardener/oidc-webhook-authenticator>oidc-webhook-authenticator</a> for the <code>target</code> cluster. Also, the <code>runtime</code> cluster should be registered as a trusted identity provider in the <code>target</code> cluster. Then, projected service accounts tokens from the <code>runtime</code> cluster can be used to authenticate against the <code>target</code> cluster. The needed steps are as follows:</p><ol><li>Deploy <a href=https://github.com/gardener/oidc-webhook-authenticator>OWA</a> and establish the needed trust.</li><li>Set <code>.Values.global.deployment.virtualGarden.enabled: true</code> and <code>.Values.global.deployment.virtualGarden.&lt;GardenerControlPlaneComponent>.user.name</code>.<blockquote><p><strong>Note:</strong> username value will depend on the trust configuration, e.g., <code>&lt;prefix>:system:serviceaccount:&lt;namespace>:&lt;serviceaccount></code></p></blockquote></li><li>Set <code>.Values.global.&lt;GardenerControlPlaneComponent>.serviceAccountTokenVolumeProjection.enabled: true</code> and <code>.Values.global.&lt;GardenerControlPlaneComponent>.serviceAccountTokenVolumeProjection.audience</code>.<blockquote><p><strong>Note:</strong> audience value will depend on the trust configuration, e.g., <code>&lt;client-id-from-trust-config></code>.</p></blockquote></li><li>Craft a kubeconfig (see the example below).</li><li>Deploy the <code>application</code> part of the charts in the <code>target</code> cluster.</li><li>Deploy the <code>runtime</code> part of the charts in the <code>runtime</code> cluster.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Config
</span></span><span style=display:flex><span>clusters:
</span></span><span style=display:flex><span>- cluster:
</span></span><span style=display:flex><span>    certificate-authority-data: &lt;CA-DATA&gt;
</span></span><span style=display:flex><span>    server: https://virtual-garden.api
</span></span><span style=display:flex><span>  name: virtual-garden
</span></span><span style=display:flex><span>contexts:
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>    cluster: virtual-garden
</span></span><span style=display:flex><span>    user: virtual-garden
</span></span><span style=display:flex><span>  name: virtual-garden
</span></span><span style=display:flex><span>current-context: virtual-garden
</span></span><span style=display:flex><span>users:
</span></span><span style=display:flex><span>- name: virtual-garden
</span></span><span style=display:flex><span>  user:
</span></span><span style=display:flex><span>    tokenFile: /var/run/secrets/projected/serviceaccount/token
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-ac0acc1100465755b2c4985cf68f7409>2 - Configuring Logging</h1><h1 id=configuring-the-logging-stack-via-gardenlet-configurations>Configuring the Logging Stack via gardenlet Configurations<a class=td-heading-self-link href=#configuring-the-logging-stack-via-gardenlet-configurations aria-label="Heading self-link"></a></h1><h2 id=enable-the-logging>Enable the Logging<a class=td-heading-self-link href=#enable-the-logging aria-label="Heading self-link"></a></h2><p>In order to install the Gardener logging stack, the <code>logging.enabled</code> configuration option has to be enabled in the Gardenlet configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>logging:
</span></span><span style=display:flex><span>  enabled: <span style=color:#00f>true</span>
</span></span></code></pre></div><p>From now on, each Seed is going to have a logging stack which will collect logs from all pods and some systemd services. Logs related to Shoots with <code>testing</code> purpose are dropped in the <code>fluent-bit</code> output plugin. Shoots with a purpose different than <code>testing</code> have the same type of log aggregator (but different instance) as the Seed. The logs can be viewed in the Plutono in the <code>garden</code> namespace for the Seed components and in the respective shoot control plane namespaces.</p><h2 id=enable-logs-from-the-shoots-node-systemd-services>Enable Logs from the Shoot&rsquo;s Node systemd Services<a class=td-heading-self-link href=#enable-logs-from-the-shoots-node-systemd-services aria-label="Heading self-link"></a></h2><p>The logs from the systemd services on each node can be retrieved by enabling the <code>logging.shootNodeLogging</code> option in the gardenlet configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>logging:
</span></span><span style=display:flex><span>  enabled: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>  shootNodeLogging:
</span></span><span style=display:flex><span>    shootPurposes:
</span></span><span style=display:flex><span>    - <span style=color:#a31515>&#34;evaluation&#34;</span>
</span></span><span style=display:flex><span>    - <span style=color:#a31515>&#34;deployment&#34;</span>
</span></span></code></pre></div><p>Under the <code>shootPurpose</code> section, just list all the shoot purposes for which the Shoot node logging feature will be enabled. Specifying the <code>testing</code> purpose has no effect because this purpose prevents the logging stack installation.
Logs can be viewed in the operator Plutono!
The dedicated labels are <code>unit</code>, <code>syslog_identifier</code>, and <code>nodename</code> in the <code>Explore</code> menu.</p><h2 id=configuring-central-vali-storage-capacity>Configuring Central Vali Storage Capacity<a class=td-heading-self-link href=#configuring-central-vali-storage-capacity aria-label="Heading self-link"></a></h2><p>By default, the central Vali has <code>100Gi</code> of storage capacity.
To overwrite the current central Vali storage capacity, the <code>logging.vali.garden.storage</code> setting in the gardenlet&rsquo;s component configuration should be altered.
If you need to increase it, you can do so without losing the current data by specifying a higher capacity. By doing so, the Vali&rsquo;s <code>PersistentVolume</code> capacity will be increased instead of deleting the current PV.
However, if you specify less capacity, then the <code>PersistentVolume</code> will be deleted and with it the logs, too.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>logging:
</span></span><span style=display:flex><span>  enabled: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>  vali:
</span></span><span style=display:flex><span>    garden:
</span></span><span style=display:flex><span>      storage: <span style=color:#a31515>&#34;200Gi&#34;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-e2f3032b3740e0030af0d52262ec390e>3 - Deploy Gardenlet</h1><h1 id=deploying-gardenlets>Deploying Gardenlets<a class=td-heading-self-link href=#deploying-gardenlets aria-label="Heading self-link"></a></h1><p>Gardenlets act as decentralized agents to manage the shoot clusters of a seed cluster.</p><h2 id=procedure>Procedure<a class=td-heading-self-link href=#procedure aria-label="Heading self-link"></a></h2><p>After you have deployed the Gardener control plane, you need one or more seed clusters in order to be able to create shoot clusters.</p><p>You can either register an existing cluster as &ldquo;seed&rdquo; (this could also be the cluster in which the control plane runs), or you can create new clusters (typically shoots, i.e., this approach registers at least one first initial seed) and then register them as &ldquo;seeds&rdquo;.</p><p>The following sections describe the scenarios.</p><h3 id=register-a-first-seed-cluster>Register A First Seed Cluster<a class=td-heading-self-link href=#register-a-first-seed-cluster aria-label="Heading self-link"></a></h3><p>If you have not registered a seed cluster yet (thus, you need to deploy a first, so-called &ldquo;unmanaged seed&rdquo;), your approach depends on how you deployed the Gardener control plane.</p><h4 id=gardener-control-plane-deployed-via-gardenercontrolplane>Gardener Control Plane Deployed Via <a href=https://github.com/gardener/gardener/tree/master/charts/gardener/controlplane><code>gardener/controlplane</code> Helm chart</a><a class=td-heading-self-link href=#gardener-control-plane-deployed-via-gardenercontrolplane aria-label="Heading self-link"></a></h4><p>You can follow <a href=/docs/gardener/deployment/deploy_gardenlet_manually/>Deploy a gardenlet Manually</a>.</p><h4 id=gardener-control-plane-deployed-via-gardener-operator>Gardener Control Plane Deployed Via <a href=/docs/gardener/concepts/operator/><code>gardener-operator</code></a><a class=td-heading-self-link href=#gardener-control-plane-deployed-via-gardener-operator aria-label="Heading self-link"></a></h4><ol><li>If you want to register the same cluster in which <code>gardener-operator</code> runs, or if you want to register another cluster that is reachable (network-wise) for <code>gardener-operator</code>, you can follow <a href=/docs/gardener/deployment/deploy_gardenlet_via_operator/>Deploy gardenlet via <code>gardener-operator</code></a>.</li><li>If you want to register a cluster that is not reachable (network-wise) (e.g., because it runs behind a firewall), you can follow <a href=/docs/gardener/deployment/deploy_gardenlet_manually/>Deploy a gardenlet Manually</a>.</li></ol><h3 id=register-further-seed-clusters>Register Further Seed Clusters<a class=td-heading-self-link href=#register-further-seed-clusters aria-label="Heading self-link"></a></h3><p>If you already have a seed cluster, and you want to deploy further seed clusters (so-called &ldquo;managed seeds&rdquo;), you can follow <a href=/docs/gardener/deployment/deploy_gardenlet_automatically/>Deploy a gardenlet Automatically</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0af204f84f4a80fc61988beb16c39e12>4 - Deploy Gardenlet Automatically</h1><h1 id=deploy-a-gardenlet-automatically>Deploy a gardenlet Automatically<a class=td-heading-self-link href=#deploy-a-gardenlet-automatically aria-label="Heading self-link"></a></h1><p>The gardenlet can automatically deploy itself into shoot clusters, and register them as seed clusters.
These clusters are called &ldquo;managed seeds&rdquo; (aka &ldquo;shooted seeds&rdquo;).
This procedure is the preferred way to add additional seed clusters, because shoot clusters already come with production-grade qualities that are also demanded for seed clusters.</p><h2 id=prerequisites>Prerequisites<a class=td-heading-self-link href=#prerequisites aria-label="Heading self-link"></a></h2><p>The only prerequisite is to register an initial cluster as a seed cluster that already has a deployed gardenlet (for available options see <a href=/docs/gardener/deployment/deploy_gardenlet/>Deploying Gardenlets</a>).</p><blockquote class="alert alert-tip"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>lightbulb-on-outline</title><path d="M20 11h3v2H20V11M1 11H4v2H1V11M13 1V4H11V1h2M4.92 3.5 7.05 5.64 5.63 7.05 3.5 4.93 4.92 3.5M16.95 5.63 19.07 3.5 20.5 4.93 18.37 7.05 16.95 5.63M12 6a6 6 0 016 6c0 2.22-1.21 4.16-3 5.2V19a1 1 0 01-1 1H10A1 1 0 019 19V17.2C7.21 16.16 6 14.22 6 12a6 6 0 016-6m2 15v1a1 1 0 01-1 1H11a1 1 0 01-1-1V21h4m-3-3h2V15.87c1.73-.44 3-2.01 3-3.87A4 4 0 0012 8 4 4 0 008 12c0 1.86 1.27 3.43 3 3.87V18z"/></svg><p>Tip</p></div><p>The initial seed cluster can be the garden cluster itself, but for better separation of concerns, it is recommended to only register other clusters as seeds.</p></blockquote><h2 id=auto-deployment-of-gardenlets-into-shoot-clusters>Auto-Deployment of Gardenlets into Shoot Clusters<a class=td-heading-self-link href=#auto-deployment-of-gardenlets-into-shoot-clusters aria-label="Heading self-link"></a></h2><p>For a better scalability of your Gardener landscape (e.g., when the total number of <code>Shoot</code>s grows), you usually need more seed clusters that you can create, as follows:</p><ol><li>Use the initial seed cluster (&ldquo;unmanaged seed&rdquo;) to create shoot clusters that you later register as seed clusters.</li><li>The gardenlet deployed in the initial cluster can deploy itself into the shoot clusters (which eventually makes them getting registered as seeds) if <code>ManagedSeed</code> resources are created.</li></ol><p>The advantage of this approach is that there&rsquo;s only one initial gardenlet installation required.
Every other managed seed cluster gets an automatically deployed gardenlet.</p><h2 id=related-links>Related Links<a class=td-heading-self-link href=#related-links aria-label="Heading self-link"></a></h2><ul><li><a href=/docs/gardener/managed_seed/><code>ManagedSeed</code>s: Register Shoot as Seed</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-ed3b289c8b619ea2a52bab3ae97c199c>5 - Deploy Gardenlet Manually</h1><h1 id=deploy-a-gardenlet-manually>Deploy a gardenlet Manually<a class=td-heading-self-link href=#deploy-a-gardenlet-manually aria-label="Heading self-link"></a></h1><p>Manually deploying a gardenlet is usually only required if the Kubernetes cluster to be registered as a seed cluster is managed via third-party tooling (i.e., the Kubernetes cluster is not a shoot cluster, so <a href=/docs/gardener/deployment/deploy_gardenlet_automatically/>Deploy a gardenlet Automatically</a> cannot be used).
In this case, <code>gardenlet</code> needs to be deployed manually, meaning that its <a href=https://github.com/gardener/gardener/tree/master/charts/gardener/gardenlet>Helm chart</a> must be installed.</p><blockquote class="alert alert-tip"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>lightbulb-on-outline</title><path d="M20 11h3v2H20V11M1 11H4v2H1V11M13 1V4H11V1h2M4.92 3.5 7.05 5.64 5.63 7.05 3.5 4.93 4.92 3.5M16.95 5.63 19.07 3.5 20.5 4.93 18.37 7.05 16.95 5.63M12 6a6 6 0 016 6c0 2.22-1.21 4.16-3 5.2V19a1 1 0 01-1 1H10A1 1 0 019 19V17.2C7.21 16.16 6 14.22 6 12a6 6 0 016-6m2 15v1a1 1 0 01-1 1H11a1 1 0 01-1-1V21h4m-3-3h2V15.87c1.73-.44 3-2.01 3-3.87A4 4 0 0012 8 4 4 0 008 12c0 1.86 1.27 3.43 3 3.87V18z"/></svg><p>Tip</p></div><p>Once you&rsquo;ve deployed a gardenlet manually, you can deploy new gardenlets automatically.
The manually deployed gardenlet is then used as a template for the new gardenlets.
For more information, see <a href=/docs/gardener/deployment/deploy_gardenlet_automatically/>Deploy a gardenlet Automatically</a>.</p></blockquote><h2 id=prerequisites>Prerequisites<a class=td-heading-self-link href=#prerequisites aria-label="Heading self-link"></a></h2><h3 id=kubernetes-cluster-that-should-be-registered-as-a-seed-cluster>Kubernetes Cluster that Should Be Registered as a Seed Cluster<a class=td-heading-self-link href=#kubernetes-cluster-that-should-be-registered-as-a-seed-cluster aria-label="Heading self-link"></a></h3><ul><li><p>Verify that the cluster has a <a href=/docs/gardener/shoot-operations/supported_k8s_versions/>supported Kubernetes version</a>.</p></li><li><p>Determine the nodes, pods, and services CIDR of the cluster.
You need to configure this information in the <code>Seed</code> configuration.
Gardener uses this information to check that the shoot cluster isn&rsquo;t created with overlapping CIDR ranges.</p></li><li><p>Every seed cluster needs an Ingress controller which distributes external requests to internal components like Plutono and Prometheus.
For this, configure the following lines in your <a href=https://github.com/gardener/gardener/blob/master/example/50-seed.yaml>Seed resource</a>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  dns:
</span></span><span style=display:flex><span>    provider:
</span></span><span style=display:flex><span>      type: aws-route53
</span></span><span style=display:flex><span>      secretRef:
</span></span><span style=display:flex><span>        name: ingress-secret
</span></span><span style=display:flex><span>        namespace: garden
</span></span><span style=display:flex><span>  ingress:
</span></span><span style=display:flex><span>    domain: ingress.my-seed.example.com
</span></span><span style=display:flex><span>    controller:
</span></span><span style=display:flex><span>      kind: nginx
</span></span><span style=display:flex><span>      providerConfig:
</span></span><span style=display:flex><span>        &lt;some-optional-provider-specific-config-for-the-ingressController&gt;
</span></span></code></pre></div></li></ul><h2 id=procedure-overview>Procedure Overview<a class=td-heading-self-link href=#procedure-overview aria-label="Heading self-link"></a></h2><ol><li>Prepare the garden cluster:<ol><li><a href=/docs/gardener/deployment/deploy_gardenlet_manually/#create-a-bootstrap-token-secret-in-the-kube-system-namespace-of-the-garden-cluster>Create a bootstrap token secret in the <code>kube-system</code> namespace of the garden cluster</a></li><li><a href=/docs/gardener/deployment/deploy_gardenlet_manually/#create-rbac-roles-for-the-gardenlet-to-allow-bootstrapping-in-the-garden-cluster>Create RBAC roles for the gardenlet to allow bootstrapping in the garden cluster</a></li></ol></li><li><a href=/docs/gardener/deployment/deploy_gardenlet_manually/#prepare-the-gardenlet-helm-chart>Prepare the gardenlet Helm chart</a>.</li><li><a href=/docs/gardener/deployment/deploy_gardenlet_manually/#automatically-register-shoot-cluster-as-a-seed-cluster>Automatically register shoot cluster as a seed cluster</a>.</li><li><a href=/docs/gardener/deployment/deploy_gardenlet_manually/#deploy-the-gardenlet>Deploy the gardenlet</a></li><li><a href=/docs/gardener/deployment/deploy_gardenlet_manually/#check-that-the-gardenlet-is-successfully-deployed>Check that the gardenlet is successfully deployed</a></li></ol><h2 id=create-a-bootstrap-token-secret-in-the-kube-system-namespace-of-the-garden-cluster>Create a Bootstrap Token Secret in the <code>kube-system</code> Namespace of the Garden Cluster<a class=td-heading-self-link href=#create-a-bootstrap-token-secret-in-the-kube-system-namespace-of-the-garden-cluster aria-label="Heading self-link"></a></h2><p>The gardenlet needs to talk to the <a href=/docs/gardener/concepts/apiserver/>Gardener API server</a> residing in the garden cluster.</p><p>Use gardenlet&rsquo;s ability to request a signed certificate for the garden cluster by leveraging <a href=https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/>Kubernetes Certificate Signing Requests</a>.
The gardenlet performs a TLS bootstrapping process that is similar to the <a href=https://kubernetes.io/docs/reference/access-authn-authz/kubelet-tls-bootstrapping/>Kubelet TLS Bootstrapping</a>.
Make sure that the API server of the garden cluster has <a href=https://kubernetes.io/docs/reference/access-authn-authz/bootstrap-tokens/#enabling-bootstrap-token-authentication>bootstrap token authentication</a> enabled.</p><p>The client credentials required for the gardenlet&rsquo;s TLS bootstrapping process need to be either <code>token</code> or <code>certificate</code> (OIDC isn&rsquo;t supported) and have permissions to create a Certificate Signing Request (<a href=https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/>CSR</a>).
It&rsquo;s recommended to use <a href=https://kubernetes.io/docs/reference/access-authn-authz/bootstrap-tokens/>bootstrap tokens</a> due to their desirable security properties (such as a limited token lifetime).</p><p>Therefore, first create a bootstrap token secret for the garden cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Secret
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  <span style=color:green># Name MUST be of form &#34;bootstrap-token-&lt;token id&gt;&#34;</span>
</span></span><span style=display:flex><span>  name: bootstrap-token-07401b
</span></span><span style=display:flex><span>  namespace: kube-system
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># Type MUST be &#39;bootstrap.kubernetes.io/token&#39;</span>
</span></span><span style=display:flex><span>type: bootstrap.kubernetes.io/token
</span></span><span style=display:flex><span>stringData:
</span></span><span style=display:flex><span>  <span style=color:green># Human readable description. Optional.</span>
</span></span><span style=display:flex><span>  description: <span style=color:#a31515>&#34;Token to be used by the gardenlet for Seed `sweet-seed`.&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:green># Token ID and secret. Required.</span>
</span></span><span style=display:flex><span>  token-id: 07401b <span style=color:green># 6 characters</span>
</span></span><span style=display:flex><span>  token-secret: f395accd246ae52d <span style=color:green># 16 characters</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:green># Expiration. Optional.</span>
</span></span><span style=display:flex><span>  <span style=color:green># expiration: 2017-03-10T03:22:11Z</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:green># Allowed usages.</span>
</span></span><span style=display:flex><span>  usage-bootstrap-authentication: <span style=color:#a31515>&#34;true&#34;</span>
</span></span><span style=display:flex><span>  usage-bootstrap-signing: <span style=color:#a31515>&#34;true&#34;</span>
</span></span></code></pre></div><p>When you later prepare the gardenlet Helm chart, a <code>kubeconfig</code> based on this token is shared with the gardenlet upon deployment.</p><h2 id=prepare-the-gardenlet-helm-chart>Prepare the gardenlet Helm Chart<a class=td-heading-self-link href=#prepare-the-gardenlet-helm-chart aria-label="Heading self-link"></a></h2><p>This section only describes the minimal configuration, using the global configuration values of the gardenlet Helm chart.
For an overview over all values, see the <a href=https://github.com/gardener/gardener/blob/master/charts/gardener/gardenlet/values.yaml>configuration values</a>.
We refer to the global configuration values as <em>gardenlet configuration</em> in the following procedure.</p><ol><li><p>Create a gardenlet configuration <code>gardenlet-values.yaml</code> based on <a href=https://github.com/gardener/gardener/blob/master/charts/gardener/gardenlet/values.yaml>this template</a>.</p></li><li><p>Create a bootstrap <code>kubeconfig</code> based on the bootstrap token created in the garden cluster.</p><p>Replace the <code>&lt;bootstrap-token></code> with <code>token-id.token-secret</code> (from our previous example: <code>07401b.f395accd246ae52d</code>) from the bootstrap token secret.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Config
</span></span><span style=display:flex><span>current-context: gardenlet-bootstrap@default
</span></span><span style=display:flex><span>clusters:
</span></span><span style=display:flex><span>- cluster:
</span></span><span style=display:flex><span>    certificate-authority-data: &lt;ca-of-garden-cluster&gt;
</span></span><span style=display:flex><span>    server: https://&lt;endpoint-of-garden-cluster&gt;
</span></span><span style=display:flex><span>  name: default
</span></span><span style=display:flex><span>contexts:
</span></span><span style=display:flex><span>- context:
</span></span><span style=display:flex><span>    cluster: default
</span></span><span style=display:flex><span>    user: gardenlet-bootstrap
</span></span><span style=display:flex><span>  name: gardenlet-bootstrap@default
</span></span><span style=display:flex><span>users:
</span></span><span style=display:flex><span>- name: gardenlet-bootstrap
</span></span><span style=display:flex><span>  user:
</span></span><span style=display:flex><span>    token: &lt;bootstrap-token&gt;
</span></span></code></pre></div></li><li><p>In the <code>gardenClientConnection.bootstrapKubeconfig</code> section of your gardenlet configuration, provide the bootstrap <code>kubeconfig</code> together with a name and namespace to the gardenlet Helm chart.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>gardenClientConnection:
</span></span><span style=display:flex><span>  bootstrapKubeconfig:
</span></span><span style=display:flex><span>    name: gardenlet-kubeconfig-bootstrap
</span></span><span style=display:flex><span>    namespace: garden
</span></span><span style=display:flex><span>    kubeconfig: |<span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515>      &lt;bootstrap-kubeconfig&gt;  # will be base64 encoded by helm</span>
</span></span></code></pre></div><p>The bootstrap <code>kubeconfig</code> is stored in the specified secret.</p></li><li><p>In the <code>gardenClientConnection.kubeconfigSecret</code> section of your gardenlet configuration, define a name and a namespace where the gardenlet stores the real <code>kubeconfig</code> that it creates during the bootstrap process.
If the secret doesn&rsquo;t exist, the gardenlet creates it for you.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>gardenClientConnection:
</span></span><span style=display:flex><span>  kubeconfigSecret:
</span></span><span style=display:flex><span>    name: gardenlet-kubeconfig
</span></span><span style=display:flex><span>    namespace: garden
</span></span></code></pre></div></li></ol><h3 id=updating-the-garden-cluster-ca>Updating the Garden Cluster CA<a class=td-heading-self-link href=#updating-the-garden-cluster-ca aria-label="Heading self-link"></a></h3><p>The kubeconfig created by the gardenlet in step 4 will not be recreated as long as it exists, even if a new bootstrap kubeconfig is provided.
To enable rotation of the garden cluster CA certificate, a new bundle can be provided via the <code>gardenClientConnection.gardenClusterCACert</code> field.
If the provided bundle differs from the one currently in the gardenlet&rsquo;s kubeconfig secret then it will be updated.
To remove the CA completely (e.g. when switching to a publicly trusted endpoint), this field can be set to either <code>none</code> or <code>null</code>.</p><h2 id=prepare-seed-specification>Prepare Seed Specification<a class=td-heading-self-link href=#prepare-seed-specification aria-label="Heading self-link"></a></h2><p>When gardenlet starts, it tries to register a <code>Seed</code> resource in the garden cluster based on the specification provided in <code>seedConfig</code> in its configuration.</p><blockquote><p>This procedure doesn&rsquo;t describe all the possible configurations for the <code>Seed</code> resource.
For more information, see:</p><ul><li><a href=https://github.com/gardener/gardener/blob/master/example/50-seed.yaml>Example Seed resource</a></li><li><a href=/docs/gardener/seed_settings/>Configurable Seed settings</a></li></ul></blockquote><ol><li><p>Supply the <code>Seed</code> resource in the <code>seedConfig</code> section of your gardenlet configuration <code>gardenlet-values.yaml</code>.</p></li><li><p>Add the <code>seedConfig</code> to your gardenlet configuration <code>gardenlet-values.yaml</code>.
The field <code>seedConfig.spec.provider.type</code> specifies the infrastructure provider type (for example, <code>aws</code>) of the seed cluster.
For all supported infrastructure providers, see <a href=/docs/extensions/#known-extension-implementations>Known Extension Implementations</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green># ...</span>
</span></span><span style=display:flex><span>seedConfig:
</span></span><span style=display:flex><span>  metadata:
</span></span><span style=display:flex><span>    name: sweet-seed
</span></span><span style=display:flex><span>    labels:
</span></span><span style=display:flex><span>      environment: evaluation
</span></span><span style=display:flex><span>    annotations:
</span></span><span style=display:flex><span>      custom.gardener.cloud/option: special
</span></span><span style=display:flex><span>  spec:
</span></span><span style=display:flex><span>    dns:
</span></span><span style=display:flex><span>      provider:
</span></span><span style=display:flex><span>        type: &lt;provider&gt;
</span></span><span style=display:flex><span>        secretRef:
</span></span><span style=display:flex><span>          name: ingress-secret
</span></span><span style=display:flex><span>          namespace: garden
</span></span><span style=display:flex><span>    ingress: <span style=color:green># see prerequisites</span>
</span></span><span style=display:flex><span>      domain: ingress.dev.my-seed.example.com
</span></span><span style=display:flex><span>      controller:
</span></span><span style=display:flex><span>        kind: nginx
</span></span><span style=display:flex><span>    networks: <span style=color:green># see prerequisites</span>
</span></span><span style=display:flex><span>      nodes: 10.240.0.0/16
</span></span><span style=display:flex><span>      pods: 100.244.0.0/16
</span></span><span style=display:flex><span>      services: 100.32.0.0/13
</span></span><span style=display:flex><span>      shootDefaults: # optional: non-overlapping default CIDRs for shoot clusters of that Seed
</span></span><span style=display:flex><span>        pods: 100.96.0.0/11
</span></span><span style=display:flex><span>        services: 100.64.0.0/13
</span></span><span style=display:flex><span>    provider:
</span></span><span style=display:flex><span>      region: eu-west-1
</span></span><span style=display:flex><span>      type: &lt;provider&gt;
</span></span></code></pre></div></li></ol><p>Apart from the seed&rsquo;s name, <code>seedConfig.metadata</code> can optionally contain <code>labels</code> and <code>annotations</code>.
gardenlet will set the labels of the registered <code>Seed</code> object to the labels given in the <code>seedConfig</code> plus <code>gardener.cloud/role=seed</code>.
Any custom labels on the <code>Seed</code> object will be removed on the next restart of gardenlet.
If a label is removed from the <code>seedConfig</code> it is removed from the <code>Seed</code> object as well.
In contrast to labels, annotations in the <code>seedConfig</code> are added to existing annotations on the <code>Seed</code> object.
Thus, custom annotations that are added to the <code>Seed</code> object during runtime are not removed by gardenlet on restarts.
Furthermore, if an annotation is removed from the <code>seedConfig</code>, gardenlet does <strong>not</strong> remove it from the <code>Seed</code> object.</p><h3 id=optional-enable-ha-mode>Optional: Enable HA Mode<a class=td-heading-self-link href=#optional-enable-ha-mode aria-label="Heading self-link"></a></h3><p>You may consider running <code>gardenlet</code> with multiple replicas, especially if the seed cluster is configured to host <a href=/docs/gardener/high-availability/shoot_high_availability/>HA shoot control planes</a>.
Therefore, the following Helm chart values define the degree of high availability you want to achieve for the <code>gardenlet</code> deployment.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>replicaCount: 2 <span style=color:green># or more if a higher failure tolerance is required.</span>
</span></span><span style=display:flex><span>failureToleranceType: zone <span style=color:green># One of `zone` or `node` - defines how replicas are spread.</span>
</span></span></code></pre></div><h3 id=optional-enable-backup-and-restore>Optional: Enable Backup and Restore<a class=td-heading-self-link href=#optional-enable-backup-and-restore aria-label="Heading self-link"></a></h3><p>The seed cluster can be set up with backup and restore for the main <code>etcds</code> of shoot clusters.</p><p>Gardener uses <a href=https://github.com/gardener/etcd-backup-restore>etcd-backup-restore</a> that <a href=https://github.com/gardener/etcd-backup-restore/blob/master/docs/deployment/getting_started.md>integrates with different storage providers</a> to store the shoot cluster&rsquo;s main <code>etcd</code> backups.
Make sure to obtain client credentials that have sufficient permissions with the chosen storage provider.</p><p>Create a secret in the garden cluster with client credentials for the storage provider.
The format of the secret is cloud provider specific and can be found in the repository of the respective Gardener extension.
For example, the secret for AWS S3 can be found in the AWS provider extension (<a href=https://github.com/gardener/gardener-extension-provider-aws/blob/master/example/30-etcd-backup-secret.yaml>30-etcd-backup-secret.yaml</a>).</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Secret
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: sweet-seed-backup
</span></span><span style=display:flex><span>  namespace: garden
</span></span><span style=display:flex><span>type: Opaque
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  <span style=color:green># client credentials format is provider specific</span>
</span></span></code></pre></div><p>Configure the <code>Seed</code> resource in the <code>seedConfig</code> section of your gardenlet configuration to use backup and restore:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green># ...</span>
</span></span><span style=display:flex><span>seedConfig:
</span></span><span style=display:flex><span>  metadata:
</span></span><span style=display:flex><span>    name: sweet-seed
</span></span><span style=display:flex><span>  spec:
</span></span><span style=display:flex><span>    backup:
</span></span><span style=display:flex><span>      provider: &lt;provider&gt;
</span></span><span style=display:flex><span>      secretRef:
</span></span><span style=display:flex><span>        name: sweet-seed-backup
</span></span><span style=display:flex><span>        namespace: garden
</span></span></code></pre></div><h3 id=optional-enable-self-upgrades>Optional: Enable Self-Upgrades<a class=td-heading-self-link href=#optional-enable-self-upgrades aria-label="Heading self-link"></a></h3><p>In order to take off the continuous task of deploying gardenlet&rsquo;s Helm chart in case you want to upgrade its version, it supports self-upgrades.
The way this works is that it pulls information (its configuration and deployment values) from a <code>seedmanagement.gardener.cloud/v1alpha1.Gardenlet</code> resource in the garden cluster.
This resource must be in the <code>garden</code> namespace and must have the same name as the <code>Seed</code> the gardenlet is responsible for.
For more information, see <a href=/docs/gardener/deployment/deploy_gardenlet_manually/#self-upgrades>this section</a>.</p><p>In order to make gardenlet automatically create a corresponding <code>seedmanagement.gardener.cloud/v1alpha1.Gardenlet</code> resource, you must provide</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>selfUpgrade:
</span></span><span style=display:flex><span>  deployment:
</span></span><span style=display:flex><span>    helm:
</span></span><span style=display:flex><span>      ociRepository:
</span></span><span style=display:flex><span>        ref: &lt;url-to-oci-repository-containing-gardenlet-helm-chart&gt;
</span></span></code></pre></div><p>in your <code>gardenlet-values.yaml</code> file.
Please replace the <code>ref</code> placeholder with the URL to the OCI repository containing the gardenlet Helm chart you are installing.</p><blockquote class="alert alert-note"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>information-outline</title><path d="M11 9h2V7H11m1 13c-4.41.0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2M11 17h2V11H11v6z"/></svg><p>Note</p></div><p>If you don&rsquo;t configure this <code>selfUpgrade</code> section in the initial deployment, you can also do it later, or you directly create the corresponding <code>seedmanagement.gardener.cloud/v1alpha1.Gardenlet</code> resource in the garden cluster.</p></blockquote><h2 id=deploy-the-gardenlet>Deploy the gardenlet<a class=td-heading-self-link href=#deploy-the-gardenlet aria-label="Heading self-link"></a></h2><p>The <code>gardenlet-values.yaml</code> looks something like this (with backup for shoot clusters enabled):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green># &lt;default config&gt;</span>
</span></span><span style=display:flex><span><span style=color:green># ...</span>
</span></span><span style=display:flex><span>config:
</span></span><span style=display:flex><span>  gardenClientConnection:
</span></span><span style=display:flex><span>    <span style=color:green># ...</span>
</span></span><span style=display:flex><span>    bootstrapKubeconfig:
</span></span><span style=display:flex><span>      name: gardenlet-bootstrap-kubeconfig
</span></span><span style=display:flex><span>      namespace: garden
</span></span><span style=display:flex><span>      kubeconfig: |<span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515>        apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#a31515>        clusters:
</span></span></span><span style=display:flex><span><span style=color:#a31515>        - cluster:
</span></span></span><span style=display:flex><span><span style=color:#a31515>            certificate-authority-data: &lt;dummy&gt;
</span></span></span><span style=display:flex><span><span style=color:#a31515>            server: &lt;my-garden-cluster-endpoint&gt;
</span></span></span><span style=display:flex><span><span style=color:#a31515>          name: my-kubernetes-cluster
</span></span></span><span style=display:flex><span><span style=color:#a31515>        # ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    kubeconfigSecret:
</span></span><span style=display:flex><span>      name: gardenlet-kubeconfig
</span></span><span style=display:flex><span>      namespace: garden
</span></span><span style=display:flex><span>  <span style=color:green># ...</span>
</span></span><span style=display:flex><span>  <span style=color:green># &lt;default config&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:green># ...</span>
</span></span><span style=display:flex><span>  seedConfig:
</span></span><span style=display:flex><span>    metadata:
</span></span><span style=display:flex><span>      name: sweet-seed
</span></span><span style=display:flex><span>    spec:
</span></span><span style=display:flex><span>      dns:
</span></span><span style=display:flex><span>        provider:
</span></span><span style=display:flex><span>          type: &lt;provider&gt;
</span></span><span style=display:flex><span>          secretRef:
</span></span><span style=display:flex><span>            name: ingress-secret
</span></span><span style=display:flex><span>            namespace: garden
</span></span><span style=display:flex><span>      ingress: <span style=color:green># see prerequisites</span>
</span></span><span style=display:flex><span>        domain: ingress.dev.my-seed.example.com
</span></span><span style=display:flex><span>        controller:
</span></span><span style=display:flex><span>          kind: nginx
</span></span><span style=display:flex><span>      networks:
</span></span><span style=display:flex><span>        nodes: 10.240.0.0/16
</span></span><span style=display:flex><span>        pods: 100.244.0.0/16
</span></span><span style=display:flex><span>        services: 100.32.0.0/13
</span></span><span style=display:flex><span>        shootDefaults:
</span></span><span style=display:flex><span>          pods: 100.96.0.0/11
</span></span><span style=display:flex><span>          services: 100.64.0.0/13
</span></span><span style=display:flex><span>      provider:
</span></span><span style=display:flex><span>        region: eu-west-1
</span></span><span style=display:flex><span>        type: &lt;provider&gt;
</span></span><span style=display:flex><span>      backup:
</span></span><span style=display:flex><span>        provider: &lt;provider&gt;
</span></span><span style=display:flex><span>        secretRef:
</span></span><span style=display:flex><span>          name: sweet-seed-backup
</span></span><span style=display:flex><span>          namespace: garden
</span></span></code></pre></div><p>Deploy the gardenlet Helm chart to the Kubernetes cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install gardenlet charts/gardener/gardenlet <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>  --namespace garden <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>  -f gardenlet-values.yaml <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>  --wait
</span></span></code></pre></div><p>This Helm chart creates:</p><ul><li>A service account <code>gardenlet</code> that the gardenlet can use to talk to the Seed API server.</li><li>RBAC roles for the service account (full admin rights at the moment).</li><li>The secret (<code>garden</code>/<code>gardenlet-bootstrap-kubeconfig</code>) containing the bootstrap <code>kubeconfig</code>.</li><li>The gardenlet deployment in the <code>garden</code> namespace.</li></ul><h2 id=check-that-the-gardenlet-is-successfully-deployed>Check that the gardenlet Is Successfully Deployed<a class=td-heading-self-link href=#check-that-the-gardenlet-is-successfully-deployed aria-label="Heading self-link"></a></h2><ol><li><p>Check that the gardenlets certificate bootstrap was successful.</p><p>Check if the secret <code>gardenlet-kubeconfig</code> in the namespace <code>garden</code> in the seed cluster
is created and contains a <code>kubeconfig</code> with a valid certificate.</p><ol><li><p>Get the <code>kubeconfig</code> from the created secret.</p><pre tabindex=0><code>$ kubectl -n garden get secret gardenlet-kubeconfig -o json | jq -r .data.kubeconfig | base64 -d
</code></pre></li><li><p>Test against the garden cluster and verify it&rsquo;s working.</p></li><li><p>Extract the <code>client-certificate-data</code> from the user <code>gardenlet</code>.</p></li><li><p>View the certificate:</p><pre tabindex=0><code>$ openssl x509 -in ./gardenlet-cert -noout -text
</code></pre></li></ol></li><li><p>Check that the bootstrap secret <code>gardenlet-bootstrap-kubeconfig</code> has been deleted from the seed cluster in namespace <code>garden</code>.</p></li><li><p>Check that the seed cluster is registered and <code>READY</code> in the garden cluster.</p><p>Check that the seed cluster <code>sweet-seed</code> exists and all conditions indicate that it&rsquo;s available.
If so, the <a href=/docs/gardener/concepts/gardenlet/#heartbeats>Gardenlet is sending regular heartbeats</a> and the <a href=/docs/gardener/seed_bootstrapping/>seed bootstrapping</a> was successful.</p><p>Check that the conditions on the <code>Seed</code> resource look similar to the following:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get seed sweet-seed -o json | jq .status.conditions
</span></span><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#34;lastTransitionTime&#34;</span>: <span style=color:#a31515>&#34;2020-07-17T09:17:29Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#34;lastUpdateTime&#34;</span>: <span style=color:#a31515>&#34;2020-07-17T09:17:29Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#34;message&#34;</span>: <span style=color:#a31515>&#34;Gardenlet is posting ready status.&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#34;reason&#34;</span>: <span style=color:#a31515>&#34;GardenletReady&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#34;status&#34;</span>: <span style=color:#a31515>&#34;True&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#34;type&#34;</span>: <span style=color:#a31515>&#34;GardenletReady&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#34;lastTransitionTime&#34;</span>: <span style=color:#a31515>&#34;2020-07-17T09:17:49Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#34;lastUpdateTime&#34;</span>: <span style=color:#a31515>&#34;2020-07-17T09:53:17Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#34;message&#34;</span>: <span style=color:#a31515>&#34;Backup Buckets are available.&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#34;reason&#34;</span>: <span style=color:#a31515>&#34;BackupBucketsAvailable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#34;status&#34;</span>: <span style=color:#a31515>&#34;True&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a31515>&#34;type&#34;</span>: <span style=color:#a31515>&#34;BackupBucketsReady&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div></li></ol><h2 id=self-upgrades>Self Upgrades<a class=td-heading-self-link href=#self-upgrades aria-label="Heading self-link"></a></h2><p>In order to keep your gardenlets in such &ldquo;unmanaged seeds&rdquo; up-to-date (i.e., in seeds which are no shoot clusters), its Helm chart must be regularly deployed.
This requires network connectivity to such clusters which can be challenging if they reside behind a firewall or in restricted environments.
It is much simpler if gardenlet could keep itself up-to-date, based on configuration read from the garden cluster.
This approach greatly reduces operational complexity.</p><p>gardenlet runs <a href=/docs/gardener/concepts/gardenlet/#gardenlet-controller>a controller</a> which watches for <code>seedmanagement.gardener.cloud/v1alpha1.Gardenlet</code> resources in the garden cluster in the <code>garden</code> namespace having the same name as the <code>Seed</code> the gardenlet is responsible for.
Such resources contain its component configuration and deployment values.
Most notably, a URL to an OCI repository containing gardenlet&rsquo;s Helm chart is included.</p><p>An example <code>Gardenlet</code> resource looks like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: seedmanagement.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>kind: Gardenlet
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: local
</span></span><span style=display:flex><span>  namespace: garden
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  deployment:
</span></span><span style=display:flex><span>    replicaCount: 1
</span></span><span style=display:flex><span>    revisionHistoryLimit: 2
</span></span><span style=display:flex><span>    helm:
</span></span><span style=display:flex><span>      ociRepository:
</span></span><span style=display:flex><span>        ref: &lt;url-to-gardenlet-chart-repository&gt;:v1.97.0
</span></span><span style=display:flex><span>  config:
</span></span><span style=display:flex><span>    apiVersion: gardenlet.config.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>    kind: GardenletConfiguration
</span></span><span style=display:flex><span>    gardenClientConnection:
</span></span><span style=display:flex><span>      kubeconfigSecret:
</span></span><span style=display:flex><span>        name: gardenlet-kubeconfig
</span></span><span style=display:flex><span>        namespace: garden
</span></span><span style=display:flex><span>    controllers:
</span></span><span style=display:flex><span>      shoot:
</span></span><span style=display:flex><span>        reconcileInMaintenanceOnly: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>        respectSyncPeriodOverwrite: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>      shootState:
</span></span><span style=display:flex><span>        concurrentSyncs: 0
</span></span><span style=display:flex><span>    featureGates:
</span></span><span style=display:flex><span>      DefaultSeccompProfile: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>    logging:
</span></span><span style=display:flex><span>      enabled: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>      vali:
</span></span><span style=display:flex><span>        enabled: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>      shootNodeLogging:
</span></span><span style=display:flex><span>        shootPurposes:
</span></span><span style=display:flex><span>        - infrastructure
</span></span><span style=display:flex><span>        - production
</span></span><span style=display:flex><span>        - development
</span></span><span style=display:flex><span>        - evaluation
</span></span><span style=display:flex><span>    seedConfig:
</span></span><span style=display:flex><span>      apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>      kind: Seed
</span></span><span style=display:flex><span>      metadata:
</span></span><span style=display:flex><span>        labels:
</span></span><span style=display:flex><span>          base: kind
</span></span><span style=display:flex><span>      spec:
</span></span><span style=display:flex><span>        backup:
</span></span><span style=display:flex><span>          provider: local
</span></span><span style=display:flex><span>          region: local
</span></span><span style=display:flex><span>          credentialsRef:
</span></span><span style=display:flex><span>            apiVersion: v1
</span></span><span style=display:flex><span>            kind: Secret
</span></span><span style=display:flex><span>            name: backup-local
</span></span><span style=display:flex><span>            namespace: garden
</span></span><span style=display:flex><span>        dns:
</span></span><span style=display:flex><span>          provider:
</span></span><span style=display:flex><span>            secretRef:
</span></span><span style=display:flex><span>              name: internal-domain-internal-local-gardener-cloud
</span></span><span style=display:flex><span>              namespace: garden
</span></span><span style=display:flex><span>            type: local
</span></span><span style=display:flex><span>        ingress:
</span></span><span style=display:flex><span>          controller:
</span></span><span style=display:flex><span>            kind: nginx
</span></span><span style=display:flex><span>          domain: ingress.local.seed.local.gardener.cloud
</span></span><span style=display:flex><span>        networks:
</span></span><span style=display:flex><span>          nodes: 172.18.0.0/16
</span></span><span style=display:flex><span>          pods: 10.1.0.0/16
</span></span><span style=display:flex><span>          services: 10.2.0.0/16
</span></span><span style=display:flex><span>          shootDefaults:
</span></span><span style=display:flex><span>            pods: 10.3.0.0/16
</span></span><span style=display:flex><span>            services: 10.4.0.0/16
</span></span><span style=display:flex><span>        provider:
</span></span><span style=display:flex><span>          region: local
</span></span><span style=display:flex><span>          type: local
</span></span><span style=display:flex><span>          zones:
</span></span><span style=display:flex><span>          - <span style=color:#a31515>&#34;0&#34;</span>
</span></span><span style=display:flex><span>        settings:
</span></span><span style=display:flex><span>          excessCapacityReservation:
</span></span><span style=display:flex><span>            enabled: <span style=color:#00f>false</span>
</span></span><span style=display:flex><span>          scheduling:
</span></span><span style=display:flex><span>            visible: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>          verticalPodAutoscaler:
</span></span><span style=display:flex><span>            enabled: <span style=color:#00f>true</span>
</span></span></code></pre></div><p>On reconciliation, gardenlet downloads the Helm chart, renders it with the provided values, and then applies it to its own cluster.
Hence, in order to keep a gardenlet up-to-date, it is enough to update the tag/digest of the OCI repository ref for the Helm chart:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  deployment:
</span></span><span style=display:flex><span>    helm:
</span></span><span style=display:flex><span>      ociRepository:
</span></span><span style=display:flex><span>        ref: &lt;url-to-gardenlet-chart-repository&gt;:v1.97.0
</span></span></code></pre></div><p>This way, network connectivity to the cluster in which gardenlet runs is not required at all (at least for deployment purposes).</p><p>When you delete this resource, nothing happens: gardenlet remains running with the configuration as before.
However, self-upgrades are obviously not possible anymore.
In order to upgrade it, you have to either recreate the <code>Gardenlet</code> object, or redeploy the Helm chart.</p><h2 id=related-links>Related Links<a class=td-heading-self-link href=#related-links aria-label="Heading self-link"></a></h2><ul><li><a href=https://github.com/gardener/gardener/issues/1724>Issue #1724: Harden Gardenlet RBAC privileges</a>.</li><li><a href=/docs/gardener/concepts/backup-restore/>Backup and Restore</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6e7247a70ba6614e9209755cffea4744>6 - Deploy Gardenlet Via Operator</h1><h1 id=deploy-a-gardenlet-via-gardener-operator>Deploy a gardenlet Via <code>gardener-operator</code><a class=td-heading-self-link href=#deploy-a-gardenlet-via-gardener-operator aria-label="Heading self-link"></a></h1><p>The gardenlet can automatically be deployed by <code>gardener-operator</code> into existing Kubernetes clusters in order to register them as seeds.</p><h2 id=prerequisites>Prerequisites<a class=td-heading-self-link href=#prerequisites aria-label="Heading self-link"></a></h2><p>Using this method only works when <a href=/docs/gardener/concepts/operator/><code>gardener-operator</code></a> is managing the garden cluster.
If you have used the <a href=https://github.com/gardener/gardener/tree/master/charts/gardener/controlplane><code>gardener/controlplane</code> Helm chart</a> for the deployment of the Gardener control plane, please refer to <a href=/docs/gardener/deployment/deploy_gardenlet_manually/>this document</a>.</p><blockquote class="alert alert-tip"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>lightbulb-on-outline</title><path d="M20 11h3v2H20V11M1 11H4v2H1V11M13 1V4H11V1h2M4.92 3.5 7.05 5.64 5.63 7.05 3.5 4.93 4.92 3.5M16.95 5.63 19.07 3.5 20.5 4.93 18.37 7.05 16.95 5.63M12 6a6 6 0 016 6c0 2.22-1.21 4.16-3 5.2V19a1 1 0 01-1 1H10A1 1 0 019 19V17.2C7.21 16.16 6 14.22 6 12a6 6 0 016-6m2 15v1a1 1 0 01-1 1H11a1 1 0 01-1-1V21h4m-3-3h2V15.87c1.73-.44 3-2.01 3-3.87A4 4 0 0012 8 4 4 0 008 12c0 1.86 1.27 3.43 3 3.87V18z"/></svg><p>Tip</p></div><p>The initial seed cluster can be the garden cluster itself, but for better separation of concerns, it is recommended to only register other clusters as seeds.</p></blockquote><h2 id=deployment-of-gardenlets>Deployment of gardenlets<a class=td-heading-self-link href=#deployment-of-gardenlets aria-label="Heading self-link"></a></h2><p>Using this method, <code>gardener-operator</code> is only taking care of the very first deployment of gardenlet.
Once running, the gardenlet leverages the <a href=/docs/gardener/deployment/deploy_gardenlet_manually/#self-upgrades>self-upgrade</a> strategy in order to keep itself up-to-date.
Concretely, <code>gardener-operator</code> only acts when there is no respective <code>Seed</code> resource yet.</p><p>In order to request a gardenlet deployment, create following resource in the (virtual) garden cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: seedmanagement.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>kind: Gardenlet
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: local
</span></span><span style=display:flex><span>  namespace: garden
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  deployment:
</span></span><span style=display:flex><span>    replicaCount: 1
</span></span><span style=display:flex><span>    revisionHistoryLimit: 2
</span></span><span style=display:flex><span>    helm:
</span></span><span style=display:flex><span>      ociRepository:
</span></span><span style=display:flex><span>        ref: &lt;url-to-gardenlet-chart-repository&gt;:v1.97.0
</span></span><span style=display:flex><span>  config:
</span></span><span style=display:flex><span>    apiVersion: gardenlet.config.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>    kind: GardenletConfiguration
</span></span><span style=display:flex><span>    controllers:
</span></span><span style=display:flex><span>      shoot:
</span></span><span style=display:flex><span>        reconcileInMaintenanceOnly: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>        respectSyncPeriodOverwrite: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>      shootState:
</span></span><span style=display:flex><span>        concurrentSyncs: 0
</span></span><span style=display:flex><span>    logging:
</span></span><span style=display:flex><span>      enabled: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>      vali:
</span></span><span style=display:flex><span>        enabled: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>      shootNodeLogging:
</span></span><span style=display:flex><span>        shootPurposes:
</span></span><span style=display:flex><span>        - infrastructure
</span></span><span style=display:flex><span>        - production
</span></span><span style=display:flex><span>        - development
</span></span><span style=display:flex><span>        - evaluation
</span></span><span style=display:flex><span>    seedConfig:
</span></span><span style=display:flex><span>      apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>      kind: Seed
</span></span><span style=display:flex><span>      metadata:
</span></span><span style=display:flex><span>        labels:
</span></span><span style=display:flex><span>          base: kind
</span></span><span style=display:flex><span>      spec:
</span></span><span style=display:flex><span>        backup:
</span></span><span style=display:flex><span>          provider: local
</span></span><span style=display:flex><span>          region: local
</span></span><span style=display:flex><span>          credentialsRef:
</span></span><span style=display:flex><span>            apiVersion: v1
</span></span><span style=display:flex><span>            kind: Secret
</span></span><span style=display:flex><span>            name: backup-local
</span></span><span style=display:flex><span>            namespace: garden
</span></span><span style=display:flex><span>        dns:
</span></span><span style=display:flex><span>          provider:
</span></span><span style=display:flex><span>            secretRef:
</span></span><span style=display:flex><span>              name: internal-domain-internal-local-gardener-cloud
</span></span><span style=display:flex><span>              namespace: garden
</span></span><span style=display:flex><span>            type: local
</span></span><span style=display:flex><span>        ingress:
</span></span><span style=display:flex><span>          controller:
</span></span><span style=display:flex><span>            kind: nginx
</span></span><span style=display:flex><span>          domain: ingress.local.seed.local.gardener.cloud
</span></span><span style=display:flex><span>        networks:
</span></span><span style=display:flex><span>          nodes: 172.18.0.0/16
</span></span><span style=display:flex><span>          pods: 10.1.0.0/16
</span></span><span style=display:flex><span>          services: 10.2.0.0/16
</span></span><span style=display:flex><span>          shootDefaults:
</span></span><span style=display:flex><span>            pods: 10.3.0.0/16
</span></span><span style=display:flex><span>            services: 10.4.0.0/16
</span></span><span style=display:flex><span>        provider:
</span></span><span style=display:flex><span>          region: local
</span></span><span style=display:flex><span>          type: local
</span></span><span style=display:flex><span>          zones:
</span></span><span style=display:flex><span>          - <span style=color:#a31515>&#34;0&#34;</span>
</span></span><span style=display:flex><span>        settings:
</span></span><span style=display:flex><span>          excessCapacityReservation:
</span></span><span style=display:flex><span>            enabled: <span style=color:#00f>false</span>
</span></span><span style=display:flex><span>          scheduling:
</span></span><span style=display:flex><span>            visible: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>          verticalPodAutoscaler:
</span></span><span style=display:flex><span>            enabled: <span style=color:#00f>true</span>
</span></span></code></pre></div><p>This causes <code>gardener-operator</code> to deploy gardenlet to the same cluster where it is running.
Once it comes up, gardenlet will create a <code>Seed</code> resource with the same name and uses the <code>Gardenlet</code> resource for self-upgrades (see <a href=/docs/gardener/deployment/deploy_gardenlet_manually/#self-upgrades>this document</a>).</p><h3 id=remote-clusters>Remote Clusters<a class=td-heading-self-link href=#remote-clusters aria-label="Heading self-link"></a></h3><p>If you want <code>gardener-operator</code> to deploy gardenlet into some other cluster, create a kubeconfig <code>Secret</code> and reference it in the <code>Gardenlet</code> resource:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Secret
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: remote-cluster-kubeconfig
</span></span><span style=display:flex><span>  namespace: garden
</span></span><span style=display:flex><span>type: Opaque
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  kubeconfig: base64(kubeconfig-to-remote-cluster)
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>apiVersion: seedmanagement.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>kind: Gardenlet
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: local
</span></span><span style=display:flex><span>  namespace: garden
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  kubeconfigSecretRef:
</span></span><span style=display:flex><span>    name: remote-cluster-kubeconfig
</span></span><span style=display:flex><span><span style=color:green># ...</span>
</span></span></code></pre></div><blockquote class="alert alert-important"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>message-outline</title><path d="M20 2H4C2.9 2 2 2.9 2 4V22l4-4H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2m0 14H5.2L4 17.2V4H20V16z"/></svg><p>Important</p></div><p>After successful deployment of gardenlet, <code>gardener-operator</code> will delete the <code>remote-cluster-kubeconfig</code> <code>Secret</code> and set <code>.spec.kubeconfigSecretRef</code> to <code>nil</code>.
This is because the kubeconfig will never ever be needed anymore (<code>gardener-operator</code> is only responsible for initial deployment, and gardenlet updates itself with an in-cluster kubeconfig).
In case your landscape is managed via a GitOps approach, you might want to reflect this change in your repository.</p></blockquote><h3 id=forceful-re-deployment>Forceful Re-Deployment<a class=td-heading-self-link href=#forceful-re-deployment aria-label="Heading self-link"></a></h3><p>In certain scenarios, it might be necessary to forcefully re-deploy the gardenlet.
For example, in case the gardenlet client certificate has been expired or is &ldquo;lost&rdquo;, or the gardenlet <code>Deployment</code> has been &ldquo;accidentally&rdquo; (😉) deleted from the seed cluster.</p><p>You can trigger the forceful re-deployment by annotating the <code>Gardenlet</code> with</p><pre tabindex=0><code>gardener.cloud/operation=force-redeploy
</code></pre><blockquote class="alert alert-tip"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>lightbulb-on-outline</title><path d="M20 11h3v2H20V11M1 11H4v2H1V11M13 1V4H11V1h2M4.92 3.5 7.05 5.64 5.63 7.05 3.5 4.93 4.92 3.5M16.95 5.63 19.07 3.5 20.5 4.93 18.37 7.05 16.95 5.63M12 6a6 6 0 016 6c0 2.22-1.21 4.16-3 5.2V19a1 1 0 01-1 1H10A1 1 0 019 19V17.2C7.21 16.16 6 14.22 6 12a6 6 0 016-6m2 15v1a1 1 0 01-1 1H11a1 1 0 01-1-1V21h4m-3-3h2V15.87c1.73-.44 3-2.01 3-3.87A4 4 0 0012 8 4 4 0 008 12c0 1.86 1.27 3.43 3 3.87V18z"/></svg><p>Tip</p></div><p>Do not forget to create the kubeconfig <code>Secret</code> and re-add the <code>.spec.kubeconfigSecretRef</code> to the <code>Gardenlet</code> specification if this is a remote cluster.</p></blockquote><p><code>gardener-operator</code> will remove the operation annotation after it&rsquo;s done.
Just like after the initial deployment, it&rsquo;ll also delete the kubeconfig <code>Secret</code> and set <code>.spec.kubeconfigSecretRef</code> to <code>nil</code>, see above.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c3272d62c1687598614ee78517d7640c>7 - Feature Gates</h1><h1 id=feature-gates-in-gardener>Feature Gates in Gardener<a class=td-heading-self-link href=#feature-gates-in-gardener aria-label="Heading self-link"></a></h1><p>This page contains an overview of the various feature gates an administrator can specify on different Gardener components.</p><h2 id=overview>Overview<a class=td-heading-self-link href=#overview aria-label="Heading self-link"></a></h2><p>Feature gates are a set of key=value pairs that describe Gardener features. You can turn these features on or off using the component configuration file for a specific component.</p><p>Each Gardener component lets you enable or disable a set of feature gates that are relevant to that component. For example, this is the configuration of the <a href=https://github.com/gardener/gardener/blob/master/example/20-componentconfig-gardenlet.yaml>gardenlet</a> component.</p><p>The following tables are a summary of the feature gates that you can set on different Gardener components.</p><ul><li>The “Since” column contains the Gardener release when a feature is introduced or its release stage is changed.</li><li>The “Until” column, if not empty, contains the last Gardener release in which you can still use a feature gate.</li><li>If a feature is in the <em>Alpha</em> or <em>Beta</em> state, you can find the feature listed in the Alpha/Beta feature gate table.</li><li>If a feature is stable you can find all stages for that feature listed in the Graduated/Deprecated feature gate table.</li><li>The Graduated/Deprecated feature gate table also lists deprecated and withdrawn features.</li></ul><h2 id=feature-gates-for-alpha-or-beta-features>Feature Gates for Alpha or Beta Features<a class=td-heading-self-link href=#feature-gates-for-alpha-or-beta-features aria-label="Heading self-link"></a></h2><table><thead><tr><th>Feature</th><th>Default</th><th>Stage</th><th>Since</th><th>Until</th></tr></thead><tbody><tr><td>DefaultSeccompProfile</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.54</code></td><td></td></tr><tr><td>UseNamespacedCloudProfile</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.92</code></td><td><code>1.111</code></td></tr><tr><td>UseNamespacedCloudProfile</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.112</code></td><td></td></tr><tr><td>ShootCredentialsBinding</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.98</code></td><td><code>1.106</code></td></tr><tr><td>ShootCredentialsBinding</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.107</code></td><td></td></tr><tr><td>NewWorkerPoolHash</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.98</code></td><td></td></tr><tr><td>NodeAgentAuthorizer</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.109</code></td><td><code>1.115</code></td></tr><tr><td>NodeAgentAuthorizer</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.116</code></td><td></td></tr><tr><td>CredentialsRotationWithoutWorkersRollout</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.112</code></td><td></td></tr><tr><td>CredentialsRotationWithoutWorkersRollout</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.121</code></td><td></td></tr><tr><td>InPlaceNodeUpdates</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.113</code></td><td></td></tr><tr><td>RemoveAPIServerProxyLegacyPort</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.113</code></td><td><code>1.118</code></td></tr><tr><td>RemoveAPIServerProxyLegacyPort</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.119</code></td><td></td></tr><tr><td>IstioTLSTermination</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.114</code></td><td></td></tr><tr><td>CloudProfileCapabilities</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.117</code></td><td></td></tr><tr><td>DoNotCopyBackupCredentials</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.121</code></td><td></td></tr></tbody></table><h2 id=feature-gates-for-graduated-or-deprecated-features>Feature Gates for Graduated or Deprecated Features<a class=td-heading-self-link href=#feature-gates-for-graduated-or-deprecated-features aria-label="Heading self-link"></a></h2><table><thead><tr><th>Feature</th><th>Default</th><th>Stage</th><th>Since</th><th>Until</th></tr></thead><tbody><tr><td>NodeLocalDNS</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.7</code></td><td><code>1.25</code></td></tr><tr><td>NodeLocalDNS</td><td></td><td><code>Removed</code></td><td><code>1.26</code></td><td></td></tr><tr><td>KonnectivityTunnel</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.6</code></td><td><code>1.26</code></td></tr><tr><td>KonnectivityTunnel</td><td></td><td><code>Removed</code></td><td><code>1.27</code></td><td></td></tr><tr><td>MountHostCADirectories</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.11</code></td><td><code>1.25</code></td></tr><tr><td>MountHostCADirectories</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.26</code></td><td><code>1.27</code></td></tr><tr><td>MountHostCADirectories</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.27</code></td><td></td></tr><tr><td>MountHostCADirectories</td><td></td><td><code>Removed</code></td><td><code>1.30</code></td><td></td></tr><tr><td>DisallowKubeconfigRotationForShootInDeletion</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.28</code></td><td><code>1.31</code></td></tr><tr><td>DisallowKubeconfigRotationForShootInDeletion</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.32</code></td><td><code>1.35</code></td></tr><tr><td>DisallowKubeconfigRotationForShootInDeletion</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.36</code></td><td><code>1.37</code></td></tr><tr><td>DisallowKubeconfigRotationForShootInDeletion</td><td></td><td><code>Removed</code></td><td><code>1.38</code></td><td></td></tr><tr><td>Logging</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>0.13</code></td><td><code>1.40</code></td></tr><tr><td>Logging</td><td></td><td><code>Removed</code></td><td><code>1.41</code></td><td></td></tr><tr><td>AdminKubeconfigRequest</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.24</code></td><td><code>1.38</code></td></tr><tr><td>AdminKubeconfigRequest</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.39</code></td><td><code>1.41</code></td></tr><tr><td>AdminKubeconfigRequest</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.42</code></td><td><code>1.49</code></td></tr><tr><td>AdminKubeconfigRequest</td><td></td><td><code>Removed</code></td><td><code>1.50</code></td><td></td></tr><tr><td>UseDNSRecords</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.27</code></td><td><code>1.38</code></td></tr><tr><td>UseDNSRecords</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.39</code></td><td><code>1.43</code></td></tr><tr><td>UseDNSRecords</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.44</code></td><td><code>1.49</code></td></tr><tr><td>UseDNSRecords</td><td></td><td><code>Removed</code></td><td><code>1.50</code></td><td></td></tr><tr><td>CachedRuntimeClients</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.7</code></td><td><code>1.33</code></td></tr><tr><td>CachedRuntimeClients</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.34</code></td><td><code>1.44</code></td></tr><tr><td>CachedRuntimeClients</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.45</code></td><td><code>1.49</code></td></tr><tr><td>CachedRuntimeClients</td><td></td><td><code>Removed</code></td><td><code>1.50</code></td><td></td></tr><tr><td>DenyInvalidExtensionResources</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.31</code></td><td><code>1.41</code></td></tr><tr><td>DenyInvalidExtensionResources</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.42</code></td><td><code>1.44</code></td></tr><tr><td>DenyInvalidExtensionResources</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.45</code></td><td><code>1.49</code></td></tr><tr><td>DenyInvalidExtensionResources</td><td></td><td><code>Removed</code></td><td><code>1.50</code></td><td></td></tr><tr><td>RotateSSHKeypairOnMaintenance</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.28</code></td><td><code>1.44</code></td></tr><tr><td>RotateSSHKeypairOnMaintenance</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.45</code></td><td><code>1.47</code></td></tr><tr><td>RotateSSHKeypairOnMaintenance (deprecated)</td><td><code>false</code></td><td><code>Beta</code></td><td><code>1.48</code></td><td><code>1.50</code></td></tr><tr><td>RotateSSHKeypairOnMaintenance (deprecated)</td><td></td><td><code>Removed</code></td><td><code>1.51</code></td><td></td></tr><tr><td>ShootForceDeletion</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.81</code></td><td><code>1.90</code></td></tr><tr><td>ShootForceDeletion</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.91</code></td><td><code>1.110</code></td></tr><tr><td>ShootForceDeletion</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.111</code></td><td><code>1.119</code></td></tr><tr><td>ShootForceDeletion</td><td></td><td><code>Removed</code></td><td><code>1.120</code></td><td></td></tr><tr><td>ShootMaxTokenExpirationOverwrite</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.43</code></td><td><code>1.44</code></td></tr><tr><td>ShootMaxTokenExpirationOverwrite</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.45</code></td><td><code>1.47</code></td></tr><tr><td>ShootMaxTokenExpirationOverwrite</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.48</code></td><td><code>1.50</code></td></tr><tr><td>ShootMaxTokenExpirationOverwrite</td><td></td><td><code>Removed</code></td><td><code>1.51</code></td><td></td></tr><tr><td>ShootMaxTokenExpirationValidation</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.43</code></td><td><code>1.45</code></td></tr><tr><td>ShootMaxTokenExpirationValidation</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.46</code></td><td><code>1.47</code></td></tr><tr><td>ShootMaxTokenExpirationValidation</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.48</code></td><td><code>1.50</code></td></tr><tr><td>ShootMaxTokenExpirationValidation</td><td></td><td><code>Removed</code></td><td><code>1.51</code></td><td></td></tr><tr><td>WorkerPoolKubernetesVersion</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.35</code></td><td><code>1.45</code></td></tr><tr><td>WorkerPoolKubernetesVersion</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.46</code></td><td><code>1.49</code></td></tr><tr><td>WorkerPoolKubernetesVersion</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.50</code></td><td><code>1.51</code></td></tr><tr><td>WorkerPoolKubernetesVersion</td><td></td><td><code>Removed</code></td><td><code>1.52</code></td><td></td></tr><tr><td>DisableDNSProviderManagement</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.41</code></td><td><code>1.49</code></td></tr><tr><td>DisableDNSProviderManagement</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.50</code></td><td><code>1.51</code></td></tr><tr><td>DisableDNSProviderManagement</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.52</code></td><td><code>1.59</code></td></tr><tr><td>DisableDNSProviderManagement</td><td></td><td><code>Removed</code></td><td><code>1.60</code></td><td></td></tr><tr><td>SecretBindingProviderValidation</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.38</code></td><td><code>1.50</code></td></tr><tr><td>SecretBindingProviderValidation</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.51</code></td><td><code>1.52</code></td></tr><tr><td>SecretBindingProviderValidation</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.53</code></td><td><code>1.54</code></td></tr><tr><td>SecretBindingProviderValidation</td><td></td><td><code>Removed</code></td><td><code>1.55</code></td><td></td></tr><tr><td>SeedKubeScheduler</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.15</code></td><td><code>1.54</code></td></tr><tr><td>SeedKubeScheduler</td><td><code>false</code></td><td><code>Deprecated</code></td><td><code>1.55</code></td><td><code>1.60</code></td></tr><tr><td>SeedKubeScheduler</td><td></td><td><code>Removed</code></td><td><code>1.61</code></td><td></td></tr><tr><td>ShootCARotation</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.42</code></td><td><code>1.50</code></td></tr><tr><td>ShootCARotation</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.51</code></td><td><code>1.56</code></td></tr><tr><td>ShootCARotation</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.57</code></td><td><code>1.59</code></td></tr><tr><td>ShootCARotation</td><td></td><td><code>Removed</code></td><td><code>1.60</code></td><td></td></tr><tr><td>ShootSARotation</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.48</code></td><td><code>1.50</code></td></tr><tr><td>ShootSARotation</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.51</code></td><td><code>1.56</code></td></tr><tr><td>ShootSARotation</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.57</code></td><td><code>1.59</code></td></tr><tr><td>ShootSARotation</td><td></td><td><code>Removed</code></td><td><code>1.60</code></td><td></td></tr><tr><td>ReversedVPN</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.22</code></td><td><code>1.41</code></td></tr><tr><td>ReversedVPN</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.42</code></td><td><code>1.62</code></td></tr><tr><td>ReversedVPN</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.63</code></td><td><code>1.69</code></td></tr><tr><td>ReversedVPN</td><td></td><td><code>Removed</code></td><td><code>1.70</code></td><td></td></tr><tr><td>ForceRestore</td><td></td><td><code>Removed</code></td><td><code>1.66</code></td><td></td></tr><tr><td>SeedChange</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.12</code></td><td><code>1.52</code></td></tr><tr><td>SeedChange</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.53</code></td><td><code>1.68</code></td></tr><tr><td>SeedChange</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.69</code></td><td><code>1.72</code></td></tr><tr><td>SeedChange</td><td></td><td><code>Removed</code></td><td><code>1.73</code></td><td></td></tr><tr><td>CopyEtcdBackupsDuringControlPlaneMigration</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.37</code></td><td><code>1.52</code></td></tr><tr><td>CopyEtcdBackupsDuringControlPlaneMigration</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.53</code></td><td><code>1.68</code></td></tr><tr><td>CopyEtcdBackupsDuringControlPlaneMigration</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.69</code></td><td><code>1.72</code></td></tr><tr><td>CopyEtcdBackupsDuringControlPlaneMigration</td><td></td><td><code>Removed</code></td><td><code>1.73</code></td><td></td></tr><tr><td>ManagedIstio</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.5</code></td><td><code>1.18</code></td></tr><tr><td>ManagedIstio</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.19</code></td><td></td></tr><tr><td>ManagedIstio</td><td><code>true</code></td><td><code>Deprecated</code></td><td><code>1.48</code></td><td><code>1.69</code></td></tr><tr><td>ManagedIstio</td><td></td><td><code>Removed</code></td><td><code>1.70</code></td><td></td></tr><tr><td>APIServerSNI</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.7</code></td><td><code>1.18</code></td></tr><tr><td>APIServerSNI</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.19</code></td><td></td></tr><tr><td>APIServerSNI</td><td><code>true</code></td><td><code>Deprecated</code></td><td><code>1.48</code></td><td><code>1.72</code></td></tr><tr><td>APIServerSNI</td><td></td><td><code>Removed</code></td><td><code>1.73</code></td><td></td></tr><tr><td>HAControlPlanes</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.49</code></td><td><code>1.70</code></td></tr><tr><td>HAControlPlanes</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.71</code></td><td><code>1.72</code></td></tr><tr><td>HAControlPlanes</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.73</code></td><td><code>1.73</code></td></tr><tr><td>HAControlPlanes</td><td></td><td><code>Removed</code></td><td><code>1.74</code></td><td></td></tr><tr><td>FullNetworkPoliciesInRuntimeCluster</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.66</code></td><td><code>1.70</code></td></tr><tr><td>FullNetworkPoliciesInRuntimeCluster</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.71</code></td><td><code>1.72</code></td></tr><tr><td>FullNetworkPoliciesInRuntimeCluster</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.73</code></td><td><code>1.73</code></td></tr><tr><td>FullNetworkPoliciesInRuntimeCluster</td><td></td><td><code>Removed</code></td><td><code>1.74</code></td><td></td></tr><tr><td>DisableScalingClassesForShoots</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.73</code></td><td><code>1.78</code></td></tr><tr><td>DisableScalingClassesForShoots</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.79</code></td><td><code>1.80</code></td></tr><tr><td>DisableScalingClassesForShoots</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.81</code></td><td><code>1.81</code></td></tr><tr><td>DisableScalingClassesForShoots</td><td></td><td><code>Removed</code></td><td><code>1.82</code></td><td></td></tr><tr><td>ContainerdRegistryHostsDir</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.77</code></td><td><code>1.85</code></td></tr><tr><td>ContainerdRegistryHostsDir</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.86</code></td><td><code>1.86</code></td></tr><tr><td>ContainerdRegistryHostsDir</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.87</code></td><td><code>1.87</code></td></tr><tr><td>ContainerdRegistryHostsDir</td><td></td><td><code>Removed</code></td><td><code>1.88</code></td><td></td></tr><tr><td>WorkerlessShoots</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.70</code></td><td><code>1.78</code></td></tr><tr><td>WorkerlessShoots</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.79</code></td><td><code>1.85</code></td></tr><tr><td>WorkerlessShoots</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.86</code></td><td><code>1.87</code></td></tr><tr><td>WorkerlessShoots</td><td></td><td><code>Removed</code></td><td><code>1.88</code></td><td></td></tr><tr><td>MachineControllerManagerDeployment</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.73</code></td><td></td></tr><tr><td>MachineControllerManagerDeployment</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.81</code></td><td><code>1.81</code></td></tr><tr><td>MachineControllerManagerDeployment</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.82</code></td><td><code>1.91</code></td></tr><tr><td>MachineControllerManagerDeployment</td><td></td><td><code>Removed</code></td><td><code>1.92</code></td><td></td></tr><tr><td>APIServerFastRollout</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.82</code></td><td><code>1.89</code></td></tr><tr><td>APIServerFastRollout</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.90</code></td><td><code>1.91</code></td></tr><tr><td>APIServerFastRollout</td><td></td><td><code>Removed</code></td><td><code>1.92</code></td><td></td></tr><tr><td>UseGardenerNodeAgent</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.82</code></td><td><code>1.88</code></td></tr><tr><td>UseGardenerNodeAgent</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.89</code></td><td><code>1.89</code></td></tr><tr><td>UseGardenerNodeAgent</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.90</code></td><td><code>1.91</code></td></tr><tr><td>UseGardenerNodeAgent</td><td></td><td><code>Removed</code></td><td><code>1.92</code></td><td></td></tr><tr><td>CoreDNSQueryRewriting</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.55</code></td><td><code>1.95</code></td></tr><tr><td>CoreDNSQueryRewriting</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.96</code></td><td><code>1.96</code></td></tr><tr><td>CoreDNSQueryRewriting</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.97</code></td><td><code>1.100</code></td></tr><tr><td>CoreDNSQueryRewriting</td><td></td><td><code>Removed</code></td><td><code>1.101</code></td><td></td></tr><tr><td>MutableShootSpecNetworkingNodes</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.64</code></td><td><code>1.95</code></td></tr><tr><td>MutableShootSpecNetworkingNodes</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.96</code></td><td><code>1.96</code></td></tr><tr><td>MutableShootSpecNetworkingNodes</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.97</code></td><td><code>1.100</code></td></tr><tr><td>MutableShootSpecNetworkingNodes</td><td></td><td><code>Removed</code></td><td><code>1.101</code></td><td></td></tr><tr><td>VPAForETCD</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.94</code></td><td><code>1.96</code></td></tr><tr><td>VPAForETCD</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.97</code></td><td><code>1.104</code></td></tr><tr><td>VPAForETCD</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.105</code></td><td><code>1.108</code></td></tr><tr><td>VPAForETCD</td><td></td><td><code>Removed</code></td><td><code>1.109</code></td><td></td></tr><tr><td>VPAAndHPAForAPIServer</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.95</code></td><td><code>1.100</code></td></tr><tr><td>VPAAndHPAForAPIServer</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.101</code></td><td><code>1.104</code></td></tr><tr><td>VPAAndHPAForAPIServer</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.105</code></td><td><code>1.108</code></td></tr><tr><td>VPAAndHPAForAPIServer</td><td></td><td><code>Removed</code></td><td><code>1.109</code></td><td></td></tr><tr><td>HVPA</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>0.31</code></td><td><code>1.105</code></td></tr><tr><td>HVPA</td><td><code>false</code></td><td><code>Deprecated</code></td><td><code>1.106</code></td><td><code>1.108</code></td></tr><tr><td>HVPA</td><td></td><td><code>Removed</code></td><td><code>1.109</code></td><td></td></tr><tr><td>HVPAForShootedSeed</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>0.32</code></td><td><code>1.105</code></td></tr><tr><td>HVPAForShootedSeed</td><td><code>false</code></td><td><code>Deprecated</code></td><td><code>1.106</code></td><td><code>1.108</code></td></tr><tr><td>HVPAForShootedSeed</td><td></td><td><code>Removed</code></td><td><code>1.109</code></td><td></td></tr><tr><td>IPv6SingleStack</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.63</code></td><td></td></tr><tr><td>IPv6SingleStack</td><td></td><td><code>Removed</code></td><td><code>1.107</code></td><td></td></tr><tr><td>ShootManagedIssuer</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.93</code></td><td><code>1.110</code></td></tr><tr><td>ShootManagedIssuer</td><td></td><td><code>Removed</code></td><td><code>1.111</code></td><td></td></tr><tr><td>NewVPN</td><td><code>false</code></td><td><code>Alpha</code></td><td><code>1.104</code></td><td><code>1.114</code></td></tr><tr><td>NewVPN</td><td><code>true</code></td><td><code>Beta</code></td><td><code>1.115</code></td><td><code>1.115</code></td></tr><tr><td>NewVPN</td><td><code>true</code></td><td><code>GA</code></td><td><code>1.116</code></td><td></td></tr></tbody></table><h2 id=using-a-feature>Using a Feature<a class=td-heading-self-link href=#using-a-feature aria-label="Heading self-link"></a></h2><p>A feature can be in <em>Alpha</em>, <em>Beta</em> or <em>GA</em> stage.
An <em>Alpha</em> feature means:</p><ul><li>Disabled by default.</li><li>Might be buggy. Enabling the feature may expose bugs.</li><li>Support for feature may be dropped at any time without notice.</li><li>The API may change in incompatible ways in a later software release without notice.</li><li>Recommended for use only in short-lived testing clusters, due to increased
risk of bugs and lack of long-term support.</li></ul><p>A <em>Beta</em> feature means:</p><ul><li>Enabled by default.</li><li>The feature is well tested. Enabling the feature is considered safe.</li><li>Support for the overall feature will not be dropped, though details may change.</li><li>The schema and/or semantics of objects may change in incompatible ways in a
subsequent beta or stable release. When this happens, we will provide instructions
for migrating to the next version. This may require deleting, editing, and
re-creating API objects. The editing process may require some thought.
This may require downtime for applications that rely on the feature.</li><li>Recommended for only non-critical uses because of potential for
incompatible changes in subsequent releases.</li></ul><blockquote><p>Please do try <em>Beta</em> features and give feedback on them!
After they exit beta, it may not be practical for us to make more changes.</p></blockquote><p>A <em>General Availability</em> (GA) feature is also referred to as a <em>stable</em> feature. It means:</p><ul><li>The feature is always enabled; you cannot disable it.</li><li>The corresponding feature gate is no longer needed.</li><li>Stable versions of features will appear in released software for many subsequent versions.</li></ul><h2 id=list-of-feature-gates>List of Feature Gates<a class=td-heading-self-link href=#list-of-feature-gates aria-label="Heading self-link"></a></h2><blockquote><p>Note: All feature gates that are relevant for <code>gardenlet</code>, are also relevant for <code>gardenadm</code>.</p></blockquote><table><thead><tr><th>Feature</th><th>Relevant Components</th><th>Description</th></tr></thead><tbody><tr><td>DefaultSeccompProfile</td><td><code>gardenlet</code>, <code>gardener-operator</code></td><td>Enables the defaulting of the seccomp profile for Gardener managed workload in the garden or seed to <code>RuntimeDefault</code>.</td></tr><tr><td>UseNamespacedCloudProfile</td><td><code>gardener-apiserver</code></td><td>Enables usage of <code>NamespacedCloudProfile</code>s in <code>Shoot</code>s.</td></tr><tr><td>ShootManagedIssuer</td><td><code>gardenlet</code></td><td>Enables the shoot managed issuer functionality described in GEP 24.</td></tr><tr><td>ShootCredentialsBinding</td><td><code>gardener-apiserver</code></td><td>Enables usage of <code>CredentialsBindingName</code> in <code>Shoot</code>s.</td></tr><tr><td>NewWorkerPoolHash</td><td><code>gardenlet</code></td><td>Enables usage of the new worker pool hash calculation. The new calculation supports rolling worker pools if <code>kubeReserved</code>, <code>systemReserved</code>, <code>evictionHard</code> or <code>cpuManagerPolicy</code> in the <code>kubelet</code> configuration are changed. All provider extensions must be upgraded to support this feature first. Existing worker pools are not immediately migrated to the new hash variant, since this would trigger the replacement of all nodes. The migration happens when a rolling update is triggered according to the old or new hash version calculation.</td></tr><tr><td>NewVPN</td><td><code>gardenlet</code></td><td>Enables usage of the new implementation of the VPN (go rewrite) using an IPv6 transfer network.</td></tr><tr><td>NodeAgentAuthorizer</td><td><code>gardenlet</code>, <code>gardener-node-agent</code></td><td>Enables authorization of gardener-node-agent to <code>kube-apiserver</code> of shoot clusters using an authorization webhook. It restricts the permissions of each gardener-node-agent instance to the objects belonging to its own node only.</td></tr><tr><td>CredentialsRotationWithoutWorkersRollout</td><td><code>gardener-apiserver</code></td><td>CredentialsRotationWithoutWorkersRollout enables starting the credentials rotation without immediately causing a rolling update of all worker nodes. Instead, the rolling update can be triggered manually by the user at a later point in time of their convenience. This should only be enabled when all deployed provider extensions vendor at least <code>gardener/gardener@v1.111+</code>.</td></tr><tr><td>InPlaceNodeUpdates</td><td><code>gardener-apiserver</code></td><td>Enables setting the update strategy of worker pools to <code>AutoInPlaceUpdate</code> or <code>ManualInPlaceUpdate</code> in the Shoot API.</td></tr><tr><td>RemoveAPIServerProxyLegacyPort</td><td><code>gardenlet</code></td><td>Disables the unused proxy port (8443) on the istio-ingressgateway Services. Operators can choose to remove the legacy apiserver-proxy port as soon as all shoots have switched to the new apiserver-proxy configuration. They might want to do so if they activate the ACL extension, which is vulnerable to proxy protocol headers of untrusted clients on the apiserver-proxy port.</td></tr><tr><td>IstioTLSTermination</td><td><code>gardenlet</code>, <code>gardener-operator</code></td><td>Enables TLS termination for the Istio Ingress Gateway instead of TLS termination at the kube-apiserver. It allows load-balancing of requests to the kube-apiserver on request level instead of connection level.</td></tr><tr><td>CloudProfileCapabilities</td><td><code>gardener-apiserver</code></td><td>Enables the usage of capabilities in the <code>CloudProfile</code>. Capabilities are used to create a relation between machineTypes and machineImages. It allows to validate worker groups of a shoot ensuring the selected image and machine combination will boot up successfully. Capabilities are also used to determine valid upgrade paths during automated maintenance operation.</td></tr><tr><td>DoNotCopyBackupCredentials</td><td><code>gardenlet</code></td><td>Disables the copying of Shoot infrastructure credentials as backup credentials when the Shoot is used as a ManagedSeed. Operators are responsible for providing the credentials for backup explicitly. Credentials that were already copied will be labeled with <code>secret.backup.gardener.cloud/status=previously-managed</code> and would have to be cleaned up by operators.</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-b20736e3fcbc4d202271af720d0806cf>8 - Getting Started Locally</h1><h1 id=deploying-gardener-locally>Deploying Gardener Locally<a class=td-heading-self-link href=#deploying-gardener-locally aria-label="Heading self-link"></a></h1><p>This document will walk you through deploying Gardener on your local machine.
If you encounter difficulties, please open an issue so that we can make this process easier.</p><h2 id=overview>Overview<a class=td-heading-self-link href=#overview aria-label="Heading self-link"></a></h2><p>Gardener runs in any Kubernetes cluster.
In this guide, we will start a <a href=https://kind.sigs.k8s.io/>KinD</a> cluster which is used as both garden and seed cluster (please refer to the <a href=/docs/gardener/concepts/architecture/>architecture overview</a>) for simplicity.</p><p>Based on <a href=https://skaffold.dev/>Skaffold</a>, the container images for all required components will be built and deployed into the cluster (via their <a href=https://helm.sh/>Helm charts</a>).</p><p><img src=/docs/gardener/deployment/content/getting_started_locally.png alt="Architecture Diagram"></p><h2 id=alternatives>Alternatives<a class=td-heading-self-link href=#alternatives aria-label="Heading self-link"></a></h2><p>When deploying Gardener on your local machine you might face several limitations:</p><ul><li>Your machine doesn&rsquo;t have enough compute resources (see <a href=/docs/gardener/deployment/getting_started_locally/#prerequisites>prerequisites</a>) for hosting a second seed cluster or multiple shoot clusters.</li><li>Testing Gardener&rsquo;s <a href=/docs/gardener/ipv6/>IPv6 features</a> requires a Linux machine and native IPv6 connectivity to the internet, but you&rsquo;re on macOS or don&rsquo;t have IPv6 connectivity in your office environment or via your home ISP.</li></ul><p>In these cases, you might want to check out one of the following options that run the setup described in this guide elsewhere for circumventing these limitations:</p><ul><li><a href=/docs/gardener/deployment/getting_started_locally/#remote-local-setup>remote local setup</a>: deploy on a remote pod for more compute resources</li><li><a href=https://github.com/gardener-community/dev-box-gcp>dev box on Google Cloud</a>: deploy on a Google Cloud machine for more compute resource and/or simple IPv4/IPv6 dual-stack networking</li></ul><h2 id=prerequisites>Prerequisites<a class=td-heading-self-link href=#prerequisites aria-label="Heading self-link"></a></h2><ul><li>Make sure that you have followed the <a href=/docs/gardener/local_setup/>Local Setup guide</a> up until the <a href=/docs/gardener/local_setup/#get-the-sources>Get the sources</a> step.</li><li>Make sure your Docker daemon is up-to-date, up and running and has enough resources (at least <code>8</code> CPUs and <code>8Gi</code> memory; see <a href=https://docs.docker.com/desktop/mac/#resources>here</a> how to configure the resources for Docker for Mac).<blockquote><p>Please note that 8 CPU / 8Gi memory might not be enough for more than two <code>Shoot</code> clusters, i.e., you might need to increase these values if you want to run additional <code>Shoot</code>s.
If you plan on following the optional steps to <a href=/docs/gardener/deployment/getting_started_locally/#optional-setting-up-a-second-seed-cluster>create a second seed cluster</a>, the required resources will be more - at least <code>10</code> CPUs and <code>18Gi</code> memory.
Additionally, please configure at least <code>120Gi</code> of disk size for the Docker daemon.
Tip: You can clean up unused data with <code>docker system df</code> and <code>docker system prune -a</code>.</p></blockquote></li></ul><h2 id=setting-up-the-kind-cluster-garden-and-seed>Setting Up the KinD Cluster (Garden and Seed)<a class=td-heading-self-link href=#setting-up-the-kind-cluster-garden-and-seed aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make kind-up
</span></span></code></pre></div><blockquote><p>If you want to setup an IPv6 KinD cluster, use <code>make kind-up IPFAMILY=ipv6</code> instead.</p></blockquote><p>This command sets up a new KinD cluster named <code>gardener-local</code> and stores the kubeconfig in the <code>./example/gardener-local/kind/local/kubeconfig</code> file.</p><blockquote><p>It might be helpful to copy this file to <code>$HOME/.kube/config</code>, since you will need to target this KinD cluster multiple times.
Alternatively, make sure to set your <code>KUBECONFIG</code> environment variable to <code>./example/gardener-local/kind/local/kubeconfig</code> for all future steps via <code>export KUBECONFIG=$PWD/example/gardener-local/kind/local/kubeconfig</code>.</p></blockquote><p>All following steps assume that you are using this kubeconfig.</p><p>Additionally, this command also deploys a local container registry to the cluster, as well as a few registry mirrors, that are set up as a pull-through cache for all upstream registries Gardener uses by default.
This is done to speed up image pulls across local clusters.</p><blockquote><p>You will need to add <code>127.0.0.1 garden.local.gardener.cloud</code> to your /etc/hosts.</p></blockquote><p>The local registry can now be accessed either via <code>localhost:5001</code> or <code>garden.local.gardener.cloud:5001</code> for pushing and pulling.
The storage directories of the registries are mounted to the host machine under <code>dev/local-registry</code>.
With this, mirrored images don&rsquo;t have to be pulled again after recreating the cluster.</p><p>The command also deploys a default <a href=https://github.com/projectcalico/calico>calico</a> installation as the cluster&rsquo;s CNI implementation with <code>NetworkPolicy</code> support (the default <code>kindnet</code> CNI doesn&rsquo;t provide <code>NetworkPolicy</code> support).
Furthermore, it deploys the <a href=https://github.com/kubernetes-sigs/metrics-server>metrics-server</a> in order to support HPA and VPA on the seed cluster.</p><h2 id=setting-up-ipv6-single-stack-networking-optional>Setting Up IPv6 Single-Stack Networking (optional)<a class=td-heading-self-link href=#setting-up-ipv6-single-stack-networking-optional aria-label="Heading self-link"></a></h2><p>First, ensure that your <code>/etc/hosts</code> file contains an entry resolving <code>garden.local.gardener.cloud</code> to the IPv6 loopback address:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>::1 garden.local.gardener.cloud
</span></span></code></pre></div><p>Typically, only <code>ip6-localhost</code> is mapped to <code>::1</code> on linux machines.
However, we need <code>garden.local.gardener.cloud</code> to resolve to both <code>127.0.0.1</code> and <code>::1</code> so that we can talk to our registry via a single address (<code>garden.local.gardener.cloud:5001</code>).</p><p>Next, we need to configure NAT for outgoing traffic from the kind network to the internet.
After executing <code>make kind-up IPFAMILY=ipv6</code>, execute the following command to set up the corresponding iptables rules:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip6tables -t nat -A POSTROUTING -o <span style=color:#00f>$(</span>ip route show default | awk <span style=color:#a31515>&#39;{print $5}&#39;</span><span style=color:#00f>)</span> -s fd00:10::/64 -j MASQUERADE
</span></span></code></pre></div><h2 id=setting-up-gardener>Setting Up Gardener<a class=td-heading-self-link href=#setting-up-gardener aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make gardener-up
</span></span></code></pre></div><blockquote><p>If you want to setup an IPv6 ready Gardener, use <code>make gardener-up IPFAMILY=ipv6</code> instead.</p></blockquote><p>This will first build the base images (which might take a bit if you do it for the first time).
Afterwards, the Gardener resources will be deployed into the cluster.</p><h2 id=developing-gardener>Developing Gardener<a class=td-heading-self-link href=#developing-gardener aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make gardener-dev
</span></span></code></pre></div><p>This is similar to <code>make gardener-up</code> but additionally starts a <a href=https://skaffold.dev/docs/workflows/dev/>skaffold dev loop</a>.
After the initial deployment, skaffold starts watching source files.
Once it has detected changes, press any key to trigger a new build and deployment of the changed components.</p><p>Tip: you can set the <code>SKAFFOLD_MODULE</code> environment variable to select specific modules of the skaffold configuration (see <a href=https://github.com/gardener/gardener/blob/master/skaffold.yaml><code>skaffold.yaml</code></a>) that skaffold should watch, build, and deploy.
This significantly reduces turnaround times during development.</p><p>For example, if you want to develop changes to gardenlet:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:green># initial deployment of all components</span>
</span></span><span style=display:flex><span>make gardener-up
</span></span><span style=display:flex><span><span style=color:green># start iterating on gardenlet without deploying other components</span>
</span></span><span style=display:flex><span>make gardener-dev SKAFFOLD_MODULE=gardenlet
</span></span></code></pre></div><h2 id=debugging-gardener>Debugging Gardener<a class=td-heading-self-link href=#debugging-gardener aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make gardener-debug
</span></span></code></pre></div><p>This is using skaffold debugging features. In the Gardener case, Go debugging using <a href=https://github.com/go-delve/delve>Delve</a> is the most relevant use case.
Please see the <a href=https://skaffold.dev/docs/workflows/debug/>skaffold debugging documentation</a> how to set up your IDE accordingly or check the examples below (<a href=/docs/gardener/deployment/getting_started_locally/#debugging-in-goland>GoLand</a>, <a href=/docs/gardener/deployment/getting_started_locally/#debugging-in-vs-code>VS Code</a>).</p><p><code>SKAFFOLD_MODULE</code> environment variable is working the same way as described for <a href=/docs/gardener/deployment/getting_started_locally/#developing-gardener>Developing Gardener</a>. However, skaffold is not watching for changes when debugging,
because it would like to avoid interrupting your debugging session.</p><p>For example, if you want to debug gardenlet:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:green># initial deployment of all components</span>
</span></span><span style=display:flex><span>make gardener-up
</span></span><span style=display:flex><span><span style=color:green># start debugging gardenlet without deploying other components</span>
</span></span><span style=display:flex><span>make gardener-debug SKAFFOLD_MODULE=gardenlet
</span></span></code></pre></div><p>In debugging flow, skaffold builds your container images, reconfigures your pods and creates port forwardings for the <code>Delve</code> debugging ports to your localhost.
The default port is <code>56268</code>. If you debug multiple pods at the same time, the port of the second pod will be forwarded to <code>56269</code> and so on.
Please check your console output for the concrete port-forwarding on your machine.</p><blockquote><p>Note: Resuming or stopping only a single goroutine (Go Issue <a href=https://github.com/golang/go/issues/25578>25578</a>, <a href=https://github.com/golang/go/issues/31132>31132</a>) is currently not supported, so the action will cause all the goroutines to get activated or paused.
(<a href=https://github.com/golang/vscode-go/wiki/debugging#connecting-to-headless-delve-with-target-specified-at-server-start-up>vscode-go wiki</a>)</p></blockquote><p>This means that when a goroutine of gardenlet (or any other gardener-core component you try to debug) is paused on a breakpoint, all the other goroutines are paused. Hence, when the whole gardenlet process is paused, it can not renew its lease and can not respond to the liveness and readiness probes. Skaffold automatically increases <code>timeoutSeconds</code> of liveness and readiness probes to 600. Anyway, we were facing problems when debugging that pods have been killed after a while.</p><p>Thus, leader election, health and readiness checks for <code>gardener-admission-controller</code>, <code>gardener-apiserver</code>, <code>gardener-controller-manager</code>, <code>gardener-scheduler</code>,<code>gardenlet</code> and <code>operator</code> are disabled when debugging.</p><p>If you have similar problems with other components which are not deployed by skaffold, you could temporarily turn off the leader election and disable liveness and readiness probes there too.</p><h3 id=debugging-in-goland>Debugging in GoLand<a class=td-heading-self-link href=#debugging-in-goland aria-label="Heading self-link"></a></h3><ol><li>Edit your <strong>Run/Debug Configurations</strong>.</li><li>Add a new <strong>Go Remote</strong> configuration.</li><li>Set the port to <code>56268</code> (or any increment of it when debugging multiple components).</li><li><em>Recommended:</em> Change the behavior of <strong>On disconnect</strong> to <strong>Leave it running</strong>.</li></ol><h3 id=debugging-in-vs-code>Debugging in VS Code<a class=td-heading-self-link href=#debugging-in-vs-code aria-label="Heading self-link"></a></h3><ol><li>Create or edit your <code>.vscode/launch.json</code> configuration.</li><li>Add the following configuration:</li></ol><pre tabindex=0><code class=language-json5 data-lang=json5>{
  &#34;name&#34;: &#34;go remote&#34;,
  &#34;type&#34;: &#34;go&#34;,
  &#34;request&#34;: &#34;attach&#34;,
  &#34;mode&#34;: &#34;remote&#34;,
  &#34;port&#34;: 56268, // or any increment of it when debugging multiple components
  &#34;host&#34;: &#34;127.0.0.1&#34;
}
</code></pre><p>Since the <a href=https://skaffold.dev/docs/builders/builder-types/ko/>ko</a> builder is used in Skaffold to build the images, it&rsquo;s not necessary to specify the <code>cwd</code> and <code>remotePath</code> options as they match the workspace folder (<a href=https://skaffold.dev/docs/workflows/debug/#skaffold-debug-using-the-vs-code-go-extension>ref</a>).</p><h2 id=creating-a-shoot-cluster>Creating a <code>Shoot</code> Cluster<a class=td-heading-self-link href=#creating-a-shoot-cluster aria-label="Heading self-link"></a></h2><p>You can wait for the <code>Seed</code> to be ready by running:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./hack/usage/wait-for.sh seed local GardenletReady SeedSystemComponentsHealthy ExtensionsReady
</span></span></code></pre></div><p>Alternatively, you can run <code>kubectl get seed local</code> and wait for the <code>STATUS</code> to indicate readiness:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME    STATUS   PROVIDER   REGION   AGE     VERSION       K8S VERSION
</span></span><span style=display:flex><span>local   Ready    local      local    4m42s   vX.Y.Z-dev    v1.28.1
</span></span></code></pre></div><p>In order to create a first shoot cluster, just run:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f example/provider-local/shoot.yaml
</span></span></code></pre></div><p>You can wait for the <code>Shoot</code> to be ready by running:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAMESPACE=garden-local ./hack/usage/wait-for.sh shoot local APIServerAvailable ControlPlaneHealthy ObservabilityComponentsHealthy EveryNodeReady SystemComponentsHealthy
</span></span></code></pre></div><p>Alternatively, you can run <code>kubectl -n garden-local get shoot local</code> and wait for the <code>LAST OPERATION</code> to reach <code>100%</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME    CLOUDPROFILE   PROVIDER   REGION   K8S VERSION   HIBERNATION   LAST OPERATION            STATUS    AGE
</span></span><span style=display:flex><span>local   local          local      local   1.28.1        Awake         Create Processing (43%)   healthy   94s
</span></span></code></pre></div><p>If you don&rsquo;t need any worker pools, you can create a workerless <code>Shoot</code> by running:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f example/provider-local/shoot-workerless.yaml
</span></span></code></pre></div><p>(Optional): You could also execute a simple e2e test (creating and deleting a shoot) by running:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make test-e2e-local-simple KUBECONFIG=<span style=color:#a31515>&#34;</span>$PWD<span style=color:#a31515>/example/gardener-local/kind/local/kubeconfig&#34;</span>
</span></span></code></pre></div><h3 id=accessing-the-shoot-cluster>Accessing the <code>Shoot</code> Cluster<a class=td-heading-self-link href=#accessing-the-shoot-cluster aria-label="Heading self-link"></a></h3><p>⚠️ Please note that in this setup, shoot clusters are not accessible by default when you download the kubeconfig and try to communicate with them.
The reason is that your host most probably cannot resolve the DNS names of the clusters since <code>provider-local</code> extension runs inside the KinD cluster (for more details, see <a href=/docs/gardener/extensions/provider-local/#dnsrecord>DNSRecord</a>).
Hence, if you want to access the shoot cluster, you have to run the following command which will extend your <code>/etc/hosts</code> file with the required information to make the DNS names resolvable:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#a31515>&lt;&lt;EOF | sudo tee -a /etc/hosts
</span></span></span><span style=display:flex><span><span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515># Begin of Gardener local setup section
</span></span></span><span style=display:flex><span><span style=color:#a31515># Shoot API server domains
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.local.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.local.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515># Ingress
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 p-seed.ingress.local.seed.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 g-seed.ingress.local.seed.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 gu-local--local.ingress.local.seed.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 p-local--local.ingress.local.seed.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 v-local--local.ingress.local.seed.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515># E2E tests
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-managedseed.garden.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-managedseed.garden.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-hib.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-hib.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-hib-wl.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-hib-wl.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-unpriv.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-unpriv.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-wake-up.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-wake-up.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-wake-up-wl.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-wake-up-wl.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-wake-up-ncp.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-wake-up-ncp.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-migrate.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-migrate.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-migrate-wl.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-migrate-wl.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-mgr-hib.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-mgr-hib.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-rotate.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-rotate.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-rotate-wl.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-rotate-wl.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-rot-noroll.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-rot-noroll.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-rot-ip.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-rot-ip.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-rot-nr-ip.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-rot-nr-ip.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-default.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-default.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-default-wl.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-default-wl.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-default-ip.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-default-ip.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-force-delete.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-force-delete.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-fd-hib.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-fd-hib.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-upd-node.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-upd-node.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-upd-node-wl.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-upd-node-wl.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-upgrade.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-upgrade.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-upgrade-wl.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-upgrade-wl.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-upg-hib.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-upg-hib.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-upg-hib-wl.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-upg-hib-wl.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-auth-one.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-auth-one.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-auth-two.local.external.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 api.e2e-auth-two.local.internal.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 gu-local--e2e-rotate.ingress.local.seed.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 gu-local--e2e-rotate-wl.ingress.local.seed.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 gu-local--e2e-rot-noroll.ingress.local.seed.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 gu-local--e2e-rot-ip.ingress.local.seed.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.1 gu-local--e2e-rot-nr-ip.ingress.local.seed.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515># End of Gardener local setup section
</span></span></span><span style=display:flex><span><span style=color:#a31515>EOF</span>
</span></span></code></pre></div><p>To access the <code>Shoot</code>, you can acquire a <code>kubeconfig</code> by using the <a href=/docs/gardener/shoot/shoot_access/#shootsadminkubeconfig-subresource><code>shoots/adminkubeconfig</code> subresource</a>.</p><p>For convenience a <a href=https://github.com/gardener/gardener/blob/master/hack/usage/generate-admin-kubeconf.sh>helper script</a> is provided in the <code>hack</code> directory. By default the script will generate a kubeconfig for a <code>Shoot</code> named &ldquo;local&rdquo; in the <code>garden-local</code> namespace valid for one hour.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./hack/usage/generate-admin-kubeconf.sh &gt; admin-kubeconf.yaml
</span></span></code></pre></div><p>If you want to change the default namespace or shoot name, you can do so by passing different values as arguments.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./hack/usage/generate-admin-kubeconf.sh --namespace &lt;namespace&gt; --shoot-name &lt;shootname&gt; &gt; admin-kubeconf.yaml
</span></span></code></pre></div><p>To access an Ingress resource from the <code>Seed</code>, use the Ingress host with port <code>8448</code> (<code>https://&lt;ingress-host>:8448</code>, for example <code>https://gu-local--local.ingress.local.seed.local.gardener.cloud:8448</code>).</p><h2 id=optional-setting-up-a-second-seed-cluster>(Optional): Setting Up a Second Seed Cluster<a class=td-heading-self-link href=#optional-setting-up-a-second-seed-cluster aria-label="Heading self-link"></a></h2><p>There are cases where you would want to create a second seed cluster in your local setup.
For example, if you want to test the <a href=/docs/gardener/control_plane_migration/>control plane migration</a> feature.
The following steps describe how to do that.</p><p>Start by setting up the second KinD cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make kind2-up
</span></span></code></pre></div><p>This command sets up a new KinD cluster named <code>gardener-local2</code> and stores its kubeconfig in the <code>./example/gardener-local/kind/local2/kubeconfig</code> file.
It adds another IP address (<code>172.18.255.2</code>) to your loopback device which is necessary for you to reach the new cluster locally.</p><p>In order to deploy required resources in the KinD cluster that you just created, run:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make gardenlet-kind2-up
</span></span></code></pre></div><p>The following steps assume that you are using the kubeconfig that points to the <code>gardener-local</code> cluster (first KinD cluster): <code>export KUBECONFIG=$PWD/example/gardener-local/kind/local/kubeconfig</code>.</p><p>You can wait for the <code>local2</code> <code>Seed</code> to be ready by running:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./hack/usage/wait-for.sh seed local2 GardenletReady SeedSystemComponentsHealthy ExtensionsReady
</span></span></code></pre></div><p>Alternatively, you can run <code>kubectl get seed local2</code> and wait for the <code>STATUS</code> to indicate readiness:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME    STATUS   PROVIDER   REGION   AGE     VERSION       K8S VERSION
</span></span><span style=display:flex><span>local2  Ready    local      local    4m42s   vX.Y.Z-dev    v1.25.1
</span></span></code></pre></div><p>If you want to perform control plane migration, you can follow the steps outlined in <a href=/docs/gardener/control_plane_migration/>Control Plane Migration</a> to migrate the shoot cluster to the second seed you just created.</p><h2 id=deleting-the-shoot-cluster>Deleting the <code>Shoot</code> Cluster<a class=td-heading-self-link href=#deleting-the-shoot-cluster aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./hack/usage/delete shoot local garden-local
</span></span></code></pre></div><h2 id=optional-tear-down-the-second-seed-cluster>(Optional): Tear Down the Second Seed Cluster<a class=td-heading-self-link href=#optional-tear-down-the-second-seed-cluster aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make kind2-down
</span></span></code></pre></div><p>On macOS, if you want to remove the additional IP address on your loopback device run the following script:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo ip addr del 172.18.255.2 dev lo0
</span></span></code></pre></div><h2 id=tear-down-the-gardener-environment>Tear Down the Gardener Environment<a class=td-heading-self-link href=#tear-down-the-gardener-environment aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make kind-down
</span></span></code></pre></div><h2 id=alternative-way-to-set-up-garden-and-seed-leveraging-gardener-operator>Alternative Way to Set Up Garden and Seed Leveraging <code>gardener-operator</code><a class=td-heading-self-link href=#alternative-way-to-set-up-garden-and-seed-leveraging-gardener-operator aria-label="Heading self-link"></a></h2><p>Instead of starting Garden and Seed via <code>make kind-up gardener-up</code>, you can also use <code>gardener-operator</code> to create your local dev landscape.
In this setup, the virtual garden cluster has its own load balancer, so you have to create an own DNS entry in your <code>/etc/hosts</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#a31515>&lt;&lt;EOF | sudo tee -a /etc/hosts
</span></span></span><span style=display:flex><span><span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515># Begin of Gardener Operator local setup section
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.3 api.virtual-garden.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515>172.18.255.3 plutono-garden.ingress.runtime-garden.local.gardener.cloud
</span></span></span><span style=display:flex><span><span style=color:#a31515># End of Gardener Operator local setup section
</span></span></span><span style=display:flex><span><span style=color:#a31515>EOF</span>
</span></span></code></pre></div><p>You can bring up <code>gardener-operator</code> with this command:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make kind-operator-up operator-up
</span></span></code></pre></div><p>Afterwards, you can create your local <code>Garden</code> and install <code>gardenlet</code> into the KinD cluster with this command:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make operator-seed-up
</span></span></code></pre></div><p>You find the kubeconfig for the KinD cluster at <code>./example/gardener-local/kind/operator/kubeconfig</code>.
The one for the virtual garden is accessible at <code>./dev-setup/kubeconfigs/virtual-garden/kubeconfig</code>.</p><blockquote class="alert alert-important"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>message-outline</title><path d="M20 2H4C2.9 2 2 2.9 2 4V22l4-4H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2m0 14H5.2L4 17.2V4H20V16z"/></svg><p>Important</p></div><p>When you create non-HA shoot clusters (i.e., <code>Shoot</code>s with <code>.spec.controlPlane.highAvailability.failureTolerance != zone</code>), then they are not exposed via <code>172.18.255.1</code> (<a href=/docs/gardener/deployment/getting_started_locally/#accessing-the-shoot-cluster>ref</a>).
Instead, you need to find out under which Istio instance they got exposed, and put the corresponding IP address into your <code>/etc/hosts</code> file:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:green># replace &lt;shoot-namespace&gt; with your shoot namespace (e.g., `shoot--foo--bar`):</span>
</span></span><span style=display:flex><span>kubectl -n <span style=color:#a31515>&#34;</span><span style=color:#00f>$(</span>kubectl -n &lt;shoot-namespace&gt; get gateway kube-apiserver -o jsonpath={.spec.selector.istio} | sed <span style=color:#a31515>&#39;s/.*--/istio-ingress--/&#39;</span><span style=color:#00f>)</span><span style=color:#a31515>&#34;</span> get svc istio-ingressgateway -o jsonpath={.status.loadBalancer.ingress..ip}
</span></span></code></pre></div><p>When the shoot cluster is HA (i.e., <code>.spec.controlPlane.highAvailability.failureTolerance == zone</code>), then you can access it via <code>172.18.255.1</code>.</p></blockquote><p>Similar as in the section <em><a href=/docs/gardener/deployment/getting_started_locally/#developing-gardener>Developing Gardener</a></em> it&rsquo;s possible to run a <a href=https://skaffold.dev/docs/workflows/dev/>Skaffold development loop</a> as well using:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make operator-seed-dev
</span></span></code></pre></div><blockquote><p>&#8505;&#xfe0f; Please note that in this setup Skaffold is only watching for changes in the following components:</p><ul><li><a href=/docs/gardener/concepts/gardenlet/><code>gardenlet</code></a></li><li><code>gardenlet/chart</code></li><li><a href=/docs/gardener/concepts/resource-manager/><code>gardener-resource-manager</code></a></li><li><a href=/docs/gardener/concepts/node-agent/><code>gardener-node-agent</code></a></li></ul></blockquote><p>Finally, please use this command to tear down your environment:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make kind-operator-down
</span></span></code></pre></div><p>This setup supports creating shoots and managed seeds the same way as explained in the previous chapters.
However, the development loop has limitations and the debugging setup is not working yet.</p><h2 id=remote-local-setup>Remote Local Setup<a class=td-heading-self-link href=#remote-local-setup aria-label="Heading self-link"></a></h2><p>Just like Prow is executing the KinD-based e2e tests in a K8s pod, it is
possible to interactively run this KinD based Gardener development environment,
aka &ldquo;local setup&rdquo;, in a &ldquo;remote&rdquo; K8s pod.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>k apply -f docs/deployment/content/remote-local-setup.yaml
</span></span><span style=display:flex><span>k exec -it remote-local-setup-0 -- sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tmux a
</span></span></code></pre></div><h3 id=caveats>Caveats<a class=td-heading-self-link href=#caveats aria-label="Heading self-link"></a></h3><p>Please refer to the <a href=https://github.com/tmux/tmux/wiki>TMUX documentation</a> for
working effectively inside the remote-local-setup pod.</p><p>To access Plutono, Prometheus or other components in a browser, two port forwards are needed:</p><p>The port forward from the laptop to the pod:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>k port-forward remote-local-setup-0 3000
</span></span></code></pre></div><p>The port forward in the remote-local-setup pod to the respective component:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>k port-forward -n shoot--local--local deployment/plutono 3000
</span></span></code></pre></div><h2 id=related-links>Related Links<a class=td-heading-self-link href=#related-links aria-label="Heading self-link"></a></h2><ul><li><a href=/docs/gardener/extensions/provider-local/>Local Provider Extension</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f278519ade7bb6a4a605318159050e20>9 - Getting Started Locally With Extensions</h1><h1 id=deploying-gardener-locally-and-enabling-provider-extensions>Deploying Gardener Locally and Enabling Provider-Extensions<a class=td-heading-self-link href=#deploying-gardener-locally-and-enabling-provider-extensions aria-label="Heading self-link"></a></h1><p>This document will walk you through deploying Gardener on your local machine and bootstrapping your own seed clusters on an existing Kubernetes cluster.
It is supposed to run your local Gardener developments on a real infrastructure. For running Gardener only entirely local, please check the <a href=/docs/gardener/deployment/getting_started_locally/>getting started locally</a> documentation.
If you encounter difficulties, please open an issue so that we can make this process easier.</p><h2 id=overview>Overview<a class=td-heading-self-link href=#overview aria-label="Heading self-link"></a></h2><p>Gardener runs in any Kubernetes cluster.
In this guide, we will start a <a href=https://kind.sigs.k8s.io/>KinD</a> cluster which is used as garden cluster. Any Kubernetes cluster could be used as seed clusters in order to support provider extensions (please refer to the <a href=/docs/gardener/concepts/architecture/>architecture overview</a>). This guide is tested for using Kubernetes clusters provided by Gardener, AWS, Azure, and GCP as seed so far.</p><p>Based on <a href=https://skaffold.dev/>Skaffold</a>, the container images for all required components will be built and deployed into the clusters (via their <a href=https://helm.sh/>Helm charts</a>).</p><p><img src=/docs/gardener/deployment/content/getting_started_locally_with_extensions.png alt="Architecture Diagram"></p><h2 id=prerequisites>Prerequisites<a class=td-heading-self-link href=#prerequisites aria-label="Heading self-link"></a></h2><ul><li>Make sure that you have followed the <a href=/docs/gardener/local_setup/>Local Setup guide</a> up until the <a href=/docs/gardener/local_setup/#get-the-sources>Get the sources</a> step.</li><li>Make sure your Docker daemon is up-to-date, up and running and has enough resources (at least <code>8</code> CPUs and <code>8Gi</code> memory; see the <a href=https://docs.docker.com/desktop/settings/mac/>Docker documentation</a> for how to configure the resources for Docker for Mac).<blockquote><p>Additionally, please configure at least <code>120Gi</code> of disk size for the Docker daemon.
Tip: You can clean up unused data with <code>docker system df</code> and <code>docker system prune -a</code>.</p></blockquote></li><li>Make sure that you have access to a Kubernetes cluster you can use as a seed cluster in this setup.<ul><li>The seed cluster requires at least 16 CPUs in total to run one shoot cluster</li><li>You could use any Kubernetes cluster for your seed cluster. However, using a Gardener shoot cluster for your seed simplifies some configuration steps.</li><li>When bootstrapping <code>gardenlet</code> to the cluster, your new seed will have the same provider type as the shoot cluster you use - an AWS shoot will become an AWS seed, a GCP shoot will become a GCP seed, etc. (only relevant when using a Gardener shoot as seed).</li></ul></li></ul><h2 id=provide-infrastructure-credentials-and-configuration>Provide Infrastructure Credentials and Configuration<a class=td-heading-self-link href=#provide-infrastructure-credentials-and-configuration aria-label="Heading self-link"></a></h2><p>As this setup is running on a real infrastructure, you have to provide credentials for DNS, the infrastructure, and the kubeconfig for the Kubernetes cluster you want to use as seed.</p><blockquote><p>There are <code>.gitignore</code> entries for all files and directories which include credentials. Nevertheless, please double check and make sure that credentials are not committed to the version control system.</p></blockquote><h3 id=dns>DNS<a class=td-heading-self-link href=#dns aria-label="Heading self-link"></a></h3><p>Gardener control plane requires DNS for default and internal domains. Thus, you have to configure a valid DNS provider for your setup.</p><p>Please maintain your DNS provider configuration and credentials at <code>./example/provider-extensions/garden/controlplane/domain-secrets.yaml</code>.</p><p>You can find a template for the file at <code>./example/provider-extensions/garden/controlplane/domain-secrets.yaml.tmpl</code>.</p><h3 id=infrastructure>Infrastructure<a class=td-heading-self-link href=#infrastructure aria-label="Heading self-link"></a></h3><p>Infrastructure secrets and the corresponding secret bindings should be maintained at:</p><ul><li><code>./example/provider-extensions/garden/project/credentials/infrastructure-secrets.yaml</code></li><li><code>./example/provider-extensions/garden/project/credentials/secretbindings.yaml</code></li></ul><p>There are templates with <code>.tmpl</code> suffixes for the files in the same folder.</p><h3 id=projects>Projects<a class=td-heading-self-link href=#projects aria-label="Heading self-link"></a></h3><p>The projects and the namespaces associated with them should be maintained at <code>./example/provider-extensions/garden/project/project.yaml</code>.</p><p>You can find a template for the file at <code>./example/provider-extensions/garden/project/project.yaml.tmpl</code>.</p><h3 id=seed-cluster-preparation>Seed Cluster Preparation<a class=td-heading-self-link href=#seed-cluster-preparation aria-label="Heading self-link"></a></h3><p>The <code>kubeconfig</code> of your Kubernetes cluster you would like to use as seed should be placed at <code>./example/provider-extensions/seed/kubeconfig</code>.
Additionally, please maintain the configuration of your seed in <code>./example/provider-extensions/gardenlet/values.yaml</code>. It is automatically copied from <code>values.yaml.tmpl</code> in the same directory when you run <code>make gardener-extensions-up</code> for the first time. It also includes explanations of the properties you should set.</p><p>Using a Gardener Shoot cluster as seed simplifies the process, because some configuration options can be taken from <code>shoot-info</code> and creating DNS entries and TLS certificates is automated.</p><p>However, you can use different Kubernetes clusters for your seed too and configure these things manually. Please configure the options of <code>./example/provider-extensions/gardenlet/values.yaml</code> upfront. For configuring DNS and TLS certificates, <code>make gardener-extensions-up</code>, which is explained later, will pause and tell you what to do.</p><h3 id=external-controllers>External Controllers<a class=td-heading-self-link href=#external-controllers aria-label="Heading self-link"></a></h3><p>You might plan to deploy and register external controllers for networking, operating system, providers, etc. Please put <code>ControllerDeployment</code>s and <code>ControllerRegistration</code>s into the <code>./example/provider-extensions/garden/controllerregistrations</code> directory. The whole content of this folder will be applied to your KinD cluster.</p><h3 id=cloudprofiles><code>CloudProfile</code>s<a class=td-heading-self-link href=#cloudprofiles aria-label="Heading self-link"></a></h3><p>There are no demo <code>CloudProfiles</code> yet. Thus, please copy <code>CloudProfiles</code> from another landscape to the <code>./example/provider-extensions/garden/cloudprofiles</code> directory or create your own <code>CloudProfiles</code> based on the <a href=https://github.com/gardener/gardener/blob/master/example/30-cloudprofile.yaml>gardener examples</a>. Please check the GitHub repository of your desired provider-extension. Most of them include example <code>CloudProfile</code>s. All files you place in this folder will be applied to your KinD cluster.</p><h2 id=setting-up-the-kind-cluster>Setting Up the KinD Cluster<a class=td-heading-self-link href=#setting-up-the-kind-cluster aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make kind-extensions-up
</span></span></code></pre></div><p>This command sets up a new KinD cluster named <code>gardener-extensions</code> and stores the kubeconfig in the <code>./example/gardener-local/kind/extensions/kubeconfig</code> file.</p><blockquote><p>It might be helpful to copy this file to <code>$HOME/.kube/config</code>, since you will need to target this KinD cluster multiple times.
Alternatively, make sure to set your <code>KUBECONFIG</code> environment variable to <code>./example/gardener-local/kind/extensions/kubeconfig</code> for all future steps via <code>export KUBECONFIG=$PWD/example/gardener-local/kind/extensions/kubeconfig</code>.</p></blockquote><p>All of the following steps assume that you are using this kubeconfig.</p><p>Additionally, this command deploys a local container registry to the cluster as well as a few registry mirrors that are set up as a pull-through cache for all upstream registries Gardener uses by default.
This is done to speed up image pulls across local clusters.</p><blockquote><p>You will need to add <code>127.0.0.1 garden.local.gardener.cloud</code> to your /etc/hosts.</p></blockquote><p>The local registry can now be accessed either via <code>localhost:5001</code> or <code>garden.local.gardener.cloud:5001</code> for pushing and pulling.
The storage directories of the registries are mounted to your machine under <code>dev/local-registry</code>.
With this, mirrored images don&rsquo;t have to be pulled again after recreating the cluster.</p><p>The command also deploys a default <a href=https://github.com/projectcalico/calico>calico</a> installation as the cluster&rsquo;s CNI implementation with <code>NetworkPolicy</code> support (the default <code>kindnet</code> CNI doesn&rsquo;t provide <code>NetworkPolicy</code> support).
Furthermore, it deploys the <a href=https://github.com/kubernetes-sigs/metrics-server>metrics-server</a> in order to support HPA and VPA on the seed cluster.</p><h2 id=setting-up-gardener-garden-on-kind-seed-on-gardener-cluster>Setting Up Gardener (Garden on KinD, Seed on Gardener Cluster)<a class=td-heading-self-link href=#setting-up-gardener-garden-on-kind-seed-on-gardener-cluster aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make gardener-extensions-up
</span></span></code></pre></div><p>This will first prepare the basic configuration of your KinD and Gardener clusters.
Afterwards, the images for the Garden cluster are built and deployed into the KinD cluster.
Finally, the images for the Seed cluster are built, pushed to a container registry on the Seed, and the <code>gardenlet</code> is started.</p><p>If support for workload identity is required you can invoke the top command with <code>DEV_SETUP_WITH_WORKLOAD_IDENTITY_SUPPORT</code> variable set to <code>true</code>.
This will cause the <a href=https://github.com/gardener/gardener-discovery-server>Gardener Discovery Server</a> to be deployed and exposed through the seed cluster.
External systems can be then configured to trust the workload identity issuer of the local Garden cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>DEV_SETUP_WITH_WORKLOAD_IDENTITY_SUPPORT=true make gardener-extensions-up
</span></span></code></pre></div><blockquote class="alert alert-important"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>message-outline</title><path d="M20 2H4C2.9 2 2 2.9 2 4V22l4-4H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2m0 14H5.2L4 17.2V4H20V16z"/></svg><p>Important</p></div><p>The Gardener Discovery Server is started with a token which is valid for 48 hours.
Rerun <code>DEV_SETUP_WITH_WORKLOAD_IDENTITY_SUPPORT=true make gardener-extensions-up</code> in order to renew the token.</p><p>When working with multiple seed clusters you need to only pass <code>DEV_SETUP_WITH_WORKLOAD_IDENTITY_SUPPORT=true</code> for the one seed cluster that will be used to expose the workload identity documents.
A single Garden cluster needs only one Gardener Discovery Server.</p></blockquote><p>To setup workload identity with your provider please refer to the provider extension specific docs:</p><ul><li><a href=/docs/extensions/infrastructure-extensions/gardener-extension-provider-aws/usage/#aws-workload-identity-federation>provider-aws</a></li><li><a href=/docs/extensions/infrastructure-extensions/gardener-extension-provider-azure/usage/#azure-workload-identity-federation>provider-azure</a></li><li><a href=/docs/extensions/infrastructure-extensions/gardener-extension-provider-gcp/usage/#gcp-workload-identity-federation>provider-gcp</a></li></ul><h3 id=adding-additional-seeds>Adding Additional Seeds<a class=td-heading-self-link href=#adding-additional-seeds aria-label="Heading self-link"></a></h3><p>Additional seed(s) can be added by running</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make gardener-extensions-up SEED_NAME=&lt;seed-name&gt;
</span></span></code></pre></div><p>The seed cluster preparations are similar to the first seed:</p><p>The <code>kubeconfig</code> of your Kubernetes cluster you would like to use as seed should be placed at <code>./example/provider-extensions/seed/kubeconfig-&lt;seed-name></code>.
Additionally, please maintain the configuration of your seed in <code>./example/provider-extensions/gardenlet/values-&lt;seed-name>.yaml</code>. It is automatically copied from <code>values.yaml.tmpl</code> in the same directory when you run <code>make gardener-extensions-up SEED_NAME=&lt;seed-name></code> for the first time. It also includes explanations of the properties you should set.</p><h3 id=removing-a-seed>Removing a Seed<a class=td-heading-self-link href=#removing-a-seed aria-label="Heading self-link"></a></h3><p>If you have multiple seeds and want to remove one, just use</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make gardener-extensions-down SEED_NAME=&lt;seed-name&gt;
</span></span></code></pre></div><p>If it is not the last seed, this command will only remove the seed, but leave the local Gardener cluster and the other seeds untouched.
To remove all seeds and to cleanup the local Gardener cluster, you have to run the command for each seed.</p><blockquote class="alert alert-tip"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>lightbulb-on-outline</title><path d="M20 11h3v2H20V11M1 11H4v2H1V11M13 1V4H11V1h2M4.92 3.5 7.05 5.64 5.63 7.05 3.5 4.93 4.92 3.5M16.95 5.63 19.07 3.5 20.5 4.93 18.37 7.05 16.95 5.63M12 6a6 6 0 016 6c0 2.22-1.21 4.16-3 5.2V19a1 1 0 01-1 1H10A1 1 0 019 19V17.2C7.21 16.16 6 14.22 6 12a6 6 0 016-6m2 15v1a1 1 0 01-1 1H11a1 1 0 01-1-1V21h4m-3-3h2V15.87c1.73-.44 3-2.01 3-3.87A4 4 0 0012 8 4 4 0 008 12c0 1.86 1.27 3.43 3 3.87V18z"/></svg><p>Tip</p></div><p>If using development setup that supports workload identity pass <code>DEV_SETUP_WITH_WORKLOAD_IDENTITY_SUPPORT=true</code> when removing the seed that was used to host the <a href=https://github.com/gardener/gardener-discovery-server>Gardener Discovery Server</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>DEV_SETUP_WITH_WORKLOAD_IDENTITY_SUPPORT=true make gardener-extensions-down SEED_NAME=&lt;seed-name&gt;
</span></span></code></pre></div></blockquote><h3 id=rotate-credentials-of-container-image-registry-in-a-seed>Rotate credentials of container image registry in a Seed<a class=td-heading-self-link href=#rotate-credentials-of-container-image-registry-in-a-seed aria-label="Heading self-link"></a></h3><p>There is a container image registry in each Seed cluster where Gardener images required for the Seed and the Shoot nodes are pushed to. This registry is password protected.
The password is generated when the Seed is deployed via <code>make gardener-extensions-up</code>. Afterward, it is not rotated automatically.
Otherwise, this could break the update of <code>gardener-node-agent</code>, because it might not be able to pull its own new image anymore
This is no general issue of <code>gardener-node-agent</code>, but a limitation <code>provider-extensions</code> setup. Gardener does not support protected container images out of the box. The function was added for this scenario only.</p><p>However, if you want to rotate the credentials for any reason, there are two options for it.</p><ul><li>run <code>make gardener-extensions-up</code> (to ensure that your images are up-to-date)</li><li><code>reconcile</code> all shoots on the seed where you want to rotate the registry password</li><li>run <code>kubectl delete secrets -n registry registry-password</code> on your seed cluster</li><li>run <code>make gardener-extensions-up</code></li><li><code>reconcile</code> the shoots again</li></ul><p>or</p><ul><li><code>reconcile</code> all shoots on the seed where you want to rotate the registry password</li><li>run <code>kubectl delete secrets -n registry registry-password</code> on your seed cluster</li><li>run <code>./example/provider-extensions/registry-seed/deploy-registry.sh &lt;path to seed kubeconfig> &lt;seed registry hostname></code></li><li><code>reconcile</code> the shoots again</li></ul><h2 id=pause-and-unpause-the-kind-cluster>Pause and Unpause the KinD Cluster<a class=td-heading-self-link href=#pause-and-unpause-the-kind-cluster aria-label="Heading self-link"></a></h2><p>The KinD cluster can be paused by stopping and keeping its docker container. This can be done by running:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make kind-extensions-down
</span></span></code></pre></div><p>When you run <code>make kind-extensions-up</code> again, you will start the docker container with your previous Gardener configuration again.</p><p>This provides the option to switch off your local KinD cluster fast without leaving orphaned infrastructure elements behind.</p><h2 id=creating-a-shoot-cluster>Creating a <code>Shoot</code> Cluster<a class=td-heading-self-link href=#creating-a-shoot-cluster aria-label="Heading self-link"></a></h2><p>You can wait for the <code>Seed</code> to be ready by running:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl wait --for=condition=gardenletready seed provider-extensions --timeout=5m
</span></span></code></pre></div><p><code>make kind-extensions-up</code> already includes such a check. However, it might be useful when you wake up your <code>Seed</code> from hibernation or unpause you KinD cluster.</p><p>Alternatively, you can run <code>kubectl get seed provider-extensions</code> and wait for the <code>STATUS</code> to indicate readiness:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME                  STATUS   PROVIDER   REGION         AGE    VERSION      K8S VERSION
</span></span><span style=display:flex><span>provider-extensions   Ready    gcp        europe-west1   111m   v1.61.0-dev   v1.24.7
</span></span></code></pre></div><p>In order to create a first shoot cluster, please create your own <code>Shoot</code> definition and apply it to your KinD cluster. <code>gardener-scheduler</code> includes <code>candidateDeterminationStrategy: MinimalDistance</code> configuration so you are able to run schedule <code>Shoot</code>s of different providers on your <code>Seed</code>.</p><p>You can wait for your <code>Shoot</code>s to be ready by running <code>kubectl -n garden-local get shoots</code> and wait for the <code>LAST OPERATION</code> to reach <code>100%</code>. The output depends on your <code>Shoot</code> definition. This is an example output:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME        CLOUDPROFILE   PROVIDER   REGION         K8S VERSION   HIBERNATION   LAST OPERATION               STATUS    AGE
</span></span><span style=display:flex><span>aws         aws            aws        eu-west-1      1.24.3        Awake         Create Processing (43%)      healthy   84s
</span></span><span style=display:flex><span>aws-arm64   aws            aws        eu-west-1      1.24.3        Awake         Create Processing (43%)      healthy   65s
</span></span><span style=display:flex><span>azure       az             azure      westeurope     1.24.2        Awake         Create Processing (43%)      healthy   57s
</span></span><span style=display:flex><span>gcp         gcp            gcp        europe-west1   1.24.3        Awake         Create Processing (43%)      healthy   94s
</span></span></code></pre></div><h3 id=accessing-the-shoot-cluster>Accessing the <code>Shoot</code> Cluster<a class=td-heading-self-link href=#accessing-the-shoot-cluster aria-label="Heading self-link"></a></h3><p>Your shoot clusters will have a public DNS entries for their API servers, so that they could be reached via the Internet via <code>kubectl</code> after you have created their <code>kubeconfig</code>.</p><p>We encourage you to use the <a href=https://github.com/gardener/gardener/blob/master/docs/proposals/16-adminkubeconfig-subresource.md>adminkubeconfig subresource</a> for accessing your shoot cluster. You can find an example how to use it in <a href=/docs/gardener/shoot/shoot_access/#shootsadminkubeconfig-subresource>Accessing Shoot Clusters</a>.</p><h2 id=deleting-the-shoot-clusters>Deleting the <code>Shoot</code> Clusters<a class=td-heading-self-link href=#deleting-the-shoot-clusters aria-label="Heading self-link"></a></h2><p>Before tearing down your environment, you have to delete your shoot clusters. This is highly recommended because otherwise you would leave orphaned items on your infrastructure accounts.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./hack/usage/delete shoot &lt;your-shoot&gt; garden-local
</span></span></code></pre></div><h2 id=tear-down-the-gardener-environment>Tear Down the Gardener Environment<a class=td-heading-self-link href=#tear-down-the-gardener-environment aria-label="Heading self-link"></a></h2><p>Before you delete your local KinD cluster, you should shut down your <code>Shoots</code> and <code>Seed</code> in a clean way to avoid orphaned infrastructure elements in your projects.</p><p>Please ensure that your KinD and Seed clusters are online (not paused or hibernated) and run:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make gardener-extensions-down
</span></span></code></pre></div><p>This will delete all <code>Shoots</code> first (this could take a couple of minutes), then uninstall <code>gardenlet</code> from the Seed and the gardener components from the KinD. Finally, the additional components like container registry, etc., are deleted from both clusters.</p><p>When this is done, you can securely delete your local KinD cluster by running:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make kind-extensions-clean
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-cfd498df78c89b6ec394f57c4eb6e410>10 - Getting Started Locally With Gardenadm</h1><h1 id=deploying-autonomous-shoot-clusters-locally>Deploying Autonomous Shoot Clusters Locally<a class=td-heading-self-link href=#deploying-autonomous-shoot-clusters-locally aria-label="Heading self-link"></a></h1><blockquote class="alert alert-caution"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>alert-octagon-outline</title><path d="M8.27 3 3 8.27v7.46L8.27 21h7.46C17.5 19.24 21 15.73 21 15.73V8.27L15.73 3M9.1 5h5.8L19 9.1v5.8L14.9 19H9.1L5 14.9V9.1M11 15h2v2H11V15m0-8h2v6H11V7"/></svg><p>Caution</p></div><p>The <code>gardenadm</code> tool is currently under development and considered highly experimental.
Do not use it in production environments.
Read more about it in <a href=https://github.com/gardener/gardener/blob/master/docs/proposals/28-autonomous-shoot-clusters.md>GEP-28</a>.</p></blockquote><p>This document walks you through deploying Autonomous Shoot Clusters using <code>gardenadm</code> on your local machine.
This setup can be used for trying out and developing <code>gardenadm</code> locally without additional infrastructure.
The setup is also used for running e2e tests for <code>gardenadm</code> in CI (<a href=https://prow.gardener.cloud>Prow</a>).</p><p>If you encounter difficulties, please open an issue so that we can make this process easier.</p><h2 id=overview>Overview<a class=td-heading-self-link href=#overview aria-label="Heading self-link"></a></h2><p><code>gardenadm</code> is a command line tool for bootstrapping Kubernetes clusters called &ldquo;Autonomous Shoot Clusters&rdquo;. Read the <a href=/docs/gardener/concepts/gardenadm/><code>gardenadm</code> documentation</a> for more details on its concepts.</p><p>In this guide, we will start a <a href=https://kind.sigs.k8s.io/>KinD</a> cluster which hosts pods serving as machines for the autonomous shoot cluster – just as for shoot clusters of <a href=/docs/gardener/extensions/provider-local/>provider-local</a>.
The setup supports both the high-touch and medium-touch scenario of <code>gardenadm</code>.</p><p>Based on <a href=https://skaffold.dev/>Skaffold</a>, the container images for all required components will be built and deployed into the cluster.
This also includes the <code>gardenadm</code> CLI, which is installed on the machine pods by pulling the container image and extracting the binary.</p><h2 id=prerequisites>Prerequisites<a class=td-heading-self-link href=#prerequisites aria-label="Heading self-link"></a></h2><ul><li>Make sure that you have followed the <a href=/docs/gardener/local_setup/>Local Setup guide</a> up until the <a href=/docs/gardener/local_setup/#get-the-sources>Get the sources</a> step.</li><li>Make sure your Docker daemon is up-to-date, up and running and has enough resources (at least <code>8</code> CPUs and <code>8Gi</code> memory; see <a href=https://docs.docker.com/desktop/mac/#resources>here</a> how to configure the resources for Docker for Mac).<blockquote><p>Additionally, please configure at least <code>120Gi</code> of disk size for the Docker daemon.</p></blockquote></li></ul><blockquote class="alert alert-tip"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>lightbulb-on-outline</title><path d="M20 11h3v2H20V11M1 11H4v2H1V11M13 1V4H11V1h2M4.92 3.5 7.05 5.64 5.63 7.05 3.5 4.93 4.92 3.5M16.95 5.63 19.07 3.5 20.5 4.93 18.37 7.05 16.95 5.63M12 6a6 6 0 016 6c0 2.22-1.21 4.16-3 5.2V19a1 1 0 01-1 1H10A1 1 0 019 19V17.2C7.21 16.16 6 14.22 6 12a6 6 0 016-6m2 15v1a1 1 0 01-1 1H11a1 1 0 01-1-1V21h4m-3-3h2V15.87c1.73-.44 3-2.01 3-3.87A4 4 0 0012 8 4 4 0 008 12c0 1.86 1.27 3.43 3 3.87V18z"/></svg><p>Tip</p></div><p>You can clean up unused data with <code>docker system df</code> and <code>docker system prune -a</code>.</p></blockquote><h2 id=setting-up-the-kind-cluster>Setting Up the KinD Cluster<a class=td-heading-self-link href=#setting-up-the-kind-cluster aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make kind-up
</span></span></code></pre></div><p>Please see <a href=/docs/gardener/deployment/getting_started_locally/#setting-up-the-kind-cluster-garden-and-seed>this documentation section</a> for more details.</p><p>All following steps assume that you are using the kubeconfig for this KinD cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>export KUBECONFIG=$PWD/example/gardener-local/kind/local/kubeconfig
</span></span></code></pre></div><h2 id=high-touch-scenario>High-Touch Scenario<a class=td-heading-self-link href=#high-touch-scenario aria-label="Heading self-link"></a></h2><p>Use the following command to prepare the <code>gardenadm</code> high-touch scenario:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make gardenadm-high-touch-up
</span></span></code></pre></div><p>This will first build the needed images, deploy 2 machine pods using the <a href=https://github.com/gardener/gardener/tree/master/pkg/provider-local/node><code>gardener-extension-provider-local-node</code> image</a>, install the <code>gardenadm</code> binary on both of them, and copy the needed manifests to the <code>/gardenadm/resources</code> directory.</p><p>Afterward, you can use <code>kubectl exec</code> to execute <code>gardenadm</code> commands on the machines.</p><p>Let&rsquo;s start with exec&rsquo;ing into the <code>machine-0</code> pod:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n gardenadm-high-touch exec -it machine-0 -- bash
</span></span><span style=display:flex><span>root@machine-0:/# gardenadm -h
</span></span><span style=display:flex><span>gardenadm bootstraps and manages autonomous shoot clusters in the Gardener project.
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>root@machine-0:/# cat /gardenadm/resources/manifests.yaml
</span></span><span style=display:flex><span>apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>kind: CloudProfile
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: local
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h3 id=bootstrapping-a-single-node-control-plane>Bootstrapping a Single-Node Control Plane<a class=td-heading-self-link href=#bootstrapping-a-single-node-control-plane aria-label="Heading self-link"></a></h3><p>Use <code>gardenadm init</code> to bootstrap the first control plane node using the provided manifests:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@machine-0:/# gardenadm init -d /gardenadm/resources
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Your Shoot cluster control-plane has initialized successfully!
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h3 id=connecting-to-the-autonomous-shoot-cluster>Connecting to the Autonomous Shoot Cluster<a class=td-heading-self-link href=#connecting-to-the-autonomous-shoot-cluster aria-label="Heading self-link"></a></h3><p>The machine pod&rsquo;s shell environment is configured for easily connecting to the autonomous shoot cluster.
Just execute <code>kubectl</code> within a <code>bash</code> shell in the machine pod:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n gardenadm-high-touch exec -it machine-0 -- bash
</span></span><span style=display:flex><span>root@machine-0:/# kubectl get node
</span></span><span style=display:flex><span>NAME        STATUS   ROLES    AGE     VERSION
</span></span><span style=display:flex><span>machine-0   Ready    &lt;none&gt;   4m11s   v1.32.0
</span></span></code></pre></div><p>You can also copy the kubeconfig to your local machine and use a port-forward to connect to the cluster&rsquo;s API server:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n gardenadm-high-touch exec -it machine-0 -- cat /etc/kubernetes/admin.conf | sed <span style=color:#a31515>&#39;s/api.root.garden.internal.gardenadm.local/localhost:6443/&#39;</span> &gt; /tmp/shoot--garden--root.conf
</span></span><span style=display:flex><span>$ kubectl -n gardenadm-high-touch port-forward pod/machine-0 6443:443
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># in a new terminal</span>
</span></span><span style=display:flex><span>$ export KUBECONFIG=/tmp/shoot--garden--root.conf
</span></span><span style=display:flex><span>$ kubectl get no
</span></span><span style=display:flex><span>NAME        STATUS   ROLES    AGE   VERSION
</span></span><span style=display:flex><span>machine-0   Ready    &lt;none&gt;   10m   v1.32.0
</span></span></code></pre></div><h3 id=joining-a-worker-node>Joining a Worker Node<a class=td-heading-self-link href=#joining-a-worker-node aria-label="Heading self-link"></a></h3><p>If you would like to join a worker node to the cluster, generate a bootstrap token and the corresponding <code>gardenadm join</code> command on <code>machine-0</code> (the control plane node).
Then exec into the <code>machine-1</code> pod to run the command:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@machine-0:/# gardenadm token create --print-join-command
</span></span><span style=display:flex><span><span style=color:green># now copy the output, terminate the exec session and start a new one for machine-1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl -n gardenadm-high-touch exec -it machine-1 -- bash
</span></span><span style=display:flex><span><span style=color:green># paste the copied &#39;gardenadm join&#39; command here and execute it</span>
</span></span><span style=display:flex><span>root@machine-1:/# gardenadm join ...
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Your node has successfully been instructed to join the cluster as a worker!
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Using the kubeconfig as described in <a href=/docs/gardener/deployment/getting_started_locally_with_gardenadm/#connecting-to-the-autonomous-shoot-cluster>this section</a>, you should now be able to see the new node in the cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get no
</span></span><span style=display:flex><span>NAME        STATUS   ROLES    AGE   VERSION
</span></span><span style=display:flex><span>machine-0   Ready    &lt;none&gt;   10m   v1.32.0
</span></span><span style=display:flex><span>machine-1   Ready    &lt;none&gt;   37s   v1.32.0
</span></span></code></pre></div><h2 id=medium-touch-scenario>Medium-Touch Scenario<a class=td-heading-self-link href=#medium-touch-scenario aria-label="Heading self-link"></a></h2><p>Use the following command to prepare the <code>gardenadm</code> medium-touch scenario:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make gardenadm-medium-touch-up
</span></span></code></pre></div><p>This will first build the needed images and then render the needed manifests for <code>gardenadm bootstrap</code> to the <a href=https://github.com/gardener/gardener/tree/master/example/gardenadm-local/resources/medium-touch><code>./example/gardenadm-local/resources/medium-touch</code></a> directory.</p><p>Afterward, you can use <code>go run</code> to execute <code>gardenadm</code> commands on your machine:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ export IMAGEVECTOR_OVERWRITE=$PWD/example/gardenadm-local/.imagevector-overwrite.yaml
</span></span><span style=display:flex><span>$ go run ./cmd/gardenadm bootstrap -d ./example/gardenadm-local/resources/medium-touch
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Command is work in progress
</span></span></code></pre></div><h2 id=running-e2e-tests-for-gardenadm>Running E2E Tests for <code>gardenadm</code><a class=td-heading-self-link href=#running-e2e-tests-for-gardenadm aria-label="Heading self-link"></a></h2><p>Based on the described setup, you can execute the e2e test suite for <code>gardenadm</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make gardenadm-high-touch-up gardenadm-medium-touch-up
</span></span><span style=display:flex><span>make test-e2e-local-gardenadm
</span></span></code></pre></div><p>You can also selectively run the e2e tests for one of the scenarios:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make gardenadm-high-touch-up
</span></span><span style=display:flex><span>./hack/test-e2e-local.sh gardenadm --label-filter=<span style=color:#a31515>&#34;high-touch&#34;</span> ./test/e2e/gardenadm/...
</span></span></code></pre></div><h2 id=tear-down-the-kind-cluster>Tear Down the KinD Cluster<a class=td-heading-self-link href=#tear-down-the-kind-cluster aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make kind-down
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-5a53ffb401b7a9ba7d6243e70af0be09>11 - Image Vector</h1><h1 id=image-vector>Image Vector<a class=td-heading-self-link href=#image-vector aria-label="Heading self-link"></a></h1><p>The Gardener components are deploying several different container images into the garden, seed, and the shoot clusters.
The image repositories and tags are defined in a <a href=https://github.com/gardener/gardener/blob/master/imagevector/containers.yaml>central image vector file</a>.
Obviously, the image versions defined there must fit together with the deployment manifests (e.g., some command-line flags do only exist in certain versions).</p><h2 id=example>Example<a class=td-heading-self-link href=#example aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>images:
</span></span><span style=display:flex><span>- name: pause-container
</span></span><span style=display:flex><span>  sourceRepository: github.com/kubernetes/kubernetes/blob/master/build/pause/Dockerfile
</span></span><span style=display:flex><span>  repository: registry.k8s.io/pause
</span></span><span style=display:flex><span>  tag: <span style=color:#a31515>&#34;3.4&#34;</span>
</span></span><span style=display:flex><span>  targetVersion: <span style=color:#a31515>&#34;1.20.x&#34;</span>
</span></span><span style=display:flex><span>  architectures:
</span></span><span style=display:flex><span>  - amd64
</span></span><span style=display:flex><span>  - arm64
</span></span><span style=display:flex><span>- name: pause-container
</span></span><span style=display:flex><span>  sourceRepository: github.com/kubernetes/kubernetes/blob/master/build/pause/Dockerfile
</span></span><span style=display:flex><span>  ref: registry.k8s.io/pause:3.5
</span></span><span style=display:flex><span>  targetVersion: <span style=color:#a31515>&#34;&gt;= 1.21&#34;</span>
</span></span><span style=display:flex><span>  architectures:
</span></span><span style=display:flex><span>  - amd64
</span></span><span style=display:flex><span>  - arm64
</span></span></code></pre></div><p>That means that Gardener will use the <code>pause-container</code> with tag <code>3.4</code> for all clusters with Kubernetes version <code>1.20.x</code>, and the image with ref <code>registry.k8s.io/pause:3.5</code> for all clusters with Kubernetes <code>>= 1.21</code>.</p><blockquote class="alert alert-note"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>information-outline</title><path d="M11 9h2V7H11m1 13c-4.41.0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2M11 17h2V11H11v6z"/></svg><p>Note</p></div><p>As you can see, it is possible to provide the full image reference via the <code>ref</code> field.
Another option is to use the <code>repository</code> and <code>tag</code> fields. <code>tag</code> may also be a digest only (starting with <code>sha256:...</code>), or it can contain both tag and digest (<code>v1.2.3@sha256:...</code>).</p></blockquote><h2 id=architectures>Architectures<a class=td-heading-self-link href=#architectures aria-label="Heading self-link"></a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>images:
</span></span><span style=display:flex><span>- name: pause-container
</span></span><span style=display:flex><span>  sourceRepository: github.com/kubernetes/kubernetes/blob/master/build/pause/Dockerfile
</span></span><span style=display:flex><span>  repository: registry.k8s.io/pause
</span></span><span style=display:flex><span>  tag: <span style=color:#a31515>&#34;3.5&#34;</span>
</span></span><span style=display:flex><span>  architectures:
</span></span><span style=display:flex><span>  - amd64
</span></span><span style=display:flex><span>- name: pause-container
</span></span><span style=display:flex><span>  sourceRepository: github.com/kubernetes/kubernetes/blob/master/build/pause/Dockerfile
</span></span><span style=display:flex><span>  ref: registry.k8s.io/pause:3.5
</span></span><span style=display:flex><span>  architectures:
</span></span><span style=display:flex><span>  - arm64
</span></span><span style=display:flex><span>- name: pause-container
</span></span><span style=display:flex><span>  sourceRepository: github.com/kubernetes/kubernetes/blob/master/build/pause/Dockerfile
</span></span><span style=display:flex><span>  ref: registry.k8s.io/pause:3.5
</span></span><span style=display:flex><span>  architectures:
</span></span><span style=display:flex><span>  - amd64
</span></span><span style=display:flex><span>  - arm64
</span></span></code></pre></div><p><code>architectures</code> is an optional field of image. It is a list of strings specifying CPU architecture of machines on which this image can be used. The valid options for the architectures field are as follows:</p><ul><li><code>amd64</code> : This specifies that the image can run only on machines having CPU architecture <code>amd64</code>.</li><li><code>arm64</code> : This specifies that the image can run only on machines having CPU architecture <code>arm64</code>.</li></ul><p>If an image doesn&rsquo;t specify any architectures, then by default it is considered to support both <code>amd64</code> and <code>arm64</code> architectures.</p><h2 id=overwriting-image-vector>Overwriting Image Vector<a class=td-heading-self-link href=#overwriting-image-vector aria-label="Heading self-link"></a></h2><p>In some environments it is not possible to use these &ldquo;pre-defined&rdquo; images that come with a Gardener release.
A prominent example for that is Alicloud in China, which does not allow access to Google&rsquo;s GCR.
In these cases, you might want to overwrite certain images, e.g., point the <code>pause-container</code> to a different registry.</p><p>&#9888;&#xfe0f; If you specify an image that does not fit to the resource manifest, then the reconciliations might fail.</p><p>In order to overwrite the images, you must provide a similar file to the Gardener component:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>images:
</span></span><span style=display:flex><span>- name: pause-container
</span></span><span style=display:flex><span>  sourceRepository: github.com/kubernetes/kubernetes/blob/master/build/pause/Dockerfile
</span></span><span style=display:flex><span>  repository: my-custom-image-registry/pause
</span></span><span style=display:flex><span>  tag: <span style=color:#a31515>&#34;3.4&#34;</span>
</span></span><span style=display:flex><span>  version: <span style=color:#a31515>&#34;1.20.x&#34;</span>
</span></span><span style=display:flex><span>- name: pause-container
</span></span><span style=display:flex><span>  sourceRepository: github.com/kubernetes/kubernetes/blob/master/build/pause/Dockerfile
</span></span><span style=display:flex><span>  ref: my-custom-image-registry/pause:3.5
</span></span><span style=display:flex><span>  version: <span style=color:#a31515>&#34;&gt;= 1.21&#34;</span>
</span></span></code></pre></div><blockquote class="alert alert-important"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>message-outline</title><path d="M20 2H4C2.9 2 2 2.9 2 4V22l4-4H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2m0 14H5.2L4 17.2V4H20V16z"/></svg><p>Important</p></div><p>When the overwriting file contains <code>ref</code> for an image but the source file doesn&rsquo;t, then this invalidates both <code>repository</code> and <code>tag</code> of the source.
When it contains <code>repository</code> for an image but the source file uses <code>ref</code>, then this invalidates <code>ref</code> of the source.</p></blockquote><p>For <code>gardenlet</code>, you can create a <code>ConfigMap</code> containing the above content and mount it as a volume into the <code>gardenlet</code> pod.
Next, specify the environment variable <code>IMAGEVECTOR_OVERWRITE</code>, whose value must be the path to the file you just mounted.
The approach works similarly for <code>gardener-operator</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: ConfigMap
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: gardenlet-images-overwrite
</span></span><span style=display:flex><span>  namespace: garden
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  images_overwrite.yaml: |<span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515>    images:
</span></span></span><span style=display:flex><span><span style=color:#a31515>    - ...</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>apiVersion: apps/v1
</span></span><span style=display:flex><span>kind: Deployment
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: gardenlet
</span></span><span style=display:flex><span>  namespace: garden
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  template:
</span></span><span style=display:flex><span>    spec:
</span></span><span style=display:flex><span>      containers:
</span></span><span style=display:flex><span>      - name: gardenlet
</span></span><span style=display:flex><span>        env:
</span></span><span style=display:flex><span>        - name: IMAGEVECTOR_OVERWRITE
</span></span><span style=display:flex><span>          value: /imagevector-overwrite/images_overwrite.yaml
</span></span><span style=display:flex><span>        volumeMounts:
</span></span><span style=display:flex><span>        - name: gardenlet-images-overwrite
</span></span><span style=display:flex><span>          mountPath: /imagevector-overwrite
</span></span><span style=display:flex><span>      volumes:
</span></span><span style=display:flex><span>      - name: gardenlet-images-overwrite
</span></span><span style=display:flex><span>        configMap:
</span></span><span style=display:flex><span>          name: gardenlet-images-overwrite
</span></span></code></pre></div><h2 id=image-vectors-for-dependent-components>Image Vectors for Dependent Components<a class=td-heading-self-link href=#image-vectors-for-dependent-components aria-label="Heading self-link"></a></h2><p>Gardener is deploying a lot of different components that might deploy other images themselves.
These components might use an image vector as well.
Operators might want to customize the image locations for these transitive images as well, hence, they might need to specify an image vector overwrite for the components directly deployed by Gardener.</p><p>It is possible to specify the <code>IMAGEVECTOR_OVERWRITE_COMPONENTS</code> environment variable to Gardener that points to a file with the following content:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>components:
</span></span><span style=display:flex><span>- name: etcd-druid
</span></span><span style=display:flex><span>  imageVectorOverwrite: |<span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515>    images:
</span></span></span><span style=display:flex><span><span style=color:#a31515>    - name: etcd
</span></span></span><span style=display:flex><span><span style=color:#a31515>      tag: v1.2.3
</span></span></span><span style=display:flex><span><span style=color:#a31515>      repository: etcd/etcd</span>
</span></span></code></pre></div><p>Gardener will, if supported by the directly deployed component (<code>etcd-druid</code> in this example), inject the given <code>imageVectorOverwrite</code> into the <code>Deployment</code> manifest.
The respective component is responsible for using the overwritten images instead of its defaults.</p><h2 id=helm-chart-image-vector>Helm Chart Image Vector<a class=td-heading-self-link href=#helm-chart-image-vector aria-label="Heading self-link"></a></h2><p>Some Gardener components might also deploy <a href=https://helm.sh/docs/helm/helm_package/>packaged Helm charts</a> which are pulled from an OCI repository.
The concepts are the very same as for the container images.
The only difference is that the environment variable for overwriting this chart image vector is called <code>IMAGEVECTOR_OVERWRITE_CHARTS</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-d48433bb7b23a8ada3fb3a2f6c8674f1>12 - Migration V0 To V1</h1><h1 id=migration-from-gardener-v0-to-v1>Migration from Gardener <code>v0</code> to <code>v1</code><a class=td-heading-self-link href=#migration-from-gardener-v0-to-v1 aria-label="Heading self-link"></a></h1><p>Please refer to the <a href=https://github.com/gardener/gardener/blob/v1.10.1/docs/deployment/migration_v0_to_v1.md>document for older Gardener versions</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9cfd104830b4bc8eafa2e90c3d9ff542>13 - Scoped API Access for gardenlets and Extensions</h1><h1 id=scoped-api-access-for-gardenlets-and-extensions>Scoped API Access for gardenlets and Extensions<a class=td-heading-self-link href=#scoped-api-access-for-gardenlets-and-extensions aria-label="Heading self-link"></a></h1><p>By default, <code>gardenlet</code>s have administrative access in the garden cluster.
They are able to execute any API request on any object independent of whether the object is related to the seed cluster the <code>gardenlet</code> is responsible for.
As RBAC is not powerful enough for fine-grained checks and for the sake of security, Gardener provides two optional but recommended configurations for your environments that scope the API access for <code>gardenlet</code>s.</p><p>Similar to the <a href=https://kubernetes.io/docs/reference/access-authn-authz/node/><code>Node</code> authorization mode in Kubernetes</a>, Gardener features a <code>SeedAuthorizer</code> plugin.
It is a special-purpose authorization plugin that specifically authorizes API requests made by the <code>gardenlet</code>s.</p><p>Likewise, similar to the <a href=https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#noderestriction><code>NodeRestriction</code> admission plugin in Kubernetes</a>, Gardener features a <code>SeedRestriction</code> plugin.
It is a special-purpose admission plugin that specifically limits the Kubernetes objects <code>gardenlet</code>s can modify.</p><p>📚 You might be interested to look into the <a href=https://github.com/kubernetes/design-proposals-archive/blob/main/node/kubelet-authorizer.md>design proposal for scoped Kubelet API access</a> from the Kubernetes community.
It can be translated to Gardener and Gardenlets with their <code>Seed</code> and <code>Shoot</code> resources.</p><p>Historically, <code>gardenlet</code> has been the only component running in the seed cluster that has access to both the seed cluster and the garden cluster.
Starting from Gardener <a href=https://github.com/gardener/gardener/releases/v1.74.0><code>v1.74.0</code></a>, extensions running on seed clusters can also get <a href=/docs/gardener/extensions/garden-api-access/>access to the garden cluster</a> using a token for a dedicated ServiceAccount.
Extensions using this mechanism only get permission to read global resources like <code>CloudProfiles</code> (this is granted to all authenticated users) unless the plugins described in this document are enabled.</p><p>Generally, the plugins handle extension clients exactly like gardenlet clients with some minor <a href=/docs/gardener/deployment/gardenlet_api_access/#rule-exceptions-for-extension-clients>exceptions</a>.
Extension clients in the sense of the plugins are clients authenticated as a <code>ServiceAccount</code> with the <code>extension-</code> name prefix in a <code>seed-</code> namespace of the garden cluster.
Other <code>ServiceAccounts</code> are not considered as seed clients, not handled by the plugins, and only get the described read access to global resources.</p><h2 id=flow-diagram>Flow Diagram<a class=td-heading-self-link href=#flow-diagram aria-label="Heading self-link"></a></h2><p>The following diagram shows how the two plugins are included in the request flow of a <code>gardenlet</code>.
When they are not enabled, then the <code>kube-apiserver</code> is internally authorizing the request via RBAC before forwarding the request directly to the <code>gardener-apiserver</code>, i.e., the <code>gardener-admission-controller</code> would not be consulted (this is not entirely correct because it also serves other admission webhook handlers, but for simplicity reasons this document focuses on the API access scope only).</p><p>When enabling the plugins, there is one additional step for each before the <code>gardener-apiserver</code> responds to the request.</p><p><img src=/docs/gardener/deployment/content/gardenlet_api_access_flow.png alt="Flow Diagram"></p><p>Please note that the example shows a request to an object (<code>Shoot</code>) residing in one of the API groups served by <code>gardener-apiserver</code>.
However, the <code>gardenlet</code> is also interacting with objects in API groups served by the <code>kube-apiserver</code> (e.g., <code>Secret</code>,<code>ConfigMap</code>).
In this case, the consultation of the <code>SeedRestriction</code> admission plugin is performed by the <code>kube-apiserver</code> itself before it forwards the request to the <code>gardener-apiserver</code>.</p><h2 id=implemented-rules>Implemented Rules<a class=td-heading-self-link href=#implemented-rules aria-label="Heading self-link"></a></h2><p>Today, the following rules are implemented:</p><table><thead><tr><th>Resource</th><th>Verbs</th><th>Path(s)</th><th>Description</th></tr></thead><tbody><tr><td><code>BackupBucket</code></td><td><code>get</code>, <code>list</code>, <code>watch</code>, <code>create</code>, <code>update</code>, <code>patch</code>, <code>delete</code></td><td><code>BackupBucket</code> -> <code>Seed</code></td><td>Allow <code>get</code>, <code>list</code>, <code>watch</code> requests for all <code>BackupBucket</code>s. Allow only <code>create</code>, <code>update</code>, <code>patch</code>, <code>delete</code> requests for <code>BackupBucket</code>s assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>BackupEntry</code></td><td><code>get</code>, <code>list</code>, <code>watch</code>, <code>create</code>, <code>update</code>, <code>patch</code></td><td><code>BackupEntry</code> -> <code>Seed</code></td><td>Allow <code>get</code>, <code>list</code>, <code>watch</code> requests for all <code>BackupEntry</code>s. Allow only <code>create</code>, <code>update</code>, <code>patch</code> requests for <code>BackupEntry</code>s assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code> and referencing <code>BackupBucket</code>s assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>Bastion</code></td><td><code>get</code>, <code>list</code>, <code>watch</code>, <code>create</code>, <code>update</code>, <code>patch</code></td><td><code>Bastion</code> -> <code>Seed</code></td><td>Allow <code>get</code>, <code>list</code>, <code>watch</code> requests for all <code>Bastion</code>s. Allow only <code>create</code>, <code>update</code>, <code>patch</code> requests for <code>Bastion</code>s assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>CertificateSigningRequest</code></td><td><code>get</code>, <code>create</code></td><td><code>CertificateSigningRequest</code> -> <code>Seed</code></td><td>Allow only <code>get</code>, <code>create</code> requests for <code>CertificateSigningRequest</code>s related to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>CloudProfile</code></td><td><code>get</code></td><td><code>CloudProfile</code> -> <code>Shoot</code> -> <code>Seed</code></td><td>Allow only <code>get</code> requests for <code>CloudProfile</code>s referenced by <code>Shoot</code>s that are assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>ClusterRoleBinding</code></td><td><code>create</code>, <code>get</code>, <code>update</code>, <code>patch</code>, <code>delete</code></td><td><code>ClusterRoleBinding</code> -> <code>ManagedSeed</code> -> <code>Shoot</code> -> <code>Seed</code></td><td>Allow <code>create</code>, <code>get</code>, <code>update</code>, <code>patch</code> requests for <code>ManagedSeed</code>s in the bootstrapping phase assigned to the gardenlet&rsquo;s <code>Seed</code>s. Allow <code>delete</code> requests from gardenlets bootstrapped via <code>ManagedSeed</code>s.</td></tr><tr><td><code>ConfigMap</code></td><td><code>get</code></td><td><code>ConfigMap</code> -> <code>Seed</code>, <code>ConfigMap</code> -> <code>Shoot</code> -> <code>Seed</code></td><td>Allow only <code>get</code> requests for <code>ConfigMap</code>s referenced by <code>Seed</code>s, or <code>Shoot</code>s that are assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>. Allow reading the <code>kube-system/cluster-identity</code> <code>ConfigMap</code>.</td></tr><tr><td><code>ControllerRegistration</code></td><td><code>get</code>, <code>list</code>, <code>watch</code></td><td><code>ControllerRegistration</code> -> <code>ControllerInstallation</code> -> <code>Seed</code></td><td>Allow <code>get</code>, <code>list</code>, <code>watch</code> requests for all <code>ControllerRegistration</code>s.</td></tr><tr><td><code>ControllerDeployment</code></td><td><code>get</code></td><td><code>ControllerDeployment</code> -> <code>ControllerInstallation</code> -> <code>Seed</code></td><td>Allow <code>get</code> requests for <code>ControllerDeployments</code>s referenced by <code>ControllerInstallation</code>s assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>ControllerInstallation</code></td><td><code>get</code>, <code>list</code>, <code>watch</code>, <code>update</code>, <code>patch</code></td><td><code>ControllerInstallation</code> -> <code>Seed</code></td><td>Allow <code>get</code>, <code>list</code>, <code>watch</code> requests for all <code>ControllerInstallation</code>s. Allow only <code>update</code>, <code>patch</code> requests for <code>ControllerInstallation</code>s assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>CredentialsBinding</code></td><td><code>get</code></td><td><code>CredentialsBinding</code> -> <code>Shoot</code> -> <code>Seed</code></td><td>Allow only <code>get</code> requests for <code>CredentialsBinding</code>s referenced by <code>Shoot</code>s that are assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>Event</code></td><td><code>create</code>, <code>patch</code></td><td>none</td><td>Allow to <code>create</code> or <code>patch</code> all kinds of <code>Event</code>s.</td></tr><tr><td><code>ExposureClass</code></td><td><code>get</code></td><td><code>ExposureClass</code> -> <code>Shoot</code> -> <code>Seed</code></td><td>Allow <code>get</code> requests for <code>ExposureClass</code>es referenced by <code>Shoot</code>s that are assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>. Deny <code>get</code> requests to other <code>ExposureClass</code>es.</td></tr><tr><td><code>Gardenlet</code></td><td><code>get</code>, <code>list</code>, <code>watch</code>, <code>update</code>, <code>patch</code>, <code>create</code></td><td><code>Gardenlet</code> -> <code>Seed</code></td><td>Allow <code>get</code>, <code>list</code>, <code>watch</code> requests for all <code>Gardenlet</code>s. Allow only <code>create</code>, <code>update</code>, and <code>patch</code> requests for <code>Gardenlet</code>s belonging to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>Lease</code></td><td><code>create</code>, <code>get</code>, <code>watch</code>, <code>update</code></td><td><code>Lease</code> -> <code>Seed</code></td><td>Allow <code>create</code>, <code>get</code>, <code>update</code>, and <code>delete</code> requests for <code>Lease</code>s of the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>ManagedSeed</code></td><td><code>get</code>, <code>list</code>, <code>watch</code>, <code>update</code>, <code>patch</code></td><td><code>ManagedSeed</code> -> <code>Shoot</code> -> <code>Seed</code></td><td>Allow <code>get</code>, <code>list</code>, <code>watch</code> requests for all <code>ManagedSeed</code>s. Allow only <code>update</code>, <code>patch</code> requests for <code>ManagedSeed</code>s referencing a <code>Shoot</code> assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>Namespace</code></td><td><code>get</code></td><td><code>Namespace</code> -> <code>Shoot</code> -> <code>Seed</code></td><td>Allow <code>get</code> requests for <code>Namespace</code>s of <code>Shoot</code>s that are assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>. Always allow <code>get</code> requests for the <code>garden</code> <code>Namespace</code>.</td></tr><tr><td><code>NamespacedCloudProfile</code></td><td><code>get</code></td><td><code>NamespacedCloudProfile</code> -> <code>Shoot</code> -> <code>Seed</code></td><td>Allow only <code>get</code> requests for <code>NamespacedCloudProfile</code>s referenced by <code>Shoot</code>s that are assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>Project</code></td><td><code>get</code></td><td><code>Project</code> -> <code>Namespace</code> -> <code>Shoot</code> -> <code>Seed</code></td><td>Allow <code>get</code> requests for <code>Project</code>s referenced by the <code>Namespace</code> of <code>Shoot</code>s that are assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>SecretBinding</code></td><td><code>get</code></td><td><code>SecretBinding</code> -> <code>Shoot</code> -> <code>Seed</code></td><td>Allow only <code>get</code> requests for <code>SecretBinding</code>s referenced by <code>Shoot</code>s that are assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>Secret</code></td><td><code>create</code>, <code>get</code>, <code>update</code>, <code>patch</code>, <code>delete</code>(, <code>list</code>, <code>watch</code>)</td><td><code>Secret</code> -> <code>Seed</code>, <code>Secret</code> -> <code>Shoot</code> -> <code>Seed</code>, <code>Secret</code> -> <code>SecretBinding</code> -> <code>Shoot</code> -> <code>Seed</code>, <code>Secret</code> -> <code>CredentialsBinding</code> -> <code>Shoot</code> -> <code>Seed</code>, <code>BackupBucket</code> -> <code>Seed</code></td><td>Allow <code>get</code>, <code>list</code>, <code>watch</code> requests for all <code>Secret</code>s in the <code>seed-&lt;name></code> namespace. Allow only <code>create</code>, <code>get</code>, <code>update</code>, <code>patch</code>, <code>delete</code> requests for the <code>Secret</code>s related to resources assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>s.</td></tr><tr><td><code>Seed</code></td><td><code>get</code>, <code>list</code>, <code>watch</code>, <code>create</code>, <code>update</code>, <code>patch</code>, <code>delete</code></td><td><code>Seed</code></td><td>Allow <code>get</code>, <code>list</code>, <code>watch</code> requests for all <code>Seed</code>s. Allow only <code>create</code>, <code>update</code>, <code>patch</code>, <code>delete</code> requests for the <code>gardenlet</code>&rsquo;s <code>Seed</code>s. [1]</td></tr><tr><td><code>ServiceAccount</code></td><td><code>create</code>, <code>get</code>, <code>update</code>, <code>patch</code>, <code>delete</code></td><td><code>ServiceAccount</code> -> <code>ManagedSeed</code> -> <code>Shoot</code> -> <code>Seed</code>, <code>ServiceAccount</code> -> <code>Namespace</code> -> <code>Seed</code></td><td>Allow <code>create</code>, <code>get</code>, <code>update</code>, <code>patch</code> requests for <code>ManagedSeed</code>s in the bootstrapping phase assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>s. Allow <code>delete</code> requests from gardenlets bootstrapped via <code>ManagedSeed</code>s. Allow all verbs on <code>ServiceAccount</code>s in seed-specific namespace.</td></tr><tr><td><code>Shoot</code></td><td><code>get</code>, <code>list</code>, <code>watch</code>, <code>update</code>, <code>patch</code></td><td><code>Shoot</code> -> <code>Seed</code></td><td>Allow <code>get</code>, <code>list</code>, <code>watch</code> requests for all <code>Shoot</code>s. Allow only <code>update</code>, <code>patch</code> requests for <code>Shoot</code>s assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>ShootState</code></td><td><code>get</code>, <code>create</code>, <code>update</code>, <code>patch</code></td><td><code>ShootState</code> -> <code>Shoot</code> -> <code>Seed</code></td><td>Allow only <code>get</code>, <code>create</code>, <code>update</code>, <code>patch</code> requests for <code>ShootState</code>s belonging by <code>Shoot</code>s that are assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr><tr><td><code>WorkloadIdentity</code></td><td><code>get</code></td><td><code>WorkloadIdentity</code> -> <code>CredentialsBinding</code> -> <code>Shoot</code> -> <code>Seed</code></td><td>Allow only <code>get</code> requests for <code>WorkloadIdentities</code> referenced by <code>CredentialsBinding</code>s referenced by <code>Shoot</code>s that are assigned to the <code>gardenlet</code>&rsquo;s <code>Seed</code>.</td></tr></tbody></table><blockquote><p>[1] If you use <code>ManagedSeed</code> resources then the <code>gardenlet</code> reconciling them (&ldquo;parent <code>gardenlet</code>&rdquo;) may be allowed to submit certain requests for the <code>Seed</code> resources resulting out of such <code>ManagedSeed</code> reconciliations (even if the &ldquo;parent <code>gardenlet</code>&rdquo; is not responsible for them):</p></blockquote><p>ℹ️ It is allowed to delete the <code>Seed</code> resources if the corresponding <code>ManagedSeed</code> objects already have a <code>deletionTimestamp</code> (this is secure as <code>gardenlet</code>s themselves don&rsquo;t have permissions for deleting <code>ManagedSeed</code>s).</p><h3 id=rule-exceptions-for-extension-clients>Rule Exceptions for Extension Clients<a class=td-heading-self-link href=#rule-exceptions-for-extension-clients aria-label="Heading self-link"></a></h3><p>Extension clients are allowed to perform the same operations as gardenlet clients with the following exceptions:</p><ul><li>Extension clients are granted the read-only subset of verbs for <code>CertificateSigningRequests</code>, <code>ClusterRoleBindings</code>, and <code>ServiceAccounts</code> (to prevent privilege escalation).</li><li>Extension clients are granted full access to <code>Lease</code> objects but only in the seed-specific namespace.</li></ul><p>When the need arises, more exceptions might be added to the access rules for resources that are already handled by the plugins.
E.g., if an extension needs to populate additional shoot-specific <code>InternalSecrets</code>, according handling can be introduced.
Permissions for resources that are not handled by the plugins can be granted using additional RBAC rules (independent of the plugins).</p><h2 id=seedauthorizer-authorization-webhook-enablement><code>SeedAuthorizer</code> Authorization Webhook Enablement<a class=td-heading-self-link href=#seedauthorizer-authorization-webhook-enablement aria-label="Heading self-link"></a></h2><p>The <code>SeedAuthorizer</code> is implemented as a <a href=https://kubernetes.io/docs/reference/access-authn-authz/webhook/>Kubernetes authorization webhook</a> and part of the <a href=/docs/gardener/concepts/admission-controller/><code>gardener-admission-controller</code></a> component running in the garden cluster.</p><p>🎛 In order to activate it, you have to follow these steps:</p><ol><li><p>Set the following flags for the <code>kube-apiserver</code> of the garden cluster (i.e., the <code>kube-apiserver</code> whose API is extended by Gardener):</p><ul><li><code>--authorization-mode=RBAC,Node,Webhook</code> (please note that <code>Webhook</code> should appear after <code>RBAC</code> in the list [1]; <code>Node</code> might not be needed if you use a virtual garden cluster)</li><li><code>--authorization-webhook-config-file=&lt;path-to-the-webhook-config-file></code></li><li><code>--authorization-webhook-cache-authorized-ttl=0</code></li><li><code>--authorization-webhook-cache-unauthorized-ttl=0</code></li></ul></li><li><p>The webhook config file (stored at <code>&lt;path-to-the-webhook-config-file></code>) should look as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Config
</span></span><span style=display:flex><span>clusters:
</span></span><span style=display:flex><span>- name: garden
</span></span><span style=display:flex><span>  cluster:
</span></span><span style=display:flex><span>    certificate-authority-data: base64(CA-CERT-OF-GARDENER-ADMISSION-CONTROLLER)
</span></span><span style=display:flex><span>    server: https://gardener-admission-controller.garden/webhooks/auth/seed
</span></span><span style=display:flex><span>users:
</span></span><span style=display:flex><span>- name: kube-apiserver
</span></span><span style=display:flex><span>  user: {}
</span></span><span style=display:flex><span>contexts:
</span></span><span style=display:flex><span>- name: auth-webhook
</span></span><span style=display:flex><span>  context:
</span></span><span style=display:flex><span>    cluster: garden
</span></span><span style=display:flex><span>    user: kube-apiserver
</span></span><span style=display:flex><span>current-context: auth-webhook
</span></span></code></pre></div></li><li><p>When deploying the <a href=https://github.com/gardener/gardener/tree/master/charts/gardener/controlplane>Gardener <code>controlplane</code> Helm chart</a>, set <code>.global.rbac.seedAuthorizer.enabled=true</code>. This will ensure that the RBAC resources granting global access for all <code>gardenlet</code>s will be deployed.</p></li><li><p>Delete the existing RBAC resources granting global access for all <code>gardenlet</code>s by running:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>  clusterrole.rbac.authorization.k8s.io/gardener.cloud:system:seeds <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>  clusterrolebinding.rbac.authorization.k8s.io/gardener.cloud:system:seeds <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>  --ignore-not-found
</span></span></code></pre></div></li></ol><p>Please note that you should activate the <a href=/docs/gardener/deployment/gardenlet_api_access/#seedrestriction-admission-webhook-enablement><code>SeedRestriction</code></a> admission handler as well.</p><blockquote><p>[1] The reason for the fact that <code>Webhook</code> authorization plugin should appear after <code>RBAC</code> is that the <code>kube-apiserver</code> will be depending on the <code>gardener-admission-controller</code> (serving the webhook). However, the <code>gardener-admission-controller</code> can only start when <code>gardener-apiserver</code> runs, but <code>gardener-apiserver</code> itself can only start when <code>kube-apiserver</code> runs. If <code>Webhook</code> is before <code>RBAC</code>, then <code>gardener-apiserver</code> might not be able to start, leading to a deadlock.</p></blockquote><h3 id=authorizer-decisions>Authorizer Decisions<a class=td-heading-self-link href=#authorizer-decisions aria-label="Heading self-link"></a></h3><p>As mentioned earlier, it&rsquo;s the authorizer&rsquo;s job to evaluate API requests and return one of the following decisions:</p><ul><li><code>DecisionAllow</code>: The request is allowed, further configured authorizers won&rsquo;t be consulted.</li><li><code>DecisionDeny</code>: The request is denied, further configured authorizers won&rsquo;t be consulted.</li><li><code>DecisionNoOpinion</code>: A decision cannot be made, further configured authorizers will be consulted.</li></ul><p>For backwards compatibility, no requests are denied at the moment, so that they are still deferred to a subsequent authorizer like RBAC.
Though, this might change in the future.</p><p>First, the <code>SeedAuthorizer</code> extracts the <code>Seed</code> name from the API request.
This step considers the following two cases:</p><ol><li>If the authenticated user belongs to the <code>gardener.cloud:system:seeds</code> group, it is considered a gardenlet client.<ul><li>This requires a proper TLS certificate that the <code>gardenlet</code> uses to contact the API server and is automatically given if <a href=/docs/gardener/concepts/gardenlet/#TLS-Bootstrapping>TLS bootstrapping</a> is used.</li><li>The authorizer extracts the seed name from the username by stripping the <code>gardener.cloud:system:seed:</code> prefix.</li><li>In cases where this information is missing e.g., when a custom Kubeconfig is used, the authorizer cannot make any decision. Thus, RBAC is still a considerable option to restrict the <code>gardenlet</code>&rsquo;s access permission if the above explained preconditions are not given.</li></ul></li><li>If the authenticated user belongs to the <code>system:serviceaccounts</code> group, it is considered an extension client under the following conditions:<ul><li>The <code>ServiceAccount</code> must be located in a <code>seed-</code> namespace. I.e., the user has to belong to a group with the <code>system:serviceaccounts:seed-</code> prefix. The seed name is extracted from this group by stripping the prefix.</li><li>The <code>ServiceAccount</code> must have the <code>extension-</code> prefix. I.e., the username must have the <code>system:serviceaccount:seed-&lt;seed-name>:extension-</code> prefix.</li></ul></li></ol><p>With the <code>Seed</code> name at hand, the authorizer checks for an <strong>existing path</strong> from the resource that a request is being made for to the <code>Seed</code> belonging to the <code>gardenlet</code>/extension.
Take a look at the <a href=/docs/gardener/deployment/gardenlet_api_access/#implementation-details>Implementation Details</a> section for more information.</p><h3 id=implementation-details>Implementation Details<a class=td-heading-self-link href=#implementation-details aria-label="Heading self-link"></a></h3><p>Internally, the <code>SeedAuthorizer</code> uses a directed, acyclic graph data structure in order to efficiently respond to authorization requests for <code>gardenlet</code>s/extensions:</p><ul><li>A vertex in this graph represents a Kubernetes resource with its kind, namespace, and name (e.g., <code>Shoot:garden-my-project/my-shoot</code>).</li><li>An edge from vertex <code>u</code> to vertex <code>v</code> in this graph exists when<ul><li>(1) <code>v</code> is referred by <code>u</code> and <code>v</code> is a <code>Seed</code>, or when</li><li>(2) <code>u</code> is referred by <code>v</code>, or when</li><li>(3) <code>u</code> is strictly associated with <code>v</code>.</li></ul></li></ul><p>For example, a <code>Shoot</code> refers to a <code>Seed</code>, a <code>CloudProfile</code>, a <code>SecretBinding</code>, etc., so it has an outgoing edge to the <code>Seed</code> (1) and incoming edges from the <code>CloudProfile</code> and <code>SecretBinding</code> vertices (2).
However, there might also be a <code>ShootState</code> or a <code>BackupEntry</code> resource strictly associated with this <code>Shoot</code>, hence, it has incoming edges from these vertices (3).</p><p><img src=/docs/gardener/deployment/content/gardenlet_api_access_graph.png alt="Resource Dependency Graph"></p><p>In the above picture, the resources that are actively watched are shaded.
Gardener resources are green, while Kubernetes resources are blue.
It shows the dependencies between the resources and how the graph is built based on the above rules.</p><p>ℹ️ The above picture shows all resources that may be accessed by <code>gardenlet</code>s/extensions, except for the <code>Quota</code> resource which is only included for completeness.</p><p>Now, when a <code>gardenlet</code>/extension wants to access certain resources, then the <code>SeedAuthorizer</code> uses a Depth-First traversal starting from the vertex representing the resource in question, e.g., from a <code>Project</code> vertex.
If there is a path from the <code>Project</code> vertex to the vertex representing the <code>Seed</code> the <code>gardenlet</code>/extension is responsible for. then it allows the request.</p><h4 id=metrics>Metrics<a class=td-heading-self-link href=#metrics aria-label="Heading self-link"></a></h4><p>The <code>SeedAuthorizer</code> registers the following metrics related to the mentioned graph implementation:</p><table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td><code>gardener_admission_controller_seed_authorizer_graph_update_duration_seconds</code></td><td>Histogram of duration of resource dependency graph updates in seed authorizer, i.e., how long does it take to update the graph&rsquo;s vertices/edges when a resource is created, changed, or deleted.</td></tr><tr><td><code>gardener_admission_controller_seed_authorizer_graph_path_check_duration_seconds</code></td><td>Histogram of duration of checks whether a path exists in the resource dependency graph in seed authorizer.</td></tr></tbody></table><h4 id=debug-handler>Debug Handler<a class=td-heading-self-link href=#debug-handler aria-label="Heading self-link"></a></h4><p>When the <code>.server.enableDebugHandlers</code> field in the <code>gardener-admission-controller</code>&rsquo;s component configuration is set to <code>true</code>, then it serves a handler that can be used for debugging the resource dependency graph under <code>/debug/resource-dependency-graph</code>.</p><p>🚨 Only use this setting for development purposes, as it enables unauthenticated users to view all data if they have access to the <code>gardener-admission-controller</code> component.</p><p>The handler renders an HTML page displaying the current graph with a list of vertices and its associated incoming and outgoing edges to other vertices.
Depending on the size of the Gardener landscape (and consequently, the size of the graph), it might not be possible to render it in its entirety.
If there are more than 2000 vertices, then the default filtering will selected for <code>kind=Seed</code> to prevent overloading the output.</p><p><em>Example output</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>-------------------------------------------------------------------------------
</span></span><span style=display:flex><span>|
</span></span><span style=display:flex><span>| # Seed:my-seed
</span></span><span style=display:flex><span>|   &lt;- (11)
</span></span><span style=display:flex><span>|     BackupBucket:73972fe2-3d7e-4f61-a406-b8f9e670e6b7
</span></span><span style=display:flex><span>|     BackupEntry:garden-my-project/shoot--dev--my-shoot--4656a460-1a69-4f00-9372-7452cbd38ee3
</span></span><span style=display:flex><span>|     ControllerInstallation:dns-external-mxt8m
</span></span><span style=display:flex><span>|     ControllerInstallation:extension-shoot-cert-service-4qw5j
</span></span><span style=display:flex><span>|     ControllerInstallation:networking-calico-bgrb2
</span></span><span style=display:flex><span>|     ControllerInstallation:os-gardenlinux-qvb5z
</span></span><span style=display:flex><span>|     ControllerInstallation:provider-gcp-w4mvf
</span></span><span style=display:flex><span>|     Secret:garden/backup
</span></span><span style=display:flex><span>|     Shoot:garden-my-project/my-shoot
</span></span><span style=display:flex><span>|
</span></span><span style=display:flex><span>-------------------------------------------------------------------------------
</span></span><span style=display:flex><span>|
</span></span><span style=display:flex><span>| # Shoot:garden-my-project/my-shoot
</span></span><span style=display:flex><span>|   &lt;- (5)
</span></span><span style=display:flex><span>|     CloudProfile:gcp
</span></span><span style=display:flex><span>|     Namespace:garden-my-project
</span></span><span style=display:flex><span>|     Secret:garden-my-project/my-dns-secret
</span></span><span style=display:flex><span>|     SecretBinding:garden-my-project/my-credentials
</span></span><span style=display:flex><span>|     ShootState:garden-my-project/my-shoot
</span></span><span style=display:flex><span>|   -&gt; (1)
</span></span><span style=display:flex><span>|     Seed:my-seed
</span></span><span style=display:flex><span>|
</span></span><span style=display:flex><span>-------------------------------------------------------------------------------
</span></span><span style=display:flex><span>|
</span></span><span style=display:flex><span>| # ShootState:garden-my-project/my-shoot
</span></span><span style=display:flex><span>|   -&gt; (1)
</span></span><span style=display:flex><span>|     Shoot:garden-my-project/my-shoot
</span></span><span style=display:flex><span>|
</span></span><span style=display:flex><span>-------------------------------------------------------------------------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>... (etc., similarly for the other resources)
</span></span></code></pre></div><p>There are anchor links to easily jump from one resource to another, and the page provides means for filtering the results based on the <code>kind</code>, <code>namespace</code>, and/or <code>name</code>.</p><h4 id=pitfalls>Pitfalls<a class=td-heading-self-link href=#pitfalls aria-label="Heading self-link"></a></h4><p>When there is a relevant update to an existing resource, i.e., when a reference to another resource is changed, then the corresponding vertex (along with all associated edges) is first deleted from the graph before it gets added again with the up-to-date edges.
However, this does only work for vertices belonging to resources that are only created in exactly one &ldquo;watch handler&rdquo;.
For example, the vertex for a <code>SecretBinding</code> can either be created in the <code>SecretBinding</code> handler itself or in the <code>Shoot</code> handler.
In such cases, deleting the vertex before (re-)computing the edges might lead to race conditions and potentially renders the graph invalid.
Consequently, instead of deleting the vertex, only the edges the respective handler is responsible for are deleted.
If the vertex ends up with no remaining edges, then it also gets deleted automatically.
Afterwards, the vertex can either be added again or the updated edges can be created.</p><h2 id=seedrestriction-admission-webhook-enablement><code>SeedRestriction</code> Admission Webhook Enablement<a class=td-heading-self-link href=#seedrestriction-admission-webhook-enablement aria-label="Heading self-link"></a></h2><p>The <code>SeedRestriction</code> is implemented as <a href=https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/>Kubernetes admission webhook</a> and part of the <a href=/docs/gardener/concepts/admission-controller/><code>gardener-admission-controller</code></a> component running in the garden cluster.</p><p>🎛 In order to activate it, you have to set <code>.global.admission.seedRestriction.enabled=true</code> when using the <a href=https://github.com/gardener/gardener/tree/master/charts/gardener/controlplane>Gardener <code>controlplane</code> Helm chart</a>.
This will add an additional webhook in the existing <code>ValidatingWebhookConfiguration</code> of the <code>gardener-admission-controller</code> which contains the configuration for the <code>SeedRestriction</code> handler.
Please note that it should only be activated when the <code>SeedAuthorizer</code> is active as well.</p><h3 id=admission-decisions>Admission Decisions<a class=td-heading-self-link href=#admission-decisions aria-label="Heading self-link"></a></h3><p>The admission&rsquo;s purpose is to perform extended validation on requests which require the body of the object in question.
Additionally, it handles <code>CREATE</code> requests of <code>gardenlet</code>s/extensions (the above discussed resource dependency graph cannot be used in such cases because there won&rsquo;t be any vertex/edge for non-existing resources).</p><p>Gardenlets/extensions are restricted to only create new resources which are somehow related to the seed clusters they are responsible for.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ba94e9b56f741be3998ac8487425f6b3>14 - Secret Binding Provider Controller</h1><h1 id=secretbinding-provider-controller>SecretBinding Provider Controller<a class=td-heading-self-link href=#secretbinding-provider-controller aria-label="Heading self-link"></a></h1><p>This page describes the process on how to enable the SecretBinding provider controller.</p><h2 id=overview>Overview<a class=td-heading-self-link href=#overview aria-label="Heading self-link"></a></h2><p>With Gardener v1.38.0, the SecretBinding resource now contains a new optional field <code>.provider.type</code> (details about the motivation can be found in <a href=https://github.com/gardener/gardener/issues/4888>https://github.com/gardener/gardener/issues/4888</a>). To make the process of setting the new field automated and afterwards to enforce validation on the new field in backwards compatible manner, Gardener features the SecretBinding provider controller and a feature gate - <code>SecretBindingProviderValidation</code>.</p><h2 id=process>Process<a class=td-heading-self-link href=#process aria-label="Heading self-link"></a></h2><p>A Gardener landscape operator can follow the following steps:</p><ol><li><p>Enable the SecretBinding provider controller of Gardener Controller Manager.</p><p>The SecretBinding provider controller is responsible for populating the <code>.provider.type</code> field of a SecretBinding based on its current usage by Shoot resources. For example, if a Shoot <code>crazy-botany</code> with <code>.provider.type=aws</code> is using a SecretBinding <code>my-secret-binding</code>, then the SecretBinding provider controller will take care to set the <code>.provider.type</code> field of the SecretBinding to the same provider type (<code>aws</code>).
To enable the SecretBinding provider controller, set the <code>controller.secretBindingProvider.concurrentSyncs</code> field in the ControllerManagerConfiguration (e.g set it to <code>5</code>).
Although that it is not recommended, the API allows Shoots from different provider types to reference the same SecretBinding (assuming that the backing Secret contains data for both of the provider types). To preserve the backwards compatibility for such SecretBindings, the provider controller will maintain the multiple provider types in the field (it will join them with the separator <code>,</code> - for example <code>aws,gcp</code>).</p></li><li><p>Disable the SecretBinding provider controller and enable the <code>SecretBindingProviderValidation</code> feature gate of Gardener API server.</p><p>The <code>SecretBindingProviderValidation</code> feature gate of Gardener API server enables a set of validations for the SecretBinding provider field. It forbids creating a Shoot that has a different provider type from the referenced SecretBinding&rsquo;s one. It also enforces immutability on the field.
After making sure that SecretBinding provider controller is enabled and it populated the <code>.provider.type</code> field of a majority of the SecretBindings on a Gardener landscape (the SecretBindings that are unused will have their provider type unset), a Gardener landscape operator has to disable the SecretBinding provider controller and to enable the <code>SecretBindingProviderValidation</code> feature gate of Gardener API server. To disable the SecretBinding provider controller, set the <code>controller.secretBindingProvider.concurrentSyncs</code> field in the ControllerManagerConfiguration to <code>0</code>.</p></li></ol><h2 id=implementation-history>Implementation History<a class=td-heading-self-link href=#implementation-history aria-label="Heading self-link"></a></h2><ul><li>Gardener v1.38: The SecretBinding resource has a new optional field <code>.provider.type</code>. The SecretBinding provider controller is disabled by default. The <code>SecretBindingProviderValidation</code> feature gate of Gardener API server is disabled by default.</li><li>Gardener v1.42: The SecretBinding provider controller is enabled by default.</li><li>Gardener v1.51: The <code>SecretBindingProviderValidation</code> feature gate of Gardener API server is enabled by default and the SecretBinding provider controller is disabled by default.</li><li>Gardener v1.53: The <code>SecretBindingProviderValidation</code> feature gate of Gardener API server is unconditionally enabled (can no longer be disabled).</li><li>Gardener v1.55: The <code>SecretBindingProviderValidation</code> feature gate of Gardener API server and the SecretBinding provider controller are removed.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-83f23df3bdd8e7e5f8233751ed6600f6>15 - Setup Gardener</h1><h1 id=how-to-set-up-a-gardener-landscape>How to Set Up a Gardener Landscape<a class=td-heading-self-link href=#how-to-set-up-a-gardener-landscape aria-label="Heading self-link"></a></h1><blockquote class="alert alert-important"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>message-outline</title><path d="M20 2H4C2.9 2 2 2.9 2 4V22l4-4H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2m0 14H5.2L4 17.2V4H20V16z"/></svg><p>Important</p></div><p><strong>DISCLAIMER</strong>
This document outlines the building blocks used to set up a Gardener landscape. It is not meant as a comprehensive configuration guide but rather as a starting point. Setting up a landscape requires careful planning and consideration of dimensions like the number of providers, geographical distribution, and envisioned size.</p><p>To make it more tangible, some choices are made to provide examples - specifically this guide uses OpenStack as infrastructure provider, Garden Linux to run any worker nodes, and Calico as CNI.
Providing working examples for all combinations of components is out of scope. For a detailed descriptions of components, please refer to the <a href=https://gardener.cloud/docs/>documentation</a> and <a href=https://gardener.cloud/docs/gardener/api-reference/>API reference</a>.</p></blockquote><h2 id=target-picture>Target Picture<a class=td-heading-self-link href=#target-picture aria-label="Heading self-link"></a></h2><p>A Gardener landscape consists of several building blocks. The basis is an existing Kubernetes cluster which is referred to as <em>runtime</em> cluster.
Within this cluster another Kubernetes cluster is hosted, which is referred to as <em>virtual Garden</em> cluster. It is nodeless, meaning it does not host any pods as workload. The virtual Garden cluster is the management plane for the Gardener landscape and contains resources like <code>Shoots</code>, <code>Seeds</code> and so on.</p><p>Any new Gardener landscape starts with the deployment of the Gardener Operator and the creation of a <code>garden</code> namespace on the designated runtime cluster.</p><p>With the operator in place, the <code>Garden</code> resource can be deployed. It is reconciled by the Gardener Operator, which will create the &ldquo;virtual&rdquo; Garden cluster with its <code>etcd</code>, <code>kube-apiserver</code>, <code>gardener-apiserver</code>, and so on.
The API server is exposed through an Istio <code>Gateway</code> and a DNS record pointing to the <code>Gateway</code>&rsquo;s external IP address is created.</p><p>Once the <code>Garden</code> reports readiness, basic building blocks like <code>CloudProfile</code>s, <code>ControllerDeployment</code>s, and <code>ControllerRegistration</code>s, as well as <code>Secret</code>s granting access to DNS management for the internal domain and external default domain, are deployed to the virtual Garden cluster.</p><p>To be able to host any <code>Shoot</code>s, at least one <code>Seed</code> is required. The very first <code>Seed</code> is created via a <code>Gardenlet</code> resource (more precisely <code>gardenlets.seedmanagement.gardener.cloud</code>) deployed to the virtual Garden cluster. The actual <code>gardenlet</code> Pods run on the runtime cluster or another Kubernetes cluster not managed by Gardener. Typically, this is referred to as an <strong>unmanaged</strong> Seed and is considered part of the Gardener infrastructure.
In this setup, the very first <code>Seed</code> will be reserved for one or several &ldquo;infrastructure&rdquo; <code>Shoot</code>s. Those will be turned into <code>Seed</code>s again through a <code>ManagedSeed</code> resource. These <strong>Gardener-managed</strong> <code>Seed</code>s will then host control planes of any users&rsquo; <code>Shoot</code> clusters.</p><p><img src=/docs/gardener/deployment/content/gardener-setup.png alt="Gardener Setup"></p><p>Reference documentation:</p><ul><li><a href=https://gardener.cloud/docs/getting-started/architecture/>Getting Started</a></li></ul><h2 id=prerequisites>Prerequisites<a class=td-heading-self-link href=#prerequisites aria-label="Heading self-link"></a></h2><h3 id=runtime-cluster>Runtime Cluster<a class=td-heading-self-link href=#runtime-cluster aria-label="Heading self-link"></a></h3><p>In order to install and run Gardener an already existing Kubernetes cluster is required. It serves as the root cluster hosting all the components required for the virtual Garden cluster - like a <code>kube-apiserver</code> and <code>etcd</code> but also admission webhooks or the <code>gardener-controller-manager</code>.</p><p>Reference documentation:</p><ul><li><a href=/docs/gardener/concepts/architecture/>Gardener Architecture</a></li><li><a href=https://github.com/gardener/gardener/tree/master/docs#concepts>Gardener concepts</a></li></ul><p>In this example, the runtime cluster is also used to host the very first <code>gardenlet</code>, which will register this cluster as a <code>Seed</code> as well. The <code>gardenlet</code> can be deployed to another Kubernetes cluster (recommended for productive setups). Here, using the runtime cluster keeps the amount of unmanaged clusters at a bare minimum.</p><h3 id=dns-zone>DNS Zone<a class=td-heading-self-link href=#dns-zone aria-label="Heading self-link"></a></h3><p>The virtual Garden API endpoint (<code>kube-apiserver</code>) is exposed through an Istio <code>Gateway</code>. This in turn is reachable via a LoadBalancer <code>Service</code>. The IP address is made discoverable through DNS. Hence, a zone where an <code>A</code> record can be created is required.</p><p>Additionally, Gardener advertises <code>kube-apiservers</code> of <code>Shoots</code> through two DNS records, which requires at least one DNS zone and credentials to interact with it through automation.</p><p>Assuming the base domain for a Gardener landscape is <code>crazy-botany.gardener.cloud</code>, the following example shows a possible way to structure DNS records:</p><table><thead><tr><th style=text-align:left>Component</th><th style=text-align:left>General</th><th style=text-align:left>Example</th></tr></thead><tbody><tr><td style=text-align:left>Gardener Base</td><td style=text-align:left>gardener.&lt;base-domain></td><td style=text-align:left>gardener.crazy-botany.gardener.cloud</td></tr><tr><td style=text-align:left>Virtual Garden</td><td style=text-align:left>api.garden.&lt;base-domain></td><td style=text-align:left>api.garden.gardener.crazy-botany.gardener.cloud</td></tr><tr><td style=text-align:left>Gardener Ingress</td><td style=text-align:left>ingress.garden&lt;gardener-base-domain></td><td style=text-align:left>ingress.garden.gardener.crazy-botany.gardener.cloud</td></tr><tr><td style=text-align:left>Gardener Dashboard</td><td style=text-align:left>dashboard.ingress.&lt;gardener-base-domain></td><td style=text-align:left>dashboard.ingress.garden.crazy-botany.gardener.cloud</td></tr><tr><td style=text-align:left>Gardener Discovery</td><td style=text-align:left>discovery.ingress.&lt;gardener-base-domain></td><td style=text-align:left>discovery.ingress.garden.crazy-botany.gardener.cloud</td></tr><tr><td style=text-align:left>Shoot Internal</td><td style=text-align:left>internal.&lt;gardener-base-domain></td><td style=text-align:left>internal.gardener.crazy-botany.gardener.cloud</td></tr><tr><td style=text-align:left>Shoot (default) External</td><td style=text-align:left>shoot.&lt;gardener-base-domain></td><td style=text-align:left>shoot.gardener.crazy-botany.gardener.cloud</td></tr><tr><td style=text-align:left>Unmanaged Seed Ingress</td><td style=text-align:left>ingress.soil.&lt;gardener-base-domain></td><td style=text-align:left>ingress.soil.gardener.crazy-botany.gardener.cloud</td></tr><tr><td style=text-align:left>Managed Seed</td><td style=text-align:left>&lt;seed-name>.seed.&lt;gardener-base-domain></td><td style=text-align:left>cc-ha.seed.gardener.crazy-botany.gardener.cloud</td></tr><tr><td style=text-align:left>Managed Seed Ingress</td><td style=text-align:left>ingress.&lt;seed-name>.seed.&lt;gardener-base-domain></td><td style=text-align:left>ingress.cc-ha.seed.gardener.crazy-botany.gardener.cloud</td></tr></tbody></table><p>Reference documentation:</p><ul><li><a href=/docs/gardener/configuration/#system-configuration>Gardener Configuration</a></li><li><a href=/docs/gardener/extensions/resources/dnsrecord/>DNS records</a></li></ul><h3 id=backup-bucket>Backup Bucket<a class=td-heading-self-link href=#backup-bucket aria-label="Heading self-link"></a></h3><p>The virtual Garden cluster&rsquo;s <code>etcd</code> is governed by <a href=https://github.com/gardener/etcd-druid>etcd-druid</a>. If configured, backups are created continuously and stored to a supported object store. This requires credentials to manage an object store on the chosen infrastructure.
It is recommended for any productive installation of Gardener.</p><h3 id=infrastructure>Infrastructure<a class=td-heading-self-link href=#infrastructure aria-label="Heading self-link"></a></h3><p>For each infrastructure supported by Gardener a so-called <strong>provider-extension</strong> exists. It implements the required interfaces. For this example, the <a href=https://github.com/gardener/gardener-extension-provider-openstack>OpenStack extension</a> will be used.</p><p>Access to the respective infrastructure is required and needs to be handed over to Gardener in the provider-specific format (e.g., OpenStack application credentials).</p><p>Reference documentation:</p><ul><li><a href=/docs/gardener/#extensions>Gardener extensibility</a></li><li><a href=https://github.com/gardener/gardener-extension-provider-openstack/tree/master/docs>Provider OpenStack</a></li></ul><h2 id=configure-and-deploy-components>Configure and deploy components<a class=td-heading-self-link href=#configure-and-deploy-components aria-label="Heading self-link"></a></h2><p>This section focuses on the individual building blocks of a Gardener landscape and their deployment / options.</p><h3 id=gardener-operator>Gardener Operator<a class=td-heading-self-link href=#gardener-operator aria-label="Heading self-link"></a></h3><p>The Gardener Operator is provided as a <a href=https://github.com/gardener/gardener/tree/master/charts/gardener/operator>helm chart</a>, which is also published as an OCI artifact and attached to each release of the <a href=https://github.com/gardener/gardener/releases>gardener/gardener</a> repository.</p><p>When setting up a new Gardener landscape, choose the latest version and either install the chart or render the templates e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm template ./charts/gardener/operator --namespace garden --set replicaCount=2 --set image.tag=v1.111.0
</span></span></code></pre></div><p>Reference documentation:</p><ul><li><a href=/docs/gardener/concepts/operator/>Gardener Operator</a></li></ul><h3 id=garden>Garden<a class=td-heading-self-link href=#garden aria-label="Heading self-link"></a></h3><p>The Gardener Operator reconciles the so-called <code>Garden</code> resource, which contains a detailed configuration of the Garden landscape to be created. Specify the domain name for the Garden&rsquo;s API endpoint, CIDR blocks for the virtual cluster, high availability, and other options here.
To get familiar with the available options, check the <a href=https://github.com/gardener/gardener/blob/master/example/operator/20-garden.yaml>Garden example</a>.</p><p>While most operations are carried out in the realm of the runtime cluster, two external services are required. To automate both the creation of <code>DNSRecord</code>s and a <code>BackupBucket</code>, a provider-extension needs to be deployed to the runtime cluster as well.
To facilitate the extension&rsquo;s deployment, the API group <code>operator.gardener.cloud/v1alpha1</code> contains an <code>Extension</code> resources, which is reconciled by the Gardener Operator. Such an <code>Extension</code> resource specifies how to install it into the runtime cluster, as well as the virtual Garden cluster. More details can be found in the <a href=/docs/gardener/deployment/setup_gardener/#extensions>Extensions section</a>.</p><p>The below example shows how an <code>Extension</code> is used to deploy the provider-extension for OpenStack. Please note, it advertises to support resources of <code>kind: BackupBucket</code> and <code>type: openstack</code> as well as <code>kind: DNSrecord</code> and <code>type: openstack-designate</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: operator.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>kind: Extension
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: provider-openstack
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  deployment:
</span></span><span style=display:flex><span>    admission:
</span></span><span style=display:flex><span>      runtimeCluster:
</span></span><span style=display:flex><span>        helm:
</span></span><span style=display:flex><span>          ociRepository:
</span></span><span style=display:flex><span>            repository: europe-docker.pkg.dev/gardener-project/releases/charts/gardener/extensions/admission-openstack-runtime
</span></span><span style=display:flex><span>            tag: v1.44.1
</span></span><span style=display:flex><span>      values:
</span></span><span style=display:flex><span>        replicaCount: 3
</span></span><span style=display:flex><span>      virtualCluster:
</span></span><span style=display:flex><span>        helm:
</span></span><span style=display:flex><span>          ociRepository:
</span></span><span style=display:flex><span>            repository: europe-docker.pkg.dev/gardener-project/releases/charts/gardener/extensions/admission-openstack-application
</span></span><span style=display:flex><span>            tag: v1.44.1
</span></span><span style=display:flex><span>    extension:
</span></span><span style=display:flex><span>      helm:
</span></span><span style=display:flex><span>        ociRepository:
</span></span><span style=display:flex><span>          repository: europe-docker.pkg.dev/gardener-project/releases/charts/gardener/extensions/provider-openstack
</span></span><span style=display:flex><span>          tag: v1.44.1
</span></span><span style=display:flex><span>      runtimeClusterValues:
</span></span><span style=display:flex><span>        vpa:
</span></span><span style=display:flex><span>          enabled: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>          resourcePolicy:
</span></span><span style=display:flex><span>            minAllowed:
</span></span><span style=display:flex><span>              memory: 128Mi
</span></span><span style=display:flex><span>          updatePolicy:
</span></span><span style=display:flex><span>            updateMode: Auto
</span></span><span style=display:flex><span>      values:
</span></span><span style=display:flex><span>        replicaCount: 3
</span></span><span style=display:flex><span>        resources:
</span></span><span style=display:flex><span>          requests:
</span></span><span style=display:flex><span>            cpu: 30m
</span></span><span style=display:flex><span>            memory: 256Mi
</span></span><span style=display:flex><span>      injectGardenKubeconfig: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>  resources:
</span></span><span style=display:flex><span>  - kind: BackupBucket
</span></span><span style=display:flex><span>    type: openstack
</span></span><span style=display:flex><span>  - kind: BackupEntry
</span></span><span style=display:flex><span>    type: openstack
</span></span><span style=display:flex><span>  - kind: Bastion
</span></span><span style=display:flex><span>    type: openstack
</span></span><span style=display:flex><span>  - kind: ControlPlane
</span></span><span style=display:flex><span>    type: openstack
</span></span><span style=display:flex><span>  - kind: Infrastructure
</span></span><span style=display:flex><span>    type: openstack
</span></span><span style=display:flex><span>  - kind: Worker
</span></span><span style=display:flex><span>    type: openstack
</span></span><span style=display:flex><span>  - kind: DNSRecord
</span></span><span style=display:flex><span>    type: openstack-designate
</span></span></code></pre></div><p>If needed, a pull secret can be referenced for the Helm charts.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: operator.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>kind: Extension
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: ...
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>    deployment:
</span></span><span style=display:flex><span>      ...
</span></span><span style=display:flex><span>        helm:
</span></span><span style=display:flex><span>          ociRepository:
</span></span><span style=display:flex><span>            repository: ...
</span></span><span style=display:flex><span>            tag: ...
</span></span><span style=display:flex><span>            pullSecretRef:
</span></span><span style=display:flex><span>              name: my-pull-secret
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Secret
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: my-pull-secret
</span></span><span style=display:flex><span>  namespace: garden
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    gardener.cloud/role: helm-pull-secret
</span></span><span style=display:flex><span>type: kubernetes.io/dockerconfigjson
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  .dockerconfigjson: &lt;base64-encoded-docker-config-json&gt;
</span></span></code></pre></div><p>To make use of the automated DNS management, the <code>Garden</code> resource has to contain a primary provider. Here is an example for an OpenStack-based setup, where the actual credentials are stored in the referenced <code>Secret</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>dns:
</span></span><span style=display:flex><span>  providers:
</span></span><span style=display:flex><span>  - name: primary
</span></span><span style=display:flex><span>    type: openstack-designate
</span></span><span style=display:flex><span>    secretRef:
</span></span><span style=display:flex><span>      name: dns-showroom-garden
</span></span></code></pre></div><p>Additionally, the <code>BackupBucket</code> and credentials to access it are configured alongside. The easiest way to get started is by using and customizing the example linked below.</p><p><img src=/docs/gardener/deployment/content/garden.png alt=Garden></p><p>Upon the first reconciliation of the <code>Garden</code> resource, a Kubernetes control plane will be bootstrapped in the <code>garden</code> namespace. <code>etcd-main</code> and <code>etcd-events</code> are managed by <a href=https://github.com/gardener/etcd-druid>etcd-druid</a> and use the <code>BackupBucket</code> created by the provider-extension.
To be able to serve any Gardener resource, the <code>gardener-apiserver</code> is deployed and registered through an <code>APIService</code> resource with the <code>kube-apiserver</code> of the virtual Garden cluster. Components like <code>gardener-scheduler</code> and <code>gardener-controller-manager</code> are deployed to act on Gardener&rsquo;s resources.</p><p>Once the <code>Garden</code> resource reports readiness, the virtual Garden cluster can be targeted.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get garden crazy-botany
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME          K8S VERSION   GARDENER VERSION   LAST OPERATION   RUNTIME   VIRTUAL   API SERVER   OBSERVABILITY   AGE
</span></span><span style=display:flex><span>crazy-botany   1.31.1        v1.110.0           Succeeded        True      True      True         True            1d
</span></span></code></pre></div><p>In case the automatic DNS record creation is not supported, a record with the external address of the <code>virtual-garden-istio-ingress</code> (found in namespace <code>istio-ingressgateway</code>) service has to be created manually.</p><p>To obtain credentials and interact with the virtual Garden cluster, please follow this <a href=/docs/gardener/concepts/operator/#virtual-garden-kubeconfig>guide</a>.</p><p>Reference documentation and examples:</p><ul><li><a href=https://github.com/gardener/gardener/blob/master/example/operator/20-garden.yaml>Garden configuration example</a></li><li><a href=https://github.com/gardener/etcd-backup-restore/tree/master/example/storage-provider-secrets>Backup secret examples</a></li><li><a href=/docs/gardener/concepts/operator/#garden-resources>Configuration options</a></li><li><a href=/docs/gardener/concepts/operator/#virtual-garden-kubeconfig>Accessing the virtual Garden</a></li></ul><h3 id=extensions>Extensions<a class=td-heading-self-link href=#extensions aria-label="Heading self-link"></a></h3><p>Gardener is provider-agnostic and relies on a growing set of extensions. An extension can provide support for an infrastructure (required) or add a desired feature to a Kubernetes cluster (often optional).</p><p>There are a few extensions considered essential to any Gardener installation:</p><ul><li>at least one <a href=/docs/extensions/#infrastructure-provider>infrastructure provider</a> (commonly referred to as provider-extension)</li><li>at least one <a href=/docs/extensions/#operating-system>operating system extension</a> - <a href=https://github.com/gardener/gardener-extension-os-gardenlinux>Garden Linux</a> is recommended</li><li>at least one <a href=/docs/extensions/#network-plugin>network plugin (CNI)</a></li><li>Shoot services</li></ul><p>An extension often consists of two components - a controller implementing the Gardener&rsquo;s extension contract and an admission controller. The latter is deployed to the runtime cluster and prevents misconfiguration of <code>Shoot</code>s.</p><h4 id=choices>Choices<a class=td-heading-self-link href=#choices aria-label="Heading self-link"></a></h4><p>For this example, the following choices are made:</p><ul><li><a href=https://github.com/gardener/gardener-extension-os-gardenlinux>Garden Linux OS extension</a></li><li><a href=https://github.com/gardener/gardener-extension-provider-openstack>Provider OpenStack</a></li><li><a href=https://github.com/gardener/gardener-extension-networking-calico>Calico</a></li><li><a href=https://github.com/gardener/gardener-extension-shoot-dns-service>DNS service</a></li><li><a href=https://github.com/gardener/gardener-extension-shoot-cert-service>Cert service</a></li><li><a href=https://github.com/gardener/gardener-extension-shoot-oidc-service>OIDC service</a></li></ul><p>Reference documentation:</p><ul><li><a href=/docs/gardener/extensions/resources/extension/#contract-extension-resource>Extension Contract</a></li><li><a href=https://github.com/gardener/gardener/blob/master/docs/proposals/01-extensibility.md>GEP 01 Extensibility</a></li><li><a href=/docs/extensions/#known-extension-implementations>Extension Library</a></li></ul><h4 id=how-to-install-an-extension>How to install an extension<a class=td-heading-self-link href=#how-to-install-an-extension aria-label="Heading self-link"></a></h4><p>In order to make an extension known to a Gardener landscape, two resources have to be applied to the virtual Garden cluster - firstly, a <code>ControllerDeployment</code> and secondly, a matching <code>ControllerRegistration</code>. With both in place, Gardener-managed <code>ControllerInstallation</code>s take care of the actual deployment of the extension to the target environment.</p><p>Check the <a href=/docs/gardener/extensions/registration/>extension registration documentation</a> for more details.</p><p>Now, the classical way of installing <code>ControllerDeployment</code> and <code>ControllerRegistration</code> is to prepare the resources and apply them to the virtual Garden cluster. The <code>ControllerDeployment</code> references an OCI repository containing the extension&rsquo;s helm chart.</p><p>For example, to deploy the <a href=https://github.com/gardener/gardener-extension-provider-openstack>provider OpenStack</a> extension, the <a href=https://github.com/gardener/gardener-extension-provider-openstack/blob/master/example/controller-registration.yaml>example file</a> can be used.</p><p>To simplify this procedure, extensions can be registered through <code>Extension</code> resources in the runtime cluster. The Gardener Operator will take care of deploying the required resources to the virtual Garden cluster.
In addition, this approach allows the extensions and their admission controllers to be deployed to the runtime cluster as well. There, they can provide additional functionality like managing <code>DNSRecord</code>s or <code>BackupBucket</code>s.
More details can be found in the <a href=/docs/gardener/concepts/operator/#extension-resource>Extension Resource documentation</a>.</p><p><img src=/docs/gardener/deployment/content/extensions.png alt=extensions></p><h3 id=cloud-profile>Cloud Profile<a class=td-heading-self-link href=#cloud-profile aria-label="Heading self-link"></a></h3><p>In order to host any <code>Shoot</code> cluster, at least one <code>CloudProfile</code> is required. The <code>CloudProfile</code> resource describes supported Kubernetes and OS versions, as well as infrastructure capabilities like regions and their availability zones.</p><p>Hence, the next step is to craft a <code>CloudProfile</code> for each infrastructure provider and combine it with the information where the operating system images can be found. The resulting <code>CloudProfile</code> resource has to be deployed to the virtual Garden cluster.</p><p>The following list provides the high-level steps to build a <code>CloudProfile</code>:</p><ul><li>add at least one supported minor version to <code>.spec.kubernetes.versions[]</code>.</li><li>add at least one region including the availability zone to <code>.spec.regions[]</code>.</li><li>add at least one operating system to <code>.spec.machineImages[]</code> and define at least on supported version.</li><li>add one or several machine types to <code>.spec.machineTypes[]</code>.</li><li>specify a <code>.spec.providerConfig</code> according to the extension&rsquo;s documentation. Typically, this includes a list of <code>MachineImages</code>. Garden Linux, for example, publishes images and provides a list of location as part of the release notes. In case of private infrastructure, copying the images might be required.</li></ul><p>Here is a simplified example manifest:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: core.gardener.cloud/v1beta1
</span></span><span style=display:flex><span>kind: CloudProfile
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: openstack-example
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  caBundle: | <span style=color:green># CA Bundle installed on all nodes of the shoot clusters using this CloudProfile</span>
</span></span><span style=display:flex><span>    &lt;redacted&gt;
</span></span><span style=display:flex><span>  kubernetes:
</span></span><span style=display:flex><span>    versions:
</span></span><span style=display:flex><span>    - classification: preview
</span></span><span style=display:flex><span>      version: 1.31.3
</span></span><span style=display:flex><span>    - classification: supported
</span></span><span style=display:flex><span>      expirationDate: <span style=color:#a31515>&#34;2025-07-30T23:59:59Z&#34;</span>
</span></span><span style=display:flex><span>      version: 1.31.2
</span></span><span style=display:flex><span>  machineImages:
</span></span><span style=display:flex><span>  - name: gardenlinux
</span></span><span style=display:flex><span>    updateStrategy: minor
</span></span><span style=display:flex><span>    versions:
</span></span><span style=display:flex><span>    - architectures:
</span></span><span style=display:flex><span>      - amd64
</span></span><span style=display:flex><span>      - arm64
</span></span><span style=display:flex><span>      classification: supported
</span></span><span style=display:flex><span>      cri:
</span></span><span style=display:flex><span>      - containerRuntimes:
</span></span><span style=display:flex><span>        - type: gvisor
</span></span><span style=display:flex><span>        name: containerd
</span></span><span style=display:flex><span>      version: 1592.3.0
</span></span><span style=display:flex><span>  machineTypes:
</span></span><span style=display:flex><span>  - architecture: amd64
</span></span><span style=display:flex><span>    cpu: <span style=color:#a31515>&#34;2&#34;</span>
</span></span><span style=display:flex><span>    gpu: <span style=color:#a31515>&#34;0&#34;</span>
</span></span><span style=display:flex><span>    memory: 4Gi
</span></span><span style=display:flex><span>    name: small_machine
</span></span><span style=display:flex><span>    storage:
</span></span><span style=display:flex><span>      class: standard
</span></span><span style=display:flex><span>      size: 64Gi
</span></span><span style=display:flex><span>      type: default
</span></span><span style=display:flex><span>    usable: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>  regions:
</span></span><span style=display:flex><span>  - name: my-region-1
</span></span><span style=display:flex><span>    zones:
</span></span><span style=display:flex><span>    - name: my-region-1a
</span></span><span style=display:flex><span>    - name: my-region-1b
</span></span><span style=display:flex><span>  providerConfig:
</span></span><span style=display:flex><span>    apiVersion: openstack.provider.extensions.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>    kind: CloudProfileConfig
</span></span><span style=display:flex><span>    machineImages:
</span></span><span style=display:flex><span>    - name: gardenlinux
</span></span><span style=display:flex><span>      versions:
</span></span><span style=display:flex><span>      - version: 1592.3.0
</span></span><span style=display:flex><span>        regions:
</span></span><span style=display:flex><span>        - id: abcd-1234 <span style=color:green># The ID of the image in the given OpenStack installation for the specified region.</span>
</span></span><span style=display:flex><span>          name: my-region-1
</span></span><span style=display:flex><span>    <span style=color:green># ...</span>
</span></span></code></pre></div><p>Reference documentation:</p><ul><li><a href=/docs/gardener/concepts/apiserver/#cloudprofiles><code>CloudProfile</code>s</a></li><li><a href=https://github.com/gardener/gardener/blob/master/example/30-cloudprofile.yaml><code>CloudProfile</code> example</a></li><li><a href=/docs/extensions/infrastructure-extensions/gardener-extension-provider-openstack/operations/>OpenStack <code>CloudProfile</code> example</a></li><li><a href=https://github.com/gardenlinux/gardenlinux/releases/tag/1592.3>Garden Linux release notes example</a></li><li><a href=/docs/gardener/deployment/image_vector/>Image vector</a></li><li><a href=https://github.com/gardener/gardener/blob/master/imagevector/containers.yaml>Image vector container defaults</a></li></ul><h3 id=dns-setup-for-internal--external-domains>DNS setup for internal & external domains<a class=td-heading-self-link href=#dns-setup-for-internal--external-domains aria-label="Heading self-link"></a></h3><p>Gardener maintains DNS records for a <code>Shoot</code> which requires a DNS zone and credentials to manage records in this zone. Provide the credentials alongside with information about the zone. The secrets are deployed to the virtual Garden cluster.</p><p>Reference documentation:</p><ul><li><a href=/docs/gardener/extensions/resources/dnsrecord/#what-does-gardener-create-dns-records-for><code>DNSRecord</code>s</a></li><li><a href=https://github.com/gardener/gardener/blob/master/example/10-secret-default-domain.yaml>Default domain example</a></li><li><a href=https://github.com/gardener/gardener/blob/master/example/10-secret-internal-domain.yaml>Internal domain example</a></li></ul><h3 id=gardenlet>Gardenlet<a class=td-heading-self-link href=#gardenlet aria-label="Heading self-link"></a></h3><p>Before the first <code>Shoot</code> can be created in a new Gardener landscape, at least one <code>Seed</code> is required. Typically, the very first <code>Seed</code> is created by deploying a properly configured <code>gardenlet</code> to an existing Kubernetes cluster. In this example, the <code>gardenlet</code> will be deployed to the runtime cluster - effectively turning it into a <code>Seed</code> as well.
Thus, the runtime cluster serves two purposes now - it hosts the virtual Garden cluster and control planes. It is possible, and strongly recommended for larger installations, to deploy a <code>gardenlet</code> to another Kubernetes cluster. This separates the virtual Garden cluster from the first <code>Seed</code> with the control planes hosted there.</p><p>A <code>Seed</code> requires a provider-extension matching the target infrastructure to manage <code>DNSRecord</code>s for the <code>Seed</code>&rsquo;s ingress domain and if configured, the <code>BackupBucket</code>. A <code>Secret</code> with the credentials to interact with the infrastructure needs to be created in the virtual Garden cluster and linked in the <code>gardenlet</code>&rsquo;s configuration.</p><p>The easiest way to deploy a <code>gardenlet</code> is to create a <code>Gardenlet</code> resource in the virtual Garden cluster. Make sure to configure the CIDR blocks properly to avoid conflicts or overlaps with the runtime cluster.</p><p><img src=/docs/gardener/deployment/content/gardenlet.png alt=gardenlet></p><p>A common pattern is to protect this very first <code>Seed</code>, in a sense that no control planes of user <code>Shoot</code> clusters will be scheduled to it. Instead, this <code>Seed</code> should host control planes of Gardener-managed <code>Seed</code> clusters exclusively. These in turn host the control planes of user <code>Shoot</code>s.
This pattern allows to scale out the capacity of a Gardener landscape, as creating new seeds is simple and fast. More details can be found in the <a href=/docs/gardener/deployment/setup_gardener/#shoot--managed-seed>Shoot & Managed Seed section</a>.</p><p>To achieve this protection, the <code>gardenlet</code> resource should contain the following configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  config:
</span></span><span style=display:flex><span>    seedConfig:
</span></span><span style=display:flex><span>      spec:
</span></span><span style=display:flex><span>        taints:
</span></span><span style=display:flex><span>          - key: seed.gardener.cloud/protected
</span></span><span style=display:flex><span>        settings:
</span></span><span style=display:flex><span>          scheduling:
</span></span><span style=display:flex><span>            visible: <span style=color:#00f>false</span>
</span></span></code></pre></div><p>Reference documentation:</p><ul><li><a href=/docs/gardener/concepts/gardenlet/>Gardenlet documentation</a></li><li><a href=/docs/gardener/deployment/deploy_gardenlet/>Deploying a Gardenlet</a></li><li><a href=https://github.com/gardener/gardener/blob/master/example/55-gardenlet.yaml>Gardenlet example</a></li><li><a href=https://github.com/gardener/gardener/blob/master/example/20-componentconfig-gardenlet.yaml>Gardenlet configuration example</a></li></ul><h3 id=shoot--managed-seed>Shoot & Managed Seed<a class=td-heading-self-link href=#shoot--managed-seed aria-label="Heading self-link"></a></h3><p>With the very first <code>Seed</code> in place, the Gardener landscape can scale by the means of Gardener-managed infrastructure. To get started, a <code>Shoot</code> needs to be created in the virtual Garden cluster. This requires infrastructure credentials to be provided in the form of a <code>Secret</code> and <code>CredentialsBinding</code>. This <code>Shoot</code> should have a <code>toleration</code> for the above <code>taint</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  tolerations:
</span></span><span style=display:flex><span>  - key: seed.gardener.cloud/protected
</span></span></code></pre></div><p>Up next, a <code>gardenlet</code> has to be installed on to this <code>Shoot</code> and it needs to be registered as a <code>Seed</code>. The recommended way is to create a <code>ManagedSeed</code> resource in the virtual Garden. The configuration for the <code>Seed</code> needs to be crafted carefully to avoid overlapping CIDR ranges etc. Additionally, the virtual Garden&rsquo;s API endpoint needs to be added. When deploying a <code>gardenlet</code> to the runtime cluster, cluster-internal communication through the <code>Service</code>&rsquo;s cluster DNS record works well. Now with the new <code>gardenlet</code> running on a different Kubernetes cluster, the public endpoint is required in the <code>gardenlet</code>&rsquo;s configuration within the <code>ManagedSeed</code> resource.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  gardenlet:
</span></span><span style=display:flex><span>    config:
</span></span><span style=display:flex><span>      apiVersion: gardenlet.config.gardener.cloud/v1alpha1
</span></span><span style=display:flex><span>      kind: GardenletConfiguration
</span></span><span style=display:flex><span>      gardenClientConnection:
</span></span><span style=display:flex><span>        gardenClusterAddress: https://api.garden.crazy-botany.gardener.cloud
</span></span></code></pre></div><p><img src=/docs/gardener/deployment/content/managedseed.png alt="managed seed"></p><p>Reference documentation:</p><ul><li><a href=/docs/gardener/managed_seed/>Managed Seeds</a></li></ul><h2 id=conclusion>Conclusion<a class=td-heading-self-link href=#conclusion aria-label="Heading self-link"></a></h2><p>Setting up a new Gardener landscape is much easier today - thanks to the evolution of the Gardener Operator and <code>Garden</code> resource. Utilizing the <code>Extension</code> resource reduces manual efforts significantly.
A single Gardener landscape can support multiple infrastructures for <code>Shoots</code>. To onboard an infrastructure, the relevant extensions need to be deployed as well.</p><p>Due to the vast amount of configuration options it is highly recommended to spend some time to derive a meaningful setup initially.</p><p>In this example, the runtime cluster serves two purposes - it hosts the virtual Garden cluster and runs a <code>gardenlet</code> which registers the runtime cluster itself as a seed with the virtual Garden cluster. This first seed is reserved to host the control planes of &ldquo;infrastructure&rdquo; <code>Shoot</code>s only. Those <code>Shoot</code>s will be turned into seeds using the <code>ManagedSeed</code> resource and allow for proper scaling.</p><p>To get started with Gardener, visit our <a href=https://gardener.cloud>landing page</a> and try the <a href=https://demo.gardener.cloud/>demo environment</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9dd0ffa442dec2cdede353f4d427f770>16 - Version Skew Policy</h1><h1 id=version-skew-policy>Version Skew Policy<a class=td-heading-self-link href=#version-skew-policy aria-label="Heading self-link"></a></h1><p>This document describes the maximum version skew supported between various Gardener components.</p><h2 id=supported-gardener-versions>Supported Gardener Versions<a class=td-heading-self-link href=#supported-gardener-versions aria-label="Heading self-link"></a></h2><p>Gardener versions are expressed as <code>x.y.z</code>, where <code>x</code> is the major version, <code>y</code> is the minor version, and <code>z</code> is the patch version, following Semantic Versioning terminology.</p><p>The Gardener project maintains release branches for the three most recent minor releases.</p><p>Applicable fixes, including security fixes, may be backported to those three release branches, depending on severity and feasibility.
Patch releases are cut from those branches at a regular cadence, plus additional urgent releases when required.</p><p>For more information, see the <a href=/docs/gardener/process/#releases>Releases document</a>.</p><h3 id=supported-version-skew>Supported Version Skew<a class=td-heading-self-link href=#supported-version-skew aria-label="Heading self-link"></a></h3><p>Technically, we follow the same <a href=https://kubernetes.io/releases/version-skew-policy/>policy</a> as the Kubernetes project.
However, given that our release cadence is much more frequent compared to Kubernetes (every <code>14d</code> vs. every <code>120d</code>), in many cases it might be possible to skip versions, though we do not test these upgrade paths.
Consequently, in general it might not work, and to be on the safe side, it is highly recommended to follow the described policy.</p><p>🚨 Note that downgrading Gardener versions is generally not tested during development and should be considered unsupported.</p><h4 id=gardener-apiserver>gardener-apiserver<a class=td-heading-self-link href=#gardener-apiserver aria-label="Heading self-link"></a></h4><p>In multi-instance setups of Gardener, the newest and oldest <code>gardener-apiserver</code> instances must be within one minor version.</p><p>Example:</p><ul><li>newest <code>gardener-apiserver</code> is at <strong>1.37</strong></li><li>other <code>gardener-apiserver</code> instances are supported at <strong>1.37</strong> and <strong>1.36</strong></li></ul><h4 id=gardener-controller-manager-gardener-scheduler-gardener-admission-controller>gardener-controller-manager, gardener-scheduler, gardener-admission-controller<a class=td-heading-self-link href=#gardener-controller-manager-gardener-scheduler-gardener-admission-controller aria-label="Heading self-link"></a></h4><p><code>gardener-controller-manager</code>, <code>gardener-scheduler</code>, and <code>gardener-admission-controller</code> must not be newer than the <code>gardener-apiserver</code> instances they communicate with.
They are expected to match the <code>gardener-apiserver</code> minor version, but may be up to one minor version older (to allow live upgrades).</p><p>Example:</p><ul><li><code>gardener-apiserver</code> is at <strong>1.37</strong></li><li><code>gardener-controller-manager</code>, <code>gardener-scheduler</code>, and <code>gardener-admission-controller</code> are supported at <strong>1.37</strong> and <strong>1.36</strong></li></ul><h4 id=gardenlet>gardenlet<a class=td-heading-self-link href=#gardenlet aria-label="Heading self-link"></a></h4><ul><li><code>gardenlet</code> must not be newer than <code>gardener-apiserver</code></li><li><code>gardenlet</code> may be up to two minor versions older than <code>gardener-apiserver</code></li></ul><p>Example:</p><ul><li><code>gardener-apiserver</code> is at <strong>1.37</strong></li><li><code>gardenlet</code> is supported at <strong>1.37</strong>, <strong>1.36</strong>, and <strong>1.35</strong></li></ul><h4 id=gardener-operator>gardener-operator<a class=td-heading-self-link href=#gardener-operator aria-label="Heading self-link"></a></h4><p>Since <code>gardener-operator</code> manages the Gardener control plane components (<code>gardener-apiserver</code>, <code>gardener-controller-manager</code>, <code>gardener-scheduler</code>, <code>gardener-admission-controller</code>), it follows the same policy as for <a href=/docs/gardener/deployment/version_skew_policy/#gardener-apiserver><code>gardener-apiserver</code></a>.</p><p>It implements additional start-up checks to ensure adherence to this policy.
Concretely, <code>gardener-operator</code> will crash when</p><ul><li>its gets downgraded.</li><li>its version gets upgraded and skips at least one minor version.</li></ul><h3 id=supported-component-upgrade-order>Supported Component Upgrade Order<a class=td-heading-self-link href=#supported-component-upgrade-order aria-label="Heading self-link"></a></h3><p>The supported version skew between components has implications on the order in which components must be upgraded.
This section describes the order in which components must be upgraded to transition an existing Gardener installation from version <strong>1.37</strong> to version <strong>1.38</strong>.</p><h4 id=gardener-apiserver-1>gardener-apiserver<a class=td-heading-self-link href=#gardener-apiserver-1 aria-label="Heading self-link"></a></h4><p>Prerequisites:</p><ul><li>In a single-instance setup, the existing <code>gardener-apiserver</code> instance is <strong>1.37</strong>.</li><li>In a multi-instance setup, all <code>gardener-apiserver</code> instances are at <strong>1.37</strong> or <strong>1.38</strong> (this ensures maximum skew of 1 minor version between the oldest and newest <code>gardener-apiserver</code> instance).</li><li>The <code>gardener-controller-manager</code>, <code>gardener-scheduler</code>, and <code>gardener-admission-controller</code> instances that communicate with this <code>gardener-apiserver</code> are at version <strong>1.37</strong> (this ensures they are not newer than the existing API server version and are within 1 minor version of the new API server version).</li><li><code>gardenlet</code> instances on all seeds are at version <strong>1.37</strong> or <strong>1.36</strong> (this ensures they are not newer than the existing API server version and are within 2 minor versions of the new API server version).</li></ul><p>Actions:</p><ul><li>Upgrade <code>gardener-apiserver</code> to <strong>1.38</strong>.</li></ul><h4 id=gardener-controller-manager-gardener-scheduler-gardener-admission-controller-1>gardener-controller-manager, gardener-scheduler, gardener-admission-controller<a class=td-heading-self-link href=#gardener-controller-manager-gardener-scheduler-gardener-admission-controller-1 aria-label="Heading self-link"></a></h4><p>Prerequisites:</p><ul><li>The <code>gardener-apiserver</code> instances these components communicate with are at <strong>1.38</strong> (in multi-instance setups in which these components can communicate with any <code>gardener-apiserver</code> instance in the cluster, all <code>gardener-apiserver</code> instances must be upgraded before upgrading these components).</li></ul><p>Actions:</p><ul><li>Upgrade <code>gardener-controller-manager</code>, <code>gardener-scheduler</code>, and <code>gardener-admission-controller</code> to <strong>1.38</strong></li></ul><h4 id=gardenlet-1>gardenlet<a class=td-heading-self-link href=#gardenlet-1 aria-label="Heading self-link"></a></h4><p>Prerequisites:</p><ul><li>The <code>gardener-apiserver</code> instances the <code>gardenlet</code> communicates with are at <strong>1.38</strong>.</li></ul><p>Actions:</p><ul><li>Optionally upgrade <code>gardenlet</code> instances to <strong>1.38</strong> (or they can be left at <strong>1.37</strong> or <strong>1.36</strong>).</li></ul><blockquote class="alert alert-warning"><div class=alert-title><svg viewBox="0 0 24 24" width="24" height="24"><title>alert-outline</title><path d="M12 2 1 21H23M12 6l7.53 13H4.47M11 10v4h2V10m-2 6v2h2V16"/></svg><p>Warning</p></div><p>Running a landscape with <code>gardenlet</code> instances that are persistently two minor versions behind <code>gardener-apiserver</code> means they must be upgraded before the Gardener control plane can be upgraded.</p></blockquote><h4 id=gardener-operator-1>gardener-operator<a class=td-heading-self-link href=#gardener-operator-1 aria-label="Heading self-link"></a></h4><p>Prerequisites:</p><ul><li>All <code>gardener-operator</code> instances are at <strong>1.37</strong>.</li></ul><p>Actions:</p><ul><li>Upgrade <code>gardener-operator</code> to <strong>1.38</strong>.</li></ul><h2 id=supported-gardener-extension-versions>Supported Gardener Extension Versions<a class=td-heading-self-link href=#supported-gardener-extension-versions aria-label="Heading self-link"></a></h2><p>Extensions are maintained and released separately and independently of the <code>gardener/gardener</code> repository.
Consequently, providing version constraints is not possible in this document.
Sometimes, the documentation of extensions contains compatibility information (e.g., &ldquo;this extension version is only compatible with Gardener versions higher than <strong>1.80</strong>&rdquo;, see <a href=https://github.com/gardener/gardener-extension-provider-aws#compatibility>this example</a>).</p><p>However, since all extensions typically make use of the <a href=https://github.com/gardener/gardener/tree/master/extensions>extensions library</a> (<a href=https://github.com/gardener/gardener-extension-provider-aws/blob/cb96b60c970c2e20615dffb3018dc0571cab764d/go.mod#L12>example</a>), a general constraint is that <em>no extension must depend on a version of the extensions library higher than the version of <code>gardenlet</code></em>.</p><p>Example 1:</p><ul><li><code>gardener-apiserver</code> and other Gardener control plane components are at <strong>1.37</strong>.</li><li>All <code>gardenlet</code>s are at <strong>1.37</strong>.</li><li>Only extensions are supported which depend on <strong>1.37</strong> or lower of the extensions library.</li></ul><p>Example 2:</p><ul><li><code>gardener-apiserver</code> and other Gardener control plane components are at <strong>1.37</strong>.</li><li>Some <code>gardenlet</code>s are at <strong>1.37</strong>, others are at <strong>1.36</strong>.</li><li>Only extensions are supported which depend on <strong>1.36</strong> or lower of the extensions library.</li></ul><h2 id=supported-kubernetes-versions>Supported Kubernetes Versions<a class=td-heading-self-link href=#supported-kubernetes-versions aria-label="Heading self-link"></a></h2><p>Please refer to <a href=/docs/gardener/shoot-operations/supported_k8s_versions/>Supported Kubernetes Versions</a>.</p></div></main></div></div><footer class="footer row d-print-none"><div class="container-fluid footer-wrapper"><ul class=nav><li><a href=https://demo.gardener.cloud>Demo</a></li><li><a href=https://gardener.cloud/adopter/>Adopters</a></li><li><a href=/docs/>Documentation</a></li><li><a href=https://gardener.cloud/blog/>Blogs</a></li><li><a href=https://gardener.cloud/community/>Community</a></li></ul><img src=/images/lp/gardener-logo.svg alt="Logo Gardener" class=logo><ul class=media-wr><li><a target=_blank href=https://gardener-cloud.slack.com/><img src=/images/branding/slack-logo-white.svg class=media-icon><div class=media-text>Slack</div></a></li><li><a target=_blank href=https://github.com/gardener><img src=/images/branding/github-mark-logo.png class=media-icon><div class=media-text>GitHub</div></a></li><li><a target=_blank href=https://www.youtube.com/channel/UCwUhwKFREV8Su0gwAJQX7tw><img src=/images/branding/youtube-logo-dark.svg class=media-icon><div class=media-text>YouTube</div></a></li><li><a target=_blank href=https://x.com/GardenerProject><img src=/images/branding/x-logo-white.svg class=media-icon><div class=media-text>X</div></a></li></ul><span class=copyright>Copyright 2019-2025 Gardener project authors.
<a href=https://www.sap.com/about/legal/terms-of-use.html>Terms of Use
<i class="fa fa-external-link" aria-hidden=true></i>
</a>|
<a href=https://www.sap.com/about/legal/terms-of-use.html>Privacy Statement
<i class="fa fa-external-link" aria-hidden=true></i>
</a>|
<a href=https://www.sap.com/about/legal/terms-of-use.html>Legal Disclosure
<i class="fa fa-external-link" aria-hidden=true></i></a></span></div></footer></div><script src=/js/main.min.403ff095218c662472dab60ed98ecbb19431682de5ac7c6159891241cd366af5.js integrity="sha256-QD/wlSGMZiRy2rYO2Y7LsZQxaC3lrHxhWYkSQc02avU=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script><script src=/js/navbar.js></script><script src=/js/filtering.js></script><script src=/js/page-content.js></script><script src=/js/community-index.js></script></body></html>