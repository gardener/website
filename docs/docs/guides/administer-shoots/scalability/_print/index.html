<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.95.0"><link rel=canonical type=text/html href=https://gardener.cloud/docs/guides/administer-shoots/scalability/><link rel=alternate type=application/rss+xml href=https://gardener.cloud/docs/guides/administer-shoots/scalability/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Scalability of Gardener Managed Kubernetes Clusters | Gardener</title><meta name=description content="Know the boundary conditions when scaling your workloads"><meta property="og:title" content="Scalability of Gardener Managed Kubernetes Clusters"><meta property="og:description" content="Know the boundary conditions when scaling your workloads"><meta property="og:type" content="website"><meta property="og:url" content="https://gardener.cloud/docs/guides/administer-shoots/scalability/"><meta property="og:image" content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta itemprop=name content="Scalability of Gardener Managed Kubernetes Clusters"><meta itemprop=description content="Know the boundary conditions when scaling your workloads"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gardener.cloud/images/lp/gardener-logo.svg"><meta name=twitter:title content="Scalability of Gardener Managed Kubernetes Clusters"><meta name=twitter:description content="Know the boundary conditions when scaling your workloads"><link rel=preload href=/scss/main.min.b5b806bb2cd9fe9ed809539377398aa9df0eb8ca0c983a6eae0b413d528d8f0e.css as=style><link href=/scss/main.min.b5b806bb2cd9fe9ed809539377398aa9df0eb8ca0c983a6eae0b413d528d8f0e.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg width="90" height="90" viewBox="0 0 90 90" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>logo</title><desc>Created with Sketch.</desc><defs><path d="M41.8864954.994901575c.996545099999999-.479910833 2.6164002-.477918931 3.6088091.0L76.8159138 16.0781121C77.8124589 16.5580229 78.8208647 17.8257185 79.0659694 18.8995926l7.7355517 33.8916663C87.0476474 53.8696088 86.6852538 55.4484075 85.9984855 56.3095876L64.3239514 83.4885938C63.6343208 84.3533632 62.1740175 85.0543973 61.0725268 85.0543973H26.3092731c-1.1060816.0-2.5646564-.704623400000003-3.2514246-1.5658035L1.38331434 56.3095876C.693683723 55.4448182.335174016 53.865133.580278769 52.7912589L8.31583044 18.8995926C8.56195675 17.8212428 9.57347722 16.556031 10.5658861 16.0781121L41.8864954.994901575z" id="path-1"/><linearGradient x1="12.7542673%" y1="-18.6617048%" x2="88.2666158%" y2="84.6075483%" id="linearGradient-3"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="50%" y1="4.93673768%" x2="148.756007%" y2="175.514523%" id="linearGradient-4"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="19.1574381%" y1="-9.04800713%" x2="82.2203149%" y2="77.9084293%" id="linearGradient-5"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient><linearGradient x1="57.4403751%" y1="26.3148481%" x2="137.966711%" y2="158.080556%" id="linearGradient-6"><stop stop-color="#fff" offset="0"/><stop stop-color="#439246" offset="100%"/></linearGradient></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="logo"><g id="Rectangle-2" transform="translate(1.000000, 0.000000)"><mask id="mask-2" fill="#fff"><use xlink:href="#path-1"/></mask><use id="Mask" fill="#009f76" xlink:href="#path-1"/><polygon fill="#000" opacity=".289628623" mask="url(#mask-2)" points="-17.6484375 54.5224609 30.8242188 25.0791016 63.4726562 58.5 24.7324219 92.6689453"/></g><path d="M56.8508631 39.260019C56.4193519 40.443987 55.6088085 41.581593 54.6736295 42.1938694l-8.0738997 5.2861089c-1.3854671.907087099999998-3.6247515.9116711-5.0172201.0L33.50861 42.1938694C32.123143 41.2867823 31 39.206345 31 37.545932V26.4150304c0-.725313.2131118-1.5301454.569268099999999-2.2825772L56.8508631 39.260019z" id="Combined-Shape" fill="url(#linearGradient-3)" transform="translate(43.925432, 36.147233) scale(-1, 1) translate(-43.925432, -36.147233)"/><path d="M56.0774672 25.1412464C56.4306829 25.8903325 56.6425556 26.6907345 56.6425556 27.4119019V38.5428034c0 1.6598979-1.1161415 3.73626640000001-2.50861 4.6479374l-8.0738997 5.286109c-1.3854671.907087000000004-3.6247516.911671000000005-5.0172201.0L32.9689261 43.1907408C32.2918101 42.7474223 31.6773514 42.0238435 31.2260376 41.206007L56.0774672 25.1412464z" id="Combined-Shape" fill="url(#linearGradient-4)" transform="translate(43.821278, 37.246598) scale(-1, 1) translate(-43.821278, -37.246598)"/><path d="M65.0702134 57.1846889C64.5985426 58.2007851 63.8367404 59.1236871 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.1597438 58.7930183 24 56.7816693 24 55.1323495V37.1145303C24 36.3487436 24.249712 35.5060005 24.6599102 34.7400631L65.0702134 57.1846889z" id="Combined-Shape" fill="url(#linearGradient-5)"/><path d="M65.0189476 34.954538C65.3636909 35.6617313 65.5692194 36.42021 65.5692194 37.1145303V55.1323495C65.5692194 56.7842831 64.4072119 58.7943252 62.9788591 59.6189851L47.37497 68.6278947c-1.4306165.825966800000003-3.75236779999999.8246599-5.1807206.0L26.5903603 59.6189851C25.9237304 59.2341061 25.3159155 58.5918431 24.8568495 57.8487596L65.0189476 34.954538z" id="Combined-Shape" fill="url(#linearGradient-6)"/></g></g></svg></span><span class=text-capitalize>Gardener</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/adopter><span>Adopters</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog><span>Blogs</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community><span>Community</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.7c0edea64639f9e42a10d8e751f32ec2.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/guides/administer-shoots/scalability/>Return to the regular view of this page</a>.</p></div><h1 class=title>Scalability of Gardener Managed Kubernetes Clusters</h1><div class=lead>Know the boundary conditions when scaling your workloads</div><div class=content><p>Have you ever wondered how much more your Kubernetes cluster can scale before it breaks down?</p><p>Of course, the answer is heavily dependent on your workloads. But be assured, any cluster will break eventually. Therefore, the best mitigation is to plan for sharding early and run multiple clusters instead of trying to optimize everything hoping to survive with a single cluster.
Still, it is helpful to know when the time has come to scale out. This document aims at giving you the basic knowledge to keep a Gardener-managed Kubernetes cluster up and running while it scales according to your needs.</p><h2 id=welcome-to-planet-scale-please-mind-the-gap>Welcome to Planet Scale, Please Mind the Gap!</h2><p>For a complex, distributed system like Kubernetes it is impossible to give absolute thresholds for its scalability. Instead, the limit of a cluster&rsquo;s scalability is a combination of various, interconnected dimensions.</p><p>Let&rsquo;s take a rather simple example of two dimensions - the number of <code>Pods</code> per <code>Node</code> and number of <code>Nodes</code> in a cluster. According to the <a href=https://github.com/kubernetes/community/blob/master/sig-scalability/configs-and-limits/thresholds.md>scalability thresholds documentation</a>, Kubernetes can scale up to 5000 <code>Nodes</code> and with default settings accommodate a maximum of 110 <code>Pods</code> on a single <code>Node</code>. Pushing only a single dimension towards its limit will likely harm the cluster. But if both are pushed simultaneously, any cluster will break way before reaching one dimension&rsquo;s limit.</p><p><img src=/__resources/pod-nodes_60dd32.png alt="Pods and Nodes"></p><p>What sounds rather straightforward in theory can be a bit trickier in reality. While 110 <code>Pods</code> is the default limit, we successfully pushed beyond that and in certain cases run up to 200 <code>Pods</code> per <code>Node</code> without breaking the cluster. This is possible in an environment where one knows and controls all workloads and cluster configurations. It still requires careful testing, though, and comes at the cost of limiting the scalability of other dimensions, like the number of <code>Nodes</code>.</p><p>Of course, a Kubernetes cluster has a plethora of dimensions. Thus, when looking at a simple questions like <em>&ldquo;How many resources can I store in ETCD?&rdquo;</em>, the only meaningful answer must be: <em>&ldquo;it depends&rdquo;</em></p><p>The following sections will help you to identify relevant dimensions and how they affect a Gardener-managed Kubernetes cluster&rsquo;s scalability.</p><h2 id=official-kubernetes-thresholds-and-scalability-considerations>&ldquo;Official&rdquo; Kubernetes Thresholds and Scalability Considerations</h2><p>To get started with the topic, please check the basic guidance provided by the Kubernetes community (specifically SIG Scalability):</p><ul><li><a href=https://github.com/kubernetes/community/blob/master/sig-scalability/slos/slos.md#how-we-define-scalability>How we define scalability?</a></li><li><a href=https://github.com/kubernetes/community/blob/master/sig-scalability/configs-and-limits/thresholds.md>Kubernetes Scalability Thresholds</a></li></ul><p>Furthermore, the problem space has been discussed in a <a href="https://www.youtube.com/watch?v=t_Ww6ELKl4Q">KubeCon talk</a>, the slides for which can be found <a href=https://docs.google.com/presentation/d/1aWjxpY4YJ4KJQUTqaVHdR4sbhwqDiW30EF4_hGCc-gI>here</a>. You should at least read the slides before continuing.</p><p>Essentially, it comes down to this:</p><blockquote><p>If you promise to:</p><ul><li>correctly configure your cluster</li><li>use extensibility features &ldquo;reasonably&rdquo;</li><li>keep the load in the cluster within recommended limits</li></ul><p>Then we promise that your cluster will function properly.</p></blockquote><p>With that knowledge in mind, let&rsquo;s look at Gardener and eventually pick up the question about the number of objects in ETCD raised above.</p><h2 id=gardener-specific-considerations>Gardener-Specific Considerations</h2><p>The following considerations are based on experience with various large clusters that scaled in different dimensions. Just as explained above, pushing beyond even one of the limits is likely to cause issues at some point in time (but not guaranteed). Depending on the setup of your workloads however, it might work unexpectedly well. Nevertheless, we urge you take conscious decisions and rather think about sharding your workloads. Please keep in mind - your workload affects the overall stability and scalability of a cluster significantly.</p><h3 id=etcd>ETCD</h3><p><strong>The following section is based on a setup where ETCD <code>Pods</code> run on a dedicated <code>Node</code> pool and each <code>Node</code> has 8 vCPU and 32GB memory at least.</strong></p><p>ETCD has a practical space limit of 8 GB. It caps the number of objects one can technically have in a Kubernetes cluster.</p><p>Of course, the number is heavily influenced by each object&rsquo;s size, especially when considering that secrets and configmaps may store up to 1MB of data. Another dimension is a cluster&rsquo;s churn rate. Since ETCD stores a history of the keyspace, a higher churn rate reduces the number of objects. Gardener runs <a href=https://etcd.io/docs/v3.4/op-guide/maintenance/#history-compaction>compaction</a> every 30min and <a href=https://etcd.io/docs/v3.4/op-guide/maintenance/#defragmentation>defragmentation</a> once per day during a cluster&rsquo;s maintenance window to ensure proper ETCD operations. However, it is still possible to overload ETCD. If the space limit is reached, ETCD will only accept <code>READ</code> or <code>DELETE</code> requests and manual interaction by a Gardener operator is needed to disarm the alarm, once you got below the threshold.</p><p>To avoid such a situation, you can monitor the current ETCD usage via the &ldquo;ETCD&rdquo; dashboard of the monitoring stack. It gives you the current DB size, as well as historical data for the past 2 weeks. While there are improvements planned to trigger compaction and defragmentation based on DB size, an ETCD should not grow up to this threshold. A typical, healthy DB size is less than 3 GB.</p><p>Furthermore, the dashboard has a panel called &ldquo;Memory&rdquo;, which indicates the memory usage of the etcd pod(s). Using more than 16GB memory is a clear red flag, and you should reduce the load on ETCD.</p><p>Another dimension you should be aware of is the object count in ETCD. You can check it via the &ldquo;API Server&rdquo; dashboard, which features a &ldquo;ETCD Object Counts By Resource&rdquo; panel. The overall number of objects (excluding <code>events</code>, as they are stored in a different etcd instance) should not exceed 100k for most use cases.</p><h3 id=kube-api-server>Kube API Server</h3><p><strong>The following section is based on a setup where <code>kube-apiserver</code> run as <code>Pods</code> and are scheduled to <code>Nodes</code> with at least 8 vCPU and 32GB memory.</strong></p><p>Gardener can scale the <code>Deployment</code> of a <code>kube-apiserver</code> horizontally and vertically. Horizontal scaling is limited to a certain number of replicas and should not concern a stakeholder much. However, the CPU / memory consumption of an individual <code>kube-apiserver</code> pod poses a potential threat to the overall availability of your cluster. The vertical scaling of any <code>kube-apiserver</code> is limited by the amount of resources available on a single <code>Node</code>. Outgrowing the resources of a <code>Node</code> will cause a downtime and render the cluster unavailable.</p><p>In general, continuous CPU usage of up to 3 cores and 16 GB memory per <code>kube-apiserver</code> pod is considered to be safe. This gives some room to absorb spikes, for example when the caches are initialized. You can check the resource consumption by selecting <code>kube-apiserver</code> <code>Pods</code> in the &ldquo;Kubernetes <code>Pods</code>&rdquo; dashboard. If these boundaries are exceeded constantly, you need to investigate and derive measures to lower the load.</p><p>Further information is also recorded and made available through the monitoring stack. The dashboard &ldquo;API Server Request Duration and Response Size&rdquo; provides insights into the request processing time of <code>kube-apiserver</code> <code>Pods</code>. Related information like request rates, dropped requests or termination codes (e.g., <code>429</code> for too many requests) can be obtained from the dashboards &ldquo;API Server&rdquo; and &ldquo;Kubernetes API Server Details&rdquo;. They provide a good indicator for how well the system is dealing with its current load.</p><p>Reducing the load on the API servers can become a challenge. To get started, you may try to:</p><ul><li>Use immutable <a href=https://kubernetes.io/docs/concepts/configuration/secret/#secret-immutable>secrets</a> and <a href=https://kubernetes.io/docs/concepts/configuration/configmap/#configmap-immutable>configmaps</a> where possible to save watches. This pays off, especially when you have a high number of <code>Nodes</code> or just lots of secrets in general.</li><li>Applications interacting with the K8s API: If you know an object by its name, use it. Using label selector queries is expensive, as the filtering happens only within the <code>kube-apiserver</code> and not <code>etcd</code>, hence all resources must first pass completely from <code>etcd</code> to <code>kube-apiserver</code>.</li><li>Use (single object) caches within your controllers. Check the <a href=https://github.com/gardener/gardener/issues/7593>&ldquo;Use cache for ShootStates in Gardenlet&rdquo; issue</a> for an example.</li></ul><h3 id=nodes><code>Nodes</code></h3><p>When talking about the scalability of a Kubernetes cluster, <code>Nodes</code> are probably mentioned in the first place&mldr; well, obviously not in this guide. While vanilla Kubernetes lists 5000 <code>Nodes</code> as its upper limit, pushing that dimension is not feasible. Most clusters should run with fewer than 300 <code>Nodes</code>. But of course, the actual limit depends on the workloads deployed and can be lower or higher. As you scale your cluster, be extra careful and closely monitor ETCD and <code>kube-apiserver</code>.</p><p>The scalability of <code>Nodes</code> is subject to a range of limiting factors. Some of them can only be defined upon cluster creation and remain immutable during a cluster lifetime. So let&rsquo;s discuss the most important dimensions.</p><p><strong>CIDR</strong>:</p><p>Upon cluster creation, you have to specify or use the default values for several network segments. There are dedicated CIDRs for services, <code>Pods</code>, and <code>Nodes</code>. Each defines a range of IP addresses available for the individual resource type. Obviously, the maximum of possible <code>Nodes</code> is capped by the CIDR for <code>Nodes</code>.
However, there is a second limiting factor, which is the pod CIDR combined with the <code>nodeCIDRMaskSize</code>. This mask is used to divide the pod CIDR into smaller subnets, where each blocks gets assigned to a node. With a <code>/16</code> pod network and a <code>/24</code> nodeCIDRMaskSize, a cluster can scale up to 256 <code>Nodes</code>. Please check <a href=https://github.com/gardener/gardener/blob/master/docs/usage/shoot_networking.md>Shoot Networking</a> for details.</p><p>Even though a <code>/24</code> nodeCIDRMaskSize translates to a theoretical 256 pod IP addresses per <code>Node</code>, the <code>maxPods</code> setting should be less than 1/2 of this value. This gives the system some breathing room for churn and minimizes the risk for strange effects like mis-routed packages caused by immediate re-use of IPs.</p><p><strong>Cloud provider capacity</strong>:</p><p>Most of the time, <code>Nodes</code> in Kubernetes translate to virtual machines on a hyperscaler. An attempt to add more <code>Nodes</code> to a cluster might fail due to capacity issues resulting in an error message like this:</p><pre tabindex=0><code>Cloud provider message - machine codes error: code = [Internal] message = [InsufficientInstanceCapacity: We currently do not have sufficient &lt;instance type&gt; capacity in the Availability Zone you requested. Our system will be working on provisioning additional capacity. 
</code></pre><p>In heavily utilized regions, individual clusters are competing for scarce resources. So before choosing a region / zone, try to ensure that the hyperscaler supports your anticipated growth. This might be done through quota requests or by contacting the respective support teams.
To mitigate such a situation, you may configure a worker pool with a different <code>Node</code> type and a corresponding <a href=https://github.com/gardener/autoscaler/blob/machine-controller-manager-provider/cluster-autoscaler/expander/priority/readme.md>priority expander</a> as part of a <a href=https://github.com/gardener/gardener/blob/master/docs/api-reference/core.md#clusterautoscaler>shoot&rsquo;s autoscaler section</a>. Please consult the <a href=https://github.com/gardener/autoscaler/blob/machine-controller-manager-provider/cluster-autoscaler/FAQ.md#what-are-expanders>Autoscaler FAQ</a> for more details.</p><p><strong>Rolling of <code>Node</code> pools</strong>:</p><p>The overall number of <code>Nodes</code> is affecting the duration of a cluster&rsquo;s maintenance. When upgrading a <code>Node</code> pool to a new OS image or Kubernetes version, all machines will be drained and deleted, and replaced with new ones. The more <code>Nodes</code> a cluster has, the longer this process will take, given that workloads are typically protected by <code>PodDisruptionBudgets</code>. Check <a href=https://github.com/gardener/gardener/blob/master/docs/usage/shoot_updates.md>Shoot Updates and Upgrades</a> for details. Be sure to take this into consideration when planning maintenance.</p><p><strong>Root disk</strong>:</p><p>You should be aware that the <code>Node</code> configuration impacts your workload&rsquo;s performance too. Take the root disk of a <code>Node</code>, for example. While most hyperscalers offer the usage of HDD and SSD disks, it is strongly recommended to use SSD volumes as root disks. When there are lots of <code>Pods</code> on a <code>Node</code> or workloads making extensive use of <code>emptyDir</code> volumes, disk throttling becomes an issue. When a disk hits its IOPS limits, processes are stuck in IO-wait and slow down significantly. This can lead to a slow-down in the kubelet&rsquo;s heartbeat mechanism and result in <code>Nodes</code> being replaced automatically, as they appear to be unhealthy. To analyze such a situation, you might have to run tools like <code>iostat</code>, <code>sar</code> or <code>top</code> directly on a <code>Node</code>.</p><p>Switching to an I/O optimized instance type (if offered for your infrastructure) can help to resolve issue. Please keep in mind that disks used via <code>PersistentVolumeClaims</code> have I/O limits as well. Sometimes these limits are related to the size and/or can be increased for individual disks.</p><h3 id=cloud-provider-infrastructure-limits>Cloud Provider (Infrastructure) Limits</h3><p>In addition to the already mentioned capacity restrictions, a cloud provider may impose other limitations to a Kubernetes cluster&rsquo;s scalability. One category is the account quota defining the number of resources allowed globally or per region. Make sure to request appropriate values that suit your needs and contain a buffer, for example for having more <code>Nodes</code> during a rolling update.</p><p>Another dimension is the network throughput per VM or network interface. While you may be able to choose a network-optimized <code>Node</code> type for your workload to mitigate issues, you cannot influence the available bandwidth for control plane components. Therefore, please ensure that the traffic on the ETCD does not exceed 100MB/s. The ETCD dashboard provides data for monitoring this metric.</p><p>In some environments the upstream DNS might become an issue too and make your workloads subject to rate limiting. Given the heterogeneity of cloud providers incl. private data centers, it is not possible to give any thresholds. Still, the &ldquo;CoreDNS&rdquo; and &ldquo;NodeLocalDNS&rdquo; dashboards can help to derive a workload&rsquo;s usage pattern. Check the <a href=https://github.com/gardener/gardener/blob/master/docs/usage/dns-autoscaling.md>DNS autoscaling</a> and <a href=https://github.com/gardener/gardener/blob/master/docs/usage/node-local-dns.md>NodeLocalDNS</a> documentations for available configuration options.</p><h3 id=webhooks>Webhooks</h3><p>While webhooks provide powerful means to manage a cluster, they are equally powerful in breaking a cluster upon a malfunction or unavailability. Imagine using a policy enforcing system like <a href=https://kyverno.io/docs/>Kyverno</a> or <a href=https://open-policy-agent.github.io/gatekeeper/website/docs/>Open Policy Agent Gatekeeper</a>. As part of the stack, both will deploy webhooks which are invoked for almost everything that happens in a cluster. Now, if this webhook gets either overloaded or is simply not available, the cluster will stop functioning properly.</p><p>Hence, you have to ensure proper sizing, quick processing time, and availability of the webhook serving <code>Pods</code> when deploying webhooks. Please consult Dynamic Admission Control (<a href=https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#availability>Availability</a> and <a href=https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#timeouts>Timeouts</a> sections) for details. You should also be aware of the time added to any request that has to go through a webhook, as the <code>kube-apiserver</code> sends the request for mutation / validation to another pod and waits for the response. The more resources being subject to an external webhook, the more likely this will become a bottleneck when having a high churn rate on resources. Within the Gardener monitoring stack, you can check the extra time per webhook via the &ldquo;API Server (Admission Details)&rdquo; dashboard, which has a panel for &ldquo;Duration per Webhook&rdquo;.</p><p>In Gardener, any webhook timeout should be less than 15 seconds. Due to the separation of Kubernetes data-plane (shoot) and control-plane (seed) in Gardener, the extra hop from <code>kube-apiserver</code> (control-plane) to webhook (data-plane) is more expensive. Please check <a href=https://github.com/gardener/gardener/blob/master/docs/usage/shoot_status.md>Shoot Status</a> for more details.</p><h3 id=custom-resource-definitions>Custom Resource Definitions</h3><p>Using Custom Resource Definitions (CRD) to extend a cluster&rsquo;s API is a common Kubernetes pattern and so is writing an operator to act upon custom resources. Writing an efficient controller reduces the load on the <code>kube-apiserver</code> and allows for better scaling. As a starting point, you might want to read Gardener&rsquo;s <a href=https://github.com/gardener/gardener/blob/master/docs/development/kubernetes-clients.md>Kubernetes Clients Guide</a>.</p><p>Another problematic dimension is the usage of <a href=https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definition-versioning/#webhook-conversion>conversion webhooks</a> when having resources stored in different versions. Not only do they add latency (see <a href=/docs/guides/administer-shoots/scalability/#webhooks>Webhooks</a>) but can also block the kube-controllermanager&rsquo;s garbage collection. If a conversion webhook is unavailable, the garbage collector fails to list all resources and does not perform any cleanup. In order to avoid such a situation, it is highly recommended to use conversion webhooks only when necessary and complete the migration to a new version as soon as possible.</p><h2 id=conclusion>Conclusion</h2><p>As outlined by SIG Scalability, it is quite impossible to give limits or even recommendations fitting every individual use case. Instead, this guide outlines relevant dimensions and gives rather conservative recommendations based on usage patterns observed. By combining this information, it is possible to operate and scale a cluster in stable manner.</p><p>While going beyond is certainly possible for some dimensions, it significantly increases the risk of instability. Typically, limits on the control-plane are introduced by the availability of resources like CPU or memory on a single machine and can hardly be influenced by any user. Therefore, utilizing the existing resources efficiently is key. Other parameters are controlled by a user. In these cases, careful testing may reveal actual limits for a specific use case.</p><p>Please keep in mind that all aspects of a workload greatly influence the stability and scalability of a Kubernetes cluster.</p></div></div></main></div></div><footer class="footer row d-print-none"><div class="container-fluid footer-wrapper"><ul class=nav><li><a href=https://gardener.cloud/blog/>Blogs</a></li><li><a href=https://gardener.cloud/community/>Community</a></li><li><a href=https://gardener.cloud/adopter/>Adopters</a></li><li><a href=/docs/>Documentation</a></li></ul><img src=/images/lp/gardener-logo.svg alt="Logo Gardener" class=logo><ul class=media-wr><li><a target=_blank href=https://kubernetes.slack.com/archives/CB57N0BFG><img src=/images/branding/slack-logo-white.svg class=media-icon><div class=media-text>Slack</div></a></li><li><a target=_blank href=https://github.com/gardener><img src=/images/branding/github-mark-logo.png class=media-icon><div class=media-text>GitHub</div></a></li><li><a target=_blank href=https://www.youtube.com/channel/UCwUhwKFREV8Su0gwAJQX7tw><img src=/images/branding/youtube-logo-dark.svg class=media-icon><div class=media-text>YouTube</div></a></li><li><a target=_blank href=https://twitter.com/GardenerProject><img src=/images/branding/twitter-logo-white.svg class=media-icon><div class=media-text>Twitter</div></a></li></ul><span class=copyright>Copyright 2019-2023 Gardener project authors. <a href=https://www.sap.com/corporate/en/legal/privacy.html>Privacy policy
<i class="fa fa-external-link" aria-hidden=true></i></a></span></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid@8.13.4/dist/mermaid.min.js integrity="sha512-JERecFUBbsm75UpkVheAuDOE8NdHjQBrPACfEQYPwvPG+fjgCpHAz1Jw2ci9EXmd3DdfiWth3O3CQvcfEg8gsA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.7b24c0fb082ffb2de6cb14d6c95e9f8053053709ffcf8c761ef8e9ad2f8021e4.js integrity="sha256-eyTA+wgv+y3myxTWyV6fgFMFNwn/z4x2HvjprS+AIeQ=" crossorigin=anonymous></script></body></html>